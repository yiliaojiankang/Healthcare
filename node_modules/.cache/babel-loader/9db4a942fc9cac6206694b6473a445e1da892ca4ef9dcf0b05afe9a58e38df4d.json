{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Action, Util } from '@antv/g2';\nimport { each, get } from '@antv/util';\nimport { renderStatistic } from '../../../../utils/statistic';\nimport { getCurrentElement } from '../util';\n/**\n * Pie 中心文本事件的 Action\n */\nvar StatisticAction = /** @class */function (_super) {\n  __extends(StatisticAction, _super);\n  function StatisticAction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  StatisticAction.prototype.getAnnotations = function (_view) {\n    var view = _view || this.context.view;\n    // @ts-ignore\n    return view.getController('annotation').option;\n  };\n  StatisticAction.prototype.getInitialAnnotation = function () {\n    return this.initialAnnotation;\n  };\n  StatisticAction.prototype.init = function () {\n    var _this = this;\n    var view = this.context.view;\n    view.removeInteraction('tooltip');\n    view.on('afterchangesize', function () {\n      var annotations = _this.getAnnotations(view);\n      _this.initialAnnotation = annotations;\n    });\n  };\n  StatisticAction.prototype.change = function (arg) {\n    var _a = this.context,\n      view = _a.view,\n      event = _a.event;\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = this.getAnnotations();\n    }\n    var data = get(event, ['data', 'data']);\n    if (event.type.match('legend-item')) {\n      var delegateObject = Util.getDelegationObject(this.context);\n      // @ts-ignore\n      var colorField_1 = view.getGroupedFields()[0];\n      if (delegateObject && colorField_1) {\n        var item_1 = delegateObject.item;\n        data = view.getData().find(function (d) {\n          return d[colorField_1] === item_1.value;\n        });\n      }\n    }\n    if (data) {\n      var annotations = get(arg, 'annotations', []);\n      var statistic = get(arg, 'statistic', {});\n      // 先清空标注，再重新渲染\n      view.getController('annotation').clear(true);\n      // 先进行其他 annotations，再去渲染统计文本\n      each(annotations, function (annotation) {\n        if (typeof annotation === 'object') {\n          view.annotation()[annotation.type](annotation);\n        }\n      });\n      renderStatistic(view, {\n        statistic: statistic,\n        plotType: 'pie'\n      }, data);\n      view.render(true);\n    }\n    // 交互的时候，把 shape 提前\n    var ele = getCurrentElement(this.context);\n    if (ele) {\n      ele.shape.toFront();\n    }\n  };\n  StatisticAction.prototype.reset = function () {\n    var view = this.context.view;\n    var annotationController = view.getController('annotation');\n    annotationController.clear(true);\n    var initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, function (a) {\n      view.annotation()[a.type](a);\n    });\n    view.render(true);\n  };\n  return StatisticAction;\n}(Action);\nexport { StatisticAction };","map":{"version":3,"names":["Action","Util","each","get","renderStatistic","getCurrentElement","StatisticAction","_super","__extends","prototype","getAnnotations","_view","view","context","getController","option","getInitialAnnotation","initialAnnotation","init","_this","removeInteraction","on","annotations","change","arg","_a","event","data","type","match","delegateObject","getDelegationObject","colorField_1","getGroupedFields","item_1","item","getData","find","d","value","statistic","clear","annotation","plotType","render","ele","shape","toFront","reset","annotationController","initialStatistic","a"],"sources":["../../../../../src/plots/pie/interactions/actions/statistic-active.ts"],"sourcesContent":["import { Action, Types, Util, View } from '@antv/g2';\nimport { each, get } from '@antv/util';\nimport { Annotation } from '../../../../types/annotation';\nimport { renderStatistic } from '../../../../utils/statistic';\nimport { PieOptions } from '../../types';\nimport { getCurrentElement } from '../util';\n\n/**\n * Pie 中心文本事件的 Action\n */\nexport class StatisticAction extends Action {\n  private initialAnnotation;\n\n  private getAnnotations(_view?: View): object[] {\n    const view = _view || this.context.view;\n    // @ts-ignore\n    return view.getController('annotation').option;\n  }\n\n  private getInitialAnnotation(): Types.ComponentOption[] | null {\n    return this.initialAnnotation;\n  }\n\n  init() {\n    const { view } = this.context;\n    view.removeInteraction('tooltip');\n\n    view.on('afterchangesize', () => {\n      const annotations = this.getAnnotations(view);\n      this.initialAnnotation = annotations;\n    });\n  }\n\n  public change(arg?: Pick<PieOptions, 'annotations' | 'statistic'>) {\n    const { view, event } = this.context;\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = this.getAnnotations();\n    }\n\n    let data = get(event, ['data', 'data']);\n    if (event.type.match('legend-item')) {\n      const delegateObject = Util.getDelegationObject(this.context);\n      // @ts-ignore\n      const colorField = view.getGroupedFields()[0];\n      if (delegateObject && colorField) {\n        const { item } = delegateObject;\n        data = view.getData().find((d) => d[colorField] === item.value);\n      }\n    }\n\n    if (data) {\n      const annotations = get(arg, 'annotations', []);\n      const statistic = get(arg, 'statistic', {});\n      // 先清空标注，再重新渲染\n      view.getController('annotation').clear(true);\n      // 先进行其他 annotations，再去渲染统计文本\n      each(annotations, (annotation: Annotation) => {\n        if (typeof annotation === 'object') {\n          view.annotation()[annotation.type](annotation);\n        }\n      });\n      renderStatistic(view, { statistic, plotType: 'pie' }, data);\n      view.render(true);\n    }\n\n    // 交互的时候，把 shape 提前\n    const ele = getCurrentElement(this.context);\n    if (ele) {\n      ele.shape.toFront();\n    }\n  }\n\n  public reset() {\n    const { view } = this.context;\n    const annotationController = view.getController('annotation');\n    annotationController.clear(true);\n    const initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, (a) => {\n      view.annotation()[a.type](a);\n    });\n    view.render(true);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
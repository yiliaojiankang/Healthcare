{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __assign, __read, __spreadArray } from \"tslib\";\nimport { each, isNil, some } from '@antv/util';\nimport { getCoordinate } from '../../dependents';\n/**\n * coordinate controller，职责：\n * 1. 创建实例\n * 2. 暂存配置\n */\nvar CoordinateController = /** @class */function () {\n  function CoordinateController(option) {\n    // 设置默认值，并存储配置\n    this.option = this.wrapperOption(option);\n  }\n  /**\n   * 更新配置\n   * @param option\n   */\n  CoordinateController.prototype.update = function (option) {\n    this.option = this.wrapperOption(option);\n    return this;\n  };\n  /**\n   * 是否存在某一个 action\n   * @param actionName\n   */\n  CoordinateController.prototype.hasAction = function (actionName) {\n    var actions = this.option.actions;\n    return some(actions, function (action) {\n      return action[0] === actionName;\n    });\n  };\n  /**\n   * 创建坐标系对象\n   * @param start 起始位置\n   * @param end   结束位置\n   * @return 坐标系实例\n   */\n  CoordinateController.prototype.create = function (start, end) {\n    var _a = this.option,\n      type = _a.type,\n      cfg = _a.cfg;\n    var isTheta = type === 'theta';\n    // 1. 起始位置\n    var props = __assign({\n      start: start,\n      end: end\n    }, cfg);\n    // 2. 创建实例\n    var C = getCoordinate(isTheta ? 'polar' : type);\n    this.coordinate = new C(props);\n    // @ts-ignore FIXME coordinate 包问题导致 type 不正确\n    this.coordinate.type = type;\n    // 3. 添加默认 action\n    if (isTheta) {\n      // 不存在 transpose，为其自动设置一个 action\n      if (!this.hasAction('transpose')) {\n        this.transpose();\n      }\n    }\n    // 4. 执行 action\n    this.execActions();\n    return this.coordinate;\n  };\n  /**\n   * 更新坐标系对象\n   * @param start 起始位置\n   * @param end   结束位置\n   * @return 坐标系实例\n   */\n  CoordinateController.prototype.adjust = function (start, end) {\n    this.coordinate.update({\n      start: start,\n      end: end\n    });\n    // 更新坐标系大小的时候，需要：\n    // 1. 重置 matrix\n    // 2. 重新执行作用于 matrix 的 action\n    this.coordinate.resetMatrix();\n    this.execActions(['scale', 'rotate', 'translate']);\n    return this.coordinate;\n  };\n  /**\n   * 旋转弧度\n   * @param angle\n   */\n  CoordinateController.prototype.rotate = function (angle) {\n    this.option.actions.push(['rotate', angle]);\n    return this;\n  };\n  /**\n   * 镜像\n   * @param dim\n   */\n  CoordinateController.prototype.reflect = function (dim) {\n    this.option.actions.push(['reflect', dim]);\n    return this;\n  };\n  /**\n   * scale\n   * @param sx\n   * @param sy\n   */\n  CoordinateController.prototype.scale = function (sx, sy) {\n    this.option.actions.push(['scale', sx, sy]);\n    return this;\n  };\n  /**\n   * 对角变换\n   */\n  CoordinateController.prototype.transpose = function () {\n    this.option.actions.push(['transpose']);\n    return this;\n  };\n  /**\n   * 获取配置\n   */\n  CoordinateController.prototype.getOption = function () {\n    return this.option;\n  };\n  /**\n   * 获得 coordinate 实例\n   */\n  CoordinateController.prototype.getCoordinate = function () {\n    return this.coordinate;\n  };\n  /**\n   * 包装配置的默认值\n   * @param option\n   */\n  CoordinateController.prototype.wrapperOption = function (option) {\n    return __assign({\n      type: 'rect',\n      actions: [],\n      cfg: {}\n    }, option);\n  };\n  /**\n   * coordinate 实例执行 actions\n   * @params includeActions 如果没有指定，则执行全部，否则，执行指定的 action\n   */\n  CoordinateController.prototype.execActions = function (includeActions) {\n    var _this = this;\n    var actions = this.option.actions;\n    each(actions, function (action) {\n      var _a;\n      var _b = __read(action),\n        actionName = _b[0],\n        args = _b.slice(1);\n      var shouldExec = isNil(includeActions) ? true : includeActions.includes(actionName);\n      if (shouldExec) {\n        (_a = _this.coordinate)[actionName].apply(_a, __spreadArray([], __read(args), false));\n      }\n    });\n  };\n  return CoordinateController;\n}();\nexport default CoordinateController;","map":{"version":3,"names":["each","isNil","some","getCoordinate","CoordinateController","option","wrapperOption","prototype","update","hasAction","actionName","actions","action","create","start","end","_a","type","cfg","isTheta","props","__assign","C","coordinate","transpose","execActions","adjust","resetMatrix","rotate","angle","push","reflect","dim","scale","sx","sy","getOption","includeActions","_this","_b","__read","args","slice","shouldExec","includes","apply","__spreadArray"],"sources":["../../../src/chart/controller/coordinate.ts"],"sourcesContent":["import { each, isNil, some } from '@antv/util';\nimport { Coordinate, getCoordinate, Point } from '../../dependents';\nimport { CoordinateOption } from '../../interface';\n\n/**\n * coordinate controller，职责：\n * 1. 创建实例\n * 2. 暂存配置\n */\nexport default class CoordinateController {\n  private option: CoordinateOption;\n  private coordinate: Coordinate;\n\n  constructor(option?: CoordinateOption) {\n    // 设置默认值，并存储配置\n    this.option = this.wrapperOption(option);\n  }\n\n  /**\n   * 更新配置\n   * @param option\n   */\n  public update(option: CoordinateOption) {\n    this.option = this.wrapperOption(option);\n    return this;\n  }\n\n  /**\n   * 是否存在某一个 action\n   * @param actionName\n   */\n  public hasAction(actionName: string) {\n    const { actions } = this.option;\n\n    return some(actions, (action) => action[0] === actionName);\n  }\n  /**\n   * 创建坐标系对象\n   * @param start 起始位置\n   * @param end   结束位置\n   * @return 坐标系实例\n   */\n  public create(start: Point, end: Point) {\n    const { type, cfg } = this.option;\n    const isTheta = type === 'theta';\n\n    // 1. 起始位置\n    const props = {\n      start,\n      end,\n      ...cfg,\n    };\n\n    // 2. 创建实例\n    const C = getCoordinate(isTheta ? 'polar' : type);\n\n    this.coordinate = new C(props);\n\n    // @ts-ignore FIXME coordinate 包问题导致 type 不正确\n    this.coordinate.type = type;\n\n    // 3. 添加默认 action\n    if (isTheta) {\n      // 不存在 transpose，为其自动设置一个 action\n      if (!this.hasAction('transpose')) {\n        this.transpose();\n      }\n    }\n\n    // 4. 执行 action\n    this.execActions();\n\n    return this.coordinate;\n  }\n\n  /**\n   * 更新坐标系对象\n   * @param start 起始位置\n   * @param end   结束位置\n   * @return 坐标系实例\n   */\n  public adjust(start: Point, end: Point) {\n    this.coordinate.update({\n      start,\n      end,\n    });\n\n    // 更新坐标系大小的时候，需要：\n    // 1. 重置 matrix\n    // 2. 重新执行作用于 matrix 的 action\n    this.coordinate.resetMatrix();\n    this.execActions(['scale', 'rotate', 'translate']);\n\n    return this.coordinate;\n  }\n\n  /**\n   * 旋转弧度\n   * @param angle\n   */\n  public rotate(angle: number) {\n    this.option.actions.push(['rotate', angle]);\n    return this;\n  }\n\n  /**\n   * 镜像\n   * @param dim\n   */\n  public reflect(dim: 'x' | 'y') {\n    this.option.actions.push(['reflect', dim]);\n    return this;\n  }\n\n  /**\n   * scale\n   * @param sx\n   * @param sy\n   */\n  public scale(sx: number, sy: number) {\n    this.option.actions.push(['scale', sx, sy]);\n    return this;\n  }\n\n  /**\n   * 对角变换\n   */\n  public transpose() {\n    this.option.actions.push(['transpose']);\n    return this;\n  }\n\n  /**\n   * 获取配置\n   */\n  public getOption(): CoordinateOption {\n    return this.option;\n  }\n\n  /**\n   * 获得 coordinate 实例\n   */\n  public getCoordinate() {\n    return this.coordinate;\n  }\n\n  /**\n   * 包装配置的默认值\n   * @param option\n   */\n  private wrapperOption(option: CoordinateOption): CoordinateOption {\n    return {\n      type: 'rect',\n      actions: [],\n      cfg: {},\n      ...option,\n    };\n  }\n\n  /**\n   * coordinate 实例执行 actions\n   * @params includeActions 如果没有指定，则执行全部，否则，执行指定的 action\n   */\n  private execActions(includeActions?: string[]) {\n    const { actions } = this.option;\n\n    each(actions, (action) => {\n      const [actionName, ...args] = action;\n\n      const shouldExec = isNil(includeActions) ? true : includeActions.includes(actionName);\n\n      if (shouldExec) {\n        this.coordinate[actionName](...args);\n      }\n    });\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
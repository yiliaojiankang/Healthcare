{"ast":null,"code":"import { mod, toRadian } from '@antv/util';\n// 向量长度\nfunction vMag(v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n}\n// u.v/|u||v|，计算夹角的余弦值\nfunction vRatio(u, v) {\n  // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n  return vMag(u) * vMag(v) ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v)) : 1;\n}\n// 向量角度\nfunction vAngle(u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n}\n/**\n * 判断两个点是否重合，点坐标的格式为 [x, y]\n * @param {Array} point1 第一个点\n * @param {Array} point2 第二个点\n */\nexport function isSamePoint(point1, point2) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\n// A 0:rx 1:ry 2:x-axis-rotation 3:large-arc-flag 4:sweep-flag 5: x 6: y\nexport default function getArcParams(startPoint, params) {\n  var rx = params[1];\n  var ry = params[2];\n  var xRotation = mod(toRadian(params[3]), Math.PI * 2);\n  var arcFlag = params[4];\n  var sweepFlag = params[5];\n  // 弧形起点坐标\n  var x1 = startPoint[0];\n  var y1 = startPoint[1];\n  // 弧形终点坐标\n  var x2 = params[6];\n  var y2 = params[7];\n  var xp = Math.cos(xRotation) * (x1 - x2) / 2.0 + Math.sin(xRotation) * (y1 - y2) / 2.0;\n  var yp = -1 * Math.sin(xRotation) * (x1 - x2) / 2.0 + Math.cos(xRotation) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n  var diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n  var f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n  if (arcFlag === sweepFlag) {\n    f *= -1;\n  }\n  if (isNaN(f)) {\n    f = 0;\n  }\n  // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n  var cxp = ry ? f * rx * yp / ry : 0;\n  var cyp = rx ? f * -ry * xp / rx : 0;\n  // 椭圆圆心坐标\n  var cx = (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n  var cy = (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp;\n  // 起始点的单位向量\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n  // 终止点的单位向量\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n  // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n  var theta = vAngle([1, 0], u);\n  // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n  var dTheta = vAngle(u, v);\n  if (vRatio(u, v) <= -1) {\n    dTheta = Math.PI;\n  }\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n  if (sweepFlag === 0 && dTheta > 0) {\n    dTheta = dTheta - 2 * Math.PI;\n  }\n  if (sweepFlag === 1 && dTheta < 0) {\n    dTheta = dTheta + 2 * Math.PI;\n  }\n  return {\n    cx: cx,\n    cy: cy,\n    // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n    rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n    ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n    startAngle: theta,\n    endAngle: theta + dTheta,\n    xRotation: xRotation,\n    arcFlag: arcFlag,\n    sweepFlag: sweepFlag\n  };\n}","map":{"version":3,"names":["mod","toRadian","vMag","v","Math","sqrt","vRatio","u","vAngle","acos","isSamePoint","point1","point2","getArcParams","startPoint","params","rx","ry","xRotation","PI","arcFlag","sweepFlag","x1","y1","x2","y2","xp","cos","sin","yp","lambda","diff","f","isNaN","cxp","cyp","cx","cy","theta","dTheta","startAngle","endAngle"],"sources":["../src/get-arc-params.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview random layout\n * @author shiwu.wyy@antfin.com\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ForceLayout = void 0;\nvar d3Force = __importStar(require(\"d3-force\"));\nvar force_in_a_box_1 = __importDefault(require(\"./force-in-a-box\"));\nvar util_1 = require(\"../../util\");\nvar base_1 = require(\"../base\");\nvar constants_1 = require(\"../constants\");\n/**\n * 经典力导布局 force-directed\n */\nvar ForceLayout = /** @class */function (_super) {\n  __extends(ForceLayout, _super);\n  function ForceLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 向心力作用点 */\n    _this.center = [0, 0];\n    /** 节点作用力 */\n    _this.nodeStrength = null;\n    /** 边的作用力, 默认为根据节点的入度出度自适应 */\n    _this.edgeStrength = null;\n    /** 是否防止节点相互覆盖 */\n    _this.preventOverlap = false;\n    /** 聚类节点作用力 */\n    _this.clusterNodeStrength = null;\n    /** 聚类边作用力 */\n    _this.clusterEdgeStrength = null;\n    /** 聚类边长度 */\n    _this.clusterEdgeDistance = null;\n    /** 聚类节点大小 / 直径，直径越大，越分散 */\n    _this.clusterNodeSize = null;\n    /** 用于 foci 的力 */\n    _this.clusterFociStrength = null;\n    /** 默认边长度 */\n    _this.linkDistance = 50;\n    /** 迭代阈值的衰减率 [0, 1]，0.028 对应最大迭代数为 300 */\n    _this.alphaDecay = 0.028;\n    /** 停止迭代的阈值 */\n    _this.alphaMin = 0.001;\n    /** 当前阈值 */\n    _this.alpha = 0.3;\n    /** 防止重叠的力强度 */\n    _this.collideStrength = 1;\n    /** 是否启用web worker。前提是在web worker里执行布局，否则无效\t*/\n    _this.workerEnabled = false;\n    _this.tick = function () {};\n    /** 布局完成回调 */\n    _this.onLayoutEnd = function () {};\n    /** 是否正在布局 */\n    _this.ticking = undefined;\n    if (options) {\n      _this.updateCfg(options);\n    }\n    return _this;\n  }\n  ForceLayout.prototype.getDefaultCfg = function () {\n    return {\n      center: [0, 0],\n      nodeStrength: null,\n      edgeStrength: null,\n      preventOverlap: false,\n      nodeSize: undefined,\n      nodeSpacing: undefined,\n      linkDistance: 50,\n      forceSimulation: null,\n      alphaDecay: 0.028,\n      alphaMin: 0.001,\n      alpha: 0.3,\n      collideStrength: 1,\n      clustering: false,\n      clusterNodeStrength: -1,\n      clusterEdgeStrength: 0.1,\n      clusterEdgeDistance: 100,\n      clusterFociStrength: 0.8,\n      clusterNodeSize: 10,\n      tick: function () {},\n      onLayoutEnd: function () {},\n      // 是否启用web worker。前提是在web worker里执行布局，否则无效\n      workerEnabled: false\n    };\n  };\n  /**\n   * 初始化\n   * @param {object} data 数据\n   */\n  ForceLayout.prototype.init = function (data) {\n    var self = this;\n    self.nodes = data.nodes || [];\n    var edges = data.edges || [];\n    self.edges = edges.map(function (edge) {\n      var res = {};\n      var expectKeys = [\"targetNode\", \"sourceNode\", \"startPoint\", \"endPoint\"];\n      Object.keys(edge).forEach(function (key) {\n        if (!(expectKeys.indexOf(key) > -1)) {\n          res[key] = edge[key];\n        }\n      });\n      return res;\n    });\n    self.ticking = false;\n  };\n  /**\n   * 执行布局\n   */\n  ForceLayout.prototype.execute = function (reloadData) {\n    var self = this;\n    var nodes = self.nodes;\n    var edges = self.edges;\n    // 如果正在布局，忽略布局请求\n    if (self.ticking) {\n      return;\n    }\n    var simulation = self.forceSimulation;\n    var alphaMin = self.alphaMin;\n    var alphaDecay = self.alphaDecay;\n    var alpha = self.alpha;\n    if (!simulation) {\n      try {\n        // 定义节点的力\n        var nodeForce = d3Force.forceManyBody();\n        if (self.nodeStrength) {\n          nodeForce.strength(self.nodeStrength);\n        }\n        simulation = d3Force.forceSimulation().nodes(nodes);\n        if (self.clustering) {\n          var clusterForce = (0, force_in_a_box_1.default)();\n          clusterForce.centerX(self.center[0]).centerY(self.center[1]).template(\"force\").strength(self.clusterFociStrength);\n          if (edges) {\n            clusterForce.links(edges);\n          }\n          if (nodes) {\n            clusterForce.nodes(nodes);\n          }\n          clusterForce.forceLinkDistance(self.clusterEdgeDistance).forceLinkStrength(self.clusterEdgeStrength).forceCharge(self.clusterNodeStrength).forceNodeSize(self.clusterNodeSize);\n          self.clusterForce = clusterForce;\n          simulation.force(\"group\", clusterForce);\n        }\n        simulation.force(\"center\", d3Force.forceCenter(self.center[0], self.center[1])).force(\"charge\", nodeForce).alpha(alpha).alphaDecay(alphaDecay).alphaMin(alphaMin);\n        if (self.preventOverlap) {\n          self.overlapProcess(simulation);\n        }\n        // 如果有边，定义边的力\n        if (edges) {\n          // d3 的 forceLayout 会重新生成边的数据模型，为了避免污染源数据\n          var edgeForce = d3Force.forceLink().id(function (d) {\n            return d.id;\n          }).links(edges);\n          if (self.edgeStrength) {\n            edgeForce.strength(self.edgeStrength);\n          }\n          if (self.linkDistance) {\n            edgeForce.distance(self.linkDistance);\n          }\n          self.edgeForce = edgeForce;\n          simulation.force(\"link\", edgeForce);\n        }\n        if (self.workerEnabled && !isInWorker()) {\n          // 如果不是运行在web worker里，不用web worker布局\n          self.workerEnabled = false;\n          console.warn(\"workerEnabled option is only supported when running in web worker.\");\n        }\n        if (!self.workerEnabled) {\n          simulation.on(\"tick\", function () {\n            self.tick();\n          }).on(\"end\", function () {\n            self.ticking = false;\n            if (self.onLayoutEnd) self.onLayoutEnd();\n          });\n          self.ticking = true;\n        } else {\n          // worker is enabled\n          simulation.stop();\n          var totalTicks = getSimulationTicks(simulation);\n          for (var currentTick = 1; currentTick <= totalTicks; currentTick++) {\n            simulation.tick();\n            // currentTick starts from 1.\n            postMessage({\n              nodes: nodes,\n              currentTick: currentTick,\n              totalTicks: totalTicks,\n              type: constants_1.LAYOUT_MESSAGE.TICK\n            }, undefined);\n          }\n          self.ticking = false;\n        }\n        self.forceSimulation = simulation;\n        self.ticking = true;\n      } catch (e) {\n        self.ticking = false;\n        console.warn(e);\n      }\n    } else {\n      if (reloadData) {\n        if (self.clustering && self.clusterForce) {\n          self.clusterForce.nodes(nodes);\n          self.clusterForce.links(edges);\n        }\n        simulation.nodes(nodes);\n        if (edges && self.edgeForce) self.edgeForce.links(edges);else if (edges && !self.edgeForce) {\n          // d3 的 forceLayout 会重新生成边的数据模型，为了避免污染源数据\n          var edgeForce = d3Force.forceLink().id(function (d) {\n            return d.id;\n          }).links(edges);\n          if (self.edgeStrength) {\n            edgeForce.strength(self.edgeStrength);\n          }\n          if (self.linkDistance) {\n            edgeForce.distance(self.linkDistance);\n          }\n          self.edgeForce = edgeForce;\n          simulation.force(\"link\", edgeForce);\n        }\n      }\n      if (self.preventOverlap) {\n        self.overlapProcess(simulation);\n      }\n      simulation.alpha(alpha).restart();\n      this.ticking = true;\n    }\n  };\n  /**\n   * 防止重叠\n   * @param {object} simulation 力模拟模型\n   */\n  ForceLayout.prototype.overlapProcess = function (simulation) {\n    var self = this;\n    var nodeSize = self.nodeSize;\n    var nodeSpacing = self.nodeSpacing;\n    var nodeSizeFunc;\n    var nodeSpacingFunc;\n    var collideStrength = self.collideStrength;\n    if ((0, util_1.isNumber)(nodeSpacing)) {\n      nodeSpacingFunc = function () {\n        return nodeSpacing;\n      };\n    } else if ((0, util_1.isFunction)(nodeSpacing)) {\n      nodeSpacingFunc = nodeSpacing;\n    } else {\n      nodeSpacingFunc = function () {\n        return 0;\n      };\n    }\n    if (!nodeSize) {\n      nodeSizeFunc = function (d) {\n        if (d.size) {\n          if ((0, util_1.isArray)(d.size)) {\n            var res = d.size[0] > d.size[1] ? d.size[0] : d.size[1];\n            return res / 2 + nodeSpacingFunc(d);\n          }\n          if ((0, util_1.isObject)(d.size)) {\n            var res = d.size.width > d.size.height ? d.size.width : d.size.height;\n            return res / 2 + nodeSpacingFunc(d);\n          }\n          return d.size / 2 + nodeSpacingFunc(d);\n        }\n        return 10 + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isFunction)(nodeSize)) {\n      nodeSizeFunc = function (d) {\n        var size = nodeSize(d);\n        return size + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isArray)(nodeSize)) {\n      var larger = nodeSize[0] > nodeSize[1] ? nodeSize[0] : nodeSize[1];\n      var radius_1 = larger / 2;\n      nodeSizeFunc = function (d) {\n        return radius_1 + nodeSpacingFunc(d);\n      };\n    } else if ((0, util_1.isNumber)(nodeSize)) {\n      var radius_2 = nodeSize / 2;\n      nodeSizeFunc = function (d) {\n        return radius_2 + nodeSpacingFunc(d);\n      };\n    } else {\n      nodeSizeFunc = function () {\n        return 10;\n      };\n    }\n    // forceCollide's parameter is a radius\n    simulation.force(\"collisionForce\", d3Force.forceCollide(nodeSizeFunc).strength(collideStrength));\n  };\n  /**\n   * 更新布局配置，但不执行布局\n   * @param {object} cfg 需要更新的配置项\n   */\n  ForceLayout.prototype.updateCfg = function (cfg) {\n    var self = this;\n    if (self.ticking) {\n      self.forceSimulation.stop();\n      self.ticking = false;\n    }\n    self.forceSimulation = null;\n    Object.assign(self, cfg);\n  };\n  ForceLayout.prototype.destroy = function () {\n    var self = this;\n    if (self.ticking) {\n      self.forceSimulation.stop();\n      self.ticking = false;\n    }\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n  return ForceLayout;\n}(base_1.Base);\nexports.ForceLayout = ForceLayout;\n// Return total ticks of d3-force simulation\nfunction getSimulationTicks(simulation) {\n  var alphaMin = simulation.alphaMin();\n  var alphaTarget = simulation.alphaTarget();\n  var alpha = simulation.alpha();\n  var totalTicksFloat = Math.log((alphaMin - alphaTarget) / (alpha - alphaTarget)) / Math.log(1 - simulation.alphaDecay());\n  var totalTicks = Math.ceil(totalTicksFloat);\n  return totalTicks;\n}\n// 判断是否运行在web worker里\nfunction isInWorker() {\n  // eslint-disable-next-line no-undef\n  return typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope;\n}","map":{"version":3,"names":["d3Force","__importStar","require","force_in_a_box_1","__importDefault","util_1","base_1","constants_1","ForceLayout","_super","__extends","options","_this","call","center","nodeStrength","edgeStrength","preventOverlap","clusterNodeStrength","clusterEdgeStrength","clusterEdgeDistance","clusterNodeSize","clusterFociStrength","linkDistance","alphaDecay","alphaMin","alpha","collideStrength","workerEnabled","tick","onLayoutEnd","ticking","undefined","updateCfg","prototype","getDefaultCfg","nodeSize","nodeSpacing","forceSimulation","clustering","init","data","self","nodes","edges","map","edge","res","expectKeys","Object","keys","forEach","key","indexOf","execute","reloadData","simulation","nodeForce","forceManyBody","strength","clusterForce","default","centerX","centerY","template","links","forceLinkDistance","forceLinkStrength","forceCharge","forceNodeSize","force","forceCenter","overlapProcess","edgeForce","forceLink","id","d","distance","isInWorker","console","warn","on","stop","totalTicks","getSimulationTicks","currentTick","postMessage","type","LAYOUT_MESSAGE","TICK","e","restart","nodeSizeFunc","nodeSpacingFunc","isNumber","isFunction","size","isArray","isObject","width","height","larger","radius_1","radius_2","forceCollide","cfg","assign","destroy","destroyed","Base","exports","alphaTarget","totalTicksFloat","Math","log","ceil","WorkerGlobalScope"],"sources":["../../../src/layout/force/force.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview fruchterman layout\n * @author shiwu.wyy@antfin.com\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FruchtermanLayout = void 0;\nvar base_1 = require(\"./base\");\nvar util_1 = require(\"../util\");\nvar SPEED_DIVISOR = 800;\n/**\n * fruchterman 布局\n */\nvar FruchtermanLayout = /** @class */function (_super) {\n  __extends(FruchtermanLayout, _super);\n  function FruchtermanLayout(options) {\n    var _this = _super.call(this) || this;\n    /** 停止迭代的最大迭代数 */\n    _this.maxIteration = 1000;\n    /** 是否启动 worker */\n    _this.workerEnabled = false;\n    /** 重力大小，影响图的紧凑程度 */\n    _this.gravity = 10;\n    /** 速度 */\n    _this.speed = 5;\n    /** 是否产生聚类力 */\n    _this.clustering = false;\n    /** 聚类力大小 */\n    _this.clusterGravity = 10;\n    _this.nodes = [];\n    _this.edges = [];\n    _this.width = 300;\n    _this.height = 300;\n    _this.nodeMap = {};\n    _this.nodeIdxMap = {};\n    /** 迭代结束的回调函数 */\n    _this.onLayoutEnd = function () {};\n    /** 每次迭代结束的回调函数 */\n    _this.tick = function () {};\n    /** 是否使用 window.setInterval 运行迭代 */\n    _this.animate = true;\n    _this.updateCfg(options);\n    return _this;\n  }\n  FruchtermanLayout.prototype.getDefaultCfg = function () {\n    return {\n      maxIteration: 1000,\n      gravity: 10,\n      speed: 1,\n      clustering: false,\n      clusterGravity: 10,\n      animate: true\n    };\n  };\n  /**\n   * 执行布局\n   */\n  FruchtermanLayout.prototype.execute = function () {\n    var _this = this;\n    var _a, _b;\n    var self = this;\n    var nodes = self.nodes;\n    if (self.timeInterval !== undefined && typeof window !== \"undefined\") {\n      window.clearInterval(self.timeInterval);\n    }\n    if (!nodes || nodes.length === 0) {\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n      return;\n    }\n    if (!self.width && typeof window !== \"undefined\") {\n      self.width = window.innerWidth;\n    }\n    if (!self.height && typeof window !== \"undefined\") {\n      self.height = window.innerHeight;\n    }\n    if (!self.center) {\n      self.center = [self.width / 2, self.height / 2];\n    }\n    var center = self.center;\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      (_b = self.onLayoutEnd) === null || _b === void 0 ? void 0 : _b.call(self);\n      return;\n    }\n    var nodeMap = {};\n    var nodeIdxMap = {};\n    nodes.forEach(function (node, i) {\n      if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * _this.width;\n      if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * _this.height;\n      nodeMap[node.id] = node;\n      nodeIdxMap[node.id] = i;\n    });\n    self.nodeMap = nodeMap;\n    self.nodeIdxMap = nodeIdxMap;\n    // layout\n    return self.run();\n  };\n  FruchtermanLayout.prototype.run = function () {\n    var _a;\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n      maxIteration = self.maxIteration,\n      workerEnabled = self.workerEnabled,\n      clustering = self.clustering,\n      animate = self.animate;\n    var clusterMap = {};\n    if (clustering) {\n      nodes.forEach(function (n) {\n        if (clusterMap[n.cluster] === undefined) {\n          clusterMap[n.cluster] = {\n            name: n.cluster,\n            cx: 0,\n            cy: 0,\n            count: 0\n          };\n        }\n      });\n    }\n    if (workerEnabled || !animate) {\n      for (var i = 0; i < maxIteration; i++) {\n        self.runOneStep(clusterMap);\n      }\n      (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n    } else {\n      if (typeof window === \"undefined\") return;\n      var iter_1 = 0;\n      // interval for render the result after each iteration\n      this.timeInterval = window.setInterval(function () {\n        var _a;\n        self.runOneStep(clusterMap);\n        iter_1++;\n        if (iter_1 >= maxIteration) {\n          (_a = self.onLayoutEnd) === null || _a === void 0 ? void 0 : _a.call(self);\n          window.clearInterval(self.timeInterval);\n        }\n      }, 0);\n    }\n    return {\n      nodes: nodes,\n      edges: edges\n    };\n  };\n  FruchtermanLayout.prototype.runOneStep = function (clusterMap) {\n    var _a;\n    var self = this;\n    var nodes = self.nodes;\n    if (!nodes) return;\n    var edges = self.edges,\n      center = self.center,\n      gravity = self.gravity,\n      speed = self.speed,\n      clustering = self.clustering;\n    var area = self.height * self.width;\n    var maxDisplace = Math.sqrt(area) / 10;\n    var k2 = area / (nodes.length + 1);\n    var k = Math.sqrt(k2);\n    var displacements = [];\n    nodes.forEach(function (_, j) {\n      displacements[j] = {\n        x: 0,\n        y: 0\n      };\n    });\n    self.applyCalculate(nodes, edges, displacements, k, k2);\n    // gravity for clusters\n    if (clustering) {\n      // re-compute the clustering centers\n      for (var key in clusterMap) {\n        clusterMap[key].cx = 0;\n        clusterMap[key].cy = 0;\n        clusterMap[key].count = 0;\n      }\n      nodes.forEach(function (n) {\n        var c = clusterMap[n.cluster];\n        if ((0, util_1.isNumber)(n.x)) {\n          c.cx += n.x;\n        }\n        if ((0, util_1.isNumber)(n.y)) {\n          c.cy += n.y;\n        }\n        c.count++;\n      });\n      for (var key in clusterMap) {\n        clusterMap[key].cx /= clusterMap[key].count;\n        clusterMap[key].cy /= clusterMap[key].count;\n      }\n      // compute the cluster gravity forces\n      var clusterGravity_1 = self.clusterGravity || gravity;\n      nodes.forEach(function (n, j) {\n        if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n        var c = clusterMap[n.cluster];\n        var distLength = Math.sqrt((n.x - c.cx) * (n.x - c.cx) + (n.y - c.cy) * (n.y - c.cy));\n        var gravityForce = k * clusterGravity_1;\n        displacements[j].x -= gravityForce * (n.x - c.cx) / distLength;\n        displacements[j].y -= gravityForce * (n.y - c.cy) / distLength;\n      });\n    }\n    // gravity\n    nodes.forEach(function (n, j) {\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var gravityForce = 0.01 * k * gravity;\n      displacements[j].x -= gravityForce * (n.x - center[0]);\n      displacements[j].y -= gravityForce * (n.y - center[1]);\n    });\n    // move\n    nodes.forEach(function (n, j) {\n      if ((0, util_1.isNumber)(n.fx) && (0, util_1.isNumber)(n.fy)) {\n        n.x = n.fx;\n        n.y = n.fy;\n        return;\n      }\n      if (!(0, util_1.isNumber)(n.x) || !(0, util_1.isNumber)(n.y)) return;\n      var distLength = Math.sqrt(displacements[j].x * displacements[j].x + displacements[j].y * displacements[j].y);\n      if (distLength > 0) {\n        // && !n.isFixed()\n        var limitedDist = Math.min(maxDisplace * (speed / SPEED_DIVISOR), distLength);\n        n.x += displacements[j].x / distLength * limitedDist;\n        n.y += displacements[j].y / distLength * limitedDist;\n      }\n    });\n    (_a = self.tick) === null || _a === void 0 ? void 0 : _a.call(self);\n  };\n  FruchtermanLayout.prototype.applyCalculate = function (nodes, edges, displacements, k, k2) {\n    var self = this;\n    self.calRepulsive(nodes, displacements, k2);\n    if (edges) self.calAttractive(edges, displacements, k);\n  };\n  FruchtermanLayout.prototype.calRepulsive = function (nodes, displacements, k2) {\n    nodes.forEach(function (v, i) {\n      displacements[i] = {\n        x: 0,\n        y: 0\n      };\n      nodes.forEach(function (u, j) {\n        if (i === j) {\n          return;\n        }\n        if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n          return;\n        }\n        var vecX = v.x - u.x;\n        var vecY = v.y - u.y;\n        var vecLengthSqr = vecX * vecX + vecY * vecY;\n        if (vecLengthSqr === 0) {\n          vecLengthSqr = 1;\n          var sign = i > j ? 1 : -1;\n          vecX = 0.01 * sign;\n          vecY = 0.01 * sign;\n        }\n        var common = k2 / vecLengthSqr;\n        displacements[i].x += vecX * common;\n        displacements[i].y += vecY * common;\n      });\n    });\n  };\n  FruchtermanLayout.prototype.calAttractive = function (edges, displacements, k) {\n    var _this = this;\n    edges.forEach(function (e) {\n      var source = (0, util_1.getEdgeTerminal)(e, 'source');\n      var target = (0, util_1.getEdgeTerminal)(e, 'target');\n      if (!source || !target) return;\n      var uIndex = _this.nodeIdxMap[source];\n      var vIndex = _this.nodeIdxMap[target];\n      if (uIndex === vIndex) {\n        return;\n      }\n      var u = _this.nodeMap[source];\n      var v = _this.nodeMap[target];\n      if (!(0, util_1.isNumber)(v.x) || !(0, util_1.isNumber)(u.x) || !(0, util_1.isNumber)(v.y) || !(0, util_1.isNumber)(u.y)) {\n        return;\n      }\n      var vecX = v.x - u.x;\n      var vecY = v.y - u.y;\n      var vecLength = Math.sqrt(vecX * vecX + vecY * vecY);\n      var common = vecLength * vecLength / k;\n      displacements[vIndex].x -= vecX / vecLength * common;\n      displacements[vIndex].y -= vecY / vecLength * common;\n      displacements[uIndex].x += vecX / vecLength * common;\n      displacements[uIndex].y += vecY / vecLength * common;\n    });\n  };\n  FruchtermanLayout.prototype.stop = function () {\n    if (this.timeInterval && typeof window !== \"undefined\") {\n      window.clearInterval(this.timeInterval);\n    }\n  };\n  FruchtermanLayout.prototype.destroy = function () {\n    var self = this;\n    self.stop();\n    self.tick = null;\n    self.nodes = null;\n    self.edges = null;\n    self.destroyed = true;\n  };\n  FruchtermanLayout.prototype.getType = function () {\n    return \"fruchterman\";\n  };\n  return FruchtermanLayout;\n}(base_1.Base);\nexports.FruchtermanLayout = FruchtermanLayout;","map":{"version":3,"names":["base_1","require","util_1","SPEED_DIVISOR","FruchtermanLayout","_super","__extends","options","_this","call","maxIteration","workerEnabled","gravity","speed","clustering","clusterGravity","nodes","edges","width","height","nodeMap","nodeIdxMap","onLayoutEnd","tick","animate","updateCfg","prototype","getDefaultCfg","execute","self","timeInterval","undefined","window","clearInterval","length","_a","innerWidth","innerHeight","center","x","y","_b","forEach","node","i","isNumber","Math","random","id","run","clusterMap","n","cluster","name","cx","cy","count","runOneStep","iter_1","setInterval","area","maxDisplace","sqrt","k2","k","displacements","_","j","applyCalculate","key","c","clusterGravity_1","distLength","gravityForce","fx","fy","limitedDist","min","calRepulsive","calAttractive","v","u","vecX","vecY","vecLengthSqr","sign","common","e","source","getEdgeTerminal","target","uIndex","vIndex","vecLength","stop","destroy","destroyed","getType","Base","exports"],"sources":["../../src/layout/fruchterman.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\n// @ts-nocheck\n/**\n * @fileOverview fruchterman layout\n * @author shiwu.wyy@antfin.com\n */\nrequire(\"core-js/modules/es.array.push.js\");\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GForceGPULayout = void 0;\nvar base_1 = require(\"../base\");\nvar util_1 = require(\"../../util\");\n// @ts-ignore\nvar g_webgpu_1 = require(\"@antv/g-webgpu\");\nvar gpu_1 = require(\"../../util/gpu\");\nvar math_1 = require(\"../../util/math\");\nvar gForceShader_1 = require(\"./gForceShader\");\nvar constants_1 = require(\"../constants\");\n/**\n * graphin 中的 force 布局\n */\nvar GForceGPULayout = /** @class */function (_super) {\n  __extends(GForceGPULayout, _super);\n  function GForceGPULayout(options) {\n    var _this = _super.call(this) || this;\n    /** 停止迭代的最大迭代数 */\n    _this.maxIteration = 1000;\n    /** 弹簧引力系数 */\n    _this.edgeStrength = 200;\n    /** 斥力系数 */\n    _this.nodeStrength = 1000;\n    /** 库伦系数 */\n    _this.coulombDisScale = 0.005;\n    /** 阻尼系数 */\n    _this.damping = 0.9;\n    /** 最大速度 */\n    _this.maxSpeed = 1000;\n    /** 一次迭代的平均移动距离小于该值时停止迭代 */\n    _this.minMovement = 0.5;\n    /** 迭代中衰减 */\n    _this.interval = 0.02;\n    /** 斥力的一个系数 */\n    _this.factor = 1;\n    /** 理想边长 */\n    _this.linkDistance = 1;\n    /** 重力大小 */\n    _this.gravity = 10;\n    /** 是否启用web worker。前提是在web worker里执行布局，否则无效\t*/\n    _this.workerEnabled = false;\n    _this.nodes = [];\n    _this.edges = [];\n    _this.width = 300;\n    _this.height = 300;\n    _this.nodeMap = {};\n    _this.nodeIdxMap = {};\n    _this.updateCfg(options);\n    return _this;\n  }\n  GForceGPULayout.prototype.getDefaultCfg = function () {\n    return {\n      maxIteration: 2000,\n      gravity: 10,\n      clustering: false,\n      clusterGravity: 10\n    };\n  };\n  /**\n   * 执行布局\n   */\n  GForceGPULayout.prototype.execute = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var self, nodes, center, nodeMap, nodeIdxMap;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            self = this;\n            nodes = self.nodes;\n            if (!nodes || nodes.length === 0) {\n              if (self.onLayoutEnd) self.onLayoutEnd();\n              return [2 /*return*/];\n            }\n\n            if (!self.width && typeof window !== \"undefined\") {\n              self.width = window.innerWidth;\n            }\n            if (!self.height && typeof window !== \"undefined\") {\n              self.height = window.innerHeight;\n            }\n            if (!self.center) {\n              self.center = [self.width / 2, self.height / 2];\n            }\n            center = self.center;\n            if (nodes.length === 1) {\n              nodes[0].x = center[0];\n              nodes[0].y = center[1];\n              if (self.onLayoutEnd) self.onLayoutEnd();\n              return [2 /*return*/];\n            }\n\n            nodeMap = {};\n            nodeIdxMap = {};\n            nodes.forEach(function (node, i) {\n              if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * self.width;\n              if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * self.height;\n              nodeMap[node.id] = node;\n              nodeIdxMap[node.id] = i;\n            });\n            self.nodeMap = nodeMap;\n            self.nodeIdxMap = nodeIdxMap;\n            self.nodeStrength = (0, gpu_1.proccessToFunc)(self.nodeStrength, 1);\n            self.edgeStrength = (0, gpu_1.proccessToFunc)(self.edgeStrength, 1);\n            // layout\n            return [4 /*yield*/, self.run()];\n          case 1:\n            // layout\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  GForceGPULayout.prototype.executeWithWorker = function (canvas, ctx) {\n    var self = this;\n    var nodes = self.nodes;\n    var center = self.center;\n    if (!nodes || nodes.length === 0) {\n      return;\n    }\n    if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      return;\n    }\n    var nodeMap = {};\n    var nodeIdxMap = {};\n    nodes.forEach(function (node, i) {\n      if (!(0, util_1.isNumber)(node.x)) node.x = Math.random() * self.width;\n      if (!(0, util_1.isNumber)(node.y)) node.y = Math.random() * self.height;\n      nodeMap[node.id] = node;\n      nodeIdxMap[node.id] = i;\n    });\n    self.nodeMap = nodeMap;\n    self.nodeIdxMap = nodeIdxMap;\n    self.nodeStrength = (0, gpu_1.proccessToFunc)(self.nodeStrength, 1);\n    self.edgeStrength = (0, gpu_1.proccessToFunc)(self.edgeStrength, 1);\n    // layout\n    self.run(canvas, ctx);\n  };\n  GForceGPULayout.prototype.run = function (canvas, ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      var self, nodes, edges, maxIteration, numParticles, _a, maxEdgePerVetex, nodesEdgesArray, masses, nodeStrengths, centerXs, centerYs, centerGravities, fxs, fys, gravity, center, nodeAttributeArray1, nodeAttributeArray2, workerEnabled, world, onLayoutEnd, initPreviousData, i, kernelGForce, kernelAveMovement, execute;\n      var _this = this;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            self = this;\n            nodes = self.nodes;\n            edges = self.edges;\n            maxIteration = self.maxIteration;\n            if (!self.width && typeof window !== \"undefined\") {\n              self.width = window.innerWidth;\n            }\n            if (!self.height && typeof window !== \"undefined\") {\n              self.height = window.innerHeight;\n            }\n            numParticles = nodes.length;\n            self.linkDistance = (0, gpu_1.proccessToFunc)(self.linkDistance);\n            self.edgeStrength = (0, gpu_1.proccessToFunc)(self.edgeStrength);\n            _a = (0, gpu_1.buildTextureDataWithTwoEdgeAttr)(nodes, edges, self.linkDistance, self.edgeStrength), maxEdgePerVetex = _a.maxEdgePerVetex, nodesEdgesArray = _a.array;\n            // init degree for mass\n            self.degrees = (0, math_1.getDegree)(nodes.length, self.nodeIdxMap, edges).map(function (degree) {\n              return degree.all;\n            });\n            masses = [];\n            nodeStrengths = [];\n            centerXs = [];\n            centerYs = [];\n            centerGravities = [];\n            fxs = [];\n            fys = [];\n            if (!self.getMass) {\n              self.getMass = function (d) {\n                return self.degrees[self.nodeIdxMap[d.id]] || 1;\n              };\n            }\n            gravity = self.gravity;\n            center = self.center;\n            nodes.forEach(function (node, i) {\n              masses.push(self.getMass(node));\n              nodeStrengths.push(self.nodeStrength(node));\n              if (!self.degrees[i]) self.degrees[i] = 0;\n              var nodeGravity = [center[0], center[1], gravity];\n              if (self.getCenter) {\n                var customCenter = self.getCenter(node, self.degrees[i]);\n                if (customCenter && (0, util_1.isNumber)(customCenter[0]) && (0, util_1.isNumber)(customCenter[1]) && (0, util_1.isNumber)(customCenter[2])) {\n                  nodeGravity = customCenter;\n                }\n              }\n              centerXs.push(nodeGravity[0]);\n              centerYs.push(nodeGravity[1]);\n              centerGravities.push(nodeGravity[2]);\n              if ((0, util_1.isNumber)(node.fx) && (0, util_1.isNumber)(node.fy)) {\n                fxs.push(node.fx || 0.001);\n                fys.push(node.fy || 0.001);\n              } else {\n                fxs.push(0);\n                fys.push(0);\n              }\n            });\n            nodeAttributeArray1 = (0, gpu_1.arrayToTextureData)([masses, self.degrees, nodeStrengths, fxs]);\n            nodeAttributeArray2 = (0, gpu_1.arrayToTextureData)([centerXs, centerYs, centerGravities, fys]);\n            workerEnabled = self.workerEnabled;\n            if (workerEnabled) {\n              world = g_webgpu_1.World.create({\n                canvas: canvas,\n                engineOptions: {\n                  supportCompute: true\n                }\n              });\n            } else {\n              world = g_webgpu_1.World.create({\n                engineOptions: {\n                  supportCompute: true\n                }\n              });\n            }\n            onLayoutEnd = self.onLayoutEnd;\n            initPreviousData = [];\n            nodesEdgesArray.forEach(function (value) {\n              initPreviousData.push(value);\n            });\n            for (i = 0; i < 4; i++) {\n              initPreviousData.push(0);\n            }\n            kernelGForce = world.createKernel(gForceShader_1.gForceBundle).setDispatch([numParticles, 1, 1]).setBinding({\n              u_Data: nodesEdgesArray,\n              u_damping: self.damping,\n              u_maxSpeed: self.maxSpeed,\n              u_minMovement: self.minMovement,\n              u_coulombDisScale: self.coulombDisScale,\n              u_factor: self.factor,\n              u_NodeAttributeArray1: nodeAttributeArray1,\n              u_NodeAttributeArray2: nodeAttributeArray2,\n              MAX_EDGE_PER_VERTEX: maxEdgePerVetex,\n              VERTEX_COUNT: numParticles,\n              u_AveMovement: initPreviousData,\n              u_interval: self.interval // 每次迭代更新，首次设置为 interval，在 onIterationCompleted 中更新\n            });\n\n            kernelAveMovement = world.createKernel(gForceShader_1.aveMovementBundle).setDispatch([1, 1, 1]).setBinding({\n              u_Data: nodesEdgesArray,\n              VERTEX_COUNT: numParticles,\n              u_AveMovement: [0, 0, 0, 0]\n            });\n            execute = function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var i, stepInterval, finalParticleData;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      i = 0;\n                      _a.label = 1;\n                    case 1:\n                      if (!(i < maxIteration)) return [3 /*break*/, 5];\n                      // TODO: 似乎都来自 kernelGForce 是一个引用\n                      // 当前坐标作为下一次迭代的 PreviousData\n                      // if (i > 0) {\n                      //   kernelAveMovement.setBinding({\n                      //     u_PreviousData: kernelGForce\n                      //   });\n                      // }\n                      // eslint-disable-next-line no-await-in-loop\n                      return [4 /*yield*/, kernelGForce.execute()];\n                    case 2:\n                      // TODO: 似乎都来自 kernelGForce 是一个引用\n                      // 当前坐标作为下一次迭代的 PreviousData\n                      // if (i > 0) {\n                      //   kernelAveMovement.setBinding({\n                      //     u_PreviousData: kernelGForce\n                      //   });\n                      // }\n                      // eslint-disable-next-line no-await-in-loop\n                      _a.sent();\n                      // midRes = await kernelGForce.getOutput();\n                      // 每次迭代完成后\n                      // 计算平均位移，用于提前终止迭代\n                      kernelAveMovement.setBinding({\n                        u_Data: kernelGForce\n                      });\n                      // eslint-disable-next-line no-await-in-loop\n                      return [4 /*yield*/, kernelAveMovement.execute()];\n                    case 3:\n                      // eslint-disable-next-line no-await-in-loop\n                      _a.sent();\n                      stepInterval = Math.max(0.02, self.interval - i * 0.002);\n                      kernelGForce.setBinding({\n                        u_interval: stepInterval,\n                        u_AveMovement: kernelAveMovement\n                      });\n                      _a.label = 4;\n                    case 4:\n                      i++;\n                      return [3 /*break*/, 1];\n                    case 5:\n                      return [4 /*yield*/, kernelGForce.getOutput()];\n                    case 6:\n                      finalParticleData = _a.sent();\n                      // 所有迭代完成后\n                      if (canvas) {\n                        // 传递数据给主线程\n                        ctx.postMessage({\n                          type: constants_1.LAYOUT_MESSAGE.GPUEND,\n                          vertexEdgeData: finalParticleData\n                          // edgeIndexBufferData,\n                        });\n                      } else {\n                        nodes.forEach(function (node, i) {\n                          var x = finalParticleData[4 * i];\n                          var y = finalParticleData[4 * i + 1];\n                          node.x = x;\n                          node.y = y;\n                        });\n                      }\n                      if (onLayoutEnd) onLayoutEnd();\n                      return [2 /*return*/];\n                  }\n                });\n              });\n            };\n\n            return [4 /*yield*/, execute()];\n          case 1:\n            _b.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  GForceGPULayout.prototype.getType = function () {\n    return \"gForce-gpu\";\n  };\n  return GForceGPULayout;\n}(base_1.Base);\nexports.GForceGPULayout = GForceGPULayout;","map":{"version":3,"names":["require","base_1","util_1","g_webgpu_1","gpu_1","math_1","gForceShader_1","constants_1","GForceGPULayout","_super","__extends","options","_this","call","maxIteration","edgeStrength","nodeStrength","coulombDisScale","damping","maxSpeed","minMovement","interval","factor","linkDistance","gravity","workerEnabled","nodes","edges","width","height","nodeMap","nodeIdxMap","updateCfg","prototype","getDefaultCfg","clustering","clusterGravity","execute","self","length","onLayoutEnd","window","innerWidth","innerHeight","center","x","y","forEach","node","i","isNumber","Math","random","id","proccessToFunc","run","_a","sent","executeWithWorker","canvas","ctx","numParticles","buildTextureDataWithTwoEdgeAttr","maxEdgePerVetex","nodesEdgesArray","array","degrees","getDegree","map","degree","all","masses","nodeStrengths","centerXs","centerYs","centerGravities","fxs","fys","getMass","d","push","nodeGravity","getCenter","customCenter","fx","fy","nodeAttributeArray1","arrayToTextureData","nodeAttributeArray2","world","World","create","engineOptions","supportCompute","initPreviousData","value","kernelGForce","createKernel","gForceBundle","setDispatch","setBinding","u_Data","u_damping","u_maxSpeed","u_minMovement","u_coulombDisScale","u_factor","u_NodeAttributeArray1","u_NodeAttributeArray2","MAX_EDGE_PER_VERTEX","VERTEX_COUNT","u_AveMovement","u_interval","kernelAveMovement","aveMovementBundle","__awaiter","stepInterval","max","getOutput","finalParticleData","postMessage","type","LAYOUT_MESSAGE","GPUEND","vertexEdgeData","_b","getType","Base","exports"],"sources":["../../../src/layout/gpu/gForce.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { encodePickingColor } from \"../color\";\nimport { a_Color, a_filter, a_Position, a_vertexId } from \"./commonFeatureFunc\";\nimport { LineTriangulation as triangulation } from \"./triangulation\";\nexport var lineModel = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var descriptors, features, enablePicking, iconMap, updateFuncs, featureLayout, verticesNum, indices, size;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          descriptors = _ref.descriptors, features = _ref.features, enablePicking = _ref.enablePicking, iconMap = _ref.iconMap;\n          updateFuncs = {\n            // fixed feature func\n            a_Color: a_Color,\n            a_Position: a_Position,\n            filter: a_filter,\n            a_vertexId: a_vertexId,\n            a_PickingColor: function a_PickingColor(feature) {\n              var id = feature.id;\n              return enablePicking ? encodePickingColor(id) : [0, 0, 0];\n            },\n            // pointFill feature func\n            a_DistanceAndIndex: function a_DistanceAndIndex(feature, featureIdx, vertex, attributeIdx, normal, vertexIndex) {\n              return vertexIndex === undefined ? [vertex[3], 10] : [vertex[3], vertexIndex];\n            },\n            a_Total_Distance: function a_Total_Distance(feature, featureIdx, vertex) {\n              return [vertex[5]];\n            },\n            a_Size: function a_Size(feature) {\n              var _feature$size = feature.size,\n                pointSize = _feature$size === void 0 ? 1 : _feature$size;\n              return Array.isArray(pointSize) ? [pointSize[0], pointSize[1]] : [pointSize, 0];\n            },\n            a_Normal: function a_Normal(feature, featureIdx, vertex, attributeIdx, normal) {\n              return normal;\n            },\n            a_Miter: function a_Miter(feature, featureIdx, vertex) {\n              return [vertex[4]];\n            },\n            a_iconMapUV: function a_iconMapUV(feature) {\n              var texture = feature.texture;\n              var _ref3 = iconMap[texture] || {\n                  x: 0,\n                  y: 0\n                },\n                x = _ref3.x,\n                y = _ref3.y;\n              return [x, y];\n            }\n          };\n          featureLayout = {\n            sizePerElement: 0,\n            elements: []\n          };\n          verticesNum = 0;\n          indices = [];\n          size = 3;\n          features.forEach(function (feature, featureIdx) {\n            var _triangulation = triangulation(feature),\n              indicesForCurrentFeature = _triangulation.indices,\n              verticesForCurrentFeature = _triangulation.vertices,\n              normalsForCurrentFeature = _triangulation.normals,\n              vertexSize = _triangulation.size,\n              indexes = _triangulation.indexes;\n            indicesForCurrentFeature.forEach(function (i) {\n              indices.push(i + verticesNum);\n            });\n            size = vertexSize;\n            var verticesNumForCurrentFeature = verticesForCurrentFeature.length / vertexSize;\n            featureLayout.sizePerElement = size;\n            featureLayout.elements.push({\n              featureIdx: featureIdx,\n              vertices: verticesForCurrentFeature,\n              normals: normalsForCurrentFeature,\n              offset: verticesNum\n            });\n            verticesNum += verticesNumForCurrentFeature;\n            var _loop = function _loop(vertexIdx) {\n              var normal = (normalsForCurrentFeature === null || normalsForCurrentFeature === void 0 ? void 0 : normalsForCurrentFeature.slice(vertexIdx * 3, vertexIdx * 3 + 3)) || [];\n              var vertice = verticesForCurrentFeature.slice(vertexIdx * vertexSize, vertexIdx * vertexSize + vertexSize);\n              var vertexIndex = 0;\n              if (indexes && indexes[vertexIdx] !== undefined) {\n                vertexIndex = indexes[vertexIdx];\n              }\n              descriptors.forEach(function (descriptor) {\n                // @ts-ignore\n                if (descriptor && updateFuncs[descriptor.name]) {\n                  var _descriptor$buffer$da;\n                  // @ts-ignore\n                  (_descriptor$buffer$da = descriptor.buffer.data).push.apply(_descriptor$buffer$da, _toConsumableArray(updateFuncs[descriptor.name](feature, featureIdx, vertice, vertexIdx, normal, vertexIndex)));\n                }\n              });\n            };\n            for (var vertexIdx = 0; vertexIdx < verticesNumForCurrentFeature; vertexIdx++) {\n              _loop(vertexIdx);\n            }\n          });\n          return _context.abrupt(\"return\", {\n            descriptors: descriptors,\n            featureLayout: featureLayout,\n            indices: indices\n          });\n        case 8:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function lineModel(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["_toConsumableArray","_asyncToGenerator","_regeneratorRuntime","encodePickingColor","a_Color","a_filter","a_Position","a_vertexId","LineTriangulation","triangulation","lineModel","_ref2","mark","_callee","_ref","descriptors","features","enablePicking","iconMap","updateFuncs","featureLayout","verticesNum","indices","size","wrap","_callee$","_context","prev","next","filter","a_PickingColor","feature","id","a_DistanceAndIndex","featureIdx","vertex","attributeIdx","normal","vertexIndex","undefined","a_Total_Distance","a_Size","_feature$size","pointSize","Array","isArray","a_Normal","a_Miter","a_iconMapUV","texture","_ref3","x","y","sizePerElement","elements","forEach","_triangulation","indicesForCurrentFeature","verticesForCurrentFeature","vertices","normalsForCurrentFeature","normals","vertexSize","indexes","i","push","verticesNumForCurrentFeature","length","offset","_loop","vertexIdx","slice","vertice","descriptor","name","_descriptor$buffer$da","buffer","data","apply","abrupt","stop","_x","arguments"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-utils/es/workers/lineModel.js"],"sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { encodePickingColor } from \"../color\";\nimport { a_Color, a_filter, a_Position, a_vertexId } from \"./commonFeatureFunc\";\nimport { LineTriangulation as triangulation } from \"./triangulation\";\nexport var lineModel = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var descriptors, features, enablePicking, iconMap, updateFuncs, featureLayout, verticesNum, indices, size;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          descriptors = _ref.descriptors, features = _ref.features, enablePicking = _ref.enablePicking, iconMap = _ref.iconMap;\n          updateFuncs = {\n            // fixed feature func\n            a_Color: a_Color,\n            a_Position: a_Position,\n            filter: a_filter,\n            a_vertexId: a_vertexId,\n            a_PickingColor: function a_PickingColor(feature) {\n              var id = feature.id;\n              return enablePicking ? encodePickingColor(id) : [0, 0, 0];\n            },\n            // pointFill feature func\n            a_DistanceAndIndex: function a_DistanceAndIndex(feature, featureIdx, vertex, attributeIdx, normal, vertexIndex) {\n              return vertexIndex === undefined ? [vertex[3], 10] : [vertex[3], vertexIndex];\n            },\n            a_Total_Distance: function a_Total_Distance(feature, featureIdx, vertex) {\n              return [vertex[5]];\n            },\n            a_Size: function a_Size(feature) {\n              var _feature$size = feature.size,\n                pointSize = _feature$size === void 0 ? 1 : _feature$size;\n              return Array.isArray(pointSize) ? [pointSize[0], pointSize[1]] : [pointSize, 0];\n            },\n            a_Normal: function a_Normal(feature, featureIdx, vertex, attributeIdx, normal) {\n              return normal;\n            },\n            a_Miter: function a_Miter(feature, featureIdx, vertex) {\n              return [vertex[4]];\n            },\n            a_iconMapUV: function a_iconMapUV(feature) {\n              var texture = feature.texture;\n              var _ref3 = iconMap[texture] || {\n                  x: 0,\n                  y: 0\n                },\n                x = _ref3.x,\n                y = _ref3.y;\n              return [x, y];\n            }\n          };\n          featureLayout = {\n            sizePerElement: 0,\n            elements: []\n          };\n          verticesNum = 0;\n          indices = [];\n          size = 3;\n          features.forEach(function (feature, featureIdx) {\n            var _triangulation = triangulation(feature),\n              indicesForCurrentFeature = _triangulation.indices,\n              verticesForCurrentFeature = _triangulation.vertices,\n              normalsForCurrentFeature = _triangulation.normals,\n              vertexSize = _triangulation.size,\n              indexes = _triangulation.indexes;\n            indicesForCurrentFeature.forEach(function (i) {\n              indices.push(i + verticesNum);\n            });\n            size = vertexSize;\n            var verticesNumForCurrentFeature = verticesForCurrentFeature.length / vertexSize;\n            featureLayout.sizePerElement = size;\n            featureLayout.elements.push({\n              featureIdx: featureIdx,\n              vertices: verticesForCurrentFeature,\n              normals: normalsForCurrentFeature,\n              offset: verticesNum\n            });\n            verticesNum += verticesNumForCurrentFeature;\n            var _loop = function _loop(vertexIdx) {\n              var normal = (normalsForCurrentFeature === null || normalsForCurrentFeature === void 0 ? void 0 : normalsForCurrentFeature.slice(vertexIdx * 3, vertexIdx * 3 + 3)) || [];\n              var vertice = verticesForCurrentFeature.slice(vertexIdx * vertexSize, vertexIdx * vertexSize + vertexSize);\n              var vertexIndex = 0;\n              if (indexes && indexes[vertexIdx] !== undefined) {\n                vertexIndex = indexes[vertexIdx];\n              }\n              descriptors.forEach(function (descriptor) {\n                // @ts-ignore\n                if (descriptor && updateFuncs[descriptor.name]) {\n                  var _descriptor$buffer$da;\n                  // @ts-ignore\n                  (_descriptor$buffer$da = descriptor.buffer.data).push.apply(_descriptor$buffer$da, _toConsumableArray(updateFuncs[descriptor.name](feature, featureIdx, vertice, vertexIdx, normal, vertexIndex)));\n                }\n              });\n            };\n            for (var vertexIdx = 0; vertexIdx < verticesNumForCurrentFeature; vertexIdx++) {\n              _loop(vertexIdx);\n            }\n          });\n          return _context.abrupt(\"return\", {\n            descriptors: descriptors,\n            featureLayout: featureLayout,\n            indices: indices\n          });\n        case 8:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function lineModel(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __extends } from \"tslib\";\nimport Hierarchy from '@antv/hierarchy';\nimport { each, isObject, isString, clone } from '@antv/util';\nimport Util from '../util';\nimport { deepClone } from '../util/deepClone';\nimport Graph from './graph';\nvar radialLayout = Util.radialLayout,\n  traverseTree = Util.traverseTree;\nvar TreeGraph = /** @class */function (_super) {\n  __extends(TreeGraph, _super);\n  function TreeGraph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n    _this.layoutAnimating = false;\n    // 用于缓存动画结束后需要删除的节点\n    _this.set('removeList', []);\n    _this.set('layoutMethod', _this.getLayout());\n    return _this;\n  }\n  /**\n   * 通过 Layout 配置获取布局配置\n   */\n  TreeGraph.prototype.getLayout = function () {\n    var layout = this.get('layout');\n    if (!layout) {\n      return null;\n    }\n    if (typeof layout === 'function') {\n      return layout;\n    }\n    if (!layout.type) {\n      layout.type = 'dendrogram';\n    }\n    if (!layout.direction) {\n      layout.direction = layout.type === 'indented' ? 'LR' : 'TB';\n    }\n    if (layout.radial) {\n      return function (data) {\n        var layoutData = Hierarchy[layout.type](data, layout);\n        radialLayout(layoutData);\n        return layoutData;\n      };\n    }\n    return function (data) {\n      return Hierarchy[layout.type](data, layout);\n    };\n  };\n  /**\n   * 返回指定节点在树图数据中的索引\n   * @param children 树图数据\n   * @param child 树图中某一个 Item 的数据\n   */\n  TreeGraph.indexOfChild = function (children, id) {\n    var index = -1;\n    // eslint-disable-next-line consistent-return\n    each(children, function (former, i) {\n      if (id === former.id) {\n        index = i;\n        return false;\n      }\n    });\n    return index;\n  };\n  TreeGraph.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n    // 树图默认打开动画\n    cfg.animate = true;\n    return cfg;\n  };\n  /**\n   * 向🌲树中添加数据\n   * @param treeData 树图数据\n   * @param parent 父节点实例\n   * @param animate 是否开启动画\n   */\n  TreeGraph.prototype.innerAddChild = function (treeData, parent, animate) {\n    var self = this;\n    var model = treeData.data;\n    if (model) {\n      // model 中应存储真实的数据，特别是真实的 children\n      model.x = treeData.x;\n      model.y = treeData.y;\n      model.depth = treeData.depth;\n    }\n    var node = self.addItem('node', model, false);\n    if (parent) {\n      node.set('parent', parent);\n      if (animate) {\n        var origin_1 = parent.get('originAttrs');\n        if (origin_1) {\n          node.set('originAttrs', origin_1);\n        } else {\n          var parentModel = parent.getModel();\n          node.set('originAttrs', {\n            x: parentModel.x,\n            y: parentModel.y\n          });\n        }\n      }\n      var childrenList = parent.get('children');\n      if (!childrenList) {\n        parent.set('children', [node]);\n      } else {\n        childrenList.push(node);\n      }\n      self.addItem('edge', {\n        source: parent.get('id'),\n        target: node.get('id'),\n        id: \"\".concat(parent.get('id'), \":\").concat(node.get('id'))\n      }, false);\n    }\n    // 渲染到视图上应参考布局的children, 避免多绘制了收起的节点\n    each(treeData.children || [], function (child) {\n      self.innerAddChild(child, node, animate);\n    });\n    self.emit('afteraddchild', {\n      item: node,\n      parent: parent\n    });\n    return node;\n  };\n  /**\n   * 将数据上的变更转换到视图上\n   * @param data\n   * @param parent\n   * @param animate\n   */\n  TreeGraph.prototype.innerUpdateChild = function (data, parent, animate) {\n    var self = this;\n    var current = self.findById(data.id);\n    // 若子树不存在，整体添加即可\n    if (!current) {\n      self.innerAddChild(data, parent, animate);\n      return;\n    }\n    // 更新新节点下所有子节点\n    each(data.children || [], function (child) {\n      self.innerUpdateChild(child, current, animate);\n    });\n    // 用现在节点的children实例来删除移除的子节点\n    var children = current.get('children');\n    if (children) {\n      var len = children.length;\n      if (len > 0) {\n        for (var i = children.length - 1; i >= 0; i--) {\n          var child = children[i].getModel();\n          if (TreeGraph.indexOfChild(data.children || [], child.id) === -1) {\n            self.innerRemoveChild(child.id, {\n              x: data.x,\n              y: data.y\n            }, animate);\n            // 更新父节点下缓存的子节点 item 实例列表\n            children.splice(i, 1);\n          }\n        }\n      }\n    }\n    var oriX;\n    var oriY;\n    if (current.get('originAttrs')) {\n      oriX = current.get('originAttrs').x;\n      oriY = current.get('originAttrs').y;\n    }\n    var model = current.getModel();\n    if (animate) {\n      // 如果有动画，先缓存节点运动再更新节点\n      current.set('originAttrs', {\n        x: model.x,\n        y: model.y\n      });\n    }\n    current.set('model', Object.assign(model, data.data));\n    if (oriX !== data.x || oriY !== data.y) {\n      current.updatePosition({\n        x: data.x,\n        y: data.y\n      });\n    }\n  };\n  /**\n   * 删除子节点Item对象\n   * @param id\n   * @param to\n   * @param animate\n   */\n  TreeGraph.prototype.innerRemoveChild = function (id, to, animate) {\n    var self = this;\n    var node = self.findById(id);\n    if (!node) {\n      return;\n    }\n    each(node.get('children'), function (child) {\n      self.innerRemoveChild(child.getModel().id, to, animate);\n    });\n    if (animate) {\n      var model = node.getModel();\n      node.set('to', to);\n      node.set('originAttrs', {\n        x: model.x,\n        y: model.y\n      });\n      self.get('removeList').push(node);\n    } else {\n      self.removeItem(node, false);\n    }\n  };\n  /**\n   * 更新数据模型，差量更新并重新渲染\n   * @param {object} data 数据模型\n   */\n  TreeGraph.prototype.changeData = function (data, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 更改数据源后，取消所有状态\n    this.getNodes().map(function (node) {\n      return self.clearItemStates(node);\n    });\n    this.getEdges().map(function (edge) {\n      return self.clearItemStates(edge);\n    });\n    if (stack && this.get('enabledStack')) {\n      this.pushStack('changedata', {\n        before: self.get('originData'),\n        after: data || self.get('data')\n      });\n    }\n    if (data) {\n      self.data(data);\n      self.render(false);\n    } else {\n      self.layout(this.get('fitView'));\n    }\n  };\n  /**\n   * 已更名为 updateLayout，为保持兼容暂且保留。\n   * 更改并应用树布局算法\n   * @param {object} layout 布局算法\n   */\n  TreeGraph.prototype.changeLayout = function (layout) {\n    // eslint-disable-next-line no-console\n    console.warn('Please call updateLayout instead of changeLayout. changeLayout will be discarded soon');\n    var self = this;\n    self.updateLayout(layout);\n  };\n  /**\n   * 更改并应用树布局算法\n   * @param {object} layout 布局算法\n   */\n  TreeGraph.prototype.updateLayout = function (layout, align, alignPoint, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    if (!layout) {\n      // eslint-disable-next-line no-console\n      console.warn('layout cannot be null');\n      return;\n    }\n    if (stack && this.get('enabledStack')) {\n      this.pushStack('layout', {\n        before: self.get('layout'),\n        after: layout\n      });\n    }\n    self.set('layout', layout);\n    self.set('layoutMethod', self.getLayout());\n    self.layout();\n    // align the graph after layout\n    if (align) {\n      var toPoint = alignPoint;\n      if (!toPoint) {\n        if (align === 'begin') toPoint = {\n          x: 0,\n          y: 0\n        };else toPoint = {\n          x: this.getWidth() / 2,\n          y: this.getHeight() / 2\n        };\n      }\n      // translate to point coordinate system\n      toPoint = this.getPointByCanvas(toPoint.x, toPoint.y);\n      var matrix = this.getGroup().getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n      toPoint.x = toPoint.x * matrix[0] + matrix[6];\n      toPoint.y = toPoint.y * matrix[0] + matrix[7];\n      var _a = this.getGroup().getCanvasBBox(),\n        minX = _a.minX,\n        maxX = _a.maxX,\n        minY = _a.minY,\n        maxY = _a.maxY;\n      var bboxPoint = {\n        x: (minX + maxX) / 2,\n        y: (minY + maxY) / 2\n      };\n      if (align === 'begin') {\n        bboxPoint.x = minX;\n        bboxPoint.y = minY;\n      }\n      this.translate(toPoint.x - bboxPoint.x, toPoint.y - bboxPoint.y);\n    }\n  };\n  /**\n   * 已更名为 layout，为保持兼容暂且保留。\n   * 根据目前的 data 刷新布局，更新到画布上。用于变更数据之后刷新视图。\n   * @param {boolean} fitView 更新布局时是否需要适应窗口\n   */\n  TreeGraph.prototype.refreshLayout = function (fitView) {\n    // eslint-disable-next-line no-console\n    console.warn('Please call layout instead of refreshLayout. refreshLayout will be discarded soon');\n    var self = this;\n    self.layout(fitView);\n  };\n  /**\n   * 根据目前的 data 刷新布局，更新到画布上。用于变更数据之后刷新视图。\n   * @param {boolean} fitView 更新布局时是否需要适应窗口\n   */\n  TreeGraph.prototype.layout = function (fitView) {\n    var _this = this;\n    var self = this;\n    var data = self.get('data');\n    var layoutMethod = self.get('layoutMethod');\n    var layoutConfig = self.get('layout');\n    var layoutData = data;\n    if (layoutConfig === null || layoutConfig === void 0 ? void 0 : layoutConfig.excludeInvisibles) {\n      data = clone(self.get('data'));\n      var cacheChidMap_1 = {};\n      traverseTree(data, function (subTree) {\n        var siblings = subTree.children;\n        if (!(siblings === null || siblings === void 0 ? void 0 : siblings.length)) return true;\n        for (var i = siblings.length - 1; i >= 0; i--) {\n          var node = _this.findById(siblings[i].id);\n          var isHidden = node ? !node.isVisible() : siblings[i].visible === false;\n          if (isHidden) {\n            cacheChidMap_1[subTree.id] = cacheChidMap_1[subTree.id] || [];\n            cacheChidMap_1[subTree.id].push({\n              idx: i,\n              child: siblings.splice(i, 1)[0]\n            });\n          }\n        }\n      });\n      layoutData = layoutMethod ? layoutMethod(data, self.get('layout')) : data;\n      traverseTree(layoutData, function (subTree) {\n        var cachedItems = cacheChidMap_1[subTree.id];\n        if (cachedItems === null || cachedItems === void 0 ? void 0 : cachedItems.length) {\n          for (var i = cachedItems.length - 1; i >= 0; i--) {\n            var _a = cachedItems[i],\n              idx = _a.idx,\n              child = _a.child;\n            subTree.children.splice(idx, 0, child);\n          }\n        }\n      });\n    } else {\n      layoutData = layoutMethod ? layoutMethod(data, self.get('layout')) : data;\n    }\n    var animate = self.get('animate');\n    self.emit('beforerefreshlayout', {\n      data: data,\n      layoutData: layoutData\n    });\n    self.emit('beforelayout');\n    self.innerUpdateChild(layoutData, undefined, animate);\n    if (fitView) {\n      var viewController = self.get('viewController');\n      viewController.fitView();\n    }\n    if (!animate) {\n      // 如果没有动画，目前仅更新了节点的位置，刷新一下边的样式\n      self.refresh();\n      self.paint();\n    } else {\n      self.layoutAnimate(layoutData);\n    }\n    self.emit('afterrefreshlayout', {\n      data: data,\n      layoutData: layoutData\n    });\n    self.emit('afterlayout');\n  };\n  /**\n   * 添加子树到对应 id 的节点\n   * @param {TreeGraphData} data 子树数据模型\n   * @param {string} parent 子树的父节点id\n   */\n  TreeGraph.prototype.addChild = function (data, parent, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    self.emit('beforeaddchild', {\n      model: data,\n      parent: parent\n    });\n    // 将数据添加到源数据中，走changeData方法\n    if (!isString(parent)) {\n      parent = parent.get('id');\n    }\n    var parentData = self.findDataById(parent);\n    if (parentData) {\n      if (!parentData.children) {\n        parentData.children = [];\n      }\n      parentData.children.push(data);\n      var parentItem = self.findById(parent);\n      parentItem.refresh();\n      self.changeData(undefined, stack);\n    }\n  };\n  /**\n   * 更新某个节点下的所有子节点\n   * @param {TreeGraphData[]} data 子树数据模型集合\n   * @param {string} parent 子树的父节点id\n   */\n  TreeGraph.prototype.updateChildren = function (data, parentId, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 如果没有父节点或找不到该节点，是全量的更新，直接重置data\n    var parentItem = self.findById(parentId);\n    if (!parentId || !parentItem) {\n      console.warn(\"Update children failed! There is no node with id '\".concat(parentId, \"'\"));\n      return;\n    }\n    var parentModel = self.findDataById(parentId);\n    parentModel.children = data;\n    parentItem.refresh();\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 更新源数据，差量更新子树\n   * @param {TreeGraphData} data 子树数据模型\n   * @param {string} parentId 子树的父节点id\n   */\n  TreeGraph.prototype.updateChild = function (data, parentId, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 如果没有父节点或找不到该节点，是全量的更新，直接重置data\n    if (!parentId || !self.findById(parentId)) {\n      self.changeData(data, stack);\n      return;\n    }\n    var parentModel = self.findDataById(parentId);\n    var current = self.findById(data.id);\n    if (!parentModel.children) {\n      // 当 current 不存在时，children 为空数组\n      parentModel.children = [];\n    }\n    // 如果不存在该节点，则添加\n    if (!current) {\n      parentModel.children.push(data);\n    } else {\n      var index = TreeGraph.indexOfChild(parentModel.children, data.id);\n      if (index > -1) parentModel.children[index] = data;\n    }\n    var parentItem = self.findById(parentId);\n    parentItem === null || parentItem === void 0 ? void 0 : parentItem.refresh();\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 删除子树\n   * @param {string} id 子树根节点id\n   */\n  TreeGraph.prototype.removeChild = function (id, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    var node = self.findById(id);\n    var parent;\n    if (!node) {\n      parent = self.getNodes().find(function (node) {\n        var children = node.getModel().children || [];\n        return !!children.find(function (child) {\n          return child.id === id;\n        });\n      });\n    } else {\n      parent = node === null || node === void 0 ? void 0 : node.get('parent');\n    }\n    if (parent && !parent.destroyed) {\n      var parentId = parent.get('id');\n      var parentNode = self.findDataById(parentId);\n      var siblings = parentNode && parentNode.children || [];\n      var index = TreeGraph.indexOfChild(siblings, id);\n      siblings.splice(index, 1);\n      parent.refresh();\n    }\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 根据id获取对应的源数据\n   * @param {string} id 元素id\n   * @param {TreeGraphData | undefined} parent 从哪个节点开始寻找，为空时从根节点开始查找\n   * @return {TreeGraphData} 对应源数据\n   */\n  TreeGraph.prototype.findDataById = function (id, parent) {\n    var self = this;\n    if (!parent) {\n      parent = self.get('data');\n    }\n    if (id === parent.id) {\n      return parent;\n    }\n    var result = null;\n    // eslint-disable-next-line consistent-return\n    each(parent.children || [], function (child) {\n      if (child.id === id) {\n        result = child;\n        return false;\n      }\n      result = self.findDataById(id, child);\n      if (result) {\n        return false;\n      }\n    });\n    return result;\n  };\n  /**\n   * 布局动画接口，用于数据更新时做节点位置更新的动画\n   * @param {TreeGraphData} data 更新的数据\n   * @param {function} onFrame 定义节点位置更新时如何移动\n   */\n  TreeGraph.prototype.layoutAnimate = function (data, onFrame) {\n    var self = this;\n    var animateCfg = this.get('animateCfg');\n    self.emit('beforeanimate', {\n      data: data\n    });\n    // 如果边中没有指定锚点，但是本身有锚点控制，在动画过程中保持锚点不变\n    self.getEdges().forEach(function (edge) {\n      var model = edge.get('model');\n      if (!model.sourceAnchor) {\n        model.sourceAnchor = edge.get('sourceAnchorIndex');\n      }\n    });\n    this.get('canvas').animate(function (ratio) {\n      traverseTree(data, function (child) {\n        var node = self.findById(child.id);\n        // 只有当存在node的时候才执行\n        if (node) {\n          var origin_2 = node.get('originAttrs');\n          var model = node.get('model');\n          if (!origin_2) {\n            origin_2 = {\n              x: model.x,\n              y: model.y\n            };\n            node.set('originAttrs', origin_2);\n          }\n          if (onFrame) {\n            var attrs = onFrame(node, ratio, origin_2, data);\n            node.set('model', Object.assign(model, attrs));\n          } else {\n            model.x = origin_2.x + (child.x - origin_2.x) * ratio;\n            model.y = origin_2.y + (child.y - origin_2.y) * ratio;\n          }\n        }\n        return true;\n      });\n      each(self.get('removeList'), function (node) {\n        var model = node.getModel();\n        var from = node.get('originAttrs');\n        var to = node.get('to');\n        model.x = from.x + (to.x - from.x) * ratio;\n        model.y = from.y + (to.y - from.y) * ratio;\n      });\n      self.refreshPositions();\n    }, {\n      duration: animateCfg.duration,\n      easing: animateCfg.ease,\n      callback: function callback() {\n        each(self.getNodes(), function (node) {\n          node.set('originAttrs', null);\n        });\n        each(self.get('removeList'), function (node) {\n          self.removeItem(node, false);\n        });\n        self.set('removeList', []);\n        if (animateCfg.callback) {\n          animateCfg.callback();\n        }\n        self.emit('afteranimate', {\n          data: data\n        });\n      },\n      delay: animateCfg.delay\n    });\n  };\n  /**\n   * 立即停止布局动画\n   */\n  TreeGraph.prototype.stopLayoutAnimate = function () {\n    this.get('canvas').stopAnimate();\n    this.emit('layoutanimateend', {\n      data: this.get('data')\n    });\n    this.layoutAnimating = false;\n  };\n  /**\n   * 是否在布局动画\n   * @return {boolean} 是否有布局动画\n   */\n  TreeGraph.prototype.isLayoutAnimating = function () {\n    return this.layoutAnimating;\n  };\n  /**\n   * 根据data接口的数据渲染视图\n   */\n  TreeGraph.prototype.render = function (clearStack) {\n    if (clearStack === void 0) {\n      clearStack = true;\n    }\n    var self = this;\n    var data = self.get('data');\n    if (!data || !isObject(data) || !Object.keys(data).length) {\n      throw new Error('data must be defined first');\n    }\n    self.clear();\n    if (clearStack && this.get('enabledStack')) {\n      // render 之前清空 redo 和 undo 栈\n      this.clearStack();\n    }\n    self.emit('beforerender');\n    self.layout(this.get('fitView'));\n    self.emit('afterrender');\n  };\n  /**\n   * 导出图数据\n   * @return {object} data\n   */\n  TreeGraph.prototype.save = function () {\n    return this.get('data');\n  };\n  /**\n   * 设置视图初始化数据\n   * @param {TreeGraphData} data 初始化数据\n   */\n  TreeGraph.prototype.data = function (data) {\n    _super.prototype.data.call(this, data);\n    this.set('originData', deepClone(data));\n  };\n  return TreeGraph;\n}(Graph);\nexport default TreeGraph;","map":{"version":3,"names":["__extends","Hierarchy","each","isObject","isString","clone","Util","deepClone","Graph","radialLayout","traverseTree","TreeGraph","_super","cfg","_this","call","layoutAnimating","set","getLayout","prototype","layout","get","type","direction","radial","data","layoutData","indexOfChild","children","id","index","former","i","getDefaultCfg","animate","innerAddChild","treeData","parent","self","model","x","y","depth","node","addItem","origin_1","parentModel","getModel","childrenList","push","source","target","concat","child","emit","item","innerUpdateChild","current","findById","len","length","innerRemoveChild","splice","oriX","oriY","Object","assign","updatePosition","to","removeItem","changeData","stack","getNodes","map","clearItemStates","getEdges","edge","pushStack","before","after","render","changeLayout","console","warn","updateLayout","align","alignPoint","toPoint","getWidth","getHeight","getPointByCanvas","matrix","getGroup","getMatrix","_a","getCanvasBBox","minX","maxX","minY","maxY","bboxPoint","translate","refreshLayout","fitView","layoutMethod","layoutConfig","excludeInvisibles","cacheChidMap_1","subTree","siblings","isHidden","isVisible","visible","idx","cachedItems","undefined","viewController","refresh","paint","layoutAnimate","addChild","parentData","findDataById","parentItem","updateChildren","parentId","updateChild","removeChild","find","destroyed","parentNode","result","onFrame","animateCfg","forEach","sourceAnchor","ratio","origin_2","attrs","from","refreshPositions","duration","easing","ease","callback","delay","stopLayoutAnimate","stopAnimate","isLayoutAnimating","clearStack","keys","Error","clear","save"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/g6-pc/es/graph/tree-graph.js"],"sourcesContent":["import { __extends } from \"tslib\";\nimport Hierarchy from '@antv/hierarchy';\nimport { each, isObject, isString, clone } from '@antv/util';\nimport Util from '../util';\nimport { deepClone } from '../util/deepClone';\nimport Graph from './graph';\nvar radialLayout = Util.radialLayout,\n  traverseTree = Util.traverseTree;\nvar TreeGraph = /** @class */function (_super) {\n  __extends(TreeGraph, _super);\n  function TreeGraph(cfg) {\n    var _this = _super.call(this, cfg) || this;\n    _this.layoutAnimating = false;\n    // 用于缓存动画结束后需要删除的节点\n    _this.set('removeList', []);\n    _this.set('layoutMethod', _this.getLayout());\n    return _this;\n  }\n  /**\n   * 通过 Layout 配置获取布局配置\n   */\n  TreeGraph.prototype.getLayout = function () {\n    var layout = this.get('layout');\n    if (!layout) {\n      return null;\n    }\n    if (typeof layout === 'function') {\n      return layout;\n    }\n    if (!layout.type) {\n      layout.type = 'dendrogram';\n    }\n    if (!layout.direction) {\n      layout.direction = layout.type === 'indented' ? 'LR' : 'TB';\n    }\n    if (layout.radial) {\n      return function (data) {\n        var layoutData = Hierarchy[layout.type](data, layout);\n        radialLayout(layoutData);\n        return layoutData;\n      };\n    }\n    return function (data) {\n      return Hierarchy[layout.type](data, layout);\n    };\n  };\n  /**\n   * 返回指定节点在树图数据中的索引\n   * @param children 树图数据\n   * @param child 树图中某一个 Item 的数据\n   */\n  TreeGraph.indexOfChild = function (children, id) {\n    var index = -1;\n    // eslint-disable-next-line consistent-return\n    each(children, function (former, i) {\n      if (id === former.id) {\n        index = i;\n        return false;\n      }\n    });\n    return index;\n  };\n  TreeGraph.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n    // 树图默认打开动画\n    cfg.animate = true;\n    return cfg;\n  };\n  /**\n   * 向🌲树中添加数据\n   * @param treeData 树图数据\n   * @param parent 父节点实例\n   * @param animate 是否开启动画\n   */\n  TreeGraph.prototype.innerAddChild = function (treeData, parent, animate) {\n    var self = this;\n    var model = treeData.data;\n    if (model) {\n      // model 中应存储真实的数据，特别是真实的 children\n      model.x = treeData.x;\n      model.y = treeData.y;\n      model.depth = treeData.depth;\n    }\n    var node = self.addItem('node', model, false);\n    if (parent) {\n      node.set('parent', parent);\n      if (animate) {\n        var origin_1 = parent.get('originAttrs');\n        if (origin_1) {\n          node.set('originAttrs', origin_1);\n        } else {\n          var parentModel = parent.getModel();\n          node.set('originAttrs', {\n            x: parentModel.x,\n            y: parentModel.y\n          });\n        }\n      }\n      var childrenList = parent.get('children');\n      if (!childrenList) {\n        parent.set('children', [node]);\n      } else {\n        childrenList.push(node);\n      }\n      self.addItem('edge', {\n        source: parent.get('id'),\n        target: node.get('id'),\n        id: \"\".concat(parent.get('id'), \":\").concat(node.get('id'))\n      }, false);\n    }\n    // 渲染到视图上应参考布局的children, 避免多绘制了收起的节点\n    each(treeData.children || [], function (child) {\n      self.innerAddChild(child, node, animate);\n    });\n    self.emit('afteraddchild', {\n      item: node,\n      parent: parent\n    });\n    return node;\n  };\n  /**\n   * 将数据上的变更转换到视图上\n   * @param data\n   * @param parent\n   * @param animate\n   */\n  TreeGraph.prototype.innerUpdateChild = function (data, parent, animate) {\n    var self = this;\n    var current = self.findById(data.id);\n    // 若子树不存在，整体添加即可\n    if (!current) {\n      self.innerAddChild(data, parent, animate);\n      return;\n    }\n    // 更新新节点下所有子节点\n    each(data.children || [], function (child) {\n      self.innerUpdateChild(child, current, animate);\n    });\n    // 用现在节点的children实例来删除移除的子节点\n    var children = current.get('children');\n    if (children) {\n      var len = children.length;\n      if (len > 0) {\n        for (var i = children.length - 1; i >= 0; i--) {\n          var child = children[i].getModel();\n          if (TreeGraph.indexOfChild(data.children || [], child.id) === -1) {\n            self.innerRemoveChild(child.id, {\n              x: data.x,\n              y: data.y\n            }, animate);\n            // 更新父节点下缓存的子节点 item 实例列表\n            children.splice(i, 1);\n          }\n        }\n      }\n    }\n    var oriX;\n    var oriY;\n    if (current.get('originAttrs')) {\n      oriX = current.get('originAttrs').x;\n      oriY = current.get('originAttrs').y;\n    }\n    var model = current.getModel();\n    if (animate) {\n      // 如果有动画，先缓存节点运动再更新节点\n      current.set('originAttrs', {\n        x: model.x,\n        y: model.y\n      });\n    }\n    current.set('model', Object.assign(model, data.data));\n    if (oriX !== data.x || oriY !== data.y) {\n      current.updatePosition({\n        x: data.x,\n        y: data.y\n      });\n    }\n  };\n  /**\n   * 删除子节点Item对象\n   * @param id\n   * @param to\n   * @param animate\n   */\n  TreeGraph.prototype.innerRemoveChild = function (id, to, animate) {\n    var self = this;\n    var node = self.findById(id);\n    if (!node) {\n      return;\n    }\n    each(node.get('children'), function (child) {\n      self.innerRemoveChild(child.getModel().id, to, animate);\n    });\n    if (animate) {\n      var model = node.getModel();\n      node.set('to', to);\n      node.set('originAttrs', {\n        x: model.x,\n        y: model.y\n      });\n      self.get('removeList').push(node);\n    } else {\n      self.removeItem(node, false);\n    }\n  };\n  /**\n   * 更新数据模型，差量更新并重新渲染\n   * @param {object} data 数据模型\n   */\n  TreeGraph.prototype.changeData = function (data, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 更改数据源后，取消所有状态\n    this.getNodes().map(function (node) {\n      return self.clearItemStates(node);\n    });\n    this.getEdges().map(function (edge) {\n      return self.clearItemStates(edge);\n    });\n    if (stack && this.get('enabledStack')) {\n      this.pushStack('changedata', {\n        before: self.get('originData'),\n        after: data || self.get('data')\n      });\n    }\n    if (data) {\n      self.data(data);\n      self.render(false);\n    } else {\n      self.layout(this.get('fitView'));\n    }\n  };\n  /**\n   * 已更名为 updateLayout，为保持兼容暂且保留。\n   * 更改并应用树布局算法\n   * @param {object} layout 布局算法\n   */\n  TreeGraph.prototype.changeLayout = function (layout) {\n    // eslint-disable-next-line no-console\n    console.warn('Please call updateLayout instead of changeLayout. changeLayout will be discarded soon');\n    var self = this;\n    self.updateLayout(layout);\n  };\n  /**\n   * 更改并应用树布局算法\n   * @param {object} layout 布局算法\n   */\n  TreeGraph.prototype.updateLayout = function (layout, align, alignPoint, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    if (!layout) {\n      // eslint-disable-next-line no-console\n      console.warn('layout cannot be null');\n      return;\n    }\n    if (stack && this.get('enabledStack')) {\n      this.pushStack('layout', {\n        before: self.get('layout'),\n        after: layout\n      });\n    }\n    self.set('layout', layout);\n    self.set('layoutMethod', self.getLayout());\n    self.layout();\n    // align the graph after layout\n    if (align) {\n      var toPoint = alignPoint;\n      if (!toPoint) {\n        if (align === 'begin') toPoint = {\n          x: 0,\n          y: 0\n        };else toPoint = {\n          x: this.getWidth() / 2,\n          y: this.getHeight() / 2\n        };\n      }\n      // translate to point coordinate system\n      toPoint = this.getPointByCanvas(toPoint.x, toPoint.y);\n      var matrix = this.getGroup().getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n      toPoint.x = toPoint.x * matrix[0] + matrix[6];\n      toPoint.y = toPoint.y * matrix[0] + matrix[7];\n      var _a = this.getGroup().getCanvasBBox(),\n        minX = _a.minX,\n        maxX = _a.maxX,\n        minY = _a.minY,\n        maxY = _a.maxY;\n      var bboxPoint = {\n        x: (minX + maxX) / 2,\n        y: (minY + maxY) / 2\n      };\n      if (align === 'begin') {\n        bboxPoint.x = minX;\n        bboxPoint.y = minY;\n      }\n      this.translate(toPoint.x - bboxPoint.x, toPoint.y - bboxPoint.y);\n    }\n  };\n  /**\n   * 已更名为 layout，为保持兼容暂且保留。\n   * 根据目前的 data 刷新布局，更新到画布上。用于变更数据之后刷新视图。\n   * @param {boolean} fitView 更新布局时是否需要适应窗口\n   */\n  TreeGraph.prototype.refreshLayout = function (fitView) {\n    // eslint-disable-next-line no-console\n    console.warn('Please call layout instead of refreshLayout. refreshLayout will be discarded soon');\n    var self = this;\n    self.layout(fitView);\n  };\n  /**\n   * 根据目前的 data 刷新布局，更新到画布上。用于变更数据之后刷新视图。\n   * @param {boolean} fitView 更新布局时是否需要适应窗口\n   */\n  TreeGraph.prototype.layout = function (fitView) {\n    var _this = this;\n    var self = this;\n    var data = self.get('data');\n    var layoutMethod = self.get('layoutMethod');\n    var layoutConfig = self.get('layout');\n    var layoutData = data;\n    if (layoutConfig === null || layoutConfig === void 0 ? void 0 : layoutConfig.excludeInvisibles) {\n      data = clone(self.get('data'));\n      var cacheChidMap_1 = {};\n      traverseTree(data, function (subTree) {\n        var siblings = subTree.children;\n        if (!(siblings === null || siblings === void 0 ? void 0 : siblings.length)) return true;\n        for (var i = siblings.length - 1; i >= 0; i--) {\n          var node = _this.findById(siblings[i].id);\n          var isHidden = node ? !node.isVisible() : siblings[i].visible === false;\n          if (isHidden) {\n            cacheChidMap_1[subTree.id] = cacheChidMap_1[subTree.id] || [];\n            cacheChidMap_1[subTree.id].push({\n              idx: i,\n              child: siblings.splice(i, 1)[0]\n            });\n          }\n        }\n      });\n      layoutData = layoutMethod ? layoutMethod(data, self.get('layout')) : data;\n      traverseTree(layoutData, function (subTree) {\n        var cachedItems = cacheChidMap_1[subTree.id];\n        if (cachedItems === null || cachedItems === void 0 ? void 0 : cachedItems.length) {\n          for (var i = cachedItems.length - 1; i >= 0; i--) {\n            var _a = cachedItems[i],\n              idx = _a.idx,\n              child = _a.child;\n            subTree.children.splice(idx, 0, child);\n          }\n        }\n      });\n    } else {\n      layoutData = layoutMethod ? layoutMethod(data, self.get('layout')) : data;\n    }\n    var animate = self.get('animate');\n    self.emit('beforerefreshlayout', {\n      data: data,\n      layoutData: layoutData\n    });\n    self.emit('beforelayout');\n    self.innerUpdateChild(layoutData, undefined, animate);\n    if (fitView) {\n      var viewController = self.get('viewController');\n      viewController.fitView();\n    }\n    if (!animate) {\n      // 如果没有动画，目前仅更新了节点的位置，刷新一下边的样式\n      self.refresh();\n      self.paint();\n    } else {\n      self.layoutAnimate(layoutData);\n    }\n    self.emit('afterrefreshlayout', {\n      data: data,\n      layoutData: layoutData\n    });\n    self.emit('afterlayout');\n  };\n  /**\n   * 添加子树到对应 id 的节点\n   * @param {TreeGraphData} data 子树数据模型\n   * @param {string} parent 子树的父节点id\n   */\n  TreeGraph.prototype.addChild = function (data, parent, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    self.emit('beforeaddchild', {\n      model: data,\n      parent: parent\n    });\n    // 将数据添加到源数据中，走changeData方法\n    if (!isString(parent)) {\n      parent = parent.get('id');\n    }\n    var parentData = self.findDataById(parent);\n    if (parentData) {\n      if (!parentData.children) {\n        parentData.children = [];\n      }\n      parentData.children.push(data);\n      var parentItem = self.findById(parent);\n      parentItem.refresh();\n      self.changeData(undefined, stack);\n    }\n  };\n  /**\n   * 更新某个节点下的所有子节点\n   * @param {TreeGraphData[]} data 子树数据模型集合\n   * @param {string} parent 子树的父节点id\n   */\n  TreeGraph.prototype.updateChildren = function (data, parentId, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 如果没有父节点或找不到该节点，是全量的更新，直接重置data\n    var parentItem = self.findById(parentId);\n    if (!parentId || !parentItem) {\n      console.warn(\"Update children failed! There is no node with id '\".concat(parentId, \"'\"));\n      return;\n    }\n    var parentModel = self.findDataById(parentId);\n    parentModel.children = data;\n    parentItem.refresh();\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 更新源数据，差量更新子树\n   * @param {TreeGraphData} data 子树数据模型\n   * @param {string} parentId 子树的父节点id\n   */\n  TreeGraph.prototype.updateChild = function (data, parentId, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    // 如果没有父节点或找不到该节点，是全量的更新，直接重置data\n    if (!parentId || !self.findById(parentId)) {\n      self.changeData(data, stack);\n      return;\n    }\n    var parentModel = self.findDataById(parentId);\n    var current = self.findById(data.id);\n    if (!parentModel.children) {\n      // 当 current 不存在时，children 为空数组\n      parentModel.children = [];\n    }\n    // 如果不存在该节点，则添加\n    if (!current) {\n      parentModel.children.push(data);\n    } else {\n      var index = TreeGraph.indexOfChild(parentModel.children, data.id);\n      if (index > -1) parentModel.children[index] = data;\n    }\n    var parentItem = self.findById(parentId);\n    parentItem === null || parentItem === void 0 ? void 0 : parentItem.refresh();\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 删除子树\n   * @param {string} id 子树根节点id\n   */\n  TreeGraph.prototype.removeChild = function (id, stack) {\n    if (stack === void 0) {\n      stack = true;\n    }\n    var self = this;\n    var node = self.findById(id);\n    var parent;\n    if (!node) {\n      parent = self.getNodes().find(function (node) {\n        var children = node.getModel().children || [];\n        return !!children.find(function (child) {\n          return child.id === id;\n        });\n      });\n    } else {\n      parent = node === null || node === void 0 ? void 0 : node.get('parent');\n    }\n    if (parent && !parent.destroyed) {\n      var parentId = parent.get('id');\n      var parentNode = self.findDataById(parentId);\n      var siblings = parentNode && parentNode.children || [];\n      var index = TreeGraph.indexOfChild(siblings, id);\n      siblings.splice(index, 1);\n      parent.refresh();\n    }\n    self.changeData(undefined, stack);\n  };\n  /**\n   * 根据id获取对应的源数据\n   * @param {string} id 元素id\n   * @param {TreeGraphData | undefined} parent 从哪个节点开始寻找，为空时从根节点开始查找\n   * @return {TreeGraphData} 对应源数据\n   */\n  TreeGraph.prototype.findDataById = function (id, parent) {\n    var self = this;\n    if (!parent) {\n      parent = self.get('data');\n    }\n    if (id === parent.id) {\n      return parent;\n    }\n    var result = null;\n    // eslint-disable-next-line consistent-return\n    each(parent.children || [], function (child) {\n      if (child.id === id) {\n        result = child;\n        return false;\n      }\n      result = self.findDataById(id, child);\n      if (result) {\n        return false;\n      }\n    });\n    return result;\n  };\n  /**\n   * 布局动画接口，用于数据更新时做节点位置更新的动画\n   * @param {TreeGraphData} data 更新的数据\n   * @param {function} onFrame 定义节点位置更新时如何移动\n   */\n  TreeGraph.prototype.layoutAnimate = function (data, onFrame) {\n    var self = this;\n    var animateCfg = this.get('animateCfg');\n    self.emit('beforeanimate', {\n      data: data\n    });\n    // 如果边中没有指定锚点，但是本身有锚点控制，在动画过程中保持锚点不变\n    self.getEdges().forEach(function (edge) {\n      var model = edge.get('model');\n      if (!model.sourceAnchor) {\n        model.sourceAnchor = edge.get('sourceAnchorIndex');\n      }\n    });\n    this.get('canvas').animate(function (ratio) {\n      traverseTree(data, function (child) {\n        var node = self.findById(child.id);\n        // 只有当存在node的时候才执行\n        if (node) {\n          var origin_2 = node.get('originAttrs');\n          var model = node.get('model');\n          if (!origin_2) {\n            origin_2 = {\n              x: model.x,\n              y: model.y\n            };\n            node.set('originAttrs', origin_2);\n          }\n          if (onFrame) {\n            var attrs = onFrame(node, ratio, origin_2, data);\n            node.set('model', Object.assign(model, attrs));\n          } else {\n            model.x = origin_2.x + (child.x - origin_2.x) * ratio;\n            model.y = origin_2.y + (child.y - origin_2.y) * ratio;\n          }\n        }\n        return true;\n      });\n      each(self.get('removeList'), function (node) {\n        var model = node.getModel();\n        var from = node.get('originAttrs');\n        var to = node.get('to');\n        model.x = from.x + (to.x - from.x) * ratio;\n        model.y = from.y + (to.y - from.y) * ratio;\n      });\n      self.refreshPositions();\n    }, {\n      duration: animateCfg.duration,\n      easing: animateCfg.ease,\n      callback: function callback() {\n        each(self.getNodes(), function (node) {\n          node.set('originAttrs', null);\n        });\n        each(self.get('removeList'), function (node) {\n          self.removeItem(node, false);\n        });\n        self.set('removeList', []);\n        if (animateCfg.callback) {\n          animateCfg.callback();\n        }\n        self.emit('afteranimate', {\n          data: data\n        });\n      },\n      delay: animateCfg.delay\n    });\n  };\n  /**\n   * 立即停止布局动画\n   */\n  TreeGraph.prototype.stopLayoutAnimate = function () {\n    this.get('canvas').stopAnimate();\n    this.emit('layoutanimateend', {\n      data: this.get('data')\n    });\n    this.layoutAnimating = false;\n  };\n  /**\n   * 是否在布局动画\n   * @return {boolean} 是否有布局动画\n   */\n  TreeGraph.prototype.isLayoutAnimating = function () {\n    return this.layoutAnimating;\n  };\n  /**\n   * 根据data接口的数据渲染视图\n   */\n  TreeGraph.prototype.render = function (clearStack) {\n    if (clearStack === void 0) {\n      clearStack = true;\n    }\n    var self = this;\n    var data = self.get('data');\n    if (!data || !isObject(data) || !Object.keys(data).length) {\n      throw new Error('data must be defined first');\n    }\n    self.clear();\n    if (clearStack && this.get('enabledStack')) {\n      // render 之前清空 redo 和 undo 栈\n      this.clearStack();\n    }\n    self.emit('beforerender');\n    self.layout(this.get('fitView'));\n    self.emit('afterrender');\n  };\n  /**\n   * 导出图数据\n   * @return {object} data\n   */\n  TreeGraph.prototype.save = function () {\n    return this.get('data');\n  };\n  /**\n   * 设置视图初始化数据\n   * @param {TreeGraphData} data 初始化数据\n   */\n  TreeGraph.prototype.data = function (data) {\n    _super.prototype.data.call(this, data);\n    this.set('originData', deepClone(data));\n  };\n  return TreeGraph;\n}(Graph);\nexport default TreeGraph;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
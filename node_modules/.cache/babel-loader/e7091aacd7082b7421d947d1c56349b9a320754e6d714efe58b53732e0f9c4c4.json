{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _scaleMap, _dec, _class;\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { IDebugLog, ILayerStage, ScaleTypes, StyleScaleType } from '@antv/l7-core';\nimport { lodashUtil } from '@antv/l7-utils';\nimport { extent } from 'd3-array';\nimport * as d3interpolate from 'd3-interpolate';\nimport * as d3 from 'd3-scale';\nimport { injectable } from 'inversify';\nimport 'reflect-metadata';\nimport identity from \"../utils/identityScale\";\nvar isNil = lodashUtil.isNil,\n  isString = lodashUtil.isString,\n  uniq = lodashUtil.uniq;\nvar dateRegex = /^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))(\\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;\nvar scaleMap = (_scaleMap = {}, _defineProperty(_scaleMap, ScaleTypes.LINEAR, d3.scaleLinear), _defineProperty(_scaleMap, ScaleTypes.POWER, d3.scalePow), _defineProperty(_scaleMap, ScaleTypes.LOG, d3.scaleLog), _defineProperty(_scaleMap, ScaleTypes.IDENTITY, identity), _defineProperty(_scaleMap, ScaleTypes.SEQUENTIAL, d3.scaleSequential), _defineProperty(_scaleMap, ScaleTypes.TIME, d3.scaleTime), _defineProperty(_scaleMap, ScaleTypes.QUANTILE, d3.scaleQuantile), _defineProperty(_scaleMap, ScaleTypes.QUANTIZE, d3.scaleQuantize), _defineProperty(_scaleMap, ScaleTypes.THRESHOLD, d3.scaleThreshold), _defineProperty(_scaleMap, ScaleTypes.CAT, d3.scaleOrdinal), _defineProperty(_scaleMap, ScaleTypes.DIVERGING, d3.scaleDiverging), _scaleMap);\n/**\n * 根据 Source 原始数据为指定字段创建 Scale，保存在 StyleAttribute 上，供下游插件使用\n */\nvar FeatureScalePlugin = (_dec = injectable(), _dec(_class = /*#__PURE__*/function () {\n  function FeatureScalePlugin() {\n    _classCallCheck(this, FeatureScalePlugin);\n    _defineProperty(this, \"scaleOptions\", {});\n  }\n  _createClass(FeatureScalePlugin, [{\n    key: \"apply\",\n    value: function apply(layer, _ref) {\n      var _this = this;\n      var styleAttributeService = _ref.styleAttributeService;\n      layer.hooks.init.tapPromise('FeatureScalePlugin', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _layer$getSource;\n        var attributes, dataArray;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              layer.log(IDebugLog.ScaleInitStart, ILayerStage.INIT);\n              _this.scaleOptions = layer.getScaleOptions();\n              attributes = styleAttributeService.getLayerStyleAttributes();\n              dataArray = (_layer$getSource = layer.getSource()) === null || _layer$getSource === void 0 ? void 0 : _layer$getSource.data.dataArray;\n              if (!(Array.isArray(dataArray) && dataArray.length === 0)) {\n                _context.next = 8;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 8:\n              _this.caculateScalesForAttributes(attributes || [], dataArray);\n            case 9:\n              layer.log(IDebugLog.ScaleInitEnd, ILayerStage.INIT);\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      })));\n\n      // 检测数据是否需要更新\n      layer.hooks.beforeRenderData.tapPromise('FeatureScalePlugin', /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(flag) {\n          var attributes, dataArray;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                if (flag) {\n                  _context2.next = 2;\n                  break;\n                }\n                return _context2.abrupt(\"return\", flag);\n              case 2:\n                layer.log(IDebugLog.ScaleInitStart, ILayerStage.UPDATE);\n                _this.scaleOptions = layer.getScaleOptions();\n                attributes = styleAttributeService.getLayerStyleAttributes();\n                dataArray = layer.getSource().data.dataArray;\n                if (!(Array.isArray(dataArray) && dataArray.length === 0)) {\n                  _context2.next = 8;\n                  break;\n                }\n                return _context2.abrupt(\"return\", true);\n              case 8:\n                _this.caculateScalesForAttributes(attributes || [], dataArray);\n                layer.log(IDebugLog.ScaleInitEnd, ILayerStage.UPDATE);\n                layer.layerModelNeedUpdate = true;\n                return _context2.abrupt(\"return\", true);\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2);\n        }));\n        return function (_x) {\n          return _ref3.apply(this, arguments);\n        };\n      }());\n      layer.hooks.beforeRender.tap('FeatureScalePlugin', function () {\n        if (layer.layerModelNeedUpdate) {\n          return;\n        }\n        _this.scaleOptions = layer.getScaleOptions();\n        var attributes = styleAttributeService.getLayerStyleAttributes();\n        var dataArray = layer.getSource().data.dataArray;\n        if (Array.isArray(dataArray) && dataArray.length === 0) {\n          return;\n        }\n        if (attributes) {\n          var attributesToRescale = attributes.filter(function (attribute) {\n            return attribute.needRescale;\n          });\n          if (attributesToRescale.length) {\n            _this.caculateScalesForAttributes(attributesToRescale, dataArray);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"isNumber\",\n    value: function isNumber(n) {\n      return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n  }, {\n    key: \"caculateScalesForAttributes\",\n    value: function caculateScalesForAttributes(attributes, dataArray) {\n      var _this2 = this;\n      attributes.forEach(function (attribute) {\n        if (attribute.scale) {\n          // 创建Scale\n          var attributeScale = attribute.scale;\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          var fieldValue = attribute.scale.field;\n          attributeScale.names = _this2.parseFields(isNil(fieldValue) ? [] : fieldValue);\n          var scales = [];\n          // 为每个字段创建 Scale\n          attributeScale.names.forEach(function (field) {\n            var _attribute$scale;\n            scales.push(_this2.createScale(field, attribute.name, (_attribute$scale = attribute.scale) === null || _attribute$scale === void 0 ? void 0 : _attribute$scale.values, dataArray));\n          });\n\n          // 为scales 设置值区间 Range\n          if (scales.some(function (scale) {\n            return scale.type === StyleScaleType.VARIABLE;\n          })) {\n            attributeScale.type = StyleScaleType.VARIABLE;\n            scales.forEach(function (scale) {\n              // 如果设置了回调, 这不需要设置range\n              if (!attributeScale.callback && attributeScale.values !== 'text') {\n                var _scale$option;\n                switch ((_scale$option = scale.option) === null || _scale$option === void 0 ? void 0 : _scale$option.type) {\n                  case ScaleTypes.LOG:\n                  case ScaleTypes.LINEAR:\n                  case ScaleTypes.POWER:\n                    if (attributeScale.values && attributeScale.values.length > 2) {\n                      var tick = scale.scale.ticks(attributeScale.values.length);\n                      scale.scale.domain(tick);\n                    }\n                    attributeScale.values ? scale.scale.range(attributeScale.values) : scale.scale.range(scale.option.domain);\n                    break;\n                  case ScaleTypes.QUANTILE:\n                  case ScaleTypes.QUANTIZE:\n                  case ScaleTypes.THRESHOLD:\n                    scale.scale.range(attributeScale.values); //\n                    break;\n                  case ScaleTypes.IDENTITY:\n                    // 不做处理xe\n                    break;\n                  case ScaleTypes.CAT:\n                    attributeScale.values ? scale.scale.range(attributeScale.values) : scale.scale.range(scale.option.domain);\n                    break;\n                  case ScaleTypes.DIVERGING:\n                  case ScaleTypes.SEQUENTIAL:\n                    scale.scale.interpolator(\n                    // @ts-ignore\n                    d3interpolate.interpolateRgbBasis(attributeScale.values));\n                    break;\n                }\n              }\n              if (attributeScale.values === 'text') {\n                var _scale$option2;\n                scale.scale.range((_scale$option2 = scale.option) === null || _scale$option2 === void 0 ? void 0 : _scale$option2.domain);\n              }\n            });\n          } else {\n            // 设置attribute 常量值 常量直接在value取值\n            attributeScale.type = StyleScaleType.CONSTANT;\n            attributeScale.defaultValues = scales.map(function (scale, index) {\n              return scale.scale(attributeScale.names[index]);\n            });\n          }\n          attributeScale.scalers = scales.map(function (scale) {\n            return {\n              field: scale.field,\n              func: scale.scale,\n              option: scale.option\n            };\n          });\n          attribute.needRescale = false;\n        }\n      });\n    }\n\n    /**\n     * @example\n     * 'w*h' => ['w', 'h']\n     * 'w' => ['w']\n     */\n  }, {\n    key: \"parseFields\",\n    value: function parseFields(field) {\n      if (Array.isArray(field)) {\n        return field;\n      }\n      if (isString(field)) {\n        return field.split('*');\n      }\n      return [field];\n    }\n  }, {\n    key: \"createScale\",\n    value: function createScale(field, name, values, data) {\n      var _this$scaleOptions$na, _find;\n      // scale 支持根据视觉通道和字段\n      var scaleOption = this.scaleOptions[name] && ((_this$scaleOptions$na = this.scaleOptions[name]) === null || _this$scaleOptions$na === void 0 ? void 0 : _this$scaleOptions$na.field) === field ? this.scaleOptions[name] // TODO  zi\n      : this.scaleOptions[field];\n      var styleScale = {\n        field: field,\n        scale: undefined,\n        type: StyleScaleType.VARIABLE,\n        option: scaleOption\n      };\n      if (!data || !data.length) {\n        if (scaleOption && scaleOption.type) {\n          styleScale.scale = this.createDefaultScale(scaleOption);\n        } else {\n          styleScale.scale = d3.scaleOrdinal([field]);\n          styleScale.type = StyleScaleType.CONSTANT;\n        }\n        return styleScale;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      var firstValue = (_find = data.find(function (d) {\n        return !isNil(d[field]);\n      })) === null || _find === void 0 ? void 0 : _find[field];\n      // 常量 Scale\n      if (this.isNumber(field) || isNil(firstValue) && !scaleOption) {\n        styleScale.scale = d3.scaleOrdinal([field]);\n        styleScale.type = StyleScaleType.CONSTANT;\n      } else {\n        // 根据数据类型判断 默认等分位，时间，和枚举类型\n        var type = scaleOption && scaleOption.type || this.getDefaultType(firstValue);\n        if (values === 'text') {\n          // text 为内置变 如果是文本则为cat\n          type = ScaleTypes.CAT;\n        }\n        if (values === undefined) {\n          type = ScaleTypes.IDENTITY;\n        }\n        var cfg = this.createScaleConfig(type, field, scaleOption, data);\n        styleScale.scale = this.createDefaultScale(cfg);\n        styleScale.option = cfg;\n      }\n      return styleScale;\n    }\n  }, {\n    key: \"getDefaultType\",\n    value: function getDefaultType(firstValue) {\n      var type = ScaleTypes.LINEAR;\n      if (typeof firstValue === 'string') {\n        type = dateRegex.test(firstValue) ? ScaleTypes.TIME : ScaleTypes.CAT;\n      }\n      return type;\n    }\n    // 生成Scale 默认配置\n  }, {\n    key: \"createScaleConfig\",\n    value: function createScaleConfig(type, field, scaleOption, data) {\n      var cfg = {\n        type: type\n      };\n      // quantile domain 需要根据ID 进行去重\n      var values = [];\n      if (type === ScaleTypes.QUANTILE) {\n        // 根据 obejct 属性 _id 进行去重 \n        var idMap = new Map();\n        data === null || data === void 0 || data.forEach(function (obj) {\n          idMap.set(obj._id, obj[field]);\n        });\n        values = Array.from(idMap.values());\n      } else {\n        values = (data === null || data === void 0 ? void 0 : data.map(function (item) {\n          return item[field];\n        })) || [];\n      }\n      if (scaleOption !== null && scaleOption !== void 0 && scaleOption.domain) {\n        cfg.domain = scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.domain;\n      } else if (type === ScaleTypes.CAT || type === ScaleTypes.IDENTITY) {\n        cfg.domain = uniq(values);\n      } else if (type === ScaleTypes.QUANTILE) {\n        cfg.domain = values;\n      } else if (type === ScaleTypes.DIVERGING) {\n        var minMax = extent(values);\n        var neutral = (scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.neutral) !== undefined ? scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.neutral : (minMax[0] + minMax[1]) / 2;\n        cfg.domain = [minMax[0], neutral, minMax[1]];\n      } else {\n        // linear/Power/log\n        cfg.domain = extent(values);\n      }\n      return _objectSpread(_objectSpread({}, cfg), scaleOption);\n    }\n\n    // 创建Scale 实例\n  }, {\n    key: \"createDefaultScale\",\n    value: function createDefaultScale(_ref4) {\n      var type = _ref4.type,\n        domain = _ref4.domain,\n        unknown = _ref4.unknown,\n        clamp = _ref4.clamp,\n        nice = _ref4.nice;\n      // @ts-ignore\n      var scale = scaleMap[type]();\n      if (domain && scale.domain) {\n        scale.domain(domain);\n      }\n      if (unknown) {\n        scale.unknown(unknown);\n      }\n      if (clamp !== undefined && scale.clamp) {\n        scale.clamp(clamp);\n      }\n      if (nice !== undefined && scale.nice) {\n        scale.nice(nice);\n      }\n      // TODO 其他属性支持\n      return scale;\n    }\n  }]);\n  return FeatureScalePlugin;\n}()) || _class);\nexport { FeatureScalePlugin as default };","map":{"version":3,"names":["_objectSpread","_asyncToGenerator","_classCallCheck","_createClass","_defineProperty","_scaleMap","_dec","_class","_regeneratorRuntime","IDebugLog","ILayerStage","ScaleTypes","StyleScaleType","lodashUtil","extent","d3interpolate","d3","injectable","identity","isNil","isString","uniq","dateRegex","scaleMap","LINEAR","scaleLinear","POWER","scalePow","LOG","scaleLog","IDENTITY","SEQUENTIAL","scaleSequential","TIME","scaleTime","QUANTILE","scaleQuantile","QUANTIZE","scaleQuantize","THRESHOLD","scaleThreshold","CAT","scaleOrdinal","DIVERGING","scaleDiverging","FeatureScalePlugin","key","value","apply","layer","_ref","_this","styleAttributeService","hooks","init","tapPromise","mark","_callee","_layer$getSource","attributes","dataArray","wrap","_callee$","_context","prev","next","log","ScaleInitStart","INIT","scaleOptions","getScaleOptions","getLayerStyleAttributes","getSource","data","Array","isArray","length","abrupt","caculateScalesForAttributes","ScaleInitEnd","stop","beforeRenderData","_ref3","_callee2","flag","_callee2$","_context2","UPDATE","layerModelNeedUpdate","_x","arguments","beforeRender","tap","attributesToRescale","filter","attribute","needRescale","isNumber","n","isNaN","parseFloat","isFinite","_this2","forEach","scale","attributeScale","fieldValue","field","names","parseFields","scales","_attribute$scale","push","createScale","name","values","some","type","VARIABLE","callback","_scale$option","option","tick","ticks","domain","range","interpolator","interpolateRgbBasis","_scale$option2","CONSTANT","defaultValues","map","index","scalers","func","split","_this$scaleOptions$na","_find","scaleOption","styleScale","undefined","createDefaultScale","firstValue","find","d","getDefaultType","cfg","createScaleConfig","test","idMap","Map","obj","set","_id","from","item","minMax","neutral","_ref4","unknown","clamp","nice","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-layers/es/plugins/FeatureScalePlugin.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _scaleMap, _dec, _class;\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { IDebugLog, ILayerStage, ScaleTypes, StyleScaleType } from '@antv/l7-core';\nimport { lodashUtil } from '@antv/l7-utils';\nimport { extent } from 'd3-array';\nimport * as d3interpolate from 'd3-interpolate';\nimport * as d3 from 'd3-scale';\nimport { injectable } from 'inversify';\nimport 'reflect-metadata';\nimport identity from \"../utils/identityScale\";\nvar isNil = lodashUtil.isNil,\n  isString = lodashUtil.isString,\n  uniq = lodashUtil.uniq;\nvar dateRegex = /^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))(\\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;\nvar scaleMap = (_scaleMap = {}, _defineProperty(_scaleMap, ScaleTypes.LINEAR, d3.scaleLinear), _defineProperty(_scaleMap, ScaleTypes.POWER, d3.scalePow), _defineProperty(_scaleMap, ScaleTypes.LOG, d3.scaleLog), _defineProperty(_scaleMap, ScaleTypes.IDENTITY, identity), _defineProperty(_scaleMap, ScaleTypes.SEQUENTIAL, d3.scaleSequential), _defineProperty(_scaleMap, ScaleTypes.TIME, d3.scaleTime), _defineProperty(_scaleMap, ScaleTypes.QUANTILE, d3.scaleQuantile), _defineProperty(_scaleMap, ScaleTypes.QUANTIZE, d3.scaleQuantize), _defineProperty(_scaleMap, ScaleTypes.THRESHOLD, d3.scaleThreshold), _defineProperty(_scaleMap, ScaleTypes.CAT, d3.scaleOrdinal), _defineProperty(_scaleMap, ScaleTypes.DIVERGING, d3.scaleDiverging), _scaleMap);\n/**\n * 根据 Source 原始数据为指定字段创建 Scale，保存在 StyleAttribute 上，供下游插件使用\n */\nvar FeatureScalePlugin = (_dec = injectable(), _dec(_class = /*#__PURE__*/function () {\n  function FeatureScalePlugin() {\n    _classCallCheck(this, FeatureScalePlugin);\n    _defineProperty(this, \"scaleOptions\", {});\n  }\n  _createClass(FeatureScalePlugin, [{\n    key: \"apply\",\n    value: function apply(layer, _ref) {\n      var _this = this;\n      var styleAttributeService = _ref.styleAttributeService;\n      layer.hooks.init.tapPromise('FeatureScalePlugin', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _layer$getSource;\n        var attributes, dataArray;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              layer.log(IDebugLog.ScaleInitStart, ILayerStage.INIT);\n              _this.scaleOptions = layer.getScaleOptions();\n              attributes = styleAttributeService.getLayerStyleAttributes();\n              dataArray = (_layer$getSource = layer.getSource()) === null || _layer$getSource === void 0 ? void 0 : _layer$getSource.data.dataArray;\n              if (!(Array.isArray(dataArray) && dataArray.length === 0)) {\n                _context.next = 8;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 8:\n              _this.caculateScalesForAttributes(attributes || [], dataArray);\n            case 9:\n              layer.log(IDebugLog.ScaleInitEnd, ILayerStage.INIT);\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      })));\n\n      // 检测数据是否需要更新\n      layer.hooks.beforeRenderData.tapPromise('FeatureScalePlugin', /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(flag) {\n          var attributes, dataArray;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                if (flag) {\n                  _context2.next = 2;\n                  break;\n                }\n                return _context2.abrupt(\"return\", flag);\n              case 2:\n                layer.log(IDebugLog.ScaleInitStart, ILayerStage.UPDATE);\n                _this.scaleOptions = layer.getScaleOptions();\n                attributes = styleAttributeService.getLayerStyleAttributes();\n                dataArray = layer.getSource().data.dataArray;\n                if (!(Array.isArray(dataArray) && dataArray.length === 0)) {\n                  _context2.next = 8;\n                  break;\n                }\n                return _context2.abrupt(\"return\", true);\n              case 8:\n                _this.caculateScalesForAttributes(attributes || [], dataArray);\n                layer.log(IDebugLog.ScaleInitEnd, ILayerStage.UPDATE);\n                layer.layerModelNeedUpdate = true;\n                return _context2.abrupt(\"return\", true);\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2);\n        }));\n        return function (_x) {\n          return _ref3.apply(this, arguments);\n        };\n      }());\n      layer.hooks.beforeRender.tap('FeatureScalePlugin', function () {\n        if (layer.layerModelNeedUpdate) {\n          return;\n        }\n        _this.scaleOptions = layer.getScaleOptions();\n        var attributes = styleAttributeService.getLayerStyleAttributes();\n        var dataArray = layer.getSource().data.dataArray;\n        if (Array.isArray(dataArray) && dataArray.length === 0) {\n          return;\n        }\n        if (attributes) {\n          var attributesToRescale = attributes.filter(function (attribute) {\n            return attribute.needRescale;\n          });\n          if (attributesToRescale.length) {\n            _this.caculateScalesForAttributes(attributesToRescale, dataArray);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"isNumber\",\n    value: function isNumber(n) {\n      return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n  }, {\n    key: \"caculateScalesForAttributes\",\n    value: function caculateScalesForAttributes(attributes, dataArray) {\n      var _this2 = this;\n      attributes.forEach(function (attribute) {\n        if (attribute.scale) {\n          // 创建Scale\n          var attributeScale = attribute.scale;\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          var fieldValue = attribute.scale.field;\n          attributeScale.names = _this2.parseFields(isNil(fieldValue) ? [] : fieldValue);\n          var scales = [];\n          // 为每个字段创建 Scale\n          attributeScale.names.forEach(function (field) {\n            var _attribute$scale;\n            scales.push(_this2.createScale(field, attribute.name, (_attribute$scale = attribute.scale) === null || _attribute$scale === void 0 ? void 0 : _attribute$scale.values, dataArray));\n          });\n\n          // 为scales 设置值区间 Range\n          if (scales.some(function (scale) {\n            return scale.type === StyleScaleType.VARIABLE;\n          })) {\n            attributeScale.type = StyleScaleType.VARIABLE;\n            scales.forEach(function (scale) {\n              // 如果设置了回调, 这不需要设置range\n              if (!attributeScale.callback && attributeScale.values !== 'text') {\n                var _scale$option;\n                switch ((_scale$option = scale.option) === null || _scale$option === void 0 ? void 0 : _scale$option.type) {\n                  case ScaleTypes.LOG:\n                  case ScaleTypes.LINEAR:\n                  case ScaleTypes.POWER:\n                    if (attributeScale.values && attributeScale.values.length > 2) {\n                      var tick = scale.scale.ticks(attributeScale.values.length);\n                      scale.scale.domain(tick);\n                    }\n                    attributeScale.values ? scale.scale.range(attributeScale.values) : scale.scale.range(scale.option.domain);\n                    break;\n                  case ScaleTypes.QUANTILE:\n                  case ScaleTypes.QUANTIZE:\n                  case ScaleTypes.THRESHOLD:\n                    scale.scale.range(attributeScale.values); //\n                    break;\n                  case ScaleTypes.IDENTITY:\n                    // 不做处理xe\n                    break;\n                  case ScaleTypes.CAT:\n                    attributeScale.values ? scale.scale.range(attributeScale.values) : scale.scale.range(scale.option.domain);\n                    break;\n                  case ScaleTypes.DIVERGING:\n                  case ScaleTypes.SEQUENTIAL:\n                    scale.scale.interpolator(\n                    // @ts-ignore\n                    d3interpolate.interpolateRgbBasis(attributeScale.values));\n                    break;\n                }\n              }\n              if (attributeScale.values === 'text') {\n                var _scale$option2;\n                scale.scale.range((_scale$option2 = scale.option) === null || _scale$option2 === void 0 ? void 0 : _scale$option2.domain);\n              }\n            });\n          } else {\n            // 设置attribute 常量值 常量直接在value取值\n            attributeScale.type = StyleScaleType.CONSTANT;\n            attributeScale.defaultValues = scales.map(function (scale, index) {\n              return scale.scale(attributeScale.names[index]);\n            });\n          }\n          attributeScale.scalers = scales.map(function (scale) {\n            return {\n              field: scale.field,\n              func: scale.scale,\n              option: scale.option\n            };\n          });\n          attribute.needRescale = false;\n        }\n      });\n    }\n\n    /**\n     * @example\n     * 'w*h' => ['w', 'h']\n     * 'w' => ['w']\n     */\n  }, {\n    key: \"parseFields\",\n    value: function parseFields(field) {\n      if (Array.isArray(field)) {\n        return field;\n      }\n      if (isString(field)) {\n        return field.split('*');\n      }\n      return [field];\n    }\n  }, {\n    key: \"createScale\",\n    value: function createScale(field, name, values, data) {\n      var _this$scaleOptions$na, _find;\n      // scale 支持根据视觉通道和字段\n      var scaleOption = this.scaleOptions[name] && ((_this$scaleOptions$na = this.scaleOptions[name]) === null || _this$scaleOptions$na === void 0 ? void 0 : _this$scaleOptions$na.field) === field ? this.scaleOptions[name] // TODO  zi\n      : this.scaleOptions[field];\n      var styleScale = {\n        field: field,\n        scale: undefined,\n        type: StyleScaleType.VARIABLE,\n        option: scaleOption\n      };\n      if (!data || !data.length) {\n        if (scaleOption && scaleOption.type) {\n          styleScale.scale = this.createDefaultScale(scaleOption);\n        } else {\n          styleScale.scale = d3.scaleOrdinal([field]);\n          styleScale.type = StyleScaleType.CONSTANT;\n        }\n        return styleScale;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      var firstValue = (_find = data.find(function (d) {\n        return !isNil(d[field]);\n      })) === null || _find === void 0 ? void 0 : _find[field];\n      // 常量 Scale\n      if (this.isNumber(field) || isNil(firstValue) && !scaleOption) {\n        styleScale.scale = d3.scaleOrdinal([field]);\n        styleScale.type = StyleScaleType.CONSTANT;\n      } else {\n        // 根据数据类型判断 默认等分位，时间，和枚举类型\n        var type = scaleOption && scaleOption.type || this.getDefaultType(firstValue);\n        if (values === 'text') {\n          // text 为内置变 如果是文本则为cat\n          type = ScaleTypes.CAT;\n        }\n        if (values === undefined) {\n          type = ScaleTypes.IDENTITY;\n        }\n        var cfg = this.createScaleConfig(type, field, scaleOption, data);\n        styleScale.scale = this.createDefaultScale(cfg);\n        styleScale.option = cfg;\n      }\n      return styleScale;\n    }\n  }, {\n    key: \"getDefaultType\",\n    value: function getDefaultType(firstValue) {\n      var type = ScaleTypes.LINEAR;\n      if (typeof firstValue === 'string') {\n        type = dateRegex.test(firstValue) ? ScaleTypes.TIME : ScaleTypes.CAT;\n      }\n      return type;\n    }\n    // 生成Scale 默认配置\n  }, {\n    key: \"createScaleConfig\",\n    value: function createScaleConfig(type, field, scaleOption, data) {\n      var cfg = {\n        type: type\n      };\n      // quantile domain 需要根据ID 进行去重\n      var values = [];\n      if (type === ScaleTypes.QUANTILE) {\n        // 根据 obejct 属性 _id 进行去重 \n        var idMap = new Map();\n        data === null || data === void 0 || data.forEach(function (obj) {\n          idMap.set(obj._id, obj[field]);\n        });\n        values = Array.from(idMap.values());\n      } else {\n        values = (data === null || data === void 0 ? void 0 : data.map(function (item) {\n          return item[field];\n        })) || [];\n      }\n      if (scaleOption !== null && scaleOption !== void 0 && scaleOption.domain) {\n        cfg.domain = scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.domain;\n      } else if (type === ScaleTypes.CAT || type === ScaleTypes.IDENTITY) {\n        cfg.domain = uniq(values);\n      } else if (type === ScaleTypes.QUANTILE) {\n        cfg.domain = values;\n      } else if (type === ScaleTypes.DIVERGING) {\n        var minMax = extent(values);\n        var neutral = (scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.neutral) !== undefined ? scaleOption === null || scaleOption === void 0 ? void 0 : scaleOption.neutral : (minMax[0] + minMax[1]) / 2;\n        cfg.domain = [minMax[0], neutral, minMax[1]];\n      } else {\n        // linear/Power/log\n        cfg.domain = extent(values);\n      }\n      return _objectSpread(_objectSpread({}, cfg), scaleOption);\n    }\n\n    // 创建Scale 实例\n  }, {\n    key: \"createDefaultScale\",\n    value: function createDefaultScale(_ref4) {\n      var type = _ref4.type,\n        domain = _ref4.domain,\n        unknown = _ref4.unknown,\n        clamp = _ref4.clamp,\n        nice = _ref4.nice;\n      // @ts-ignore\n      var scale = scaleMap[type]();\n      if (domain && scale.domain) {\n        scale.domain(domain);\n      }\n      if (unknown) {\n        scale.unknown(unknown);\n      }\n      if (clamp !== undefined && scale.clamp) {\n        scale.clamp(clamp);\n      }\n      if (nice !== undefined && scale.nice) {\n        scale.nice(nice);\n      }\n      // TODO 其他属性支持\n      return scale;\n    }\n  }]);\n  return FeatureScalePlugin;\n}()) || _class);\nexport { FeatureScalePlugin as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
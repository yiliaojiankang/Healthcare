{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __assign } from \"tslib\";\nimport { isArray } from '@antv/util';\nimport { animation, annotation, interaction, theme, tooltip } from '../../adaptor/common';\nimport { point, schema } from '../../adaptor/geometries';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { deepAssign, flow, pick } from '../../utils';\nimport { BOX_RANGE, BOX_SYNC_NAME, OUTLIERS_VIEW_ID } from './constant';\nimport { transformData } from './utils';\n/**\n * 字段\n * @param params\n */\nfunction field(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xField = options.xField,\n    yField = options.yField,\n    groupField = options.groupField,\n    color = options.color,\n    tooltip = options.tooltip,\n    boxStyle = options.boxStyle;\n  chart.data(transformData(options.data, yField));\n  var yFieldName = isArray(yField) ? BOX_RANGE : yField;\n  var rawFields = yField ? isArray(yField) ? yField : [yField] : [];\n  var tooltipOptions = tooltip;\n  if (tooltipOptions !== false) {\n    tooltipOptions = deepAssign({}, {\n      fields: isArray(yField) ? yField : []\n    }, tooltipOptions);\n  }\n  var ext = schema(deepAssign({}, params, {\n    options: {\n      xField: xField,\n      yField: yFieldName,\n      seriesField: groupField,\n      tooltip: tooltipOptions,\n      rawFields: rawFields,\n      // 只有异常点视图展示 label\n      label: false,\n      schema: {\n        shape: 'box',\n        color: color,\n        style: boxStyle\n      }\n    }\n  })).ext;\n  if (groupField) {\n    ext.geometry.adjust('dodge');\n  }\n  return params;\n}\n/**\n * 创建异常点 view\n */\nfunction outliersPoint(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xField = options.xField,\n    data = options.data,\n    outliersField = options.outliersField,\n    outliersStyle = options.outliersStyle,\n    padding = options.padding,\n    label = options.label;\n  if (!outliersField) return params;\n  var outliersView = chart.createView({\n    padding: padding,\n    id: OUTLIERS_VIEW_ID\n  });\n  var outliersViewData = data.reduce(function (ret, datum) {\n    var outliersData = datum[outliersField];\n    outliersData.forEach(function (d) {\n      var _a;\n      return ret.push(__assign(__assign({}, datum), (_a = {}, _a[outliersField] = d, _a)));\n    });\n    return ret;\n  }, []);\n  outliersView.data(outliersViewData);\n  point({\n    chart: outliersView,\n    options: {\n      xField: xField,\n      yField: outliersField,\n      point: {\n        shape: 'circle',\n        style: outliersStyle\n      },\n      label: label\n    }\n  });\n  outliersView.axis(false);\n  return params;\n}\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params) {\n  var _a, _b;\n  var chart = params.chart,\n    options = params.options;\n  var meta = options.meta,\n    xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField,\n    outliersField = options.outliersField;\n  var yFieldName = Array.isArray(yField) ? BOX_RANGE : yField;\n  var baseMeta = {};\n  // make yField and outliersField share y mate\n  if (outliersField) {\n    var syncName = BOX_SYNC_NAME;\n    baseMeta = (_a = {}, _a[outliersField] = {\n      sync: syncName,\n      nice: true\n    }, _a[yFieldName] = {\n      sync: syncName,\n      nice: true\n    }, _a);\n  }\n  var scales = deepAssign(baseMeta, meta, (_b = {}, _b[xField] = pick(xAxis, AXIS_META_CONFIG_KEYS), _b[yFieldName] = pick(yAxis, AXIS_META_CONFIG_KEYS), _b));\n  chart.scale(scales);\n  return params;\n}\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField;\n  var yFieldName = Array.isArray(yField) ? BOX_RANGE : yField;\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n  if (yAxis === false) {\n    chart.axis(BOX_RANGE, false);\n  } else {\n    chart.axis(yFieldName, yAxis);\n  }\n  return params;\n}\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    groupField = options.groupField;\n  if (groupField) {\n    if (legend) {\n      chart.legend(groupField, legend);\n    } else {\n      // Grouped Box Chart default has legend, and it's position is `bottom`\n      chart.legend(groupField, {\n        position: 'bottom'\n      });\n    }\n  } else {\n    chart.legend(false);\n  }\n  return params;\n}\n/**\n * 箱型图适配器\n * @param params\n */\nexport function adaptor(params) {\n  return flow(field, outliersPoint, meta, axis, legend, tooltip, annotation(), interaction, animation, theme)(params);\n}","map":{"version":3,"names":["isArray","animation","annotation","interaction","theme","tooltip","point","schema","AXIS_META_CONFIG_KEYS","deepAssign","flow","pick","BOX_RANGE","BOX_SYNC_NAME","OUTLIERS_VIEW_ID","transformData","field","params","chart","options","xField","yField","groupField","color","boxStyle","data","yFieldName","rawFields","tooltipOptions","fields","ext","seriesField","label","shape","style","geometry","adjust","outliersPoint","outliersField","outliersStyle","padding","outliersView","createView","id","outliersViewData","reduce","ret","datum","outliersData","forEach","d","push","__assign","_a","axis","meta","xAxis","yAxis","Array","baseMeta","syncName","sync","nice","scales","_b","scale","legend","position","adaptor"],"sources":["../../../src/plots/box/adaptor.ts"],"sourcesContent":["import { Types } from '@antv/g2';\nimport { isArray } from '@antv/util';\nimport { animation, annotation, interaction, theme, tooltip } from '../../adaptor/common';\nimport { point, schema } from '../../adaptor/geometries';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, flow, pick } from '../../utils';\nimport { BOX_RANGE, BOX_SYNC_NAME, OUTLIERS_VIEW_ID } from './constant';\nimport { BoxOptions } from './types';\nimport { transformData } from './utils';\n\n/**\n * 字段\n * @param params\n */\nfunction field(params: Params<BoxOptions>): Params<BoxOptions> {\n  const { chart, options } = params;\n  const { xField, yField, groupField, color, tooltip, boxStyle } = options;\n\n  chart.data(transformData(options.data, yField));\n\n  const yFieldName = isArray(yField) ? BOX_RANGE : yField;\n  const rawFields = yField ? (isArray(yField) ? yField : [yField]) : [];\n\n  let tooltipOptions = tooltip;\n  if (tooltipOptions !== false) {\n    tooltipOptions = deepAssign({}, { fields: isArray(yField) ? yField : [] }, tooltipOptions);\n  }\n\n  const { ext } = schema(\n    deepAssign({}, params, {\n      options: {\n        xField,\n        yField: yFieldName,\n        seriesField: groupField,\n        tooltip: tooltipOptions,\n        rawFields,\n        // 只有异常点视图展示 label\n        label: false,\n        schema: {\n          shape: 'box',\n          color,\n          style: boxStyle,\n        },\n      },\n    })\n  );\n\n  if (groupField) {\n    ext.geometry.adjust('dodge');\n  }\n\n  return params;\n}\n\n/**\n * 创建异常点 view\n */\nfunction outliersPoint(params: Params<BoxOptions>): Params<BoxOptions> {\n  const { chart, options } = params;\n  const { xField, data, outliersField, outliersStyle, padding, label } = options;\n\n  if (!outliersField) return params;\n\n  const outliersView = chart.createView({ padding, id: OUTLIERS_VIEW_ID });\n  const outliersViewData = data.reduce((ret, datum) => {\n    const outliersData = datum[outliersField];\n    outliersData.forEach((d) => ret.push({ ...datum, [outliersField]: d }));\n    return ret;\n  }, []) as Types.Datum[];\n\n  outliersView.data(outliersViewData);\n  point({\n    chart: outliersView,\n    options: {\n      xField,\n      yField: outliersField,\n      point: { shape: 'circle', style: outliersStyle },\n      label,\n    },\n  });\n\n  outliersView.axis(false);\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<BoxOptions>): Params<BoxOptions> {\n  const { chart, options } = params;\n  const { meta, xAxis, yAxis, xField, yField, outliersField } = options;\n  const yFieldName = Array.isArray(yField) ? BOX_RANGE : yField;\n\n  let baseMeta = {};\n\n  // make yField and outliersField share y mate\n  if (outliersField) {\n    const syncName = BOX_SYNC_NAME;\n    baseMeta = {\n      [outliersField]: { sync: syncName, nice: true },\n      [yFieldName]: { sync: syncName, nice: true },\n    };\n  }\n\n  const scales = deepAssign(baseMeta, meta, {\n    [xField]: pick(xAxis, AXIS_META_CONFIG_KEYS),\n    [yFieldName]: pick(yAxis, AXIS_META_CONFIG_KEYS),\n  });\n\n  chart.scale(scales);\n\n  return params;\n}\n\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<BoxOptions>): Params<BoxOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n  const yFieldName = Array.isArray(yField) ? BOX_RANGE : yField;\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n\n  if (yAxis === false) {\n    chart.axis(BOX_RANGE, false);\n  } else {\n    chart.axis(yFieldName, yAxis);\n  }\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params: Params<BoxOptions>): Params<BoxOptions> {\n  const { chart, options } = params;\n  const { legend, groupField } = options;\n\n  if (groupField) {\n    if (legend) {\n      chart.legend(groupField, legend);\n    } else {\n      // Grouped Box Chart default has legend, and it's position is `bottom`\n      chart.legend(groupField, { position: 'bottom' });\n    }\n  } else {\n    chart.legend(false);\n  }\n\n  return params;\n}\n\n/**\n * 箱型图适配器\n * @param params\n */\nexport function adaptor(params: Params<BoxOptions>) {\n  return flow(field, outliersPoint, meta, axis, legend, tooltip, annotation(), interaction, animation, theme)(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
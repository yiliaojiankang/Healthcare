{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { each, omit } from '@antv/util';\nimport { animation, annotation, interaction, limitInPlot, pattern, slider, theme, tooltip, transformations } from '../../adaptor/common';\nimport { area, line, point } from '../../adaptor/geometries';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { getDataWhetherPercentage } from '../../utils/transform/percent';\nimport { axis, legend, meta } from '../line/adaptor';\nexport { meta };\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var data = options.data,\n    areaStyle = options.areaStyle,\n    areaShape = options.areaShape,\n    color = options.color,\n    pointMapping = options.point,\n    lineMapping = options.line,\n    isPercent = options.isPercent,\n    xField = options.xField,\n    yField = options.yField,\n    tooltip = options.tooltip,\n    seriesField = options.seriesField,\n    startOnZero = options.startOnZero;\n  var pointState = pointMapping === null || pointMapping === void 0 ? void 0 : pointMapping.state;\n  var chartData = getDataWhetherPercentage(data, yField, xField, yField, isPercent);\n  chart.data(chartData);\n  // 百分比堆积图，默认会给一个 % 格式化逻辑, 用户可自定义\n  var tooltipOptions = isPercent ? __assign({\n    formatter: function (datum) {\n      return {\n        name: datum[seriesField] || datum[xField],\n        value: (Number(datum[yField]) * 100).toFixed(2) + '%'\n      };\n    }\n  }, tooltip) : tooltip;\n  var primary = deepAssign({}, params, {\n    options: {\n      area: {\n        color: color,\n        style: areaStyle,\n        shape: areaShape\n      },\n      point: pointMapping && __assign({\n        color: color\n      }, pointMapping),\n      tooltip: tooltipOptions,\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined,\n      args: {\n        startOnZero: startOnZero\n      }\n    }\n  });\n  // 线默认 2px (折线不能复用面积图的 state，因为 fill 和 stroke 不匹配)\n  var lineParams = {\n    chart: chart,\n    options: deepAssign({\n      line: {\n        size: 2\n      }\n    }, omit(options, ['state']), {\n      // 颜色保持一致，因为如果颜色不一致，会导致 tooltip 中元素重复。\n      // 如果存在，才设置，否则为空\n      line: lineMapping && __assign({\n        color: color\n      }, lineMapping),\n      sizeField: seriesField,\n      state: lineMapping === null || lineMapping === void 0 ? void 0 : lineMapping.state,\n      tooltip: false,\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined,\n      args: {\n        startOnZero: startOnZero\n      }\n    })\n  };\n  var pointParams = deepAssign({}, primary, {\n    options: {\n      tooltip: false,\n      state: pointState\n    }\n  });\n  // area geometry 处理\n  area(primary);\n  line(lineParams);\n  point(pointParams);\n  return params;\n}\n/**\n * 数据标签\n * @param params\n */\nfunction label(params) {\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label,\n    yField = options.yField;\n  var areaGeometry = findGeometry(chart, 'area');\n  // label 为 false, 空 则不显示 label\n  if (!label) {\n    areaGeometry.label(false);\n  } else {\n    var callback = label.callback,\n      cfg = __rest(label, [\"callback\"]);\n    areaGeometry.label({\n      fields: [yField],\n      callback: callback,\n      cfg: __assign({\n        layout: [{\n          type: 'limit-in-plot'\n        }, {\n          type: 'path-adjust-position'\n        }, {\n          type: 'point-adjust-position'\n        }, {\n          type: 'limit-in-plot',\n          cfg: {\n            action: 'hide'\n          }\n        }]\n      }, transformLabel(cfg))\n    });\n  }\n  return params;\n}\n/**\n * 处理 adjust\n * @param params\n */\nfunction adjust(params) {\n  var chart = params.chart,\n    options = params.options;\n  var isStack = options.isStack,\n    isPercent = options.isPercent,\n    seriesField = options.seriesField;\n  if ((isPercent || isStack) && seriesField) {\n    each(chart.geometries, function (g) {\n      g.adjust('stack');\n    });\n  }\n  return params;\n}\n/**\n * 折线图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, pattern('areaStyle'), transformations('rect'), geometry, meta, adjust, axis, legend, tooltip, label, slider, annotation(), interaction, animation, limitInPlot)(params);\n}","map":{"version":3,"names":["each","omit","animation","annotation","interaction","limitInPlot","pattern","slider","theme","tooltip","transformations","area","line","point","deepAssign","findGeometry","flow","transformLabel","getDataWhetherPercentage","axis","legend","meta","geometry","params","chart","options","data","areaStyle","areaShape","color","pointMapping","lineMapping","isPercent","xField","yField","seriesField","startOnZero","pointState","state","chartData","tooltipOptions","__assign","formatter","datum","name","value","Number","toFixed","primary","style","shape","label","undefined","args","lineParams","size","sizeField","pointParams","areaGeometry","callback","cfg","__rest","fields","layout","type","action","adjust","isStack","geometries","g","adaptor"],"sources":["../../../src/plots/area/adaptor.ts"],"sourcesContent":["import { Geometry } from '@antv/g2';\nimport { each, omit } from '@antv/util';\nimport {\n  animation,\n  annotation,\n  interaction,\n  limitInPlot,\n  pattern,\n  slider,\n  theme,\n  tooltip,\n  transformations,\n} from '../../adaptor/common';\nimport { area, line, point } from '../../adaptor/geometries';\nimport { Params } from '../../core/adaptor';\nimport { Datum } from '../../types';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { getDataWhetherPercentage } from '../../utils/transform/percent';\nimport { axis, legend, meta } from '../line/adaptor';\nimport { AreaOptions } from './types';\n\nexport { meta };\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<AreaOptions>): Params<AreaOptions> {\n  const { chart, options } = params;\n  const {\n    data,\n    areaStyle,\n    areaShape,\n    color,\n    point: pointMapping,\n    line: lineMapping,\n    isPercent,\n    xField,\n    yField,\n    tooltip,\n    seriesField,\n    startOnZero,\n  } = options;\n  const pointState = pointMapping?.state;\n\n  const chartData = getDataWhetherPercentage(data, yField, xField, yField, isPercent);\n  chart.data(chartData);\n  // 百分比堆积图，默认会给一个 % 格式化逻辑, 用户可自定义\n  const tooltipOptions = isPercent\n    ? {\n        formatter: (datum: Datum) => ({\n          name: datum[seriesField] || datum[xField],\n          value: (Number(datum[yField]) * 100).toFixed(2) + '%',\n        }),\n        ...tooltip,\n      }\n    : tooltip;\n  const primary = deepAssign({}, params, {\n    options: {\n      area: {\n        color,\n        style: areaStyle,\n        shape: areaShape,\n      },\n      point: pointMapping && {\n        color,\n        ...pointMapping,\n      },\n      tooltip: tooltipOptions,\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined,\n      args: {\n        startOnZero,\n      },\n    },\n  });\n  // 线默认 2px (折线不能复用面积图的 state，因为 fill 和 stroke 不匹配)\n  const lineParams = {\n    chart,\n    options: deepAssign({ line: { size: 2 } }, omit(options as any, ['state']), {\n      // 颜色保持一致，因为如果颜色不一致，会导致 tooltip 中元素重复。\n      // 如果存在，才设置，否则为空\n      line: lineMapping && {\n        color,\n        ...lineMapping,\n      },\n      sizeField: seriesField,\n      state: lineMapping?.state,\n      tooltip: false,\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined,\n      args: {\n        startOnZero,\n      },\n    }),\n  };\n  const pointParams = deepAssign({}, primary, { options: { tooltip: false, state: pointState } });\n\n  // area geometry 处理\n  area(primary);\n  line(lineParams);\n  point(pointParams);\n\n  return params;\n}\n\n/**\n * 数据标签\n * @param params\n */\nfunction label(params: Params<AreaOptions>): Params<AreaOptions> {\n  const { chart, options } = params;\n  const { label, yField } = options;\n\n  const areaGeometry = findGeometry(chart, 'area');\n\n  // label 为 false, 空 则不显示 label\n  if (!label) {\n    areaGeometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    areaGeometry.label({\n      fields: [yField],\n      callback,\n      cfg: {\n        layout: [\n          { type: 'limit-in-plot' },\n          { type: 'path-adjust-position' },\n          { type: 'point-adjust-position' },\n          { type: 'limit-in-plot', cfg: { action: 'hide' } },\n        ],\n        ...transformLabel(cfg),\n      },\n    });\n  }\n\n  return params;\n}\n\n/**\n * 处理 adjust\n * @param params\n */\nfunction adjust(params: Params<AreaOptions>): Params<AreaOptions> {\n  const { chart, options } = params;\n  const { isStack, isPercent, seriesField } = options;\n  if ((isPercent || isStack) && seriesField) {\n    each(chart.geometries, (g: Geometry) => {\n      g.adjust('stack');\n    });\n  }\n\n  return params;\n}\n\n/**\n * 折线图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<AreaOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    theme,\n    pattern('areaStyle'),\n    transformations('rect'),\n    geometry,\n    meta,\n    adjust,\n    axis,\n    legend,\n    tooltip,\n    label,\n    slider,\n    annotation(),\n    interaction,\n    animation,\n    limitInPlot\n  )(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
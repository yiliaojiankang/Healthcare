{"ast":null,"code":"import { __rest } from \"tslib\";\nimport { filter, isArray, isObject } from '@antv/util';\nimport { animation, annotation, interaction, pattern, scale, state, theme, tooltip } from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { deepAssign, findGeometry, flow, LEVEL, log, transformLabel } from '../../utils';\n/**\n * geometry 配置处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var data = options.data,\n    sectorStyle = options.sectorStyle,\n    shape = options.shape,\n    color = options.color;\n  // 装载数据\n  chart.data(data);\n  flow(interval)(deepAssign({}, params, {\n    options: {\n      marginRatio: 1,\n      interval: {\n        style: sectorStyle,\n        color: color,\n        shape: shape\n      }\n    }\n  }));\n  return params;\n}\n/**\n * label 配置\n * @param params\n */\nfunction label(params) {\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label,\n    xField = options.xField;\n  var geometry = findGeometry(chart, 'interval');\n  // label 为 false 不显示 label\n  if (label === false) {\n    geometry.label(false);\n  } else if (isObject(label)) {\n    var callback = label.callback,\n      fields = label.fields,\n      cfg = __rest(label, [\"callback\", \"fields\"]);\n    var offset = cfg.offset;\n    var layout = cfg.layout;\n    // 当 label 在 shape 外部显示时，设置 'limit-in-shape' 会\n    // 造成 label 不显示。\n    if (offset === undefined || offset >= 0) {\n      layout = layout ? isArray(layout) ? layout : [layout] : [];\n      cfg.layout = filter(layout, function (v) {\n        return v.type !== 'limit-in-shape';\n      });\n      cfg.layout.length || delete cfg.layout;\n    }\n    geometry.label({\n      fields: fields || [xField],\n      callback: callback,\n      cfg: transformLabel(cfg)\n    });\n  } else {\n    log(LEVEL.WARN, label === null, 'the label option must be an Object.');\n    geometry.label({\n      fields: [xField]\n    });\n  }\n  return params;\n}\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    seriesField = options.seriesField;\n  if (legend === false) {\n    chart.legend(false);\n  } else if (seriesField) {\n    chart.legend(seriesField, legend);\n  }\n  return params;\n}\n/**\n * coord 配置\n * @param params\n */\nfunction coordinate(params) {\n  var chart = params.chart,\n    options = params.options;\n  var radius = options.radius,\n    innerRadius = options.innerRadius,\n    startAngle = options.startAngle,\n    endAngle = options.endAngle;\n  chart.coordinate({\n    type: 'polar',\n    cfg: {\n      radius: radius,\n      innerRadius: innerRadius,\n      startAngle: startAngle,\n      endAngle: endAngle\n    }\n  });\n  return params;\n}\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params) {\n  var _a;\n  var options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField;\n  return flow(scale((_a = {}, _a[xField] = xAxis, _a[yField] = yAxis, _a)))(params);\n}\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField;\n  // 为 falsy 则是不显示轴\n  if (!xAxis) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n  if (!yAxis) {\n    chart.axis(yField, false);\n  } else {\n    chart.axis(yField, yAxis);\n  }\n  return params;\n}\n/**\n * 玫瑰图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  flow(pattern('sectorStyle'), geometry, meta, label, coordinate, axis, legend, tooltip, interaction, animation, theme, annotation(), state)(params);\n}","map":{"version":3,"names":["filter","isArray","isObject","animation","annotation","interaction","pattern","scale","state","theme","tooltip","interval","deepAssign","findGeometry","flow","LEVEL","log","transformLabel","geometry","params","chart","options","data","sectorStyle","shape","color","marginRatio","style","label","xField","callback","fields","cfg","__rest","offset","layout","undefined","v","type","length","WARN","legend","seriesField","coordinate","radius","innerRadius","startAngle","endAngle","meta","xAxis","yAxis","yField","_a","axis","adaptor"],"sources":["../../../src/plots/rose/adaptor.ts"],"sourcesContent":["import { filter, isArray, isObject } from '@antv/util';\nimport { animation, annotation, interaction, pattern, scale, state, theme, tooltip } from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, findGeometry, flow, LEVEL, log, transformLabel } from '../../utils';\nimport { RoseOptions } from './types';\n\n/**\n * geometry 配置处理\n * @param params\n */\nfunction geometry(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { chart, options } = params;\n  const { data, sectorStyle, shape, color } = options;\n\n  // 装载数据\n  chart.data(data);\n\n  flow(interval)(\n    deepAssign({}, params, {\n      options: {\n        marginRatio: 1,\n        interval: {\n          style: sectorStyle,\n          color,\n          shape: shape,\n        },\n      },\n    })\n  );\n\n  return params;\n}\n\n/**\n * label 配置\n * @param params\n */\nfunction label(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { chart, options } = params;\n  const { label, xField } = options;\n  const geometry = findGeometry(chart, 'interval');\n\n  // label 为 false 不显示 label\n  if (label === false) {\n    geometry.label(false);\n  } else if (isObject(label)) {\n    const { callback, fields, ...cfg } = label;\n    const { offset } = cfg;\n    let layout = cfg.layout;\n\n    // 当 label 在 shape 外部显示时，设置 'limit-in-shape' 会\n    // 造成 label 不显示。\n    if (offset === undefined || offset >= 0) {\n      layout = layout ? (isArray(layout) ? layout : [layout]) : [];\n      cfg.layout = filter(layout, (v) => v.type !== 'limit-in-shape');\n      cfg.layout.length || delete cfg.layout;\n    }\n\n    geometry.label({\n      fields: fields || [xField],\n      callback,\n      cfg: transformLabel(cfg),\n    });\n  } else {\n    log(LEVEL.WARN, label === null, 'the label option must be an Object.');\n    geometry.label({ fields: [xField] });\n  }\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { chart, options } = params;\n  const { legend, seriesField } = options;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else if (seriesField) {\n    chart.legend(seriesField, legend);\n  }\n\n  return params;\n}\n\n/**\n * coord 配置\n * @param params\n */\nfunction coordinate(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { chart, options } = params;\n  const { radius, innerRadius, startAngle, endAngle } = options;\n\n  chart.coordinate({\n    type: 'polar',\n    cfg: {\n      radius,\n      innerRadius,\n      startAngle,\n      endAngle,\n    },\n  });\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n\n  return flow(\n    scale({\n      [xField]: xAxis,\n      [yField]: yAxis,\n    })\n  )(params);\n}\n\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<RoseOptions>): Params<RoseOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n\n  // 为 falsy 则是不显示轴\n  if (!xAxis) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n\n  if (!yAxis) {\n    chart.axis(yField, false);\n  } else {\n    chart.axis(yField, yAxis);\n  }\n\n  return params;\n}\n\n/**\n * 玫瑰图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<RoseOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  flow(\n    pattern('sectorStyle'),\n    geometry,\n    meta,\n    label,\n    coordinate,\n    axis,\n    legend,\n    tooltip,\n    interaction,\n    animation,\n    theme,\n    annotation(),\n    state\n  )(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
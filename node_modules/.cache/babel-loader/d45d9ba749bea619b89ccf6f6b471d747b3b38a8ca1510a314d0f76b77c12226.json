{"ast":null,"code":"import { __assign, __extends, __values } from \"tslib\";\nimport ColorUtil from '@antv/color-util';\nimport { get, isNumber } from '@antv/util';\nimport { FIELD_ORIGIN } from '../constant';\nimport Geometry from './base';\n/**\n * 用于绘制热力图。\n */\nvar Heatmap = /** @class */function (_super) {\n  __extends(Heatmap, _super);\n  function Heatmap() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.type = 'heatmap';\n    _this.paletteCache = {};\n    return _this;\n  }\n  Heatmap.prototype.updateElements = function (mappingDataArray, isUpdate) {\n    if (isUpdate === void 0) {\n      isUpdate = false;\n    }\n    for (var i = 0; i < mappingDataArray.length; i++) {\n      var mappingData = mappingDataArray[i];\n      var range = this.prepareRange(mappingData);\n      var radius = this.prepareSize();\n      var blur_1 = get(this.styleOption, ['cfg', 'shadowBlur']);\n      if (!isNumber(blur_1)) {\n        blur_1 = radius / 2;\n      }\n      this.prepareGreyScaleBlurredCircle(radius, blur_1);\n      this.drawWithRange(mappingData, range, radius, blur_1);\n    }\n  };\n  /** 热力图暂时不支持 callback 回调（文档需要说明下） */\n  Heatmap.prototype.color = function (field, cfg) {\n    this.createAttrOption('color', field, typeof cfg !== 'function' ? cfg : '');\n    return this;\n  };\n  /**\n   * clear\n   */\n  Heatmap.prototype.clear = function () {\n    _super.prototype.clear.call(this);\n    this.clearShadowCanvasCtx();\n    this.paletteCache = {};\n  };\n  Heatmap.prototype.prepareRange = function (data) {\n    var colorAttr = this.getAttribute('color');\n    var colorField = colorAttr.getFields()[0];\n    var min = Infinity;\n    var max = -Infinity;\n    data.forEach(function (row) {\n      var value = row[FIELD_ORIGIN][colorField];\n      if (value > max) {\n        max = value;\n      }\n      if (value < min) {\n        min = value;\n      }\n    });\n    if (min === max) {\n      min = max - 1;\n    }\n    return [min, max];\n  };\n  Heatmap.prototype.prepareSize = function () {\n    var radius = this.getDefaultValue('size');\n    if (!isNumber(radius)) {\n      radius = this.getDefaultSize();\n    }\n    return radius;\n  };\n  Heatmap.prototype.prepareGreyScaleBlurredCircle = function (radius, blur) {\n    var grayScaleBlurredCanvas = this.getGrayScaleBlurredCanvas();\n    var r2 = radius + blur;\n    var ctx = grayScaleBlurredCanvas.getContext('2d');\n    grayScaleBlurredCanvas.width = grayScaleBlurredCanvas.height = r2 * 2;\n    ctx.clearRect(0, 0, grayScaleBlurredCanvas.width, grayScaleBlurredCanvas.height);\n    ctx.shadowOffsetX = ctx.shadowOffsetY = r2 * 2;\n    ctx.shadowBlur = blur;\n    ctx.shadowColor = 'black';\n    ctx.beginPath();\n    ctx.arc(-r2, -r2, radius, 0, Math.PI * 2, true);\n    ctx.closePath();\n    ctx.fill();\n  };\n  Heatmap.prototype.drawWithRange = function (data, range, radius, blur) {\n    var e_1, _a;\n    // canvas size\n    var _b = this.coordinate,\n      start = _b.start,\n      end = _b.end;\n    var width = this.coordinate.getWidth();\n    var height = this.coordinate.getHeight();\n    // value, range, etc\n    var colorAttr = this.getAttribute('color');\n    var valueField = colorAttr.getFields()[0];\n    // prepare shadow canvas context\n    this.clearShadowCanvasCtx();\n    var ctx = this.getShadowCanvasCtx();\n    // filter data\n    if (range) {\n      data = data.filter(function (row) {\n        return row[FIELD_ORIGIN][valueField] <= range[1] && row[FIELD_ORIGIN][valueField] >= range[0];\n      });\n    }\n    // step1. draw points with shadow\n    var scale = this.scales[valueField];\n    try {\n      for (var data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {\n        var obj = data_1_1.value;\n        var _c = this.getDrawCfg(obj),\n          x = _c.x,\n          y = _c.y;\n        var alpha = scale.scale(obj[FIELD_ORIGIN][valueField]);\n        this.drawGrayScaleBlurredCircle(x - start.x, y - end.y, radius + blur, alpha, ctx);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n    // step2. convert pixels\n    var colored = ctx.getImageData(0, 0, width, height);\n    this.clearShadowCanvasCtx();\n    this.colorize(colored);\n    ctx.putImageData(colored, 0, 0);\n    var imageShape = this.getImageShape();\n    imageShape.attr('x', start.x);\n    imageShape.attr('y', end.y);\n    imageShape.attr('width', width);\n    imageShape.attr('height', height);\n    imageShape.attr('img', ctx.canvas);\n    imageShape.set('origin', this.getShapeInfo(data)); // 存储绘图信息数据\n  };\n\n  Heatmap.prototype.getDefaultSize = function () {\n    var position = this.getAttribute('position');\n    var coordinate = this.coordinate;\n    return Math.min(coordinate.getWidth() / (position.scales[0].ticks.length * 4), coordinate.getHeight() / (position.scales[1].ticks.length * 4));\n  };\n  Heatmap.prototype.clearShadowCanvasCtx = function () {\n    var ctx = this.getShadowCanvasCtx();\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  };\n  Heatmap.prototype.getShadowCanvasCtx = function () {\n    var canvas = this.shadowCanvas;\n    if (!canvas) {\n      canvas = document.createElement('canvas');\n      this.shadowCanvas = canvas;\n    }\n    canvas.width = this.coordinate.getWidth();\n    canvas.height = this.coordinate.getHeight();\n    return canvas.getContext('2d');\n  };\n  Heatmap.prototype.getGrayScaleBlurredCanvas = function () {\n    if (!this.grayScaleBlurredCanvas) {\n      this.grayScaleBlurredCanvas = document.createElement('canvas');\n    }\n    return this.grayScaleBlurredCanvas;\n  };\n  Heatmap.prototype.drawGrayScaleBlurredCircle = function (x, y, r, alpha, ctx) {\n    var grayScaleBlurredCanvas = this.getGrayScaleBlurredCanvas();\n    ctx.globalAlpha = alpha;\n    ctx.drawImage(grayScaleBlurredCanvas, x - r, y - r);\n  };\n  Heatmap.prototype.colorize = function (img) {\n    var colorAttr = this.getAttribute('color');\n    var pixels = img.data;\n    var paletteCache = this.paletteCache;\n    for (var i = 3; i < pixels.length; i += 4) {\n      var alpha = pixels[i]; // get gradient color from opacity value\n      if (isNumber(alpha)) {\n        var palette = paletteCache[alpha] ? paletteCache[alpha] : ColorUtil.rgb2arr(colorAttr.gradient(alpha / 256));\n        pixels[i - 3] = palette[0];\n        pixels[i - 2] = palette[1];\n        pixels[i - 1] = palette[2];\n        pixels[i] = alpha;\n      }\n    }\n  };\n  Heatmap.prototype.getImageShape = function () {\n    var imageShape = this.imageShape;\n    if (imageShape) {\n      return imageShape;\n    }\n    var container = this.container;\n    imageShape = container.addShape({\n      type: 'image',\n      attrs: {}\n    });\n    this.imageShape = imageShape;\n    return imageShape;\n  };\n  Heatmap.prototype.getShapeInfo = function (mappingData) {\n    var shapeCfg = this.getDrawCfg(mappingData[0]);\n    var data = mappingData.map(function (obj) {\n      return obj[FIELD_ORIGIN];\n    });\n    return __assign(__assign({}, shapeCfg), {\n      mappingData: mappingData,\n      data: data\n    });\n  };\n  return Heatmap;\n}(Geometry);\nexport default Heatmap;","map":{"version":3,"names":["ColorUtil","get","isNumber","FIELD_ORIGIN","Geometry","Heatmap","_super","__extends","_this","apply","arguments","type","paletteCache","prototype","updateElements","mappingDataArray","isUpdate","i","length","mappingData","range","prepareRange","radius","prepareSize","blur_1","styleOption","prepareGreyScaleBlurredCircle","drawWithRange","color","field","cfg","createAttrOption","clear","call","clearShadowCanvasCtx","data","colorAttr","getAttribute","colorField","getFields","min","Infinity","max","forEach","row","value","getDefaultValue","getDefaultSize","blur","grayScaleBlurredCanvas","getGrayScaleBlurredCanvas","r2","ctx","getContext","width","height","clearRect","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","beginPath","arc","Math","PI","closePath","fill","_b","coordinate","start","end","getWidth","getHeight","valueField","getShadowCanvasCtx","filter","scale","scales","data_1","__values","data_1_1","next","done","obj","_c","getDrawCfg","x","y","alpha","drawGrayScaleBlurredCircle","colored","getImageData","colorize","putImageData","imageShape","getImageShape","attr","canvas","set","getShapeInfo","position","ticks","shadowCanvas","document","createElement","r","globalAlpha","drawImage","img","pixels","palette","rgb2arr","gradient","container","addShape","attrs","shapeCfg","map","__assign"],"sources":["../../src/geometry/heatmap.ts"],"sourcesContent":["import ColorUtil from '@antv/color-util';\nimport { get, isNumber } from '@antv/util';\nimport { FIELD_ORIGIN } from '../constant';\nimport { Color, IShape } from '../dependents';\nimport { Data, Datum, MappingDatum, ShapeInfo, AttributeOption, ColorAttrCallback } from '../interface';\nimport Geometry from './base';\n\n/**\n * 用于绘制热力图。\n */\nexport default class Heatmap extends Geometry {\n  public readonly type: string = 'heatmap';\n\n  private paletteCache: Record<number, number> = {};\n  private grayScaleBlurredCanvas: HTMLCanvasElement;\n  private shadowCanvas: HTMLCanvasElement;\n  private imageShape: IShape;\n\n  protected updateElements(mappingDataArray: MappingDatum[][], isUpdate: boolean = false) {\n    for (let i = 0; i < mappingDataArray.length; i++) {\n      const mappingData = mappingDataArray[i];\n      const range = this.prepareRange(mappingData);\n      const radius = this.prepareSize();\n\n      let blur = get(this.styleOption, ['cfg', 'shadowBlur']);\n      if (!isNumber(blur)) {\n        blur = radius / 2;\n      }\n\n      this.prepareGreyScaleBlurredCircle(radius, blur);\n      this.drawWithRange(mappingData, range, radius, blur);\n    }\n  }\n\n  /** 热力图暂时不支持 callback 回调（文档需要说明下） */\n  public color(field: AttributeOption | string, cfg?: string | string[] | ColorAttrCallback): Geometry {\n    this.createAttrOption('color', field, typeof cfg !== 'function' ? cfg : '');\n\n    return this;\n  }\n\n  /**\n   * clear\n   */\n  public clear() {\n    super.clear();\n    this.clearShadowCanvasCtx();\n    this.paletteCache = {};\n  }\n\n  private prepareRange(data: MappingDatum[]) {\n    const colorAttr = this.getAttribute('color');\n    const colorField = colorAttr.getFields()[0];\n\n    let min = Infinity;\n    let max = -Infinity;\n    data.forEach((row) => {\n      const value = row[FIELD_ORIGIN][colorField];\n      if (value > max) {\n        max = value;\n      }\n      if (value < min) {\n        min = value;\n      }\n    });\n\n    if (min === max) {\n      min = max - 1;\n    }\n\n    return [min, max];\n  }\n\n  private prepareSize() {\n    let radius = this.getDefaultValue('size');\n    if (!isNumber(radius)) {\n      radius = this.getDefaultSize();\n    }\n\n    return radius;\n  }\n\n  private prepareGreyScaleBlurredCircle(radius: number, blur: number) {\n    const grayScaleBlurredCanvas = this.getGrayScaleBlurredCanvas();\n    const r2 = radius + blur;\n    const ctx = grayScaleBlurredCanvas.getContext('2d');\n    grayScaleBlurredCanvas.width = grayScaleBlurredCanvas.height = r2 * 2;\n    ctx.clearRect(0, 0, grayScaleBlurredCanvas.width, grayScaleBlurredCanvas.height);\n    ctx.shadowOffsetX = ctx.shadowOffsetY = r2 * 2;\n    ctx.shadowBlur = blur;\n    ctx.shadowColor = 'black';\n\n    ctx.beginPath();\n    ctx.arc(-r2, -r2, radius, 0, Math.PI * 2, true);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  private drawWithRange(data: MappingDatum[], range: number[], radius: number, blur: number) {\n    // canvas size\n    const { start, end } = this.coordinate;\n    const width = this.coordinate.getWidth();\n    const height = this.coordinate.getHeight();\n\n    // value, range, etc\n    const colorAttr = this.getAttribute('color');\n    const valueField = colorAttr.getFields()[0];\n\n    // prepare shadow canvas context\n    this.clearShadowCanvasCtx();\n    const ctx = this.getShadowCanvasCtx();\n    // filter data\n    if (range) {\n      data = data.filter((row) => {\n        return row[FIELD_ORIGIN][valueField] <= range[1] && row[FIELD_ORIGIN][valueField] >= range[0];\n      });\n    }\n\n    // step1. draw points with shadow\n    const scale = this.scales[valueField];\n    for (const obj of data) {\n      const { x, y } = this.getDrawCfg(obj);\n      const alpha = scale.scale(obj[FIELD_ORIGIN][valueField]);\n      this.drawGrayScaleBlurredCircle((x as number) - start.x, (y as number) - end.y, radius + blur, alpha, ctx);\n    }\n\n    // step2. convert pixels\n    const colored = ctx.getImageData(0, 0, width, height);\n    this.clearShadowCanvasCtx();\n    this.colorize(colored);\n    ctx.putImageData(colored, 0, 0);\n    const imageShape = this.getImageShape();\n    imageShape.attr('x', start.x);\n    imageShape.attr('y', end.y);\n    imageShape.attr('width', width);\n    imageShape.attr('height', height);\n    imageShape.attr('img', ctx.canvas);\n    imageShape.set('origin', this.getShapeInfo(data)); // 存储绘图信息数据\n  }\n\n  private getDefaultSize() {\n    const position = this.getAttribute('position');\n    const coordinate = this.coordinate;\n    return Math.min(\n      coordinate.getWidth() / (position.scales[0].ticks.length * 4),\n      coordinate.getHeight() / (position.scales[1].ticks.length * 4)\n    );\n  }\n\n  private clearShadowCanvasCtx() {\n    const ctx = this.getShadowCanvasCtx();\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  }\n\n  private getShadowCanvasCtx() {\n    let canvas = this.shadowCanvas;\n    if (!canvas) {\n      canvas = document.createElement('canvas');\n      this.shadowCanvas = canvas;\n    }\n    canvas.width = this.coordinate.getWidth();\n    canvas.height = this.coordinate.getHeight();\n    return canvas.getContext('2d');\n  }\n\n  private getGrayScaleBlurredCanvas() {\n    if (!this.grayScaleBlurredCanvas) {\n      this.grayScaleBlurredCanvas = document.createElement('canvas');\n    }\n\n    return this.grayScaleBlurredCanvas;\n  }\n\n  private drawGrayScaleBlurredCircle(x: number, y: number, r: number, alpha: number, ctx: CanvasRenderingContext2D) {\n    const grayScaleBlurredCanvas = this.getGrayScaleBlurredCanvas();\n    ctx.globalAlpha = alpha;\n    ctx.drawImage(grayScaleBlurredCanvas, x - r, y - r);\n  }\n\n  private colorize(img: ImageData) {\n    const colorAttr = this.getAttribute('color') as Color;\n    const pixels = img.data;\n    const paletteCache = this.paletteCache;\n    for (let i = 3; i < pixels.length; i += 4) {\n      const alpha = pixels[i]; // get gradient color from opacity value\n      if (isNumber(alpha)) {\n        const palette = paletteCache[alpha] ? paletteCache[alpha] : ColorUtil.rgb2arr(colorAttr.gradient(alpha / 256));\n        pixels[i - 3] = palette[0];\n        pixels[i - 2] = palette[1];\n        pixels[i - 1] = palette[2];\n        pixels[i] = alpha;\n      }\n    }\n  }\n\n  private getImageShape() {\n    let imageShape = this.imageShape;\n    if (imageShape) {\n      return imageShape;\n    }\n    const container = this.container;\n    imageShape = container.addShape({\n      type: 'image',\n      attrs: {},\n    });\n    this.imageShape = imageShape;\n    return imageShape;\n  }\n\n  private getShapeInfo(mappingData: MappingDatum[]): ShapeInfo {\n    const shapeCfg = this.getDrawCfg(mappingData[0]);\n\n    const data = mappingData.map((obj: Datum) => {\n      return obj[FIELD_ORIGIN];\n    });\n\n    return {\n      ...shapeCfg,\n      mappingData,\n      data,\n    };\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
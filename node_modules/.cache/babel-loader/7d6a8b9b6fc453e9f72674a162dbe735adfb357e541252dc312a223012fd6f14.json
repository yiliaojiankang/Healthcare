{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { isEqual, get, deepMix } from '@antv/util';\nimport { TOOLTIP_CSS_CONST } from '@antv/component';\nimport Action from '../../base';\nimport { HtmlTooltip } from '../../../../dependents';\n/**\n * 用于组件文本省略后需要展示完整信息的 Tooltip Action\n * @ignore\n */\nvar EllipsisText = /** @class */function (_super) {\n  __extends(EllipsisText, _super);\n  function EllipsisText() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.timeStamp = 0;\n    return _this;\n  }\n  EllipsisText.prototype.destroy = function () {\n    _super.prototype.destroy.call(this);\n    this.tooltip && this.tooltip.destroy();\n  };\n  /**\n   * 显示 Tooltip\n   * @returns\n   */\n  EllipsisText.prototype.show = function () {\n    var context = this.context;\n    var ev = context.event;\n    var lastTimeStamp = this.timeStamp;\n    var timeStamp = +new Date();\n    if (timeStamp - lastTimeStamp > 16) {\n      var preLoc = this.location;\n      var curLoc = {\n        x: ev.x,\n        y: ev.y\n      };\n      if (!preLoc || !isEqual(preLoc, curLoc)) {\n        this.showTooltip(curLoc);\n      }\n      this.timeStamp = timeStamp;\n      this.location = curLoc;\n    }\n  };\n  /**\n   * 隐藏 Tooltip。\n   * @returns\n   */\n  EllipsisText.prototype.hide = function () {\n    this.hideTooltip();\n    this.location = null;\n  };\n  EllipsisText.prototype.showTooltip = function (curLoc) {\n    var context = this.context;\n    var ev = context.event;\n    var target = ev.target;\n    if (target && target.get('tip')) {\n      if (!this.tooltip) {\n        this.renderTooltip(); // 延迟生成\n      }\n\n      var tipContent = target.get('tip');\n      // 展示 tooltip\n      this.tooltip.update(__assign({\n        title: tipContent\n      }, curLoc));\n      this.tooltip.show();\n    }\n  };\n  EllipsisText.prototype.hideTooltip = function () {\n    this.tooltip && this.tooltip.hide();\n  };\n  EllipsisText.prototype.renderTooltip = function () {\n    var _a;\n    var view = this.context.view;\n    var canvas = view.canvas;\n    var region = {\n      start: {\n        x: 0,\n        y: 0\n      },\n      end: {\n        x: canvas.get('width'),\n        y: canvas.get('height')\n      }\n    };\n    var theme = view.getTheme();\n    var tooltipStyles = get(theme, ['components', 'tooltip', 'domStyles'], {}); // 获取 tooltip 样式\n    var tooltip = new HtmlTooltip({\n      parent: canvas.get('el').parentNode,\n      region: region,\n      visible: false,\n      crosshairs: null,\n      domStyles: __assign({}, deepMix({}, tooltipStyles, (_a = {},\n      // 超长的时候，tooltip tip 最大宽度为 50%，然后可以换行\n      _a[TOOLTIP_CSS_CONST.CONTAINER_CLASS] = {\n        'max-width': '50%'\n      }, _a[TOOLTIP_CSS_CONST.TITLE_CLASS] = {\n        'word-break': 'break-all'\n      }, _a)))\n    });\n    tooltip.init();\n    tooltip.setCapture(false); // 不允许捕获事件\n    this.tooltip = tooltip;\n  };\n  return EllipsisText;\n}(Action);\nexport default EllipsisText;","map":{"version":3,"names":["isEqual","get","deepMix","TOOLTIP_CSS_CONST","Action","HtmlTooltip","EllipsisText","_super","__extends","_this","apply","arguments","timeStamp","prototype","destroy","call","tooltip","show","context","ev","event","lastTimeStamp","Date","preLoc","location","curLoc","x","y","showTooltip","hide","hideTooltip","target","renderTooltip","tipContent","update","__assign","title","view","canvas","region","start","end","theme","getTheme","tooltipStyles","parent","parentNode","visible","crosshairs","domStyles","_a","CONTAINER_CLASS","TITLE_CLASS","init","setCapture"],"sources":["../../../../../src/interaction/action/component/tooltip/ellipsis-text.ts"],"sourcesContent":["import { isEqual, get, deepMix } from '@antv/util';\nimport { TOOLTIP_CSS_CONST } from '@antv/component';\nimport { Point } from '../../../../interface';\nimport Action from '../../base';\nimport { HtmlTooltip } from '../../../../dependents';\n\n/**\n * 用于组件文本省略后需要展示完整信息的 Tooltip Action\n * @ignore\n */\nexport default class EllipsisText extends Action {\n  private timeStamp: number = 0;\n  private location: Point;\n  private tooltip;\n\n  public destroy() {\n    super.destroy();\n    this.tooltip && this.tooltip.destroy();\n  }\n\n  /**\n   * 显示 Tooltip\n   * @returns\n   */\n  public show() {\n    const context = this.context;\n    const ev = context.event;\n    const lastTimeStamp = this.timeStamp;\n    const timeStamp = +new Date();\n\n    if (timeStamp - lastTimeStamp > 16) {\n      const preLoc = this.location;\n      const curLoc = { x: ev.x, y: ev.y };\n      if (!preLoc || !isEqual(preLoc, curLoc)) {\n        this.showTooltip(curLoc);\n      }\n      this.timeStamp = timeStamp;\n      this.location = curLoc;\n    }\n  }\n\n  /**\n   * 隐藏 Tooltip。\n   * @returns\n   */\n  public hide() {\n    this.hideTooltip();\n    this.location = null;\n  }\n\n  protected showTooltip(curLoc: Point) {\n    const context = this.context;\n    const ev = context.event;\n    const target = ev.target;\n\n    if (target && target.get('tip')) {\n      if (!this.tooltip) {\n        this.renderTooltip(); // 延迟生成\n      }\n      const tipContent = target.get('tip');\n      // 展示 tooltip\n      this.tooltip.update({\n        title: tipContent,\n        ...curLoc,\n      });\n      this.tooltip.show();\n    }\n  }\n\n  protected hideTooltip() {\n    this.tooltip && this.tooltip.hide();\n  }\n\n  private renderTooltip() {\n    const view = this.context.view;\n    const canvas = view.canvas;\n\n    const region = {\n      start: { x: 0, y: 0 },\n      end: { x: canvas.get('width'), y: canvas.get('height') },\n    };\n\n    const theme = view.getTheme();\n    const tooltipStyles = get(theme, ['components', 'tooltip', 'domStyles'], {}); // 获取 tooltip 样式\n    const tooltip = new HtmlTooltip({\n      parent: canvas.get('el').parentNode,\n      region,\n      visible: false,\n      crosshairs: null,\n      domStyles: {\n        ...deepMix({}, tooltipStyles, {\n          // 超长的时候，tooltip tip 最大宽度为 50%，然后可以换行\n          [TOOLTIP_CSS_CONST.CONTAINER_CLASS]: { 'max-width': '50%' },\n          [TOOLTIP_CSS_CONST.TITLE_CLASS]: { 'word-break': 'break-all' },\n        }),\n      },\n    });\n    tooltip.init();\n    tooltip.setCapture(false); // 不允许捕获事件\n    this.tooltip = tooltip;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { each, isNil, isFunction, isObject } from '@antv/util';\nimport { vec2 } from '@antv/matrix-util';\nimport AxisBase from './base';\nimport * as OverlapUtil from './overlap';\nvar Circle = /** @class */function (_super) {\n  __extends(Circle, _super);\n  function Circle() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  Circle.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n    return __assign(__assign({}, cfg), {\n      type: 'circle',\n      locationType: 'circle',\n      center: null,\n      radius: null,\n      startAngle: -Math.PI / 2,\n      endAngle: Math.PI * 3 / 2\n    });\n  };\n  Circle.prototype.getLinePath = function () {\n    var center = this.get('center');\n    var x = center.x;\n    var y = center.y;\n    var rx = this.get('radius');\n    var ry = rx;\n    var startAngle = this.get('startAngle');\n    var endAngle = this.get('endAngle');\n    var path = [];\n    if (Math.abs(endAngle - startAngle) === Math.PI * 2) {\n      path = [['M', x, y - ry], ['A', rx, ry, 0, 1, 1, x, y + ry], ['A', rx, ry, 0, 1, 1, x, y - ry], ['Z']];\n    } else {\n      var startPoint = this.getCirclePoint(startAngle);\n      var endPoint = this.getCirclePoint(endAngle);\n      var large = Math.abs(endAngle - startAngle) > Math.PI ? 1 : 0;\n      var sweep = startAngle > endAngle ? 0 : 1;\n      path = [['M', x, y], ['L', startPoint.x, startPoint.y], ['A', rx, ry, 0, large, sweep, endPoint.x, endPoint.y], ['L', x, y]];\n    }\n    return path;\n  };\n  Circle.prototype.getTickPoint = function (tickValue) {\n    var startAngle = this.get('startAngle');\n    var endAngle = this.get('endAngle');\n    var angle = startAngle + (endAngle - startAngle) * tickValue;\n    return this.getCirclePoint(angle);\n  };\n  // 获取垂直于坐标轴的向量\n  Circle.prototype.getSideVector = function (offset, point) {\n    var center = this.get('center');\n    var vector = [point.x - center.x, point.y - center.y];\n    var factor = this.get('verticalFactor');\n    var vecLen = vec2.length(vector);\n    vec2.scale(vector, vector, factor * offset / vecLen);\n    return vector;\n  };\n  // 获取沿坐标轴方向的向量\n  Circle.prototype.getAxisVector = function (point) {\n    var center = this.get('center');\n    var vector = [point.x - center.x, point.y - center.y];\n    return [vector[1], -1 * vector[0]]; // 获取顺时针方向的向量\n  };\n  // 根据圆心和半径获取点\n  Circle.prototype.getCirclePoint = function (angle, radius) {\n    var center = this.get('center');\n    radius = radius || this.get('radius');\n    return {\n      x: center.x + Math.cos(angle) * radius,\n      y: center.y + Math.sin(angle) * radius\n    };\n  };\n  /**\n   * 是否可以执行某一 overlap\n   * @param name\n   */\n  Circle.prototype.canProcessOverlap = function (name) {\n    var labelCfg = this.get('label');\n    // 对 autoRotate，如果配置了旋转角度，直接进行固定角度旋转\n    if (name === 'autoRotate') {\n      return isNil(labelCfg.rotate);\n    }\n    // 默认所有 overlap 都可执行\n    return true;\n  };\n  Circle.prototype.processOverlap = function (labelGroup) {\n    var _this = this;\n    var labelCfg = this.get('label');\n    var titleCfg = this.get('title');\n    var verticalLimitLength = this.get('verticalLimitLength');\n    var labelOffset = labelCfg.offset;\n    var limitLength = verticalLimitLength;\n    var titleHeight = 0;\n    var titleSpacing = 0;\n    if (titleCfg) {\n      titleHeight = titleCfg.style.fontSize;\n      titleSpacing = titleCfg.spacing;\n    }\n    if (limitLength) {\n      limitLength = limitLength - labelOffset - titleSpacing - titleHeight;\n    }\n    var overlapOrder = this.get('overlapOrder');\n    each(overlapOrder, function (name) {\n      if (labelCfg[name] && _this.canProcessOverlap(name)) {\n        _this.autoProcessOverlap(name, labelCfg[name], labelGroup, limitLength);\n      }\n    });\n    if (titleCfg) {\n      if (isNil(titleCfg.offset)) {\n        // 调整 title 的 offset\n        var length_1 = labelGroup.getCanvasBBox().height;\n        // 如果用户没有设置 offset，则自动计算\n        titleCfg.offset = labelOffset + length_1 + titleSpacing + titleHeight / 2;\n      }\n    }\n  };\n  Circle.prototype.autoProcessOverlap = function (name, value, labelGroup, limitLength) {\n    var _this = this;\n    var hasAdjusted = false;\n    var util = OverlapUtil[name];\n    if (limitLength > 0) {\n      if (value === true) {\n        // true 形式的配置：使用 overlap 默认的的处理方法进行处理\n        hasAdjusted = util.getDefault()(false, labelGroup, limitLength);\n      } else if (isFunction(value)) {\n        // 回调函数形式的配置： 用户可以传入回调函数\n        hasAdjusted = value(false, labelGroup, limitLength);\n      } else if (isObject(value)) {\n        // object 形式的配置方式：包括 处理方法 type， 和可选参数配置 cfg\n        var overlapCfg = value;\n        if (util[overlapCfg.type]) {\n          hasAdjusted = util[overlapCfg.type](false, labelGroup, limitLength, overlapCfg.cfg);\n        }\n      } else if (util[value]) {\n        // 字符串类型的配置：按照名称执行 overlap 处理方法\n        hasAdjusted = util[value](false, labelGroup, limitLength);\n      }\n    }\n    if (name === 'autoRotate') {\n      // 文本旋转后，文本的对齐方式可能就不合适了\n      if (hasAdjusted) {\n        var labels = labelGroup.getChildren();\n        var verticalFactor_1 = this.get('verticalFactor');\n        each(labels, function (label) {\n          var textAlign = label.attr('textAlign');\n          if (textAlign === 'center') {\n            // 居中的文本需要调整旋转度\n            var newAlign = verticalFactor_1 > 0 ? 'end' : 'start';\n            label.attr('textAlign', newAlign);\n          }\n        });\n      }\n    } else if (name === 'autoHide') {\n      var children = labelGroup.getChildren().slice(0); // 复制数组，删除时不会出错\n      each(children, function (label) {\n        if (!label.get('visible')) {\n          if (_this.get('isRegister')) {\n            // 已经注册过了，则删除\n            _this.unregisterElement(label);\n          }\n          label.remove(); // 防止 label 数量太多，所以统一删除\n        }\n      });\n    }\n  };\n\n  return Circle;\n}(AxisBase);\nexport default Circle;","map":{"version":3,"names":["each","isNil","isFunction","isObject","vec2","AxisBase","OverlapUtil","Circle","_super","__extends","prototype","getDefaultCfg","cfg","call","__assign","type","locationType","center","radius","startAngle","Math","PI","endAngle","getLinePath","get","x","y","rx","ry","path","abs","startPoint","getCirclePoint","endPoint","large","sweep","getTickPoint","tickValue","angle","getSideVector","offset","point","vector","factor","vecLen","length","scale","getAxisVector","cos","sin","canProcessOverlap","name","labelCfg","rotate","processOverlap","labelGroup","_this","titleCfg","verticalLimitLength","labelOffset","limitLength","titleHeight","titleSpacing","style","fontSize","spacing","overlapOrder","autoProcessOverlap","length_1","getCanvasBBox","height","value","hasAdjusted","util","getDefault","overlapCfg","labels","getChildren","verticalFactor_1","label","textAlign","attr","newAlign","children","slice","unregisterElement","remove"],"sources":["../../src/axis/circle.ts"],"sourcesContent":[null],"mappings":";AACA,SAASA,IAAI,EAAEC,KAAK,EAAEC,UAAU,EAAEC,QAAQ,QAAQ,YAAY;AAC9D,SAASC,IAAI,QAAQ,mBAAmB;AACxC,OAAOC,QAAQ,MAAM,QAAQ;AAC7B,OAAO,KAAKC,WAAW,MAAM,WAAW;AAIxC,IAAAC,MAAA,0BAAAC,MAAA;EAAqBC,SAAA,CAAAF,MAAA,EAAAC,MAAA;EAArB,SAAAD,OAAA;;EA0KA;EAzKSA,MAAA,CAAAG,SAAA,CAAAC,aAAa,GAApB;IACE,IAAMC,GAAG,GAAGJ,MAAA,CAAAE,SAAA,CAAMC,aAAa,CAAAE,IAAA,MAAE;IACjC,OAAAC,QAAA,CAAAA,QAAA,KACKF,GAAG;MACNG,IAAI,EAAE,QAAQ;MACdC,YAAY,EAAE,QAAQ;MACtBC,MAAM,EAAE,IAAI;MACZC,MAAM,EAAE,IAAI;MACZC,UAAU,EAAE,CAACC,IAAI,CAACC,EAAE,GAAG,CAAC;MACxBC,QAAQ,EAAGF,IAAI,CAACC,EAAE,GAAG,CAAC,GAAI;IAAC;EAE/B,CAAC;EAESd,MAAA,CAAAG,SAAA,CAAAa,WAAW,GAArB;IACE,IAAMN,MAAM,GAAG,IAAI,CAACO,GAAG,CAAC,QAAQ,CAAC;IACjC,IAAMC,CAAC,GAAGR,MAAM,CAACQ,CAAC;IAClB,IAAMC,CAAC,GAAGT,MAAM,CAACS,CAAC;IAClB,IAAMC,EAAE,GAAG,IAAI,CAACH,GAAG,CAAC,QAAQ,CAAC;IAC7B,IAAMI,EAAE,GAAGD,EAAE;IACb,IAAMR,UAAU,GAAG,IAAI,CAACK,GAAG,CAAC,YAAY,CAAC;IACzC,IAAMF,QAAQ,GAAG,IAAI,CAACE,GAAG,CAAC,UAAU,CAAC;IAErC,IAAIK,IAAI,GAAG,EAAE;IACb,IAAIT,IAAI,CAACU,GAAG,CAACR,QAAQ,GAAGH,UAAU,CAAC,KAAKC,IAAI,CAACC,EAAE,GAAG,CAAC,EAAE;MACnDQ,IAAI,GAAG,CAAC,CAAC,GAAG,EAAEJ,CAAC,EAAEC,CAAC,GAAGE,EAAE,CAAC,EAAE,CAAC,GAAG,EAAED,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAEH,CAAC,EAAEC,CAAC,GAAGE,EAAE,CAAC,EAAE,CAAC,GAAG,EAAED,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAEH,CAAC,EAAEC,CAAC,GAAGE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;KACvG,MAAM;MACL,IAAMG,UAAU,GAAG,IAAI,CAACC,cAAc,CAACb,UAAU,CAAC;MAClD,IAAMc,QAAQ,GAAG,IAAI,CAACD,cAAc,CAACV,QAAQ,CAAC;MAC9C,IAAMY,KAAK,GAAGd,IAAI,CAACU,GAAG,CAACR,QAAQ,GAAGH,UAAU,CAAC,GAAGC,IAAI,CAACC,EAAE,GAAG,CAAC,GAAG,CAAC;MAC/D,IAAMc,KAAK,GAAGhB,UAAU,GAAGG,QAAQ,GAAG,CAAC,GAAG,CAAC;MAC3CO,IAAI,GAAG,CACL,CAAC,GAAG,EAAEJ,CAAC,EAAEC,CAAC,CAAC,EACX,CAAC,GAAG,EAAEK,UAAU,CAACN,CAAC,EAAEM,UAAU,CAACL,CAAC,CAAC,EACjC,CAAC,GAAG,EAAEC,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAEM,KAAK,EAAEC,KAAK,EAAEF,QAAQ,CAACR,CAAC,EAAEQ,QAAQ,CAACP,CAAC,CAAC,EACtD,CAAC,GAAG,EAAED,CAAC,EAAEC,CAAC,CAAC,CACZ;;IAEH,OAAOG,IAAI;EACb,CAAC;EAEStB,MAAA,CAAAG,SAAA,CAAA0B,YAAY,GAAtB,UAAuBC,SAAS;IAC9B,IAAMlB,UAAU,GAAG,IAAI,CAACK,GAAG,CAAC,YAAY,CAAC;IACzC,IAAMF,QAAQ,GAAG,IAAI,CAACE,GAAG,CAAC,UAAU,CAAC;IACrC,IAAMc,KAAK,GAAGnB,UAAU,GAAG,CAACG,QAAQ,GAAGH,UAAU,IAAIkB,SAAS;IAC9D,OAAO,IAAI,CAACL,cAAc,CAACM,KAAK,CAAC;EACnC,CAAC;EAED;EACU/B,MAAA,CAAAG,SAAA,CAAA6B,aAAa,GAAvB,UAAwBC,MAAc,EAAEC,KAAY;IAClD,IAAMxB,MAAM,GAAG,IAAI,CAACO,GAAG,CAAC,QAAQ,CAAC;IACjC,IAAMkB,MAAM,GAAqB,CAACD,KAAK,CAAChB,CAAC,GAAGR,MAAM,CAACQ,CAAC,EAAEgB,KAAK,CAACf,CAAC,GAAGT,MAAM,CAACS,CAAC,CAAC;IACzE,IAAMiB,MAAM,GAAG,IAAI,CAACnB,GAAG,CAAC,gBAAgB,CAAC;IACzC,IAAMoB,MAAM,GAAGxC,IAAI,CAACyC,MAAM,CAACH,MAAM,CAAC;IAClCtC,IAAI,CAAC0C,KAAK,CAACJ,MAAM,EAAEA,MAAM,EAAGC,MAAM,GAAGH,MAAM,GAAII,MAAM,CAAC;IACtD,OAAOF,MAAM;EACf,CAAC;EAED;EACUnC,MAAA,CAAAG,SAAA,CAAAqC,aAAa,GAAvB,UAAwBN,KAAY;IAClC,IAAMxB,MAAM,GAAG,IAAI,CAACO,GAAG,CAAC,QAAQ,CAAC;IACjC,IAAMkB,MAAM,GAAG,CAACD,KAAK,CAAChB,CAAC,GAAGR,MAAM,CAACQ,CAAC,EAAEgB,KAAK,CAACf,CAAC,GAAGT,MAAM,CAACS,CAAC,CAAC;IACvD,OAAO,CAACgB,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACtC,CAAC;EAED;EACQnC,MAAA,CAAAG,SAAA,CAAAsB,cAAc,GAAtB,UAAuBM,KAAa,EAAEpB,MAAe;IACnD,IAAMD,MAAM,GAAG,IAAI,CAACO,GAAG,CAAC,QAAQ,CAAC;IACjCN,MAAM,GAAGA,MAAM,IAAI,IAAI,CAACM,GAAG,CAAC,QAAQ,CAAC;IACrC,OAAO;MACLC,CAAC,EAAER,MAAM,CAACQ,CAAC,GAAGL,IAAI,CAAC4B,GAAG,CAACV,KAAK,CAAC,GAAGpB,MAAM;MACtCQ,CAAC,EAAET,MAAM,CAACS,CAAC,GAAGN,IAAI,CAAC6B,GAAG,CAACX,KAAK,CAAC,GAAGpB;KACjC;EACH,CAAC;EAED;;;;EAIQX,MAAA,CAAAG,SAAA,CAAAwC,iBAAiB,GAAzB,UAA0BC,IAAY;IACpC,IAAMC,QAAQ,GAAG,IAAI,CAAC5B,GAAG,CAAC,OAAO,CAAC;IAElC;IACA,IAAI2B,IAAI,KAAK,YAAY,EAAE;MACzB,OAAOlD,KAAK,CAACmD,QAAQ,CAACC,MAAM,CAAC;;IAG/B;IACA,OAAO,IAAI;EACb,CAAC;EAES9C,MAAA,CAAAG,SAAA,CAAA4C,cAAc,GAAxB,UAAyBC,UAAU;IAAnC,IAAAC,KAAA;IACE,IAAMJ,QAAQ,GAAG,IAAI,CAAC5B,GAAG,CAAC,OAAO,CAAC;IAClC,IAAMiC,QAAQ,GAAG,IAAI,CAACjC,GAAG,CAAC,OAAO,CAAC;IAClC,IAAMkC,mBAAmB,GAAG,IAAI,CAAClC,GAAG,CAAC,qBAAqB,CAAC;IAC3D,IAAMmC,WAAW,GAAGP,QAAQ,CAACZ,MAAM;IACnC,IAAIoB,WAAW,GAAGF,mBAAmB;IACrC,IAAIG,WAAW,GAAG,CAAC;IACnB,IAAIC,YAAY,GAAG,CAAC;IACpB,IAAIL,QAAQ,EAAE;MACZI,WAAW,GAAGJ,QAAQ,CAACM,KAAK,CAACC,QAAQ;MACrCF,YAAY,GAAGL,QAAQ,CAACQ,OAAO;;IAEjC,IAAIL,WAAW,EAAE;MACfA,WAAW,GAAGA,WAAW,GAAGD,WAAW,GAAGG,YAAY,GAAGD,WAAW;;IAEtE,IAAMK,YAAY,GAAG,IAAI,CAAC1C,GAAG,CAAC,cAAc,CAAC;IAC7CxB,IAAI,CAACkE,YAAY,EAAE,UAACf,IAAI;MACtB,IAAIC,QAAQ,CAACD,IAAI,CAAC,IAAIK,KAAI,CAACN,iBAAiB,CAACC,IAAI,CAAC,EAAE;QAClDK,KAAI,CAACW,kBAAkB,CAAChB,IAAI,EAAEC,QAAQ,CAACD,IAAI,CAAC,EAAEI,UAAU,EAAEK,WAAW,CAAC;;IAE1E,CAAC,CAAC;IACF,IAAIH,QAAQ,EAAE;MACZ,IAAIxD,KAAK,CAACwD,QAAQ,CAACjB,MAAM,CAAC,EAAE;QAC1B;QACQ,IAAQ4B,QAAM,GAAKb,UAAU,CAACc,aAAa,EAAE,CAAAC,MAA/B;QACtB;QACAb,QAAQ,CAACjB,MAAM,GAAGmB,WAAW,GAAGS,QAAM,GAAGN,YAAY,GAAGD,WAAW,GAAG,CAAC;;;EAG7E,CAAC;EAEOtD,MAAA,CAAAG,SAAA,CAAAyD,kBAAkB,GAA1B,UAA2BhB,IAAY,EAAEoB,KAAU,EAAEhB,UAAkB,EAAEK,WAAmB;IAA5F,IAAAJ,KAAA;IACE,IAAIgB,WAAW,GAAG,KAAK;IACvB,IAAMC,IAAI,GAAGnE,WAAW,CAAC6C,IAAI,CAAC;IAC9B,IAAIS,WAAW,GAAG,CAAC,EAAE;MACnB,IAAIW,KAAK,KAAK,IAAI,EAAE;QAClB;QACAC,WAAW,GAAGC,IAAI,CAACC,UAAU,EAAE,CAAC,KAAK,EAAEnB,UAAU,EAAEK,WAAW,CAAC;OAChE,MAAM,IAAI1D,UAAU,CAACqE,KAAK,CAAC,EAAE;QAC5B;QACAC,WAAW,GAAGD,KAAK,CAAC,KAAK,EAAEhB,UAAU,EAAEK,WAAW,CAAC;OACpD,MAAM,IAAIzD,QAAQ,CAACoE,KAAK,CAAC,EAAE;QAC1B;QACA,IAAMI,UAAU,GAAGJ,KAAqD;QACxE,IAAIE,IAAI,CAACE,UAAU,CAAC5D,IAAI,CAAC,EAAE;UACzByD,WAAW,GAAGC,IAAI,CAACE,UAAU,CAAC5D,IAAI,CAAC,CAAC,KAAK,EAAEwC,UAAU,EAAEK,WAAW,EAAEe,UAAU,CAAC/D,GAAG,CAAC;;OAEtF,MAAM,IAAI6D,IAAI,CAACF,KAAK,CAAC,EAAE;QACtB;QACAC,WAAW,GAAGC,IAAI,CAACF,KAAK,CAAC,CAAC,KAAK,EAAEhB,UAAU,EAAEK,WAAW,CAAC;;;IAG7D,IAAIT,IAAI,KAAK,YAAY,EAAE;MACzB;MACA,IAAIqB,WAAW,EAAE;QACf,IAAMI,MAAM,GAAGrB,UAAU,CAACsB,WAAW,EAAE;QACvC,IAAMC,gBAAc,GAAG,IAAI,CAACtD,GAAG,CAAC,gBAAgB,CAAC;QACjDxB,IAAI,CAAC4E,MAAM,EAAE,UAACG,KAAK;UACjB,IAAMC,SAAS,GAAGD,KAAK,CAACE,IAAI,CAAC,WAAW,CAAC;UACzC,IAAID,SAAS,KAAK,QAAQ,EAAE;YAC1B;YACA,IAAME,QAAQ,GAAGJ,gBAAc,GAAG,CAAC,GAAG,KAAK,GAAG,OAAO;YACrDC,KAAK,CAACE,IAAI,CAAC,WAAW,EAAEC,QAAQ,CAAC;;QAErC,CAAC,CAAC;;KAEL,MAAM,IAAI/B,IAAI,KAAK,UAAU,EAAE;MAC9B,IAAMgC,QAAQ,GAAG5B,UAAU,CAACsB,WAAW,EAAE,CAACO,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;MACpDpF,IAAI,CAACmF,QAAQ,EAAE,UAACJ,KAAK;QACnB,IAAI,CAACA,KAAK,CAACvD,GAAG,CAAC,SAAS,CAAC,EAAE;UACzB,IAAIgC,KAAI,CAAChC,GAAG,CAAC,YAAY,CAAC,EAAE;YAC1B;YACAgC,KAAI,CAAC6B,iBAAiB,CAACN,KAAK,CAAC;;UAE/BA,KAAK,CAACO,MAAM,EAAE,CAAC,CAAC;;MAEpB,CAAC,CAAC;;EAEN,CAAC;;EACH,OAAA/E,MAAC;AAAD,CAAC,CA1KoBF,QAAQ;AA4K7B,eAAeE,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}
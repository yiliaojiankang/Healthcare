{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _class, _class2, _descriptor, _descriptor2, _descriptor3;\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport { lodashUtil, rgb2arr } from '@antv/l7-utils';\nimport { EventEmitter } from 'eventemitter3';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport Clock from \"../../utils/clock\";\nimport { MaskOperation, StencilType } from \"./ILayerService\";\nvar throttle = lodashUtil.throttle;\nvar LayerService = (_dec = injectable(), _dec2 = inject(TYPES.IRendererService), _dec3 = inject(TYPES.IMapService), _dec4 = inject(TYPES.IDebugService), _dec(_class = (_class2 = /*#__PURE__*/function (_ref) {\n  _inherits(LayerService, _ref);\n  var _super = _createSuper(LayerService);\n  function LayerService() {\n    var _this;\n    _classCallCheck(this, LayerService);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    // pickedLayerId 参数用于指定当前存在被选中的 layer\n    _defineProperty(_assertThisInitialized(_this), \"pickedLayerId\", -1);\n    _defineProperty(_assertThisInitialized(_this), \"clock\", new Clock());\n    _defineProperty(_assertThisInitialized(_this), \"alreadyInRendering\", false);\n    _defineProperty(_assertThisInitialized(_this), \"layers\", []);\n    _defineProperty(_assertThisInitialized(_this), \"layerList\", []);\n    _defineProperty(_assertThisInitialized(_this), \"layerRenderID\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"sceneInited\", false);\n    _defineProperty(_assertThisInitialized(_this), \"animateInstanceCount\", 0);\n    // TODO: 是否开启 shader 中的颜色拾取计算\n    _defineProperty(_assertThisInitialized(_this), \"shaderPicking\", true);\n    _defineProperty(_assertThisInitialized(_this), \"enableRender\", true);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"renderService\", _descriptor, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"mapService\", _descriptor2, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"debugService\", _descriptor3, _assertThisInitialized(_this));\n    _defineProperty(_assertThisInitialized(_this), \"reRender\", throttle(function () {\n      _this.renderLayers();\n    }, 32));\n    _defineProperty(_assertThisInitialized(_this), \"throttleRenderLayers\", throttle(function () {\n      _this.renderLayers();\n    }, 16));\n    return _this;\n  }\n  _createClass(LayerService, [{\n    key: \"needPick\",\n    value: function needPick(type) {\n      return this.layerList.some(function (layer) {\n        return layer.needPick(type);\n      });\n    }\n  }, {\n    key: \"add\",\n    value: function add(layer) {\n      var _this2 = this;\n      this.layers.push(layer);\n      if (this.sceneInited) {\n        layer.init().then(function () {\n          _this2.renderLayers();\n        });\n      }\n    }\n  }, {\n    key: \"addMask\",\n    value: function addMask(mask) {\n      var _this3 = this;\n      if (this.sceneInited) {\n        mask.init().then(function () {\n          _this3.renderLayers();\n        });\n      }\n    }\n  }, {\n    key: \"initLayers\",\n    value: function () {\n      var _initLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this4 = this;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              this.sceneInited = true;\n              this.layers.forEach( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(layer) {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) switch (_context.prev = _context.next) {\n                      case 0:\n                        if (layer.startInit) {\n                          _context.next = 4;\n                          break;\n                        }\n                        _context.next = 3;\n                        return layer.init();\n                      case 3:\n                        _this4.updateLayerRenderList();\n                      case 4:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }, _callee);\n                }));\n                return function (_x) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function initLayers() {\n        return _initLayers.apply(this, arguments);\n      }\n      return initLayers;\n    }()\n  }, {\n    key: \"getSceneInited\",\n    value: function getSceneInited() {\n      return this.sceneInited;\n    }\n  }, {\n    key: \"getRenderList\",\n    value: function getRenderList() {\n      return this.layerList;\n    }\n  }, {\n    key: \"getLayers\",\n    value: function getLayers() {\n      return this.layers;\n    }\n  }, {\n    key: \"getLayer\",\n    value: function getLayer(id) {\n      return this.layers.find(function (layer) {\n        return layer.id === id;\n      });\n    }\n  }, {\n    key: \"getLayerByName\",\n    value: function getLayerByName(name) {\n      return this.layers.find(function (layer) {\n        return layer.name === name;\n      });\n    }\n  }, {\n    key: \"remove\",\n    value: function () {\n      var _remove = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(layer, parentLayer) {\n        var layerIndex, _layerIndex;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              // Tip: layer.layerChildren 当 layer 存在子图层的情况\n              if (parentLayer) {\n                layerIndex = parentLayer.layerChildren.indexOf(layer);\n                if (layerIndex > -1) {\n                  parentLayer.layerChildren.splice(layerIndex, 1);\n                }\n              } else {\n                _layerIndex = this.layers.indexOf(layer);\n                if (_layerIndex > -1) {\n                  this.layers.splice(_layerIndex, 1);\n                }\n              }\n              layer.destroy();\n              this.reRender();\n              this.emit('layerChange', this.layers);\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function remove(_x2, _x3) {\n        return _remove.apply(this, arguments);\n      }\n      return remove;\n    }()\n  }, {\n    key: \"removeAllLayers\",\n    value: function () {\n      var _removeAllLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              this.destroy();\n              this.reRender();\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function removeAllLayers() {\n        return _removeAllLayers.apply(this, arguments);\n      }\n      return removeAllLayers;\n    }()\n  }, {\n    key: \"setEnableRender\",\n    value: function setEnableRender(flag) {\n      this.enableRender = flag;\n    }\n  }, {\n    key: \"renderLayers\",\n    value: function () {\n      var _renderLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var renderUid, _iterator, _step, layer, _iterator2, _step2, _layer, _layer$getLayerConfig, enableMask;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(this.alreadyInRendering || !this.enableRender)) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              this.updateLayerRenderList();\n              renderUid = this.debugService.generateRenderUid();\n              this.debugService.renderStart(renderUid);\n              this.alreadyInRendering = true;\n              this.clear();\n              _iterator = _createForOfIteratorHelper(this.layerList);\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  layer = _step.value;\n                  layer.prerender();\n                }\n\n                // The main render pass, all layers in a whole.\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n              this.renderService.beginFrame();\n              _iterator2 = _createForOfIteratorHelper(this.layerList);\n              _context5.prev = 11;\n              _iterator2.s();\n            case 13:\n              if ((_step2 = _iterator2.n()).done) {\n                _context5.next = 25;\n                break;\n              }\n              _layer = _step2.value;\n              _layer$getLayerConfig = _layer.getLayerConfig(), enableMask = _layer$getLayerConfig.enableMask;\n              if (_layer.masks.filter(function (m) {\n                return m.inited;\n              }).length > 0 && enableMask) {\n                // 清除上一次的模版缓存\n                this.renderMask(_layer.masks);\n              }\n              if (!_layer.getLayerConfig().enableMultiPassRenderer) {\n                _context5.next = 22;\n                break;\n              }\n              _context5.next = 20;\n              return _layer.renderMultiPass();\n            case 20:\n              _context5.next = 23;\n              break;\n            case 22:\n              _layer.render();\n            case 23:\n              _context5.next = 13;\n              break;\n            case 25:\n              _context5.next = 30;\n              break;\n            case 27:\n              _context5.prev = 27;\n              _context5.t0 = _context5[\"catch\"](11);\n              _iterator2.e(_context5.t0);\n            case 30:\n              _context5.prev = 30;\n              _iterator2.f();\n              return _context5.finish(30);\n            case 33:\n              this.renderService.endFrame();\n              this.debugService.renderEnd(renderUid);\n              this.alreadyInRendering = false;\n            case 36:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[11, 27, 30, 33]]);\n      }));\n      function renderLayers() {\n        return _renderLayers.apply(this, arguments);\n      }\n      return renderLayers;\n    }()\n  }, {\n    key: \"renderMask\",\n    value: function renderMask(masks) {\n      var maskIndex = 0;\n      this.renderService.clear({\n        stencil: 0,\n        depth: 1,\n        framebuffer: null\n      });\n      var stencilType = masks.length > 1 ? StencilType.MULTIPLE : StencilType.SINGLE;\n      var _iterator3 = _createForOfIteratorHelper(masks),\n        _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var layer = _step3.value;\n          // 清除上一次的模版缓存\n          layer.render({\n            isStencil: true,\n            stencilType: stencilType,\n            stencilIndex: maskIndex++\n          });\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"beforeRenderData\",\n    value: function () {\n      var _beforeRenderData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(layer) {\n        var flag;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return layer.hooks.beforeRenderData.promise();\n            case 2:\n              flag = _context6.sent;\n              if (flag) {\n                this.renderLayers();\n              }\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function beforeRenderData(_x4) {\n        return _beforeRenderData.apply(this, arguments);\n      }\n      return beforeRenderData;\n    }()\n  }, {\n    key: \"renderTileLayerMask\",\n    value: function renderTileLayerMask(layer) {\n      var maskindex = 0;\n      var _layer$getLayerConfig2 = layer.getLayerConfig(),\n        _layer$getLayerConfig3 = _layer$getLayerConfig2.enableMask,\n        enableMask = _layer$getLayerConfig3 === void 0 ? true : _layer$getLayerConfig3;\n      var maskCount = layer.tileMask ? 1 : 0;\n      var masklayers = layer.masks.filter(function (m) {\n        return m.inited;\n      });\n      maskCount = maskCount + (enableMask ? masklayers.length : 1);\n      var stencilType = maskCount > 1 ? StencilType.MULTIPLE : StencilType.SINGLE;\n      //  兼容MaskLayer MaskLayer的掩膜不能clear\n      if (layer.tileMask || masklayers.length && enableMask) {\n        this.renderService.clear({\n          stencil: 0,\n          depth: 1,\n          framebuffer: null\n        });\n      }\n      if (masklayers.length && enableMask) {\n        var _iterator4 = _createForOfIteratorHelper(masklayers),\n          _step4;\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var mask = _step4.value;\n            mask.render({\n              isStencil: true,\n              stencilType: stencilType,\n              stencilIndex: maskindex++\n            });\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n      }\n      // // 瓦片裁剪\n      if (layer.tileMask) {\n        layer.tileMask.render({\n          isStencil: true,\n          stencilType: stencilType,\n          stencilIndex: maskindex++,\n          stencilOperation: MaskOperation.OR\n        });\n      }\n    }\n    // 瓦片图层渲染\n  }, {\n    key: \"renderTileLayer\",\n    value: function () {\n      var _renderTileLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(layer) {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              this.renderTileLayerMask(layer);\n              if (!layer.getLayerConfig().enableMultiPassRenderer) {\n                _context7.next = 6;\n                break;\n              }\n              _context7.next = 4;\n              return layer.renderMultiPass();\n            case 4:\n              _context7.next = 8;\n              break;\n            case 6:\n              _context7.next = 8;\n              return layer.render();\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function renderTileLayer(_x5) {\n        return _renderTileLayer.apply(this, arguments);\n      }\n      return renderTileLayer;\n    }()\n  }, {\n    key: \"updateLayerRenderList\",\n    value: function updateLayerRenderList() {\n      var _this5 = this;\n      // Tip: 每次更新都是从 layers 重新构建\n      this.layerList = [];\n      this.layers.filter(function (layer) {\n        return layer.inited;\n      }).filter(function (layer) {\n        return layer.isVisible();\n      }).sort(function (pre, next) {\n        // 根据 zIndex 对渲染顺序进行排序\n        return pre.zIndex - next.zIndex;\n      }).forEach(function (layer) {\n        _this5.layerList.push(layer);\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.layers.forEach(function (layer) {\n        layer.destroy();\n      });\n      this.layers = [];\n      this.layerList = [];\n      this.emit('layerChange', this.layers);\n    }\n  }, {\n    key: \"startAnimate\",\n    value: function startAnimate() {\n      if (this.animateInstanceCount++ === 0) {\n        this.clock.start();\n        this.runRender();\n      }\n    }\n  }, {\n    key: \"stopAnimate\",\n    value: function stopAnimate() {\n      if (--this.animateInstanceCount === 0) {\n        this.stopRender();\n        this.clock.stop();\n      }\n    }\n  }, {\n    key: \"getOESTextureFloat\",\n    value: function getOESTextureFloat() {\n      return this.renderService.extensionObject.OES_texture_float;\n    }\n\n    // 控制着色器颜色拾取计算\n  }, {\n    key: \"enableShaderPick\",\n    value: function enableShaderPick() {\n      this.shaderPicking = true;\n    }\n  }, {\n    key: \"disableShaderPick\",\n    value: function disableShaderPick() {\n      this.shaderPicking = false;\n    }\n  }, {\n    key: \"getShaderPickStat\",\n    value: function getShaderPickStat() {\n      return this.shaderPicking;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var color = rgb2arr(this.mapService.bgColor);\n      this.renderService.clear({\n        color: color,\n        depth: 1,\n        stencil: 0,\n        framebuffer: null\n      });\n    }\n  }, {\n    key: \"runRender\",\n    value: function runRender() {\n      this.renderLayers();\n      this.layerRenderID = window.requestAnimationFrame(this.runRender.bind(this));\n    }\n  }, {\n    key: \"stopRender\",\n    value: function stopRender() {\n      window.cancelAnimationFrame(this.layerRenderID);\n    }\n  }]);\n  return LayerService;\n}(EventEmitter), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"renderService\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"mapService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"debugService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { LayerService as default };","map":{"version":3,"names":["_asyncToGenerator","_initializerDefineProperty","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_applyDecoratedDescriptor","_initializerWarningHelper","_dec","_dec2","_dec3","_dec4","_class","_class2","_descriptor","_descriptor2","_descriptor3","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","_regeneratorRuntime","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","Reflect","construct","arguments","apply","sham","Proxy","Boolean","valueOf","lodashUtil","rgb2arr","EventEmitter","inject","injectable","TYPES","Clock","MaskOperation","StencilType","throttle","LayerService","IRendererService","IMapService","IDebugService","_ref","_super","_this","_len","args","_key","concat","renderLayers","key","needPick","type","layerList","some","layer","add","_this2","layers","push","sceneInited","init","then","addMask","mask","_this3","_initLayers","mark","_callee2","_this4","wrap","_callee2$","_context2","prev","forEach","_ref2","_callee","_callee$","_context","startInit","updateLayerRenderList","stop","_x","initLayers","getSceneInited","getRenderList","getLayers","getLayer","id","find","getLayerByName","_remove","_callee3","parentLayer","layerIndex","_layerIndex","_callee3$","_context3","layerChildren","indexOf","splice","destroy","reRender","emit","remove","_x2","_x3","_removeAllLayers","_callee4","_callee4$","_context4","removeAllLayers","setEnableRender","flag","enableRender","_renderLayers","_callee5","renderUid","_iterator","_step","_iterator2","_step2","_layer","_layer$getLayerConfig","enableMask","_callee5$","_context5","alreadyInRendering","abrupt","debugService","generateRenderUid","renderStart","clear","prerender","renderService","beginFrame","getLayerConfig","masks","filter","m","inited","renderMask","enableMultiPassRenderer","renderMultiPass","render","t0","finish","endFrame","renderEnd","maskIndex","stencil","depth","framebuffer","stencilType","MULTIPLE","SINGLE","_iterator3","_step3","isStencil","stencilIndex","_beforeRenderData","_callee6","_callee6$","_context6","hooks","beforeRenderData","promise","sent","_x4","renderTileLayerMask","maskindex","_layer$getLayerConfig2","_layer$getLayerConfig3","maskCount","tileMask","masklayers","_iterator4","_step4","stencilOperation","OR","_renderTileLayer","_callee7","_callee7$","_context7","renderTileLayer","_x5","_this5","isVisible","sort","pre","zIndex","startAnimate","animateInstanceCount","clock","start","runRender","stopAnimate","stopRender","getOESTextureFloat","extensionObject","OES_texture_float","enableShaderPick","shaderPicking","disableShaderPick","getShaderPickStat","color","mapService","bgColor","layerRenderID","window","requestAnimationFrame","bind","cancelAnimationFrame","configurable","enumerable","writable","initializer","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-core/es/services/layer/LayerService.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _class, _class2, _descriptor, _descriptor2, _descriptor3;\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { lodashUtil, rgb2arr } from '@antv/l7-utils';\nimport { EventEmitter } from 'eventemitter3';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport Clock from \"../../utils/clock\";\nimport { MaskOperation, StencilType } from \"./ILayerService\";\nvar throttle = lodashUtil.throttle;\nvar LayerService = (_dec = injectable(), _dec2 = inject(TYPES.IRendererService), _dec3 = inject(TYPES.IMapService), _dec4 = inject(TYPES.IDebugService), _dec(_class = (_class2 = /*#__PURE__*/function (_ref) {\n  _inherits(LayerService, _ref);\n  var _super = _createSuper(LayerService);\n  function LayerService() {\n    var _this;\n    _classCallCheck(this, LayerService);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    // pickedLayerId 参数用于指定当前存在被选中的 layer\n    _defineProperty(_assertThisInitialized(_this), \"pickedLayerId\", -1);\n    _defineProperty(_assertThisInitialized(_this), \"clock\", new Clock());\n    _defineProperty(_assertThisInitialized(_this), \"alreadyInRendering\", false);\n    _defineProperty(_assertThisInitialized(_this), \"layers\", []);\n    _defineProperty(_assertThisInitialized(_this), \"layerList\", []);\n    _defineProperty(_assertThisInitialized(_this), \"layerRenderID\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"sceneInited\", false);\n    _defineProperty(_assertThisInitialized(_this), \"animateInstanceCount\", 0);\n    // TODO: 是否开启 shader 中的颜色拾取计算\n    _defineProperty(_assertThisInitialized(_this), \"shaderPicking\", true);\n    _defineProperty(_assertThisInitialized(_this), \"enableRender\", true);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"renderService\", _descriptor, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"mapService\", _descriptor2, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"debugService\", _descriptor3, _assertThisInitialized(_this));\n    _defineProperty(_assertThisInitialized(_this), \"reRender\", throttle(function () {\n      _this.renderLayers();\n    }, 32));\n    _defineProperty(_assertThisInitialized(_this), \"throttleRenderLayers\", throttle(function () {\n      _this.renderLayers();\n    }, 16));\n    return _this;\n  }\n  _createClass(LayerService, [{\n    key: \"needPick\",\n    value: function needPick(type) {\n      return this.layerList.some(function (layer) {\n        return layer.needPick(type);\n      });\n    }\n  }, {\n    key: \"add\",\n    value: function add(layer) {\n      var _this2 = this;\n      this.layers.push(layer);\n      if (this.sceneInited) {\n        layer.init().then(function () {\n          _this2.renderLayers();\n        });\n      }\n    }\n  }, {\n    key: \"addMask\",\n    value: function addMask(mask) {\n      var _this3 = this;\n      if (this.sceneInited) {\n        mask.init().then(function () {\n          _this3.renderLayers();\n        });\n      }\n    }\n  }, {\n    key: \"initLayers\",\n    value: function () {\n      var _initLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this4 = this;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              this.sceneInited = true;\n              this.layers.forEach( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(layer) {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) switch (_context.prev = _context.next) {\n                      case 0:\n                        if (layer.startInit) {\n                          _context.next = 4;\n                          break;\n                        }\n                        _context.next = 3;\n                        return layer.init();\n                      case 3:\n                        _this4.updateLayerRenderList();\n                      case 4:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }, _callee);\n                }));\n                return function (_x) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function initLayers() {\n        return _initLayers.apply(this, arguments);\n      }\n      return initLayers;\n    }()\n  }, {\n    key: \"getSceneInited\",\n    value: function getSceneInited() {\n      return this.sceneInited;\n    }\n  }, {\n    key: \"getRenderList\",\n    value: function getRenderList() {\n      return this.layerList;\n    }\n  }, {\n    key: \"getLayers\",\n    value: function getLayers() {\n      return this.layers;\n    }\n  }, {\n    key: \"getLayer\",\n    value: function getLayer(id) {\n      return this.layers.find(function (layer) {\n        return layer.id === id;\n      });\n    }\n  }, {\n    key: \"getLayerByName\",\n    value: function getLayerByName(name) {\n      return this.layers.find(function (layer) {\n        return layer.name === name;\n      });\n    }\n  }, {\n    key: \"remove\",\n    value: function () {\n      var _remove = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(layer, parentLayer) {\n        var layerIndex, _layerIndex;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              // Tip: layer.layerChildren 当 layer 存在子图层的情况\n              if (parentLayer) {\n                layerIndex = parentLayer.layerChildren.indexOf(layer);\n                if (layerIndex > -1) {\n                  parentLayer.layerChildren.splice(layerIndex, 1);\n                }\n              } else {\n                _layerIndex = this.layers.indexOf(layer);\n                if (_layerIndex > -1) {\n                  this.layers.splice(_layerIndex, 1);\n                }\n              }\n              layer.destroy();\n              this.reRender();\n              this.emit('layerChange', this.layers);\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function remove(_x2, _x3) {\n        return _remove.apply(this, arguments);\n      }\n      return remove;\n    }()\n  }, {\n    key: \"removeAllLayers\",\n    value: function () {\n      var _removeAllLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              this.destroy();\n              this.reRender();\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function removeAllLayers() {\n        return _removeAllLayers.apply(this, arguments);\n      }\n      return removeAllLayers;\n    }()\n  }, {\n    key: \"setEnableRender\",\n    value: function setEnableRender(flag) {\n      this.enableRender = flag;\n    }\n  }, {\n    key: \"renderLayers\",\n    value: function () {\n      var _renderLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var renderUid, _iterator, _step, layer, _iterator2, _step2, _layer, _layer$getLayerConfig, enableMask;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(this.alreadyInRendering || !this.enableRender)) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              this.updateLayerRenderList();\n              renderUid = this.debugService.generateRenderUid();\n              this.debugService.renderStart(renderUid);\n              this.alreadyInRendering = true;\n              this.clear();\n              _iterator = _createForOfIteratorHelper(this.layerList);\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  layer = _step.value;\n                  layer.prerender();\n                }\n\n                // The main render pass, all layers in a whole.\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n              this.renderService.beginFrame();\n              _iterator2 = _createForOfIteratorHelper(this.layerList);\n              _context5.prev = 11;\n              _iterator2.s();\n            case 13:\n              if ((_step2 = _iterator2.n()).done) {\n                _context5.next = 25;\n                break;\n              }\n              _layer = _step2.value;\n              _layer$getLayerConfig = _layer.getLayerConfig(), enableMask = _layer$getLayerConfig.enableMask;\n              if (_layer.masks.filter(function (m) {\n                return m.inited;\n              }).length > 0 && enableMask) {\n                // 清除上一次的模版缓存\n                this.renderMask(_layer.masks);\n              }\n              if (!_layer.getLayerConfig().enableMultiPassRenderer) {\n                _context5.next = 22;\n                break;\n              }\n              _context5.next = 20;\n              return _layer.renderMultiPass();\n            case 20:\n              _context5.next = 23;\n              break;\n            case 22:\n              _layer.render();\n            case 23:\n              _context5.next = 13;\n              break;\n            case 25:\n              _context5.next = 30;\n              break;\n            case 27:\n              _context5.prev = 27;\n              _context5.t0 = _context5[\"catch\"](11);\n              _iterator2.e(_context5.t0);\n            case 30:\n              _context5.prev = 30;\n              _iterator2.f();\n              return _context5.finish(30);\n            case 33:\n              this.renderService.endFrame();\n              this.debugService.renderEnd(renderUid);\n              this.alreadyInRendering = false;\n            case 36:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[11, 27, 30, 33]]);\n      }));\n      function renderLayers() {\n        return _renderLayers.apply(this, arguments);\n      }\n      return renderLayers;\n    }()\n  }, {\n    key: \"renderMask\",\n    value: function renderMask(masks) {\n      var maskIndex = 0;\n      this.renderService.clear({\n        stencil: 0,\n        depth: 1,\n        framebuffer: null\n      });\n      var stencilType = masks.length > 1 ? StencilType.MULTIPLE : StencilType.SINGLE;\n      var _iterator3 = _createForOfIteratorHelper(masks),\n        _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var layer = _step3.value;\n          // 清除上一次的模版缓存\n          layer.render({\n            isStencil: true,\n            stencilType: stencilType,\n            stencilIndex: maskIndex++\n          });\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"beforeRenderData\",\n    value: function () {\n      var _beforeRenderData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(layer) {\n        var flag;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return layer.hooks.beforeRenderData.promise();\n            case 2:\n              flag = _context6.sent;\n              if (flag) {\n                this.renderLayers();\n              }\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function beforeRenderData(_x4) {\n        return _beforeRenderData.apply(this, arguments);\n      }\n      return beforeRenderData;\n    }()\n  }, {\n    key: \"renderTileLayerMask\",\n    value: function renderTileLayerMask(layer) {\n      var maskindex = 0;\n      var _layer$getLayerConfig2 = layer.getLayerConfig(),\n        _layer$getLayerConfig3 = _layer$getLayerConfig2.enableMask,\n        enableMask = _layer$getLayerConfig3 === void 0 ? true : _layer$getLayerConfig3;\n      var maskCount = layer.tileMask ? 1 : 0;\n      var masklayers = layer.masks.filter(function (m) {\n        return m.inited;\n      });\n      maskCount = maskCount + (enableMask ? masklayers.length : 1);\n      var stencilType = maskCount > 1 ? StencilType.MULTIPLE : StencilType.SINGLE;\n      //  兼容MaskLayer MaskLayer的掩膜不能clear\n      if (layer.tileMask || masklayers.length && enableMask) {\n        this.renderService.clear({\n          stencil: 0,\n          depth: 1,\n          framebuffer: null\n        });\n      }\n      if (masklayers.length && enableMask) {\n        var _iterator4 = _createForOfIteratorHelper(masklayers),\n          _step4;\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var mask = _step4.value;\n            mask.render({\n              isStencil: true,\n              stencilType: stencilType,\n              stencilIndex: maskindex++\n            });\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n      }\n      // // 瓦片裁剪\n      if (layer.tileMask) {\n        layer.tileMask.render({\n          isStencil: true,\n          stencilType: stencilType,\n          stencilIndex: maskindex++,\n          stencilOperation: MaskOperation.OR\n        });\n      }\n    }\n    // 瓦片图层渲染\n  }, {\n    key: \"renderTileLayer\",\n    value: function () {\n      var _renderTileLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(layer) {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              this.renderTileLayerMask(layer);\n              if (!layer.getLayerConfig().enableMultiPassRenderer) {\n                _context7.next = 6;\n                break;\n              }\n              _context7.next = 4;\n              return layer.renderMultiPass();\n            case 4:\n              _context7.next = 8;\n              break;\n            case 6:\n              _context7.next = 8;\n              return layer.render();\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function renderTileLayer(_x5) {\n        return _renderTileLayer.apply(this, arguments);\n      }\n      return renderTileLayer;\n    }()\n  }, {\n    key: \"updateLayerRenderList\",\n    value: function updateLayerRenderList() {\n      var _this5 = this;\n      // Tip: 每次更新都是从 layers 重新构建\n      this.layerList = [];\n      this.layers.filter(function (layer) {\n        return layer.inited;\n      }).filter(function (layer) {\n        return layer.isVisible();\n      }).sort(function (pre, next) {\n        // 根据 zIndex 对渲染顺序进行排序\n        return pre.zIndex - next.zIndex;\n      }).forEach(function (layer) {\n        _this5.layerList.push(layer);\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.layers.forEach(function (layer) {\n        layer.destroy();\n      });\n      this.layers = [];\n      this.layerList = [];\n      this.emit('layerChange', this.layers);\n    }\n  }, {\n    key: \"startAnimate\",\n    value: function startAnimate() {\n      if (this.animateInstanceCount++ === 0) {\n        this.clock.start();\n        this.runRender();\n      }\n    }\n  }, {\n    key: \"stopAnimate\",\n    value: function stopAnimate() {\n      if (--this.animateInstanceCount === 0) {\n        this.stopRender();\n        this.clock.stop();\n      }\n    }\n  }, {\n    key: \"getOESTextureFloat\",\n    value: function getOESTextureFloat() {\n      return this.renderService.extensionObject.OES_texture_float;\n    }\n\n    // 控制着色器颜色拾取计算\n  }, {\n    key: \"enableShaderPick\",\n    value: function enableShaderPick() {\n      this.shaderPicking = true;\n    }\n  }, {\n    key: \"disableShaderPick\",\n    value: function disableShaderPick() {\n      this.shaderPicking = false;\n    }\n  }, {\n    key: \"getShaderPickStat\",\n    value: function getShaderPickStat() {\n      return this.shaderPicking;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var color = rgb2arr(this.mapService.bgColor);\n      this.renderService.clear({\n        color: color,\n        depth: 1,\n        stencil: 0,\n        framebuffer: null\n      });\n    }\n  }, {\n    key: \"runRender\",\n    value: function runRender() {\n      this.renderLayers();\n      this.layerRenderID = window.requestAnimationFrame(this.runRender.bind(this));\n    }\n  }, {\n    key: \"stopRender\",\n    value: function stopRender() {\n      window.cancelAnimationFrame(this.layerRenderID);\n    }\n  }]);\n  return LayerService;\n}(EventEmitter), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"renderService\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"mapService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"debugService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { LayerService as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
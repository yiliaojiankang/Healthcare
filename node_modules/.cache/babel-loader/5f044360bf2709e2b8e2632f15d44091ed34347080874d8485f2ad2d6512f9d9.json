{"ast":null,"code":"\"use strict\";\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n  return to;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.resolveInstance = void 0;\nvar error_msgs_1 = require(\"../constants/error_msgs\");\nvar literal_types_1 = require(\"../constants/literal_types\");\nvar METADATA_KEY = require(\"../constants/metadata_keys\");\nfunction _injectProperties(instance, childRequests, resolveRequest) {\n  var propertyInjectionsRequests = childRequests.filter(function (childRequest) {\n    return childRequest.target !== null && childRequest.target.type === literal_types_1.TargetTypeEnum.ClassProperty;\n  });\n  var propertyInjections = propertyInjectionsRequests.map(resolveRequest);\n  propertyInjectionsRequests.forEach(function (r, index) {\n    var propertyName = \"\";\n    propertyName = r.target.name.value();\n    var injection = propertyInjections[index];\n    instance[propertyName] = injection;\n  });\n  return instance;\n}\nfunction _createInstance(Func, injections) {\n  return new (Func.bind.apply(Func, __spreadArray([void 0], injections)))();\n}\nfunction _postConstruct(constr, result) {\n  if (Reflect.hasMetadata(METADATA_KEY.POST_CONSTRUCT, constr)) {\n    var data = Reflect.getMetadata(METADATA_KEY.POST_CONSTRUCT, constr);\n    try {\n      result[data.value]();\n    } catch (e) {\n      throw new Error(error_msgs_1.POST_CONSTRUCT_ERROR(constr.name, e.message));\n    }\n  }\n}\nfunction resolveInstance(constr, childRequests, resolveRequest) {\n  var result = null;\n  if (childRequests.length > 0) {\n    var constructorInjectionsRequests = childRequests.filter(function (childRequest) {\n      return childRequest.target !== null && childRequest.target.type === literal_types_1.TargetTypeEnum.ConstructorArgument;\n    });\n    var constructorInjections = constructorInjectionsRequests.map(resolveRequest);\n    result = _createInstance(constr, constructorInjections);\n    result = _injectProperties(result, childRequests, resolveRequest);\n  } else {\n    result = new constr();\n  }\n  _postConstruct(constr, result);\n  return result;\n}\nexports.resolveInstance = resolveInstance;","map":{"version":3,"names":["error_msgs_1","require","literal_types_1","METADATA_KEY","_injectProperties","instance","childRequests","resolveRequest","propertyInjectionsRequests","filter","childRequest","target","type","TargetTypeEnum","ClassProperty","propertyInjections","map","forEach","r","index","propertyName","name","value","injection","_createInstance","Func","injections","bind","apply","__spreadArray","_postConstruct","constr","result","Reflect","hasMetadata","POST_CONSTRUCT","data","getMetadata","e","Error","POST_CONSTRUCT_ERROR","message","resolveInstance","length","constructorInjectionsRequests","ConstructorArgument","constructorInjections","exports"],"sources":["../../src/resolution/instantiation.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AACA,IAAAC,eAAA,GAAAD,OAAA;AACA,IAAAE,YAAA,GAAAF,OAAA;AAIA,SAASG,iBAAiBA,CACtBC,QAAa,EACbC,aAAmC,EACnCC,cAAgD;EAGhD,IAAMC,0BAA0B,GAAGF,aAAa,CAACG,MAAM,CAAC,UAACC,YAAgC;IACrF,OACIA,YAAY,CAACC,MAAM,KAAK,IAAI,IAC5BD,YAAY,CAACC,MAAM,CAACC,IAAI,KAAKV,eAAA,CAAAW,cAAc,CAACC,aAAa;EAF7D,CAGC,CAAC;EAEN,IAAMC,kBAAkB,GAAGP,0BAA0B,CAACQ,GAAG,CAACT,cAAc,CAAC;EAEzEC,0BAA0B,CAACS,OAAO,CAAC,UAACC,CAAqB,EAAEC,KAAa;IACpE,IAAIC,YAAY,GAAG,EAAE;IACrBA,YAAY,GAAGF,CAAC,CAACP,MAAM,CAACU,IAAI,CAACC,KAAK,EAAE;IACpC,IAAMC,SAAS,GAAGR,kBAAkB,CAACI,KAAK,CAAC;IAC3Cd,QAAQ,CAACe,YAAY,CAAC,GAAGG,SAAS;EACtC,CAAC,CAAC;EAEF,OAAOlB,QAAQ;AAEnB;AAEA,SAASmB,eAAeA,CAACC,IAA6B,EAAEC,UAAoB;EACxE,YAAWD,IAAI,CAAAE,IAAA,CAAAC,KAAA,CAAJH,IAAI,EAAAI,aAAA,WAAIH,UAAU;AACjC;AAEA,SAASI,cAAcA,CAACC,MAA+B,EAAEC,MAAW;EAChE,IAAIC,OAAO,CAACC,WAAW,CAAC/B,YAAY,CAACgC,cAAc,EAAEJ,MAAM,CAAC,EAAE;IAC1D,IAAMK,IAAI,GAAaH,OAAO,CAACI,WAAW,CAAClC,YAAY,CAACgC,cAAc,EAAEJ,MAAM,CAAC;IAC/E,IAAI;MACAC,MAAM,CAACI,IAAI,CAACd,KAAK,CAAC,EAAE;KACvB,CAAC,OAAOgB,CAAC,EAAE;MACR,MAAM,IAAIC,KAAK,CAACvC,YAAA,CAAAwC,oBAAoB,CAACT,MAAM,CAACV,IAAI,EAAEiB,CAAC,CAACG,OAAO,CAAC,CAAC;;;AAGzE;AAEA,SAASC,eAAeA,CACpBX,MAA+B,EAC/BzB,aAAmC,EACnCC,cAAgD;EAGhD,IAAIyB,MAAM,GAAQ,IAAI;EAEtB,IAAI1B,aAAa,CAACqC,MAAM,GAAG,CAAC,EAAE;IAE1B,IAAMC,6BAA6B,GAAGtC,aAAa,CAACG,MAAM,CAAC,UAACC,YAAgC;MACxF,OAACA,YAAY,CAACC,MAAM,KAAK,IAAI,IAAID,YAAY,CAACC,MAAM,CAACC,IAAI,KAAKV,eAAA,CAAAW,cAAc,CAACgC,mBAAmB;IAAhG,CAAiG,CAAC;IAEtG,IAAMC,qBAAqB,GAAGF,6BAA6B,CAAC5B,GAAG,CAACT,cAAc,CAAC;IAE/EyB,MAAM,GAAGR,eAAe,CAACO,MAAM,EAAEe,qBAAqB,CAAC;IACvDd,MAAM,GAAG5B,iBAAiB,CAAC4B,MAAM,EAAE1B,aAAa,EAAEC,cAAc,CAAC;GAEpE,MAAM;IACHyB,MAAM,GAAG,IAAID,MAAM,EAAE;;EAEzBD,cAAc,CAACC,MAAM,EAAEC,MAAM,CAAC;EAE9B,OAAOA,MAAM;AACjB;AAESe,OAAA,CAAAL,eAAA,GAAAA,eAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}
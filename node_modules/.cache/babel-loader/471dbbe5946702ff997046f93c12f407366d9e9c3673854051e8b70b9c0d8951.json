{"ast":null,"code":"import { __spreadArray } from \"tslib\";\nimport { get } from '@antv/util';\nimport { animation, annotation, interaction as commonInteraction, legend, theme, tooltip } from '../../adaptor/common';\nimport { polygon as basePolygon } from '../../adaptor/geometries/polygon';\nimport { pattern } from '../../adaptor/pattern';\nimport { deepAssign, flow } from '../../utils';\nimport { getAdjustAppendPadding } from '../../utils/padding';\nimport { enableDrillInteraction, findInteraction, transformData } from './utils';\n/**\n * 获取默认 option\n * @param params\n */\nfunction defaultOptions(params) {\n  var options = params.options;\n  var colorField = options.colorField;\n  return deepAssign({\n    options: {\n      rawFields: ['value'],\n      tooltip: {\n        fields: ['name', 'value', colorField, 'path'],\n        formatter: function (data) {\n          return {\n            name: data.name,\n            value: data.value\n          };\n        }\n      }\n    }\n  }, params);\n}\n/**\n * 字段\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var color = options.color,\n    colorField = options.colorField,\n    rectStyle = options.rectStyle,\n    hierarchyConfig = options.hierarchyConfig,\n    rawFields = options.rawFields;\n  var data = transformData({\n    data: options.data,\n    colorField: options.colorField,\n    enableDrillDown: enableDrillInteraction(options),\n    hierarchyConfig: hierarchyConfig\n  });\n  chart.data(data);\n  // geometry\n  basePolygon(deepAssign({}, params, {\n    options: {\n      xField: 'x',\n      yField: 'y',\n      seriesField: colorField,\n      rawFields: rawFields,\n      polygon: {\n        color: color,\n        style: rectStyle\n      }\n    }\n  }));\n  // 做一个反转，这样配合排序，可以将最大值放到左上角，最小值放到右下角\n  chart.coordinate().reflect('y');\n  return params;\n}\n/**\n * 坐标轴\n * @param params\n */\nfunction axis(params) {\n  var chart = params.chart;\n  chart.axis(false);\n  return params;\n}\nfunction adaptorInteraction(options) {\n  var drilldown = options.drilldown,\n    _a = options.interactions,\n    interactions = _a === void 0 ? [] : _a;\n  var enableDrillDown = enableDrillInteraction(options);\n  if (enableDrillDown) {\n    return deepAssign({}, options, {\n      interactions: __spreadArray(__spreadArray([], interactions, true), [{\n        type: 'drill-down',\n        // 🚓 这不是一个规范的 API，后续会变更。慎重参考\n        cfg: {\n          drillDownConfig: drilldown,\n          transformData: transformData\n        }\n      }], false)\n    });\n  }\n  return options;\n}\n/**\n * Interaction 配置\n * @param params\n */\nexport function interaction(params) {\n  var chart = params.chart,\n    options = params.options;\n  var interactions = options.interactions,\n    drilldown = options.drilldown;\n  commonInteraction({\n    chart: chart,\n    options: adaptorInteraction(options)\n  });\n  // 适配 view-zoom\n  var viewZoomInteraction = findInteraction(interactions, 'view-zoom');\n  if (viewZoomInteraction) {\n    // 开启缩放 interaction 后，则阻止默认滚动事件，避免整个窗口的滚动\n    if (viewZoomInteraction.enable !== false) {\n      chart.getCanvas().on('mousewheel', function (ev) {\n        ev.preventDefault();\n      });\n    } else {\n      // 手动关闭后，清除。仅对声明 viewZoomInteraction 的清除。\n      chart.getCanvas().off('mousewheel');\n    }\n  }\n  // 适应下钻交互面包屑\n  var enableDrillDown = enableDrillInteraction(options);\n  if (enableDrillDown) {\n    // 为面包屑在底部留出 25px 的空间\n    chart.appendPadding = getAdjustAppendPadding(chart.appendPadding, get(drilldown, ['breadCrumb', 'position']));\n  }\n  return params;\n}\n/**\n * 矩形树图\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  return flow(defaultOptions, theme, pattern('rectStyle'), geometry, axis, legend, tooltip, interaction, animation, annotation())(params);\n}","map":{"version":3,"names":["get","animation","annotation","interaction","commonInteraction","legend","theme","tooltip","polygon","basePolygon","pattern","deepAssign","flow","getAdjustAppendPadding","enableDrillInteraction","findInteraction","transformData","defaultOptions","params","options","colorField","rawFields","fields","formatter","data","name","value","geometry","chart","color","rectStyle","hierarchyConfig","enableDrillDown","xField","yField","seriesField","style","coordinate","reflect","axis","adaptorInteraction","drilldown","_a","interactions","__spreadArray","type","cfg","drillDownConfig","viewZoomInteraction","enable","getCanvas","on","ev","preventDefault","off","appendPadding","adaptor"],"sources":["../../../src/plots/treemap/adaptor.ts"],"sourcesContent":["import { get } from '@antv/util';\nimport { animation, annotation, interaction as commonInteraction, legend, theme, tooltip } from '../../adaptor/common';\nimport { polygon as basePolygon } from '../../adaptor/geometries/polygon';\nimport { pattern } from '../../adaptor/pattern';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, flow } from '../../utils';\nimport { getAdjustAppendPadding } from '../../utils/padding';\nimport { TreemapOptions } from './types';\nimport { enableDrillInteraction, findInteraction, transformData } from './utils';\n\n/**\n * 获取默认 option\n * @param params\n */\nfunction defaultOptions(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { options } = params;\n  const { colorField } = options;\n\n  return deepAssign(\n    {\n      options: {\n        rawFields: ['value'],\n        tooltip: {\n          fields: ['name', 'value', colorField, 'path'],\n          formatter: (data) => {\n            return {\n              name: data.name,\n              value: data.value,\n            };\n          },\n        },\n      },\n    },\n    params\n  );\n}\n\n/**\n * 字段\n * @param params\n */\nfunction geometry(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart, options } = params;\n  const { color, colorField, rectStyle, hierarchyConfig, rawFields } = options;\n\n  const data = transformData({\n    data: options.data,\n    colorField: options.colorField,\n    enableDrillDown: enableDrillInteraction(options),\n    hierarchyConfig,\n  });\n\n  chart.data(data);\n\n  // geometry\n  basePolygon(\n    deepAssign({}, params, {\n      options: {\n        xField: 'x',\n        yField: 'y',\n        seriesField: colorField,\n        rawFields: rawFields,\n        polygon: {\n          color,\n          style: rectStyle,\n        },\n      },\n    })\n  );\n\n  // 做一个反转，这样配合排序，可以将最大值放到左上角，最小值放到右下角\n  chart.coordinate().reflect('y');\n\n  return params;\n}\n\n/**\n * 坐标轴\n * @param params\n */\nfunction axis(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart } = params;\n  chart.axis(false);\n  return params;\n}\n\nfunction adaptorInteraction(options: TreemapOptions): TreemapOptions {\n  const { drilldown, interactions = [] } = options;\n\n  const enableDrillDown = enableDrillInteraction(options);\n  if (enableDrillDown) {\n    return deepAssign({}, options, {\n      interactions: [\n        ...interactions,\n        {\n          type: 'drill-down',\n          // 🚓 这不是一个规范的 API，后续会变更。慎重参考\n          cfg: { drillDownConfig: drilldown, transformData },\n        },\n      ],\n    });\n  }\n  return options;\n}\n\n/**\n * Interaction 配置\n * @param params\n */\nexport function interaction(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart, options } = params;\n  const { interactions, drilldown } = options;\n\n  commonInteraction({\n    chart,\n    options: adaptorInteraction(options),\n  });\n\n  // 适配 view-zoom\n  const viewZoomInteraction = findInteraction(interactions, 'view-zoom');\n\n  if (viewZoomInteraction) {\n    // 开启缩放 interaction 后，则阻止默认滚动事件，避免整个窗口的滚动\n    if (viewZoomInteraction.enable !== false) {\n      chart.getCanvas().on('mousewheel', (ev) => {\n        ev.preventDefault();\n      });\n    } else {\n      // 手动关闭后，清除。仅对声明 viewZoomInteraction 的清除。\n      chart.getCanvas().off('mousewheel');\n    }\n  }\n\n  // 适应下钻交互面包屑\n  const enableDrillDown = enableDrillInteraction(options);\n  if (enableDrillDown) {\n    // 为面包屑在底部留出 25px 的空间\n    chart.appendPadding = getAdjustAppendPadding(chart.appendPadding, get(drilldown, ['breadCrumb', 'position']));\n  }\n  return params;\n}\n\n/**\n * 矩形树图\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<TreemapOptions>) {\n  return flow(\n    defaultOptions,\n    theme,\n    pattern('rectStyle'),\n    geometry,\n    axis,\n    legend,\n    tooltip,\n    interaction,\n    animation,\n    annotation()\n  )(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
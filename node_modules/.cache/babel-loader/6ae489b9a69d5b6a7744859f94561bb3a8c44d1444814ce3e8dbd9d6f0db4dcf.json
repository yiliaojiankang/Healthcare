{"ast":null,"code":"\"use strict\";\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar util_1 = require(\"../util\");\nvar bk_1 = require(\"./bk\");\nvar positionY = function (g) {\n  var layering = (0, util_1.buildLayerMatrix)(g);\n  var rankSep = g.graph().ranksep;\n  var prevY = 0;\n  layering === null || layering === void 0 ? void 0 : layering.forEach(function (layer) {\n    var heights = layer.map(function (v) {\n      return g.node(v).height;\n    });\n    var maxHeight = Math.max.apply(Math, __spreadArray(__spreadArray([], heights, false), [0], false));\n    layer === null || layer === void 0 ? void 0 : layer.forEach(function (v) {\n      g.node(v).y = prevY + maxHeight / 2;\n    });\n    prevY += maxHeight + rankSep;\n  });\n};\nvar positionX = function (g) {\n  var layering = (0, util_1.buildLayerMatrix)(g);\n  var conflicts = Object.assign((0, bk_1.findType1Conflicts)(g, layering), (0, bk_1.findType2Conflicts)(g, layering));\n  var xss = {};\n  var adjustedLayering = [];\n  [\"u\", \"d\"].forEach(function (vert) {\n    adjustedLayering = vert === \"u\" ? layering : Object.values(layering).reverse();\n    [\"l\", \"r\"].forEach(function (horiz) {\n      if (horiz === \"r\") {\n        adjustedLayering = adjustedLayering.map(function (inner) {\n          return Object.values(inner).reverse();\n        });\n      }\n      var neighborFn = (vert === \"u\" ? g.predecessors : g.successors).bind(g);\n      var align = (0, bk_1.verticalAlignment)(g, adjustedLayering, conflicts, neighborFn);\n      var xs = (0, bk_1.horizontalCompaction)(g, adjustedLayering, align.root, align.align, horiz === \"r\");\n      if (horiz === \"r\") {\n        Object.keys(xs).forEach(function (xsKey) {\n          return xs[xsKey] = -xs[xsKey];\n        });\n      }\n      xss[vert + horiz] = xs;\n    });\n  });\n  var smallestWidth = (0, bk_1.findSmallestWidthAlignment)(g, xss);\n  smallestWidth && (0, bk_1.alignCoordinates)(xss, smallestWidth);\n  return (0, bk_1.balance)(xss, g.graph().align);\n};\nvar position = function (g) {\n  var _a;\n  var ng = (0, util_1.asNonCompoundGraph)(g);\n  positionY(ng);\n  var xs = positionX(ng);\n  (_a = Object.keys(xs)) === null || _a === void 0 ? void 0 : _a.forEach(function (key) {\n    ng.node(key).x = xs[key];\n  });\n};\nexports.default = position;","map":{"version":3,"names":["util_1","require","bk_1","positionY","g","layering","buildLayerMatrix","rankSep","graph","ranksep","prevY","forEach","layer","heights","map","v","node","height","maxHeight","Math","max","apply","__spreadArray","y","positionX","conflicts","Object","assign","findType1Conflicts","findType2Conflicts","xss","adjustedLayering","vert","values","reverse","horiz","inner","neighborFn","predecessors","successors","bind","align","verticalAlignment","xs","horizontalCompaction","root","keys","xsKey","smallestWidth","findSmallestWidthAlignment","alignCoordinates","balance","position","ng","asNonCompoundGraph","_a","key","x","exports","default"],"sources":["../../../../../src/layout/dagre/src/position/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5;\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { decodePickingColor, DOM } from '@antv/l7-utils';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport { isEventCrash } from \"../../utils/dom\";\nimport { InteractionEvent } from \"../interaction/IInteractionService\";\nimport { TextureUsage } from \"../renderer/ITexture2D\";\nvar PickingService = (_dec = injectable(), _dec2 = inject(TYPES.IMapService), _dec3 = inject(TYPES.IRendererService), _dec4 = inject(TYPES.IGlobalConfigService), _dec5 = inject(TYPES.IInteractionService), _dec6 = inject(TYPES.ILayerService), _dec(_class = (_class2 = /*#__PURE__*/function () {\n  function PickingService() {\n    var _this = this;\n    _classCallCheck(this, PickingService);\n    _defineProperty(this, \"pickedColors\", void 0);\n    _defineProperty(this, \"pickedTileLayers\", []);\n    _initializerDefineProperty(this, \"mapService\", _descriptor, this);\n    _initializerDefineProperty(this, \"rendererService\", _descriptor2, this);\n    _initializerDefineProperty(this, \"configService\", _descriptor3, this);\n    _initializerDefineProperty(this, \"interactionService\", _descriptor4, this);\n    _initializerDefineProperty(this, \"layerService\", _descriptor5, this);\n    _defineProperty(this, \"pickingFBO\", void 0);\n    _defineProperty(this, \"width\", 0);\n    _defineProperty(this, \"height\", 0);\n    _defineProperty(this, \"alreadyInPicking\", false);\n    _defineProperty(this, \"pickBufferScale\", 1.0);\n    _defineProperty(this, \"pickFromPickingFBO\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(layer, _ref) {\n        var x, y, lngLat, type, target, isPicked, _this$rendererService, readPixelsAsync, getContainer, _this$getContainerSiz, width, height, _layer$getLayerConfig, enableHighlight, enableSelect, xInDevicePixel, yInDevicePixel, pickedColors, pickedFeatureIdx, rawFeature, layerTarget, _layerTarget, selectedId;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              x = _ref.x, y = _ref.y, lngLat = _ref.lngLat, type = _ref.type, target = _ref.target;\n              isPicked = false;\n              _this$rendererService = _this.rendererService, readPixelsAsync = _this$rendererService.readPixelsAsync, getContainer = _this$rendererService.getContainer;\n              _this$getContainerSiz = _this.getContainerSize(getContainer()), width = _this$getContainerSiz.width, height = _this$getContainerSiz.height;\n              width *= DOM.DPR;\n              height *= DOM.DPR;\n              _layer$getLayerConfig = layer.getLayerConfig(), enableHighlight = _layer$getLayerConfig.enableHighlight, enableSelect = _layer$getLayerConfig.enableSelect;\n              xInDevicePixel = x * DOM.DPR;\n              yInDevicePixel = y * DOM.DPR;\n              if (!(xInDevicePixel > width - 1 * DOM.DPR || xInDevicePixel < 0 || yInDevicePixel > height - 1 * DOM.DPR || yInDevicePixel < 0)) {\n                _context.next = 11;\n                break;\n              }\n              return _context.abrupt(\"return\", false);\n            case 11:\n              _context.next = 13;\n              return readPixelsAsync({\n                x: Math.floor(xInDevicePixel / _this.pickBufferScale),\n                // 视口坐标系原点在左上，而 WebGL 在左下，需要翻转 Y 轴\n                y: Math.floor((height - (y + 1) * DOM.DPR) / _this.pickBufferScale),\n                width: 1,\n                height: 1,\n                data: new Uint8Array(1 * 1 * 4),\n                framebuffer: _this.pickingFBO\n              });\n            case 13:\n              pickedColors = _context.sent;\n              _this.pickedColors = pickedColors;\n              if (pickedColors[0] !== 0 || pickedColors[1] !== 0 || pickedColors[2] !== 0) {\n                pickedFeatureIdx = decodePickingColor(pickedColors); // 瓦片数据获取性能问题需要优化\n                rawFeature = layer.layerPickService.getFeatureById(pickedFeatureIdx);\n                if (pickedFeatureIdx !== layer.getCurrentPickId() && type === 'mousemove') {\n                  type = 'mouseenter';\n                }\n                layerTarget = {\n                  x: x,\n                  y: y,\n                  type: type,\n                  lngLat: lngLat,\n                  featureId: pickedFeatureIdx,\n                  feature: rawFeature,\n                  target: target\n                };\n                if (!rawFeature) {\n\n                  // this.logger.error(\n                  //   '未找到颜色编码解码后的原始 feature，请检查 fragment shader 中末尾是否添加了 `gl_FragColor = filterColor(gl_FragColor);`',\n                  // );\n                } else {\n                  // trigger onHover/Click callback on layer\n                  isPicked = true;\n                  layer.setCurrentPickId(pickedFeatureIdx);\n                  _this.triggerHoverOnLayer(layer, layerTarget); // 触发拾取事件\n                }\n              } else {\n                // 未选中\n                _layerTarget = {\n                  x: x,\n                  y: y,\n                  lngLat: lngLat,\n                  type: layer.getCurrentPickId() !== null && type === 'mousemove' ? 'mouseout' : 'un' + type,\n                  featureId: null,\n                  target: target,\n                  feature: null\n                };\n                _this.triggerHoverOnLayer(layer, _objectSpread(_objectSpread({}, _layerTarget), {}, {\n                  type: 'unpick'\n                }));\n                _this.triggerHoverOnLayer(layer, _layerTarget);\n                layer.setCurrentPickId(null);\n              }\n              if (enableHighlight) {\n                layer.layerPickService.highlightPickedFeature(pickedColors);\n              }\n              if (enableSelect && type === 'click' && (pickedColors === null || pickedColors === void 0 ? void 0 : pickedColors.toString()) !== [0, 0, 0, 0].toString()) {\n                selectedId = decodePickingColor(pickedColors);\n                if (layer.getCurrentSelectedId() === null || selectedId !== layer.getCurrentSelectedId()) {\n                  layer.layerPickService.selectFeature(pickedColors);\n                  layer.setCurrentSelectedId(selectedId);\n                } else {\n                  layer.layerPickService.selectFeature(new Uint8Array([0, 0, 0, 0])); // toggle select\n                  layer.setCurrentSelectedId(null);\n                }\n              }\n              return _context.abrupt(\"return\", isPicked);\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  }\n  _createClass(PickingService, [{\n    key: \"init\",\n    value: function init(id) {\n      var _this$rendererService2 = this.rendererService,\n        createTexture2D = _this$rendererService2.createTexture2D,\n        createFramebuffer = _this$rendererService2.createFramebuffer,\n        getContainer = _this$rendererService2.getContainer;\n      var _this$getContainerSiz2 = this.getContainerSize(getContainer()),\n        width = _this$getContainerSiz2.width,\n        height = _this$getContainerSiz2.height;\n      width *= DOM.DPR;\n      height *= DOM.DPR;\n      this.pickBufferScale = this.configService.getSceneConfig(id).pickBufferScale || 1;\n      width = Math.round(width / this.pickBufferScale);\n      height = Math.round(height / this.pickBufferScale);\n      // 创建 picking framebuffer，后续实时 resize\n      var pickingColorTexture = createTexture2D({\n        width: width,\n        height: height,\n        // wrapS: gl.CLAMP_TO_EDGE,\n        // wrapT: gl.CLAMP_TO_EDGE,\n        usage: TextureUsage.RENDER_TARGET,\n        label: 'Picking Texture'\n      });\n      this.pickingFBO = createFramebuffer({\n        color: pickingColorTexture,\n        depth: true,\n        width: width,\n        height: height\n      });\n\n      // 监听 hover 事件\n      this.interactionService.on(InteractionEvent.Hover, this.pickingAllLayer.bind(this));\n    }\n  }, {\n    key: \"boxPickLayer\",\n    value: function () {\n      var _boxPickLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(layer, box, cb) {\n        var _this2 = this;\n        var _this$rendererService3, useFramebufferAsync, clear, features;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _this$rendererService3 = this.rendererService, useFramebufferAsync = _this$rendererService3.useFramebufferAsync, clear = _this$rendererService3.clear;\n              this.resizePickingFBO();\n              layer.hooks.beforePickingEncode.call();\n              _context3.next = 5;\n              return useFramebufferAsync(this.pickingFBO, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) switch (_context2.prev = _context2.next) {\n                    case 0:\n                      clear({\n                        framebuffer: _this2.pickingFBO,\n                        color: [0, 0, 0, 0],\n                        stencil: 0,\n                        depth: 1\n                      });\n                      layer.renderModels({\n                        ispick: true\n                      });\n                    case 2:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }, _callee2);\n              })));\n            case 5:\n              layer.hooks.afterPickingEncode.call();\n              _context3.next = 8;\n              return this.pickBox(layer, box);\n            case 8:\n              features = _context3.sent;\n              cb(features);\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function boxPickLayer(_x3, _x4, _x5) {\n        return _boxPickLayer.apply(this, arguments);\n      }\n      return boxPickLayer;\n    }()\n  }, {\n    key: \"pickBox\",\n    value: function () {\n      var _pickBox = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(layer, box) {\n        var _this3 = this;\n        var _box$map, _box$map2, xMin, yMin, xMax, yMax, _this$rendererService4, readPixelsAsync, getContainer, _this$getContainerSiz3, width, height, w, h, pickedColors, features, featuresIdMap, i, color, pickedFeatureIdx, rawFeature;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _box$map = box.map(function (v) {\n                var tmpV = v < 0 ? 0 : v;\n                return Math.floor(tmpV * DOM.DPR / _this3.pickBufferScale);\n              }), _box$map2 = _slicedToArray(_box$map, 4), xMin = _box$map2[0], yMin = _box$map2[1], xMax = _box$map2[2], yMax = _box$map2[3];\n              _this$rendererService4 = this.rendererService, readPixelsAsync = _this$rendererService4.readPixelsAsync, getContainer = _this$rendererService4.getContainer;\n              _this$getContainerSiz3 = this.getContainerSize(getContainer()), width = _this$getContainerSiz3.width, height = _this$getContainerSiz3.height;\n              width *= DOM.DPR;\n              height *= DOM.DPR;\n              if (!(xMin > (width - 1) * DOM.DPR / this.pickBufferScale || xMax < 0 || yMin > (height - 1) * DOM.DPR / this.pickBufferScale || yMax < 0)) {\n                _context4.next = 7;\n                break;\n              }\n              return _context4.abrupt(\"return\", []);\n            case 7:\n              w = Math.min(width / this.pickBufferScale, xMax) - xMin;\n              h = Math.min(height / this.pickBufferScale, yMax) - yMin;\n              _context4.next = 11;\n              return readPixelsAsync({\n                x: xMin,\n                // 视口坐标系原点在左上，而 WebGL 在左下，需要翻转 Y 轴\n                y: Math.floor(height / this.pickBufferScale - (yMax + 1)),\n                width: w,\n                height: h,\n                data: new Uint8Array(w * h * 4),\n                framebuffer: this.pickingFBO\n              });\n            case 11:\n              pickedColors = _context4.sent;\n              features = [];\n              featuresIdMap = {};\n              for (i = 0; i < pickedColors.length / 4; i = i + 1) {\n                color = pickedColors.slice(i * 4, i * 4 + 4);\n                pickedFeatureIdx = decodePickingColor(color);\n                if (pickedFeatureIdx !== -1 && !featuresIdMap[pickedFeatureIdx]) {\n                  rawFeature = layer.layerPickService.getFeatureById(pickedFeatureIdx);\n                  features.push(_objectSpread(_objectSpread({}, rawFeature), {}, {\n                    pickedFeatureIdx: pickedFeatureIdx\n                  }));\n                  featuresIdMap[pickedFeatureIdx] = true;\n                }\n              }\n              return _context4.abrupt(\"return\", features);\n            case 16:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function pickBox(_x6, _x7) {\n        return _pickBox.apply(this, arguments);\n      }\n      return pickBox;\n    }() // 动态设置鼠标光标\n  }, {\n    key: \"handleCursor\",\n    value: function handleCursor(layer, type) {\n      var _layer$getLayerConfig2 = layer.getLayerConfig(),\n        _layer$getLayerConfig3 = _layer$getLayerConfig2.cursor,\n        cursor = _layer$getLayerConfig3 === void 0 ? '' : _layer$getLayerConfig3,\n        cursorEnabled = _layer$getLayerConfig2.cursorEnabled;\n      if (cursorEnabled) {\n        var version = this.mapService.version;\n        var domContainer = version === 'GAODE2.x' ? this.mapService.getMapContainer() : this.mapService.getMarkerContainer();\n        // const domContainer = this.mapService.getMarkerContainer();\n        // const domContainer = this.mapService.getMapContainer();\n        var defaultCursor = domContainer === null || domContainer === void 0 ? void 0 : domContainer.style.getPropertyValue('cursor');\n        if (type === 'unmousemove' && defaultCursor !== '') {\n          domContainer === null || domContainer === void 0 || domContainer.style.setProperty('cursor', '');\n        } else if (type === 'mousemove') {\n          domContainer === null || domContainer === void 0 || domContainer.style.setProperty('cursor', cursor);\n        }\n      }\n      // const domContainer = this.mapService.getMapContainer()\n      // domContainer?.style.setProperty('cursor', 'move');\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.pickingFBO.destroy();\n      // this.pickingFBO = null; 清除对 webgl 实例的引用\n      // @ts-ignore\n      this.pickingFBO = null;\n    }\n  }, {\n    key: \"getContainerSize\",\n    value:\n    // 获取容器的大小 - 兼容小程序环境\n    function getContainerSize(container) {\n      if (container.getContext) {\n        return {\n          width: container.width / DOM.DPR,\n          height: container.height / DOM.DPR\n        };\n      } else {\n        return container.getBoundingClientRect();\n      }\n    }\n  }, {\n    key: \"pickingAllLayer\",\n    value: function () {\n      var _pickingAllLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(target) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(!this.layerService.needPick(target.type) || !this.isPickingAllLayer())) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              this.alreadyInPicking = true;\n              _context5.next = 5;\n              return this.pickingLayers(target);\n            case 5:\n              this.layerService.renderLayers();\n              this.alreadyInPicking = false;\n            case 7:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function pickingAllLayer(_x8) {\n        return _pickingAllLayer.apply(this, arguments);\n      }\n      return pickingAllLayer;\n    }()\n  }, {\n    key: \"isPickingAllLayer\",\n    value: function isPickingAllLayer() {\n      // this.alreadyInPicking 避免多次重复拾取\n\n      if (this.alreadyInPicking) {\n        return false;\n      }\n      // this.layerService.alreadyInRendering 一个渲染序列中只进行一次拾取操作\n      if (this.layerService.alreadyInRendering) {\n        return false;\n      }\n      // this.interactionService.dragging amap2 在点击操作的时候同时会触发 dragging 的情况（避免舍去）\n      if (this.interactionService.indragging) {\n        return false;\n      }\n\n      // 判断当前进行 shader pick 拾取判断\n      if (!this.layerService.getShaderPickStat()) {\n        return false;\n      }\n\n      // 进行拾取\n      return true;\n    }\n  }, {\n    key: \"resizePickingFBO\",\n    value: function resizePickingFBO() {\n      var getContainer = this.rendererService.getContainer;\n      var _this$getContainerSiz4 = this.getContainerSize(getContainer()),\n        width = _this$getContainerSiz4.width,\n        height = _this$getContainerSiz4.height;\n      width *= DOM.DPR;\n      height *= DOM.DPR;\n      if (this.width !== width || this.height !== height) {\n        this.pickingFBO.resize({\n          width: Math.round(width / this.pickBufferScale),\n          height: Math.round(height / this.pickBufferScale)\n        });\n        this.width = width;\n        this.height = height;\n      }\n    }\n  }, {\n    key: \"pickingLayers\",\n    value: function () {\n      var _pickingLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(target) {\n        var _this4 = this;\n        var _this$rendererService5, clear, useFramebufferAsync, layers, _iterator, _step, _loop;\n        return _regeneratorRuntime.wrap(function _callee7$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _this$rendererService5 = this.rendererService, clear = _this$rendererService5.clear, useFramebufferAsync = _this$rendererService5.useFramebufferAsync;\n              this.resizePickingFBO();\n              layers = this.layerService.getRenderList();\n              _iterator = _createForOfIteratorHelper(layers.filter(function (layer) {\n                return layer.needPick(target.type);\n              }).reverse());\n              _context8.prev = 4;\n              _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n                var layer, isPicked;\n                return _regeneratorRuntime.wrap(function _loop$(_context7) {\n                  while (1) switch (_context7.prev = _context7.next) {\n                    case 0:\n                      layer = _step.value;\n                      if (!layer.tileLayer) {\n                        layer.hooks.beforePickingEncode.call();\n                      }\n                      _context7.next = 4;\n                      return useFramebufferAsync(_this4.pickingFBO, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                          while (1) switch (_context6.prev = _context6.next) {\n                            case 0:\n                              clear({\n                                framebuffer: _this4.pickingFBO,\n                                color: [0, 0, 0, 0],\n                                stencil: 0,\n                                depth: 1\n                              });\n                              layer.layerPickService.pickRender(target);\n                            case 2:\n                            case \"end\":\n                              return _context6.stop();\n                          }\n                        }, _callee6);\n                      })));\n                    case 4:\n                      if (!layer.tileLayer) {\n                        layer.hooks.afterPickingEncode.call();\n                      }\n                      _context7.next = 7;\n                      return _this4.pickFromPickingFBO(layer, target);\n                    case 7:\n                      isPicked = _context7.sent;\n                      _this4.layerService.pickedLayerId = isPicked ? +layer.id : -1;\n                      if (!(isPicked && !layer.getLayerConfig().enablePropagation)) {\n                        _context7.next = 11;\n                        break;\n                      }\n                      return _context7.abrupt(\"return\", 1);\n                    case 11:\n                    case \"end\":\n                      return _context7.stop();\n                  }\n                }, _loop);\n              });\n              _iterator.s();\n            case 7:\n              if ((_step = _iterator.n()).done) {\n                _context8.next = 13;\n                break;\n              }\n              return _context8.delegateYield(_loop(), \"t0\", 9);\n            case 9:\n              if (!_context8.t0) {\n                _context8.next = 11;\n                break;\n              }\n              return _context8.abrupt(\"break\", 13);\n            case 11:\n              _context8.next = 7;\n              break;\n            case 13:\n              _context8.next = 18;\n              break;\n            case 15:\n              _context8.prev = 15;\n              _context8.t1 = _context8[\"catch\"](4);\n              _iterator.e(_context8.t1);\n            case 18:\n              _context8.prev = 18;\n              _iterator.f();\n              return _context8.finish(18);\n            case 21:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee7, this, [[4, 15, 18, 21]]);\n      }));\n      function pickingLayers(_x9) {\n        return _pickingLayers.apply(this, arguments);\n      }\n      return pickingLayers;\n    }()\n  }, {\n    key: \"triggerHoverOnLayer\",\n    value: function triggerHoverOnLayer(layer, target) {\n      // layer.emit(target.type, target);\n      // 判断是否发生事件冲突\n      if (isEventCrash(target)) {\n        // Tip: 允许用户动态设置鼠标光标\n        this.handleCursor(layer, target.type);\n        layer.emit(target.type, target);\n      }\n    }\n  }]);\n  return PickingService;\n}(), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"mapService\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"rendererService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, \"interactionService\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, \"layerService\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { PickingService as default };","map":{"version":3,"names":["_slicedToArray","_objectSpread","_asyncToGenerator","_initializerDefineProperty","_classCallCheck","_createClass","_defineProperty","_applyDecoratedDescriptor","_initializerWarningHelper","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","_regeneratorRuntime","decodePickingColor","DOM","inject","injectable","TYPES","isEventCrash","InteractionEvent","TextureUsage","PickingService","IMapService","IRendererService","IGlobalConfigService","IInteractionService","ILayerService","_this","_ref2","mark","_callee","layer","_ref","x","y","lngLat","type","target","isPicked","_this$rendererService","readPixelsAsync","getContainer","_this$getContainerSiz","width","height","_layer$getLayerConfig","enableHighlight","enableSelect","xInDevicePixel","yInDevicePixel","pickedColors","pickedFeatureIdx","rawFeature","layerTarget","_layerTarget","selectedId","wrap","_callee$","_context","prev","rendererService","getContainerSize","DPR","getLayerConfig","abrupt","Math","floor","pickBufferScale","data","Uint8Array","framebuffer","pickingFBO","sent","layerPickService","getFeatureById","getCurrentPickId","featureId","feature","setCurrentPickId","triggerHoverOnLayer","highlightPickedFeature","getCurrentSelectedId","selectFeature","setCurrentSelectedId","stop","_x","_x2","apply","arguments","key","init","id","_this$rendererService2","createTexture2D","createFramebuffer","_this$getContainerSiz2","configService","getSceneConfig","round","pickingColorTexture","usage","RENDER_TARGET","label","color","depth","interactionService","on","Hover","pickingAllLayer","bind","_boxPickLayer","_callee3","box","cb","_this2","_this$rendererService3","useFramebufferAsync","clear","features","_callee3$","_context3","resizePickingFBO","hooks","beforePickingEncode","_callee2","_callee2$","_context2","stencil","renderModels","ispick","afterPickingEncode","pickBox","boxPickLayer","_x3","_x4","_x5","_pickBox","_callee4","_this3","_box$map","_box$map2","xMin","yMin","xMax","yMax","_this$rendererService4","_this$getContainerSiz3","w","h","featuresIdMap","_callee4$","_context4","map","v","tmpV","min","push","_x6","_x7","handleCursor","_layer$getLayerConfig2","_layer$getLayerConfig3","cursor","cursorEnabled","version","mapService","domContainer","getMapContainer","getMarkerContainer","defaultCursor","style","getPropertyValue","setProperty","destroy","container","getContext","getBoundingClientRect","_pickingAllLayer","_callee5","_callee5$","_context5","layerService","needPick","isPickingAllLayer","alreadyInPicking","pickingLayers","renderLayers","_x8","alreadyInRendering","indragging","getShaderPickStat","_this$getContainerSiz4","resize","_pickingLayers","_callee7","_this4","_this$rendererService5","layers","_iterator","_step","_loop","_callee7$","_context8","getRenderList","filter","reverse","_loop$","_context7","tileLayer","_callee6","_callee6$","_context6","pickRender","pickFromPickingFBO","pickedLayerId","enablePropagation","delegateYield","t0","t1","finish","_x9","emit","configurable","enumerable","writable","initializer","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-core/es/services/interaction/PickingService.js"],"sourcesContent":["import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5;\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { decodePickingColor, DOM } from '@antv/l7-utils';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport { isEventCrash } from \"../../utils/dom\";\nimport { InteractionEvent } from \"../interaction/IInteractionService\";\nimport { TextureUsage } from \"../renderer/ITexture2D\";\nvar PickingService = (_dec = injectable(), _dec2 = inject(TYPES.IMapService), _dec3 = inject(TYPES.IRendererService), _dec4 = inject(TYPES.IGlobalConfigService), _dec5 = inject(TYPES.IInteractionService), _dec6 = inject(TYPES.ILayerService), _dec(_class = (_class2 = /*#__PURE__*/function () {\n  function PickingService() {\n    var _this = this;\n    _classCallCheck(this, PickingService);\n    _defineProperty(this, \"pickedColors\", void 0);\n    _defineProperty(this, \"pickedTileLayers\", []);\n    _initializerDefineProperty(this, \"mapService\", _descriptor, this);\n    _initializerDefineProperty(this, \"rendererService\", _descriptor2, this);\n    _initializerDefineProperty(this, \"configService\", _descriptor3, this);\n    _initializerDefineProperty(this, \"interactionService\", _descriptor4, this);\n    _initializerDefineProperty(this, \"layerService\", _descriptor5, this);\n    _defineProperty(this, \"pickingFBO\", void 0);\n    _defineProperty(this, \"width\", 0);\n    _defineProperty(this, \"height\", 0);\n    _defineProperty(this, \"alreadyInPicking\", false);\n    _defineProperty(this, \"pickBufferScale\", 1.0);\n    _defineProperty(this, \"pickFromPickingFBO\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(layer, _ref) {\n        var x, y, lngLat, type, target, isPicked, _this$rendererService, readPixelsAsync, getContainer, _this$getContainerSiz, width, height, _layer$getLayerConfig, enableHighlight, enableSelect, xInDevicePixel, yInDevicePixel, pickedColors, pickedFeatureIdx, rawFeature, layerTarget, _layerTarget, selectedId;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              x = _ref.x, y = _ref.y, lngLat = _ref.lngLat, type = _ref.type, target = _ref.target;\n              isPicked = false;\n              _this$rendererService = _this.rendererService, readPixelsAsync = _this$rendererService.readPixelsAsync, getContainer = _this$rendererService.getContainer;\n              _this$getContainerSiz = _this.getContainerSize(getContainer()), width = _this$getContainerSiz.width, height = _this$getContainerSiz.height;\n              width *= DOM.DPR;\n              height *= DOM.DPR;\n              _layer$getLayerConfig = layer.getLayerConfig(), enableHighlight = _layer$getLayerConfig.enableHighlight, enableSelect = _layer$getLayerConfig.enableSelect;\n              xInDevicePixel = x * DOM.DPR;\n              yInDevicePixel = y * DOM.DPR;\n              if (!(xInDevicePixel > width - 1 * DOM.DPR || xInDevicePixel < 0 || yInDevicePixel > height - 1 * DOM.DPR || yInDevicePixel < 0)) {\n                _context.next = 11;\n                break;\n              }\n              return _context.abrupt(\"return\", false);\n            case 11:\n              _context.next = 13;\n              return readPixelsAsync({\n                x: Math.floor(xInDevicePixel / _this.pickBufferScale),\n                // 视口坐标系原点在左上，而 WebGL 在左下，需要翻转 Y 轴\n                y: Math.floor((height - (y + 1) * DOM.DPR) / _this.pickBufferScale),\n                width: 1,\n                height: 1,\n                data: new Uint8Array(1 * 1 * 4),\n                framebuffer: _this.pickingFBO\n              });\n            case 13:\n              pickedColors = _context.sent;\n              _this.pickedColors = pickedColors;\n              if (pickedColors[0] !== 0 || pickedColors[1] !== 0 || pickedColors[2] !== 0) {\n                pickedFeatureIdx = decodePickingColor(pickedColors); // 瓦片数据获取性能问题需要优化\n                rawFeature = layer.layerPickService.getFeatureById(pickedFeatureIdx);\n                if (pickedFeatureIdx !== layer.getCurrentPickId() && type === 'mousemove') {\n                  type = 'mouseenter';\n                }\n                layerTarget = {\n                  x: x,\n                  y: y,\n                  type: type,\n                  lngLat: lngLat,\n                  featureId: pickedFeatureIdx,\n                  feature: rawFeature,\n                  target: target\n                };\n                if (!rawFeature) {\n\n                  // this.logger.error(\n                  //   '未找到颜色编码解码后的原始 feature，请检查 fragment shader 中末尾是否添加了 `gl_FragColor = filterColor(gl_FragColor);`',\n                  // );\n                } else {\n                  // trigger onHover/Click callback on layer\n                  isPicked = true;\n                  layer.setCurrentPickId(pickedFeatureIdx);\n                  _this.triggerHoverOnLayer(layer, layerTarget); // 触发拾取事件\n                }\n              } else {\n                // 未选中\n                _layerTarget = {\n                  x: x,\n                  y: y,\n                  lngLat: lngLat,\n                  type: layer.getCurrentPickId() !== null && type === 'mousemove' ? 'mouseout' : 'un' + type,\n                  featureId: null,\n                  target: target,\n                  feature: null\n                };\n                _this.triggerHoverOnLayer(layer, _objectSpread(_objectSpread({}, _layerTarget), {}, {\n                  type: 'unpick'\n                }));\n                _this.triggerHoverOnLayer(layer, _layerTarget);\n                layer.setCurrentPickId(null);\n              }\n              if (enableHighlight) {\n                layer.layerPickService.highlightPickedFeature(pickedColors);\n              }\n              if (enableSelect && type === 'click' && (pickedColors === null || pickedColors === void 0 ? void 0 : pickedColors.toString()) !== [0, 0, 0, 0].toString()) {\n                selectedId = decodePickingColor(pickedColors);\n                if (layer.getCurrentSelectedId() === null || selectedId !== layer.getCurrentSelectedId()) {\n                  layer.layerPickService.selectFeature(pickedColors);\n                  layer.setCurrentSelectedId(selectedId);\n                } else {\n                  layer.layerPickService.selectFeature(new Uint8Array([0, 0, 0, 0])); // toggle select\n                  layer.setCurrentSelectedId(null);\n                }\n              }\n              return _context.abrupt(\"return\", isPicked);\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  }\n  _createClass(PickingService, [{\n    key: \"init\",\n    value: function init(id) {\n      var _this$rendererService2 = this.rendererService,\n        createTexture2D = _this$rendererService2.createTexture2D,\n        createFramebuffer = _this$rendererService2.createFramebuffer,\n        getContainer = _this$rendererService2.getContainer;\n      var _this$getContainerSiz2 = this.getContainerSize(getContainer()),\n        width = _this$getContainerSiz2.width,\n        height = _this$getContainerSiz2.height;\n      width *= DOM.DPR;\n      height *= DOM.DPR;\n      this.pickBufferScale = this.configService.getSceneConfig(id).pickBufferScale || 1;\n      width = Math.round(width / this.pickBufferScale);\n      height = Math.round(height / this.pickBufferScale);\n      // 创建 picking framebuffer，后续实时 resize\n      var pickingColorTexture = createTexture2D({\n        width: width,\n        height: height,\n        // wrapS: gl.CLAMP_TO_EDGE,\n        // wrapT: gl.CLAMP_TO_EDGE,\n        usage: TextureUsage.RENDER_TARGET,\n        label: 'Picking Texture'\n      });\n      this.pickingFBO = createFramebuffer({\n        color: pickingColorTexture,\n        depth: true,\n        width: width,\n        height: height\n      });\n\n      // 监听 hover 事件\n      this.interactionService.on(InteractionEvent.Hover, this.pickingAllLayer.bind(this));\n    }\n  }, {\n    key: \"boxPickLayer\",\n    value: function () {\n      var _boxPickLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(layer, box, cb) {\n        var _this2 = this;\n        var _this$rendererService3, useFramebufferAsync, clear, features;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _this$rendererService3 = this.rendererService, useFramebufferAsync = _this$rendererService3.useFramebufferAsync, clear = _this$rendererService3.clear;\n              this.resizePickingFBO();\n              layer.hooks.beforePickingEncode.call();\n              _context3.next = 5;\n              return useFramebufferAsync(this.pickingFBO, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) switch (_context2.prev = _context2.next) {\n                    case 0:\n                      clear({\n                        framebuffer: _this2.pickingFBO,\n                        color: [0, 0, 0, 0],\n                        stencil: 0,\n                        depth: 1\n                      });\n                      layer.renderModels({\n                        ispick: true\n                      });\n                    case 2:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }, _callee2);\n              })));\n            case 5:\n              layer.hooks.afterPickingEncode.call();\n              _context3.next = 8;\n              return this.pickBox(layer, box);\n            case 8:\n              features = _context3.sent;\n              cb(features);\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function boxPickLayer(_x3, _x4, _x5) {\n        return _boxPickLayer.apply(this, arguments);\n      }\n      return boxPickLayer;\n    }()\n  }, {\n    key: \"pickBox\",\n    value: function () {\n      var _pickBox = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(layer, box) {\n        var _this3 = this;\n        var _box$map, _box$map2, xMin, yMin, xMax, yMax, _this$rendererService4, readPixelsAsync, getContainer, _this$getContainerSiz3, width, height, w, h, pickedColors, features, featuresIdMap, i, color, pickedFeatureIdx, rawFeature;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _box$map = box.map(function (v) {\n                var tmpV = v < 0 ? 0 : v;\n                return Math.floor(tmpV * DOM.DPR / _this3.pickBufferScale);\n              }), _box$map2 = _slicedToArray(_box$map, 4), xMin = _box$map2[0], yMin = _box$map2[1], xMax = _box$map2[2], yMax = _box$map2[3];\n              _this$rendererService4 = this.rendererService, readPixelsAsync = _this$rendererService4.readPixelsAsync, getContainer = _this$rendererService4.getContainer;\n              _this$getContainerSiz3 = this.getContainerSize(getContainer()), width = _this$getContainerSiz3.width, height = _this$getContainerSiz3.height;\n              width *= DOM.DPR;\n              height *= DOM.DPR;\n              if (!(xMin > (width - 1) * DOM.DPR / this.pickBufferScale || xMax < 0 || yMin > (height - 1) * DOM.DPR / this.pickBufferScale || yMax < 0)) {\n                _context4.next = 7;\n                break;\n              }\n              return _context4.abrupt(\"return\", []);\n            case 7:\n              w = Math.min(width / this.pickBufferScale, xMax) - xMin;\n              h = Math.min(height / this.pickBufferScale, yMax) - yMin;\n              _context4.next = 11;\n              return readPixelsAsync({\n                x: xMin,\n                // 视口坐标系原点在左上，而 WebGL 在左下，需要翻转 Y 轴\n                y: Math.floor(height / this.pickBufferScale - (yMax + 1)),\n                width: w,\n                height: h,\n                data: new Uint8Array(w * h * 4),\n                framebuffer: this.pickingFBO\n              });\n            case 11:\n              pickedColors = _context4.sent;\n              features = [];\n              featuresIdMap = {};\n              for (i = 0; i < pickedColors.length / 4; i = i + 1) {\n                color = pickedColors.slice(i * 4, i * 4 + 4);\n                pickedFeatureIdx = decodePickingColor(color);\n                if (pickedFeatureIdx !== -1 && !featuresIdMap[pickedFeatureIdx]) {\n                  rawFeature = layer.layerPickService.getFeatureById(pickedFeatureIdx);\n                  features.push(_objectSpread(_objectSpread({}, rawFeature), {}, {\n                    pickedFeatureIdx: pickedFeatureIdx\n                  }));\n                  featuresIdMap[pickedFeatureIdx] = true;\n                }\n              }\n              return _context4.abrupt(\"return\", features);\n            case 16:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function pickBox(_x6, _x7) {\n        return _pickBox.apply(this, arguments);\n      }\n      return pickBox;\n    }() // 动态设置鼠标光标\n  }, {\n    key: \"handleCursor\",\n    value: function handleCursor(layer, type) {\n      var _layer$getLayerConfig2 = layer.getLayerConfig(),\n        _layer$getLayerConfig3 = _layer$getLayerConfig2.cursor,\n        cursor = _layer$getLayerConfig3 === void 0 ? '' : _layer$getLayerConfig3,\n        cursorEnabled = _layer$getLayerConfig2.cursorEnabled;\n      if (cursorEnabled) {\n        var version = this.mapService.version;\n        var domContainer = version === 'GAODE2.x' ? this.mapService.getMapContainer() : this.mapService.getMarkerContainer();\n        // const domContainer = this.mapService.getMarkerContainer();\n        // const domContainer = this.mapService.getMapContainer();\n        var defaultCursor = domContainer === null || domContainer === void 0 ? void 0 : domContainer.style.getPropertyValue('cursor');\n        if (type === 'unmousemove' && defaultCursor !== '') {\n          domContainer === null || domContainer === void 0 || domContainer.style.setProperty('cursor', '');\n        } else if (type === 'mousemove') {\n          domContainer === null || domContainer === void 0 || domContainer.style.setProperty('cursor', cursor);\n        }\n      }\n      // const domContainer = this.mapService.getMapContainer()\n      // domContainer?.style.setProperty('cursor', 'move');\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.pickingFBO.destroy();\n      // this.pickingFBO = null; 清除对 webgl 实例的引用\n      // @ts-ignore\n      this.pickingFBO = null;\n    }\n  }, {\n    key: \"getContainerSize\",\n    value:\n    // 获取容器的大小 - 兼容小程序环境\n    function getContainerSize(container) {\n      if (container.getContext) {\n        return {\n          width: container.width / DOM.DPR,\n          height: container.height / DOM.DPR\n        };\n      } else {\n        return container.getBoundingClientRect();\n      }\n    }\n  }, {\n    key: \"pickingAllLayer\",\n    value: function () {\n      var _pickingAllLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(target) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(!this.layerService.needPick(target.type) || !this.isPickingAllLayer())) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              this.alreadyInPicking = true;\n              _context5.next = 5;\n              return this.pickingLayers(target);\n            case 5:\n              this.layerService.renderLayers();\n              this.alreadyInPicking = false;\n            case 7:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function pickingAllLayer(_x8) {\n        return _pickingAllLayer.apply(this, arguments);\n      }\n      return pickingAllLayer;\n    }()\n  }, {\n    key: \"isPickingAllLayer\",\n    value: function isPickingAllLayer() {\n      // this.alreadyInPicking 避免多次重复拾取\n\n      if (this.alreadyInPicking) {\n        return false;\n      }\n      // this.layerService.alreadyInRendering 一个渲染序列中只进行一次拾取操作\n      if (this.layerService.alreadyInRendering) {\n        return false;\n      }\n      // this.interactionService.dragging amap2 在点击操作的时候同时会触发 dragging 的情况（避免舍去）\n      if (this.interactionService.indragging) {\n        return false;\n      }\n\n      // 判断当前进行 shader pick 拾取判断\n      if (!this.layerService.getShaderPickStat()) {\n        return false;\n      }\n\n      // 进行拾取\n      return true;\n    }\n  }, {\n    key: \"resizePickingFBO\",\n    value: function resizePickingFBO() {\n      var getContainer = this.rendererService.getContainer;\n      var _this$getContainerSiz4 = this.getContainerSize(getContainer()),\n        width = _this$getContainerSiz4.width,\n        height = _this$getContainerSiz4.height;\n      width *= DOM.DPR;\n      height *= DOM.DPR;\n      if (this.width !== width || this.height !== height) {\n        this.pickingFBO.resize({\n          width: Math.round(width / this.pickBufferScale),\n          height: Math.round(height / this.pickBufferScale)\n        });\n        this.width = width;\n        this.height = height;\n      }\n    }\n  }, {\n    key: \"pickingLayers\",\n    value: function () {\n      var _pickingLayers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(target) {\n        var _this4 = this;\n        var _this$rendererService5, clear, useFramebufferAsync, layers, _iterator, _step, _loop;\n        return _regeneratorRuntime.wrap(function _callee7$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _this$rendererService5 = this.rendererService, clear = _this$rendererService5.clear, useFramebufferAsync = _this$rendererService5.useFramebufferAsync;\n              this.resizePickingFBO();\n              layers = this.layerService.getRenderList();\n              _iterator = _createForOfIteratorHelper(layers.filter(function (layer) {\n                return layer.needPick(target.type);\n              }).reverse());\n              _context8.prev = 4;\n              _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n                var layer, isPicked;\n                return _regeneratorRuntime.wrap(function _loop$(_context7) {\n                  while (1) switch (_context7.prev = _context7.next) {\n                    case 0:\n                      layer = _step.value;\n                      if (!layer.tileLayer) {\n                        layer.hooks.beforePickingEncode.call();\n                      }\n                      _context7.next = 4;\n                      return useFramebufferAsync(_this4.pickingFBO, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                          while (1) switch (_context6.prev = _context6.next) {\n                            case 0:\n                              clear({\n                                framebuffer: _this4.pickingFBO,\n                                color: [0, 0, 0, 0],\n                                stencil: 0,\n                                depth: 1\n                              });\n                              layer.layerPickService.pickRender(target);\n                            case 2:\n                            case \"end\":\n                              return _context6.stop();\n                          }\n                        }, _callee6);\n                      })));\n                    case 4:\n                      if (!layer.tileLayer) {\n                        layer.hooks.afterPickingEncode.call();\n                      }\n                      _context7.next = 7;\n                      return _this4.pickFromPickingFBO(layer, target);\n                    case 7:\n                      isPicked = _context7.sent;\n                      _this4.layerService.pickedLayerId = isPicked ? +layer.id : -1;\n                      if (!(isPicked && !layer.getLayerConfig().enablePropagation)) {\n                        _context7.next = 11;\n                        break;\n                      }\n                      return _context7.abrupt(\"return\", 1);\n                    case 11:\n                    case \"end\":\n                      return _context7.stop();\n                  }\n                }, _loop);\n              });\n              _iterator.s();\n            case 7:\n              if ((_step = _iterator.n()).done) {\n                _context8.next = 13;\n                break;\n              }\n              return _context8.delegateYield(_loop(), \"t0\", 9);\n            case 9:\n              if (!_context8.t0) {\n                _context8.next = 11;\n                break;\n              }\n              return _context8.abrupt(\"break\", 13);\n            case 11:\n              _context8.next = 7;\n              break;\n            case 13:\n              _context8.next = 18;\n              break;\n            case 15:\n              _context8.prev = 15;\n              _context8.t1 = _context8[\"catch\"](4);\n              _iterator.e(_context8.t1);\n            case 18:\n              _context8.prev = 18;\n              _iterator.f();\n              return _context8.finish(18);\n            case 21:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee7, this, [[4, 15, 18, 21]]);\n      }));\n      function pickingLayers(_x9) {\n        return _pickingLayers.apply(this, arguments);\n      }\n      return pickingLayers;\n    }()\n  }, {\n    key: \"triggerHoverOnLayer\",\n    value: function triggerHoverOnLayer(layer, target) {\n      // layer.emit(target.type, target);\n      // 判断是否发生事件冲突\n      if (isEventCrash(target)) {\n        // Tip: 允许用户动态设置鼠标光标\n        this.handleCursor(layer, target.type);\n        layer.emit(target.type, target);\n      }\n    }\n  }]);\n  return PickingService;\n}(), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"mapService\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"rendererService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, \"interactionService\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, \"layerService\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { PickingService as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
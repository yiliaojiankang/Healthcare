{"ast":null,"code":"import { __rest } from \"tslib\";\nimport { animation, interaction, scale, state, theme, tooltip } from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { pattern } from '../../adaptor/pattern';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { binHistogram } from '../../utils/transform/histogram';\nimport { HISTOGRAM_X_FIELD, HISTOGRAM_Y_FIELD } from './constant';\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var data = options.data,\n    binField = options.binField,\n    binNumber = options.binNumber,\n    binWidth = options.binWidth,\n    color = options.color,\n    stackField = options.stackField,\n    legend = options.legend,\n    columnStyle = options.columnStyle;\n  // 处理数据\n  var plotData = binHistogram(data, binField, binWidth, binNumber, stackField);\n  chart.data(plotData);\n  var p = deepAssign({}, params, {\n    options: {\n      xField: HISTOGRAM_X_FIELD,\n      yField: HISTOGRAM_Y_FIELD,\n      seriesField: stackField,\n      isStack: true,\n      interval: {\n        color: color,\n        style: columnStyle\n      }\n    }\n  });\n  interval(p);\n  // 图例\n  if (legend && stackField) {\n    chart.legend(stackField, legend);\n  } else {\n    chart.legend(false);\n  }\n  return params;\n}\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params) {\n  var _a;\n  var options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis;\n  return flow(scale((_a = {}, _a[HISTOGRAM_X_FIELD] = xAxis, _a[HISTOGRAM_Y_FIELD] = yAxis, _a)))(params);\n}\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis;\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(HISTOGRAM_X_FIELD, false);\n  } else {\n    chart.axis(HISTOGRAM_X_FIELD, xAxis);\n  }\n  if (yAxis === false) {\n    chart.axis(HISTOGRAM_Y_FIELD, false);\n  } else {\n    chart.axis(HISTOGRAM_Y_FIELD, yAxis);\n  }\n  return params;\n}\n/**\n * label 配置\n * @param params\n */\nfunction label(params) {\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label;\n  var geometry = findGeometry(chart, 'interval');\n  if (!label) {\n    geometry.label(false);\n  } else {\n    var callback = label.callback,\n      cfg = __rest(label, [\"callback\"]);\n    geometry.label({\n      fields: [HISTOGRAM_Y_FIELD],\n      callback: callback,\n      cfg: transformLabel(cfg)\n    });\n  }\n  return params;\n}\n/**\n * 直方图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, pattern('columnStyle'), geometry, meta, axis, state, label, tooltip, interaction, animation)(params);\n}","map":{"version":3,"names":["animation","interaction","scale","state","theme","tooltip","interval","pattern","deepAssign","findGeometry","flow","transformLabel","binHistogram","HISTOGRAM_X_FIELD","HISTOGRAM_Y_FIELD","geometry","params","chart","options","data","binField","binNumber","binWidth","color","stackField","legend","columnStyle","plotData","p","xField","yField","seriesField","isStack","style","meta","xAxis","yAxis","_a","axis","label","callback","cfg","__rest","fields","adaptor"],"sources":["../../../src/plots/histogram/adaptor.ts"],"sourcesContent":["import { animation, interaction, scale, state, theme, tooltip } from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { pattern } from '../../adaptor/pattern';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { binHistogram } from '../../utils/transform/histogram';\nimport { HISTOGRAM_X_FIELD, HISTOGRAM_Y_FIELD } from './constant';\nimport { HistogramOptions } from './types';\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<HistogramOptions>): Params<HistogramOptions> {\n  const { chart, options } = params;\n  const { data, binField, binNumber, binWidth, color, stackField, legend, columnStyle } = options;\n\n  // 处理数据\n  const plotData = binHistogram(data, binField, binWidth, binNumber, stackField);\n\n  chart.data(plotData);\n\n  const p = deepAssign({}, params, {\n    options: {\n      xField: HISTOGRAM_X_FIELD,\n      yField: HISTOGRAM_Y_FIELD,\n      seriesField: stackField,\n      isStack: true,\n      interval: {\n        color,\n        style: columnStyle,\n      },\n    },\n  });\n\n  interval(p);\n\n  // 图例\n  if (legend && stackField) {\n    chart.legend(stackField, legend);\n  } else {\n    chart.legend(false);\n  }\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<HistogramOptions>): Params<HistogramOptions> {\n  const { options } = params;\n  const { xAxis, yAxis } = options;\n\n  return flow(\n    scale({\n      [HISTOGRAM_X_FIELD]: xAxis,\n      [HISTOGRAM_Y_FIELD]: yAxis,\n    })\n  )(params);\n}\n\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<HistogramOptions>): Params<HistogramOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis } = options;\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(HISTOGRAM_X_FIELD, false);\n  } else {\n    chart.axis(HISTOGRAM_X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    chart.axis(HISTOGRAM_Y_FIELD, false);\n  } else {\n    chart.axis(HISTOGRAM_Y_FIELD, yAxis);\n  }\n\n  return params;\n}\n\n/**\n * label 配置\n * @param params\n */\nfunction label(params: Params<HistogramOptions>): Params<HistogramOptions> {\n  const { chart, options } = params;\n  const { label } = options;\n\n  const geometry = findGeometry(chart, 'interval');\n\n  if (!label) {\n    geometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    geometry.label({\n      fields: [HISTOGRAM_Y_FIELD],\n      callback,\n      cfg: transformLabel(cfg),\n    });\n  }\n\n  return params;\n}\n\n/**\n * 直方图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<HistogramOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    theme,\n    pattern('columnStyle'),\n    geometry,\n    meta,\n    axis,\n    state,\n    label,\n    tooltip,\n    interaction,\n    animation\n  )(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
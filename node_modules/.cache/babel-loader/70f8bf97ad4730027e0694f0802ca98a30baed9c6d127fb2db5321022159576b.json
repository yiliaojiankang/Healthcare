{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar Grid = /** @class */function () {\n  function Grid() {\n    this.cells = [];\n    this.columnNum = 0;\n    this.rowNum = 0;\n    this.additionColumn = [];\n    this.additionRow = [];\n  }\n  Grid.prototype.init = function (width, height, gridSize) {\n    this.cells = [];\n    this.CELL_W = gridSize.CELL_W || Grid.DEFAULT_CELL_W;\n    this.CELL_H = gridSize.CELL_H || Grid.DEFAULT_CELL_H;\n    this.columnNum = Math.ceil(width / this.CELL_W);\n    this.rowNum = Math.ceil(height / this.CELL_H);\n    Grid.MIN_DIST = Math.pow(width, 2) + Math.pow(height, 2);\n    for (var i = 0; i < this.columnNum; i++) {\n      var tmp = [];\n      for (var j = 0; j < this.rowNum; j++) {\n        var cell = {\n          dx: i,\n          dy: j,\n          x: i * this.CELL_W,\n          y: j * this.CELL_H,\n          occupied: false\n        };\n        tmp.push(cell);\n      }\n      this.cells.push(tmp);\n    }\n  };\n  Grid.prototype.findGridByNodeId = function (nodeId) {\n    var _a, _b;\n    for (var i = 0; i < this.columnNum; i++) {\n      for (var j = 0; j < this.rowNum; j++) {\n        if (this.cells[i][j].node) {\n          if (((_b = (_a = this.cells[i][j]) === null || _a === void 0 ? void 0 : _a.node) === null || _b === void 0 ? void 0 : _b.id) === nodeId) {\n            return {\n              column: i,\n              row: j\n            };\n          }\n        }\n      }\n    }\n    return null;\n  };\n  Grid.prototype.sqdist = function (a, b) {\n    return Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2);\n  };\n  Grid.prototype.occupyNearest = function (p) {\n    var minDist = Grid.MIN_DIST;\n    var d;\n    var candidate = null;\n    for (var i = 0; i < this.columnNum; i++) {\n      for (var j = 0; j < this.rowNum; j++) {\n        if (!this.cells[i][j].occupied && (d = this.sqdist(p, this.cells[i][j])) < minDist) {\n          minDist = d;\n          candidate = this.cells[i][j];\n        }\n      }\n    }\n    if (candidate) {\n      candidate.occupied = true;\n    }\n    return candidate;\n  };\n  Grid.prototype.insertColumn = function (columnIndex, length) {\n    if (length <= 0) return;\n    // 插入空列\n    for (var i = 0; i < length; i++) {\n      this.cells[i + this.columnNum] = [];\n      for (var j = 0; j < this.rowNum; j++) {\n        this.cells[i + this.columnNum][j] = {\n          dx: i,\n          dy: j,\n          x: i * this.CELL_W,\n          y: j * this.CELL_H,\n          occupied: false,\n          node: null\n        };\n      }\n    }\n    // 交换数据\n    for (var i = this.columnNum - 1; i > columnIndex; i--) {\n      for (var j = 0; j < this.rowNum; j++) {\n        this.cells[i + length][j] = __assign(__assign({}, this.cells[i][j]), {\n          x: (i + length) * this.CELL_W,\n          y: j * this.CELL_H\n        });\n        this.cells[i][j] = {\n          x: i * this.CELL_W,\n          y: j * this.CELL_H,\n          occupied: true,\n          node: null\n        };\n      }\n    }\n    // 已有行列的处理\n    for (var j = 0; j < this.additionColumn.length; j++) {\n      if (this.additionColumn[j] >= columnIndex) {\n        this.additionColumn[j] += length;\n      }\n    }\n    // 记录新增的行列\n    for (var i = 0; i < length; i++) {\n      this.additionColumn.push(columnIndex + i + 1);\n    }\n    this.columnNum += length;\n  };\n  Grid.prototype.insertRow = function (rowIndex, length) {\n    if (length <= 0) return;\n    // 插入空行\n    for (var j = 0; j < length; j++) {\n      for (var i = 0; i < this.columnNum; i++) {\n        this.cells[i][j + this.rowNum] = {\n          dx: i,\n          dy: j,\n          x: i * this.CELL_W,\n          y: j * this.CELL_H,\n          occupied: false,\n          node: null\n        };\n      }\n    }\n    // 交换数据\n    for (var i = 0; i < this.columnNum; i++) {\n      for (var j = this.rowNum - 1; j > rowIndex; j--) {\n        this.cells[i][j + length] = __assign(__assign({}, this.cells[i][j]), {\n          dx: i,\n          dy: j + length,\n          x: i * this.CELL_W,\n          y: (j + length) * this.CELL_H\n        });\n        this.cells[i][j] = {\n          dx: i,\n          dy: j,\n          x: i * this.CELL_W,\n          y: j * this.CELL_H,\n          occupied: false,\n          node: null\n        };\n      }\n    }\n    // 已有行列的处理\n    for (var j = 0; j < this.additionRow.length; j++) {\n      if (this.additionRow[j] >= rowIndex) {\n        this.additionRow[j] += length;\n      }\n    }\n    // 记录新增的行列\n    for (var i = 0; i < length; i++) {\n      this.additionRow.push(rowIndex + i + 1);\n    }\n    this.rowNum += length;\n  };\n  Grid.prototype.getNodes = function () {\n    var nodes = [];\n    for (var i = 0; i < this.columnNum; i++) {\n      for (var j = 0; j < this.rowNum; j++) {\n        if (this.cells[i][j].node) {\n          nodes.push(this.cells[i][j]);\n        }\n      }\n    }\n    return nodes;\n  };\n  Grid.MIN_DIST = 50;\n  Grid.DEFAULT_CELL_W = 80;\n  Grid.DEFAULT_CELL_H = 80;\n  return Grid;\n}();\nexports.default = Grid;","map":{"version":3,"names":["Grid","cells","columnNum","rowNum","additionColumn","additionRow","prototype","init","width","height","gridSize","CELL_W","DEFAULT_CELL_W","CELL_H","DEFAULT_CELL_H","Math","ceil","MIN_DIST","pow","i","tmp","j","cell","dx","dy","x","y","occupied","push","findGridByNodeId","nodeId","node","_b","_a","id","column","row","sqdist","a","b","occupyNearest","p","minDist","d","candidate","insertColumn","columnIndex","length","__assign","insertRow","rowIndex","getNodes","nodes"],"sources":["../../../src/layout/er/grid.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
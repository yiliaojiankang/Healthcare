{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport { AttributeType, gl } from '@antv/l7-core';\nimport BaseModel from \"../../core/BaseModel\";\n/* babel-plugin-inline-import '../shaders/billboard_frag.glsl' */\nvar planeFrag = \"layout(std140) uniform commonUniforms {\\n vec2 u_size;\\n float u_raisingHeight;\\n float u_rotation;\\n float u_opacity;\\n};\\n\\nuniform sampler2D u_texture;\\n\\nin vec2 v_uv;\\nout vec4 outputColor;\\n\\n#pragma include \\\"picking\\\"\\nvoid main() {\\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\\n  outputColor.a *= u_opacity;\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/billboard_vert.glsl' */\nvar planeVert = \"layout(location = 0) in vec3 a_Position;\\nlayout(location = 11) in vec3 a_Extrude;\\nlayout(location = 14) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n vec2 u_size;\\n float u_raisingHeight;\\n float u_rotation;\\n float u_opacity;\\n};\\n\\nout vec2 v_uv;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"picking\\\"\\n#pragma include \\\"rotation_2d\\\"\\nvoid main() {\\n   vec3 extrude = a_Extrude;\\n   v_uv = a_Uv;\\n   float raiseHeight = u_raisingHeight;\\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\\n   }\\n\\n   // \\u8BA1\\u7B97\\u7ECF\\u7EAC\\u5EA6\\u70B9\\u4F4D\\u5750\\u6807\\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\\n\\n   // \\u8BA1\\u7B97\\u7ED5 z \\u8F74\\u65CB\\u8F6C\\u540E\\u7684\\u504F\\u79FB\\n   vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0),u_rotation));\\n   // \\u7ED5 z \\u8F74\\u65CB\\u8F6C\\n   float x = project_pos.x + offsetXY.x;\\n   float y = project_pos.y + offsetXY.y;\\n   // z \\u8F74\\u4E0D\\u53C2\\u4E0E\\u65CB\\u8F6C\\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\\n\\n   gl_Position = project_common_position_to_clipspace_v2(vec4(x , y, z , 1.0));\\n\\n   setPickingColor(a_PickingColor);\\n}\\n\";\nimport { ShaderLocation } from \"../../core/CommonStyleAttribute\";\nvar BillBoardModel = /*#__PURE__*/function (_BaseModel) {\n  _inherits(BillBoardModel, _BaseModel);\n  var _super = _createSuper(BillBoardModel);\n  function BillBoardModel() {\n    var _this;\n    _classCallCheck(this, BillBoardModel);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"radian\", 0);\n    // 旋转的弧度\n    _defineProperty(_assertThisInitialized(_this), \"planeGeometryTriangulation\", function () {\n      var _ref = _this.layer.getLayerConfig(),\n        _ref$center = _ref.center,\n        center = _ref$center === void 0 ? [120, 30] : _ref$center;\n      return {\n        size: 4,\n        indices: [0, 1, 2, 2, 3, 0],\n        vertices: [].concat(_toConsumableArray(center), [1, 1], _toConsumableArray(center), [0, 1], _toConsumableArray(center), [0, 0], _toConsumableArray(center), [1, 0])\n      };\n    });\n    return _this;\n  }\n  _createClass(BillBoardModel, [{\n    key: \"getUninforms\",\n    value: function getUninforms() {\n      var commoninfo = this.getCommonUniformsInfo();\n      var attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n      this.updateStyleUnifoms();\n      return _objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption);\n    }\n  }, {\n    key: \"getCommonUniformsInfo\",\n    value: function getCommonUniformsInfo() {\n      var _ref2 = this.layer.getLayerConfig(),\n        opacity = _ref2.opacity,\n        _ref2$width = _ref2.width,\n        width = _ref2$width === void 0 ? 1 : _ref2$width,\n        _ref2$height = _ref2.height,\n        height = _ref2$height === void 0 ? 1 : _ref2$height,\n        _ref2$raisingHeight = _ref2.raisingHeight,\n        raisingHeight = _ref2$raisingHeight === void 0 ? 0 : _ref2$raisingHeight;\n\n      /**\n       *               rotateFlag\n       * DEFAULT            1\n       * MAPBOX           1\n       * GAODE2.x         -1\n       * GAODE1.x         -1\n       */\n      var rotateFlag = 1;\n      if (this.mapService.version === 'GAODE2.x' || this.mapService.version === 'GAODE1.x') {\n        rotateFlag = -1;\n      }\n      // 控制图标的旋转角度（绕 Z 轴旋转）\n      this.radian = rotateFlag * Math.PI * (this.mapService.getRotation() % 360) / 180;\n      var commonOptions = {\n        u_size: [width, height],\n        u_raisingHeight: Number(raisingHeight),\n        u_rotation: this.radian,\n        u_opacity: opacity || 1,\n        u_texture: this.texture\n      };\n      this.textures = [this.texture];\n      var commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n      return commonBufferInfo;\n    }\n  }, {\n    key: \"clearModels\",\n    value: function clearModels() {\n      var _this$texture;\n      (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n    }\n  }, {\n    key: \"initModels\",\n    value: function () {\n      var _initModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _ref3, drawCanvas, createTexture2D, model;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _ref3 = this.layer.getLayerConfig(), drawCanvas = _ref3.drawCanvas;\n              createTexture2D = this.rendererService.createTexture2D;\n              this.texture = createTexture2D({\n                height: 0,\n                width: 0\n              });\n              if (drawCanvas) {\n                this.updateTexture(drawCanvas);\n              }\n              this.initUniformsBuffer();\n              _context.next = 7;\n              return this.layer.buildLayerModel({\n                moduleName: 'geometryBillboard',\n                vertexShader: planeVert,\n                fragmentShader: planeFrag,\n                triangulation: this.planeGeometryTriangulation,\n                inject: this.getInject(),\n                primitive: gl.TRIANGLES,\n                depth: {\n                  enable: true\n                }\n              });\n            case 7:\n              model = _context.sent;\n              return _context.abrupt(\"return\", [model]);\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function initModels() {\n        return _initModels.apply(this, arguments);\n      }\n      return initModels;\n    }()\n  }, {\n    key: \"buildModels\",\n    value: function () {\n      var _buildModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\", this.initModels());\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function buildModels() {\n        return _buildModels.apply(this, arguments);\n      }\n      return buildModels;\n    }()\n  }, {\n    key: \"updateTexture\",\n    value: function updateTexture(drawCanvas) {\n      var createTexture2D = this.rendererService.createTexture2D;\n      var _ref4 = this.layer.getLayerConfig(),\n        _ref4$canvasWidth = _ref4.canvasWidth,\n        canvasWidth = _ref4$canvasWidth === void 0 ? 1 : _ref4$canvasWidth,\n        _ref4$canvasHeight = _ref4.canvasHeight,\n        canvasHeight = _ref4$canvasHeight === void 0 ? 1 : _ref4$canvasHeight;\n      var canvas = document.createElement('canvas');\n      canvas.width = canvasWidth;\n      canvas.height = canvasHeight;\n      var ctx = canvas.getContext('2d');\n      if (ctx) {\n        drawCanvas(canvas);\n        this.texture = createTexture2D({\n          data: canvas,\n          width: canvas.width,\n          height: canvas.height,\n          wrapS: gl.CLAMP_TO_EDGE,\n          wrapT: gl.CLAMP_TO_EDGE\n        });\n        this.layerService.reRender();\n      }\n    }\n  }, {\n    key: \"registerBuiltinAttributes\",\n    value: function registerBuiltinAttributes() {\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'extrude',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Extrude',\n          shaderLocation: ShaderLocation.EXTRUDE,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 3,\n          update: function update(feature, featureIdx, vertex, attributeIdx) {\n            var extrude = [1, 1, 0, -1, 1, 0, -1, -1, 0, 1, -1, 0];\n            var extrudeIndex = attributeIdx % 4 * 3;\n            return [extrude[extrudeIndex], extrude[extrudeIndex + 1], extrude[extrudeIndex + 2]];\n          }\n        }\n      });\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'uv',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Uv',\n          shaderLocation: ShaderLocation.UV,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[2], vertex[3]];\n          }\n        }\n      });\n    }\n  }]);\n  return BillBoardModel;\n}(BaseModel);\nexport { BillBoardModel as default };","map":{"version":3,"names":["_asyncToGenerator","_objectSpread","_toConsumableArray","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_regeneratorRuntime","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","AttributeType","gl","BaseModel","planeFrag","planeVert","ShaderLocation","BillBoardModel","_BaseModel","_super","_this","_len","length","args","Array","_key","concat","_ref","layer","getLayerConfig","_ref$center","center","size","indices","vertices","key","value","getUninforms","commoninfo","getCommonUniformsInfo","attributeInfo","getUniformsBufferInfo","getStyleAttribute","updateStyleUnifoms","uniformsOption","_ref2","opacity","_ref2$width","width","_ref2$height","height","_ref2$raisingHeight","raisingHeight","rotateFlag","mapService","version","radian","Math","PI","getRotation","commonOptions","u_size","u_raisingHeight","Number","u_rotation","u_opacity","u_texture","texture","textures","commonBufferInfo","clearModels","_this$texture","destroy","_initModels","mark","_callee","_ref3","drawCanvas","createTexture2D","model","wrap","_callee$","_context","prev","next","rendererService","updateTexture","initUniformsBuffer","buildLayerModel","moduleName","vertexShader","fragmentShader","triangulation","planeGeometryTriangulation","inject","getInject","primitive","TRIANGLES","depth","enable","sent","abrupt","stop","initModels","_buildModels","_callee2","_callee2$","_context2","buildModels","_ref4","_ref4$canvasWidth","canvasWidth","_ref4$canvasHeight","canvasHeight","canvas","document","createElement","ctx","getContext","data","wrapS","CLAMP_TO_EDGE","wrapT","layerService","reRender","registerBuiltinAttributes","styleAttributeService","registerStyleAttribute","name","type","Attribute","descriptor","shaderLocation","EXTRUDE","buffer","usage","DYNAMIC_DRAW","FLOAT","update","feature","featureIdx","vertex","attributeIdx","extrude","extrudeIndex","UV","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-layers/es/geometry/models/billboard.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { AttributeType, gl } from '@antv/l7-core';\nimport BaseModel from \"../../core/BaseModel\";\n/* babel-plugin-inline-import '../shaders/billboard_frag.glsl' */\nvar planeFrag = \"layout(std140) uniform commonUniforms {\\n vec2 u_size;\\n float u_raisingHeight;\\n float u_rotation;\\n float u_opacity;\\n};\\n\\nuniform sampler2D u_texture;\\n\\nin vec2 v_uv;\\nout vec4 outputColor;\\n\\n#pragma include \\\"picking\\\"\\nvoid main() {\\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\\n  outputColor.a *= u_opacity;\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/billboard_vert.glsl' */\nvar planeVert = \"layout(location = 0) in vec3 a_Position;\\nlayout(location = 11) in vec3 a_Extrude;\\nlayout(location = 14) in vec2 a_Uv;\\n\\nlayout(std140) uniform commonUniforms {\\n vec2 u_size;\\n float u_raisingHeight;\\n float u_rotation;\\n float u_opacity;\\n};\\n\\nout vec2 v_uv;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"picking\\\"\\n#pragma include \\\"rotation_2d\\\"\\nvoid main() {\\n   vec3 extrude = a_Extrude;\\n   v_uv = a_Uv;\\n   float raiseHeight = u_raisingHeight;\\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\\n   }\\n\\n   // \\u8BA1\\u7B97\\u7ECF\\u7EAC\\u5EA6\\u70B9\\u4F4D\\u5750\\u6807\\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\\n\\n   // \\u8BA1\\u7B97\\u7ED5 z \\u8F74\\u65CB\\u8F6C\\u540E\\u7684\\u504F\\u79FB\\n   vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0),u_rotation));\\n   // \\u7ED5 z \\u8F74\\u65CB\\u8F6C\\n   float x = project_pos.x + offsetXY.x;\\n   float y = project_pos.y + offsetXY.y;\\n   // z \\u8F74\\u4E0D\\u53C2\\u4E0E\\u65CB\\u8F6C\\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\\n\\n   gl_Position = project_common_position_to_clipspace_v2(vec4(x , y, z , 1.0));\\n\\n   setPickingColor(a_PickingColor);\\n}\\n\";\nimport { ShaderLocation } from \"../../core/CommonStyleAttribute\";\nvar BillBoardModel = /*#__PURE__*/function (_BaseModel) {\n  _inherits(BillBoardModel, _BaseModel);\n  var _super = _createSuper(BillBoardModel);\n  function BillBoardModel() {\n    var _this;\n    _classCallCheck(this, BillBoardModel);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"radian\", 0);\n    // 旋转的弧度\n    _defineProperty(_assertThisInitialized(_this), \"planeGeometryTriangulation\", function () {\n      var _ref = _this.layer.getLayerConfig(),\n        _ref$center = _ref.center,\n        center = _ref$center === void 0 ? [120, 30] : _ref$center;\n      return {\n        size: 4,\n        indices: [0, 1, 2, 2, 3, 0],\n        vertices: [].concat(_toConsumableArray(center), [1, 1], _toConsumableArray(center), [0, 1], _toConsumableArray(center), [0, 0], _toConsumableArray(center), [1, 0])\n      };\n    });\n    return _this;\n  }\n  _createClass(BillBoardModel, [{\n    key: \"getUninforms\",\n    value: function getUninforms() {\n      var commoninfo = this.getCommonUniformsInfo();\n      var attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n      this.updateStyleUnifoms();\n      return _objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption);\n    }\n  }, {\n    key: \"getCommonUniformsInfo\",\n    value: function getCommonUniformsInfo() {\n      var _ref2 = this.layer.getLayerConfig(),\n        opacity = _ref2.opacity,\n        _ref2$width = _ref2.width,\n        width = _ref2$width === void 0 ? 1 : _ref2$width,\n        _ref2$height = _ref2.height,\n        height = _ref2$height === void 0 ? 1 : _ref2$height,\n        _ref2$raisingHeight = _ref2.raisingHeight,\n        raisingHeight = _ref2$raisingHeight === void 0 ? 0 : _ref2$raisingHeight;\n\n      /**\n       *               rotateFlag\n       * DEFAULT            1\n       * MAPBOX           1\n       * GAODE2.x         -1\n       * GAODE1.x         -1\n       */\n      var rotateFlag = 1;\n      if (this.mapService.version === 'GAODE2.x' || this.mapService.version === 'GAODE1.x') {\n        rotateFlag = -1;\n      }\n      // 控制图标的旋转角度（绕 Z 轴旋转）\n      this.radian = rotateFlag * Math.PI * (this.mapService.getRotation() % 360) / 180;\n      var commonOptions = {\n        u_size: [width, height],\n        u_raisingHeight: Number(raisingHeight),\n        u_rotation: this.radian,\n        u_opacity: opacity || 1,\n        u_texture: this.texture\n      };\n      this.textures = [this.texture];\n      var commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n      return commonBufferInfo;\n    }\n  }, {\n    key: \"clearModels\",\n    value: function clearModels() {\n      var _this$texture;\n      (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n    }\n  }, {\n    key: \"initModels\",\n    value: function () {\n      var _initModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _ref3, drawCanvas, createTexture2D, model;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _ref3 = this.layer.getLayerConfig(), drawCanvas = _ref3.drawCanvas;\n              createTexture2D = this.rendererService.createTexture2D;\n              this.texture = createTexture2D({\n                height: 0,\n                width: 0\n              });\n              if (drawCanvas) {\n                this.updateTexture(drawCanvas);\n              }\n              this.initUniformsBuffer();\n              _context.next = 7;\n              return this.layer.buildLayerModel({\n                moduleName: 'geometryBillboard',\n                vertexShader: planeVert,\n                fragmentShader: planeFrag,\n                triangulation: this.planeGeometryTriangulation,\n                inject: this.getInject(),\n                primitive: gl.TRIANGLES,\n                depth: {\n                  enable: true\n                }\n              });\n            case 7:\n              model = _context.sent;\n              return _context.abrupt(\"return\", [model]);\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function initModels() {\n        return _initModels.apply(this, arguments);\n      }\n      return initModels;\n    }()\n  }, {\n    key: \"buildModels\",\n    value: function () {\n      var _buildModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\", this.initModels());\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function buildModels() {\n        return _buildModels.apply(this, arguments);\n      }\n      return buildModels;\n    }()\n  }, {\n    key: \"updateTexture\",\n    value: function updateTexture(drawCanvas) {\n      var createTexture2D = this.rendererService.createTexture2D;\n      var _ref4 = this.layer.getLayerConfig(),\n        _ref4$canvasWidth = _ref4.canvasWidth,\n        canvasWidth = _ref4$canvasWidth === void 0 ? 1 : _ref4$canvasWidth,\n        _ref4$canvasHeight = _ref4.canvasHeight,\n        canvasHeight = _ref4$canvasHeight === void 0 ? 1 : _ref4$canvasHeight;\n      var canvas = document.createElement('canvas');\n      canvas.width = canvasWidth;\n      canvas.height = canvasHeight;\n      var ctx = canvas.getContext('2d');\n      if (ctx) {\n        drawCanvas(canvas);\n        this.texture = createTexture2D({\n          data: canvas,\n          width: canvas.width,\n          height: canvas.height,\n          wrapS: gl.CLAMP_TO_EDGE,\n          wrapT: gl.CLAMP_TO_EDGE\n        });\n        this.layerService.reRender();\n      }\n    }\n  }, {\n    key: \"registerBuiltinAttributes\",\n    value: function registerBuiltinAttributes() {\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'extrude',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Extrude',\n          shaderLocation: ShaderLocation.EXTRUDE,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 3,\n          update: function update(feature, featureIdx, vertex, attributeIdx) {\n            var extrude = [1, 1, 0, -1, 1, 0, -1, -1, 0, 1, -1, 0];\n            var extrudeIndex = attributeIdx % 4 * 3;\n            return [extrude[extrudeIndex], extrude[extrudeIndex + 1], extrude[extrudeIndex + 2]];\n          }\n        }\n      });\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'uv',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Uv',\n          shaderLocation: ShaderLocation.UV,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[2], vertex[3]];\n          }\n        }\n      });\n    }\n  }]);\n  return BillBoardModel;\n}(BaseModel);\nexport { BillBoardModel as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { justify } from './align';\nimport { constant, maxValueBy, minValueBy, sumBy } from './helper';\nfunction ascendingSourceBreadth(a, b) {\n  return ascendingBreadth(a.source, b.source) || a.index - b.index;\n}\nfunction ascendingTargetBreadth(a, b) {\n  return ascendingBreadth(a.target, b.target) || a.index - b.index;\n}\nfunction ascendingBreadth(a, b) {\n  return a.y0 - b.y0;\n}\nfunction value(d) {\n  return d.value;\n}\nfunction defaultId(d) {\n  return d.index;\n}\nfunction defaultNodes(graph) {\n  return graph.nodes;\n}\nfunction defaultLinks(graph) {\n  return graph.links;\n}\nfunction find(nodeById, id) {\n  var node = nodeById.get(id);\n  if (!node) throw new Error('missing: ' + id);\n  return node;\n}\nfunction computeLinkBreadths(_a) {\n  var nodes = _a.nodes;\n  for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n    var node = nodes_1[_i];\n    var y0 = node.y0;\n    var y1 = y0;\n    for (var _b = 0, _c = node.sourceLinks; _b < _c.length; _b++) {\n      var link = _c[_b];\n      link.y0 = y0 + link.width / 2;\n      y0 += link.width;\n    }\n    for (var _d = 0, _e = node.targetLinks; _d < _e.length; _d++) {\n      var link = _e[_d];\n      link.y1 = y1 + link.width / 2;\n      y1 += link.width;\n    }\n  }\n}\nexport function Sankey() {\n  var x0 = 0,\n    y0 = 0,\n    x1 = 1,\n    y1 = 1; // extent\n  var dx = 24; // nodeWidth\n  var dy = 8,\n    py; // nodePadding\n  var id = defaultId;\n  var align = justify;\n  var depth;\n  var sort;\n  var linkSort;\n  var nodes = defaultNodes;\n  var links = defaultLinks;\n  var iterations = 6;\n  function sankey(arg) {\n    var graph = {\n      nodes: nodes(arg),\n      links: links(arg)\n    };\n    computeNodeLinks(graph);\n    computeNodeValues(graph);\n    computeNodeDepths(graph);\n    computeNodeHeights(graph);\n    computeNodeBreadths(graph);\n    computeLinkBreadths(graph);\n    return graph;\n  }\n  sankey.update = function (graph) {\n    computeLinkBreadths(graph);\n    return graph;\n  };\n  sankey.nodeId = function (_) {\n    return arguments.length ? (id = typeof _ === 'function' ? _ : constant(_), sankey) : id;\n  };\n  sankey.nodeAlign = function (_) {\n    return arguments.length ? (align = typeof _ === 'function' ? _ : constant(_), sankey) : align;\n  };\n  sankey.nodeDepth = function (_) {\n    return arguments.length ? (depth = typeof _ === 'function' ? _ : _, sankey) : depth;\n  };\n  sankey.nodeSort = function (_) {\n    return arguments.length ? (sort = _, sankey) : sort;\n  };\n  sankey.nodeWidth = function (_) {\n    return arguments.length ? (dx = +_, sankey) : dx;\n  };\n  sankey.nodePadding = function (_) {\n    return arguments.length ? (dy = py = +_, sankey) : dy;\n  };\n  sankey.nodes = function (_) {\n    return arguments.length ? (nodes = typeof _ === 'function' ? _ : constant(_), sankey) : nodes;\n  };\n  sankey.links = function (_) {\n    return arguments.length ? (links = typeof _ === 'function' ? _ : constant(_), sankey) : links;\n  };\n  sankey.linkSort = function (_) {\n    return arguments.length ? (linkSort = _, sankey) : linkSort;\n  };\n  sankey.size = function (_) {\n    return arguments.length ? (x0 = y0 = 0, x1 = +_[0], y1 = +_[1], sankey) : [x1 - x0, y1 - y0];\n  };\n  sankey.extent = function (_) {\n    return arguments.length ? (x0 = +_[0][0], x1 = +_[1][0], y0 = +_[0][1], y1 = +_[1][1], sankey) : [[x0, y0], [x1, y1]];\n  };\n  sankey.iterations = function (_) {\n    return arguments.length ? (iterations = +_, sankey) : iterations;\n  };\n  function computeNodeLinks(_a) {\n    var nodes = _a.nodes,\n      links = _a.links;\n    nodes.forEach(function (node, idx) {\n      node.index = idx;\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n    var nodeById = new Map(nodes.map(function (d) {\n      return [id(d), d];\n    }));\n    links.forEach(function (link, idx) {\n      link.index = idx;\n      var source = link.source,\n        target = link.target;\n      if (typeof source !== 'object') source = link.source = find(nodeById, source);\n      if (typeof target !== 'object') target = link.target = find(nodeById, target);\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n    if (linkSort != null) {\n      for (var _i = 0, nodes_2 = nodes; _i < nodes_2.length; _i++) {\n        var _b = nodes_2[_i],\n          sourceLinks = _b.sourceLinks,\n          targetLinks = _b.targetLinks;\n        sourceLinks.sort(linkSort);\n        targetLinks.sort(linkSort);\n      }\n    }\n  }\n  function computeNodeValues(_a) {\n    var nodes = _a.nodes;\n    for (var _i = 0, nodes_3 = nodes; _i < nodes_3.length; _i++) {\n      var node = nodes_3[_i];\n      node.value = node.fixedValue === undefined ? Math.max(sumBy(node.sourceLinks, value), sumBy(node.targetLinks, value)) : node.fixedValue;\n    }\n  }\n  function computeNodeDepths(_a) {\n    var nodes = _a.nodes;\n    var n = nodes.length;\n    var current = new Set(nodes);\n    var next = new Set();\n    var x = 0;\n    while (current.size) {\n      current.forEach(function (node) {\n        node.depth = x;\n        for (var _i = 0, _a = node.sourceLinks; _i < _a.length; _i++) {\n          var target = _a[_i].target;\n          next.add(target);\n        }\n      });\n      if (++x > n) throw new Error('circular link');\n      current = next;\n      next = new Set();\n    }\n    // 如果配置了 depth，则设置自定义 depth\n    if (depth) {\n      var maxDepth = Math.max(maxValueBy(nodes, function (d) {\n        return d.depth;\n      }) + 1, 0);\n      var node = void 0;\n      for (var i = 0; i < nodes.length; i++) {\n        node = nodes[i];\n        node.depth = depth.call(null, node, maxDepth);\n      }\n    }\n  }\n  function computeNodeHeights(_a) {\n    var nodes = _a.nodes;\n    var n = nodes.length;\n    var current = new Set(nodes);\n    var next = new Set();\n    var x = 0;\n    while (current.size) {\n      current.forEach(function (node) {\n        node.height = x;\n        for (var _i = 0, _a = node.targetLinks; _i < _a.length; _i++) {\n          var source = _a[_i].source;\n          next.add(source);\n        }\n      });\n      if (++x > n) throw new Error('circular link');\n      current = next;\n      next = new Set();\n    }\n  }\n  function computeNodeLayers(_a) {\n    var nodes = _a.nodes;\n    var x = Math.max(maxValueBy(nodes, function (d) {\n      return d.depth;\n    }) + 1, 0);\n    var kx = (x1 - x0 - dx) / (x - 1);\n    var columns = new Array(x).fill(0).map(function () {\n      return [];\n    });\n    for (var _i = 0, nodes_4 = nodes; _i < nodes_4.length; _i++) {\n      var node = nodes_4[_i];\n      var i = Math.max(0, Math.min(x - 1, Math.floor(align.call(null, node, x))));\n      node.layer = i;\n      node.x0 = x0 + i * kx;\n      node.x1 = node.x0 + dx;\n      if (columns[i]) columns[i].push(node);else columns[i] = [node];\n    }\n    if (sort) for (var _b = 0, columns_1 = columns; _b < columns_1.length; _b++) {\n      var column = columns_1[_b];\n      column.sort(sort);\n    }\n    return columns;\n  }\n  function initializeNodeBreadths(columns) {\n    var ky = minValueBy(columns, function (c) {\n      return (y1 - y0 - (c.length - 1) * py) / sumBy(c, value);\n    });\n    for (var _i = 0, columns_2 = columns; _i < columns_2.length; _i++) {\n      var nodes_6 = columns_2[_i];\n      var y = y0;\n      for (var _a = 0, nodes_5 = nodes_6; _a < nodes_5.length; _a++) {\n        var node = nodes_5[_a];\n        node.y0 = y;\n        node.y1 = y + node.value * ky;\n        y = node.y1 + py;\n        for (var _b = 0, _c = node.sourceLinks; _b < _c.length; _b++) {\n          var link = _c[_b];\n          link.width = link.value * ky;\n        }\n      }\n      y = (y1 - y + py) / (nodes_6.length + 1);\n      for (var i = 0; i < nodes_6.length; ++i) {\n        var node = nodes_6[i];\n        node.y0 += y * (i + 1);\n        node.y1 += y * (i + 1);\n      }\n      reorderLinks(nodes_6);\n    }\n  }\n  function computeNodeBreadths(graph) {\n    var columns = computeNodeLayers(graph);\n    py = Math.min(dy, (y1 - y0) / (maxValueBy(columns, function (c) {\n      return c.length;\n    }) - 1));\n    initializeNodeBreadths(columns);\n    for (var i = 0; i < iterations; ++i) {\n      var alpha = Math.pow(0.99, i);\n      var beta = Math.max(1 - alpha, (i + 1) / iterations);\n      relaxRightToLeft(columns, alpha, beta);\n      relaxLeftToRight(columns, alpha, beta);\n    }\n  }\n  // Reposition each node based on its incoming (target) links.\n  function relaxLeftToRight(columns, alpha, beta) {\n    for (var i = 1, n = columns.length; i < n; ++i) {\n      var column = columns[i];\n      for (var _i = 0, column_1 = column; _i < column_1.length; _i++) {\n        var target = column_1[_i];\n        var y = 0;\n        var w = 0;\n        for (var _a = 0, _b = target.targetLinks; _a < _b.length; _a++) {\n          var _c = _b[_a],\n            source = _c.source,\n            value_1 = _c.value;\n          var v = value_1 * (target.layer - source.layer);\n          y += targetTop(source, target) * v;\n          w += v;\n        }\n        if (!(w > 0)) continue;\n        var dy_1 = (y / w - target.y0) * alpha;\n        target.y0 += dy_1;\n        target.y1 += dy_1;\n        reorderNodeLinks(target);\n      }\n      if (sort === undefined) column.sort(ascendingBreadth);\n      if (column.length) resolveCollisions(column, beta);\n    }\n  }\n  // Reposition each node based on its outgoing (source) links.\n  function relaxRightToLeft(columns, alpha, beta) {\n    for (var n = columns.length, i = n - 2; i >= 0; --i) {\n      var column = columns[i];\n      for (var _i = 0, column_2 = column; _i < column_2.length; _i++) {\n        var source = column_2[_i];\n        var y = 0;\n        var w = 0;\n        for (var _a = 0, _b = source.sourceLinks; _a < _b.length; _a++) {\n          var _c = _b[_a],\n            target = _c.target,\n            value_2 = _c.value;\n          var v = value_2 * (target.layer - source.layer);\n          y += sourceTop(source, target) * v;\n          w += v;\n        }\n        if (!(w > 0)) continue;\n        var dy_2 = (y / w - source.y0) * alpha;\n        source.y0 += dy_2;\n        source.y1 += dy_2;\n        reorderNodeLinks(source);\n      }\n      if (sort === undefined) column.sort(ascendingBreadth);\n      if (column.length) resolveCollisions(column, beta);\n    }\n  }\n  function resolveCollisions(nodes, alpha) {\n    var i = nodes.length >> 1;\n    var subject = nodes[i];\n    resolveCollisionsBottomToTop(nodes, subject.y0 - py, i - 1, alpha);\n    resolveCollisionsTopToBottom(nodes, subject.y1 + py, i + 1, alpha);\n    resolveCollisionsBottomToTop(nodes, y1, nodes.length - 1, alpha);\n    resolveCollisionsTopToBottom(nodes, y0, 0, alpha);\n  }\n  // Push any overlapping nodes down.\n  function resolveCollisionsTopToBottom(nodes, y, i, alpha) {\n    for (; i < nodes.length; ++i) {\n      var node = nodes[i];\n      var dy_3 = (y - node.y0) * alpha;\n      if (dy_3 > 1e-6) node.y0 += dy_3, node.y1 += dy_3;\n      y = node.y1 + py;\n    }\n  }\n  // Push any overlapping nodes up.\n  function resolveCollisionsBottomToTop(nodes, y, i, alpha) {\n    for (; i >= 0; --i) {\n      var node = nodes[i];\n      var dy_4 = (node.y1 - y) * alpha;\n      if (dy_4 > 1e-6) node.y0 -= dy_4, node.y1 -= dy_4;\n      y = node.y0 - py;\n    }\n  }\n  function reorderNodeLinks(_a) {\n    var sourceLinks = _a.sourceLinks,\n      targetLinks = _a.targetLinks;\n    if (linkSort === undefined) {\n      for (var _i = 0, targetLinks_1 = targetLinks; _i < targetLinks_1.length; _i++) {\n        var sourceLinks_2 = targetLinks_1[_i].source.sourceLinks;\n        sourceLinks_2.sort(ascendingTargetBreadth);\n      }\n      for (var _b = 0, sourceLinks_1 = sourceLinks; _b < sourceLinks_1.length; _b++) {\n        var targetLinks_2 = sourceLinks_1[_b].target.targetLinks;\n        targetLinks_2.sort(ascendingSourceBreadth);\n      }\n    }\n  }\n  function reorderLinks(nodes) {\n    if (linkSort === undefined) {\n      for (var _i = 0, nodes_7 = nodes; _i < nodes_7.length; _i++) {\n        var _a = nodes_7[_i],\n          sourceLinks = _a.sourceLinks,\n          targetLinks = _a.targetLinks;\n        sourceLinks.sort(ascendingTargetBreadth);\n        targetLinks.sort(ascendingSourceBreadth);\n      }\n    }\n  }\n  // Returns the target.y0 that would produce an ideal link from source to target.\n  function targetTop(source, target) {\n    var y = source.y0 - (source.sourceLinks.length - 1) * py / 2;\n    for (var _i = 0, _a = source.sourceLinks; _i < _a.length; _i++) {\n      var _b = _a[_i],\n        node = _b.target,\n        width = _b.width;\n      if (node === target) break;\n      y += width + py;\n    }\n    for (var _c = 0, _d = target.targetLinks; _c < _d.length; _c++) {\n      var _e = _d[_c],\n        node = _e.source,\n        width = _e.width;\n      if (node === source) break;\n      y -= width;\n    }\n    return y;\n  }\n  // Returns the source.y0 that would produce an ideal link from source to target.\n  function sourceTop(source, target) {\n    var y = target.y0 - (target.targetLinks.length - 1) * py / 2;\n    for (var _i = 0, _a = target.targetLinks; _i < _a.length; _i++) {\n      var _b = _a[_i],\n        node = _b.source,\n        width = _b.width;\n      if (node === source) break;\n      y += width + py;\n    }\n    for (var _c = 0, _d = source.sourceLinks; _c < _d.length; _c++) {\n      var _e = _d[_c],\n        node = _e.target,\n        width = _e.width;\n      if (node === target) break;\n      y -= width;\n    }\n    return y;\n  }\n  return sankey;\n}","map":{"version":3,"names":["justify","constant","maxValueBy","minValueBy","sumBy","ascendingSourceBreadth","a","b","ascendingBreadth","source","index","ascendingTargetBreadth","target","y0","value","d","defaultId","defaultNodes","graph","nodes","defaultLinks","links","find","nodeById","id","node","get","Error","computeLinkBreadths","_a","_i","nodes_1","length","y1","_b","_c","sourceLinks","link","width","_d","_e","targetLinks","Sankey","x0","x1","dx","dy","py","align","depth","sort","linkSort","iterations","sankey","arg","computeNodeLinks","computeNodeValues","computeNodeDepths","computeNodeHeights","computeNodeBreadths","update","nodeId","_","arguments","nodeAlign","nodeDepth","nodeSort","nodeWidth","nodePadding","size","extent","forEach","idx","Map","map","push","nodes_2","nodes_3","fixedValue","undefined","Math","max","n","current","Set","next","x","add","maxDepth","i","call","height","computeNodeLayers","kx","columns","Array","fill","nodes_4","min","floor","layer","columns_1","column","initializeNodeBreadths","ky","c","columns_2","nodes_6","y","nodes_5","reorderLinks","alpha","pow","beta","relaxRightToLeft","relaxLeftToRight","column_1","w","value_1","v","targetTop","dy_1","reorderNodeLinks","resolveCollisions","column_2","value_2","sourceTop","dy_2","subject","resolveCollisionsBottomToTop","resolveCollisionsTopToBottom","dy_3","dy_4","targetLinks_1","sourceLinks_2","sourceLinks_1","targetLinks_2","nodes_7"],"sources":["../../../../src/plots/sankey/sankey/sankey.ts"],"sourcesContent":["import { justify } from './align';\nimport { constant, maxValueBy, minValueBy, sumBy } from './helper';\n\nfunction ascendingSourceBreadth(a, b) {\n  return ascendingBreadth(a.source, b.source) || a.index - b.index;\n}\n\nfunction ascendingTargetBreadth(a, b) {\n  return ascendingBreadth(a.target, b.target) || a.index - b.index;\n}\n\nfunction ascendingBreadth(a, b) {\n  return a.y0 - b.y0;\n}\n\nfunction value(d) {\n  return d.value;\n}\n\nfunction defaultId(d) {\n  return d.index;\n}\n\nfunction defaultNodes(graph) {\n  return graph.nodes;\n}\n\nfunction defaultLinks(graph) {\n  return graph.links;\n}\n\nfunction find(nodeById, id) {\n  const node = nodeById.get(id);\n  if (!node) throw new Error('missing: ' + id);\n  return node;\n}\n\nfunction computeLinkBreadths({ nodes }) {\n  for (const node of nodes) {\n    let y0 = node.y0;\n    let y1 = y0;\n    for (const link of node.sourceLinks) {\n      link.y0 = y0 + link.width / 2;\n      y0 += link.width;\n    }\n    for (const link of node.targetLinks) {\n      link.y1 = y1 + link.width / 2;\n      y1 += link.width;\n    }\n  }\n}\n\nexport function Sankey() {\n  let x0 = 0,\n    y0 = 0,\n    x1 = 1,\n    y1 = 1; // extent\n  let dx = 24; // nodeWidth\n  let dy = 8,\n    py; // nodePadding\n  let id = defaultId;\n  let align = justify;\n  let depth;\n  let sort;\n  let linkSort;\n  let nodes = defaultNodes;\n  let links = defaultLinks;\n  let iterations = 6;\n\n  function sankey(arg) {\n    const graph = {\n      nodes: nodes(arg),\n      links: links(arg),\n    };\n    computeNodeLinks(graph);\n    computeNodeValues(graph);\n    computeNodeDepths(graph);\n    computeNodeHeights(graph);\n    computeNodeBreadths(graph);\n    computeLinkBreadths(graph);\n    return graph;\n  }\n\n  sankey.update = function (graph) {\n    computeLinkBreadths(graph);\n    return graph;\n  };\n\n  sankey.nodeId = function (_) {\n    return arguments.length ? ((id = typeof _ === 'function' ? _ : constant(_)), sankey) : id;\n  };\n\n  sankey.nodeAlign = function (_) {\n    return arguments.length ? ((align = typeof _ === 'function' ? _ : constant(_)), sankey) : align;\n  };\n\n  sankey.nodeDepth = function (_) {\n    return arguments.length ? ((depth = typeof _ === 'function' ? _ : _), sankey) : depth;\n  };\n\n  sankey.nodeSort = function (_) {\n    return arguments.length ? ((sort = _), sankey) : sort;\n  };\n\n  sankey.nodeWidth = function (_) {\n    return arguments.length ? ((dx = +_), sankey) : dx;\n  };\n\n  sankey.nodePadding = function (_) {\n    return arguments.length ? ((dy = py = +_), sankey) : dy;\n  };\n\n  sankey.nodes = function (_) {\n    return arguments.length ? ((nodes = typeof _ === 'function' ? _ : constant(_)), sankey) : nodes;\n  };\n\n  sankey.links = function (_) {\n    return arguments.length ? ((links = typeof _ === 'function' ? _ : constant(_)), sankey) : links;\n  };\n\n  sankey.linkSort = function (_) {\n    return arguments.length ? ((linkSort = _), sankey) : linkSort;\n  };\n\n  sankey.size = function (_) {\n    return arguments.length ? ((x0 = y0 = 0), (x1 = +_[0]), (y1 = +_[1]), sankey) : [x1 - x0, y1 - y0];\n  };\n\n  sankey.extent = function (_) {\n    return arguments.length\n      ? ((x0 = +_[0][0]), (x1 = +_[1][0]), (y0 = +_[0][1]), (y1 = +_[1][1]), sankey)\n      : [\n          [x0, y0],\n          [x1, y1],\n        ];\n  };\n\n  sankey.iterations = function (_) {\n    return arguments.length ? ((iterations = +_), sankey) : iterations;\n  };\n\n  function computeNodeLinks({ nodes, links }) {\n    nodes.forEach((node, idx) => {\n      node.index = idx;\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n\n    const nodeById = new Map(nodes.map((d) => [id(d), d]));\n\n    links.forEach((link, idx) => {\n      link.index = idx;\n      let { source, target } = link;\n      if (typeof source !== 'object') source = link.source = find(nodeById, source);\n      if (typeof target !== 'object') target = link.target = find(nodeById, target);\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n\n    if (linkSort != null) {\n      for (const { sourceLinks, targetLinks } of nodes) {\n        sourceLinks.sort(linkSort);\n        targetLinks.sort(linkSort);\n      }\n    }\n  }\n\n  function computeNodeValues({ nodes }) {\n    for (const node of nodes) {\n      node.value =\n        node.fixedValue === undefined\n          ? Math.max(sumBy(node.sourceLinks, value), sumBy(node.targetLinks, value))\n          : node.fixedValue;\n    }\n  }\n\n  function computeNodeDepths({ nodes }) {\n    const n = nodes.length;\n    let current = new Set<any>(nodes);\n    let next = new Set();\n    let x = 0;\n    while (current.size) {\n      current.forEach((node) => {\n        node.depth = x;\n        for (const { target } of node.sourceLinks) {\n          next.add(target);\n        }\n      });\n      if (++x > n) throw new Error('circular link');\n      current = next;\n      next = new Set();\n    }\n\n    // 如果配置了 depth，则设置自定义 depth\n    if (depth) {\n      const maxDepth = Math.max(maxValueBy(nodes, (d: any) => d.depth) + 1, 0);\n\n      let node;\n      for (let i = 0; i < nodes.length; i++) {\n        node = nodes[i];\n        node.depth = depth.call(null, node, maxDepth);\n      }\n    }\n  }\n\n  function computeNodeHeights({ nodes }) {\n    const n = nodes.length;\n    let current = new Set<any>(nodes);\n    let next = new Set();\n    let x = 0;\n    while (current.size) {\n      current.forEach((node) => {\n        node.height = x;\n        for (const { source } of node.targetLinks) {\n          next.add(source);\n        }\n      });\n      if (++x > n) throw new Error('circular link');\n      current = next;\n      next = new Set();\n    }\n  }\n\n  function computeNodeLayers({ nodes }) {\n    const x = Math.max(maxValueBy(nodes, (d: any) => d.depth) + 1, 0);\n    const kx = (x1 - x0 - dx) / (x - 1);\n    const columns = new Array(x).fill(0).map(() => []);\n    for (const node of nodes) {\n      const i = Math.max(0, Math.min(x - 1, Math.floor(align.call(null, node, x))));\n      node.layer = i;\n      node.x0 = x0 + i * kx;\n      node.x1 = node.x0 + dx;\n      if (columns[i]) columns[i].push(node);\n      else columns[i] = [node];\n    }\n    if (sort)\n      for (const column of columns) {\n        column.sort(sort);\n      }\n    return columns;\n  }\n\n  function initializeNodeBreadths(columns) {\n    const ky = minValueBy(columns, (c: any[]) => (y1 - y0 - (c.length - 1) * py) / sumBy(c, value)) as any as number;\n    for (const nodes of columns) {\n      let y = y0;\n      for (const node of nodes) {\n        node.y0 = y;\n        node.y1 = y + node.value * ky;\n        y = node.y1 + py;\n        for (const link of node.sourceLinks) {\n          link.width = link.value * ky;\n        }\n      }\n      y = (y1 - y + py) / (nodes.length + 1);\n      for (let i = 0; i < nodes.length; ++i) {\n        const node = nodes[i];\n        node.y0 += y * (i + 1);\n        node.y1 += y * (i + 1);\n      }\n      reorderLinks(nodes);\n    }\n  }\n\n  function computeNodeBreadths(graph) {\n    const columns = computeNodeLayers(graph);\n    py = Math.min(dy, (y1 - y0) / ((maxValueBy(columns, (c: any[]) => c.length) as any as number) - 1));\n    initializeNodeBreadths(columns);\n    for (let i = 0; i < iterations; ++i) {\n      const alpha = Math.pow(0.99, i);\n      const beta = Math.max(1 - alpha, (i + 1) / iterations);\n      relaxRightToLeft(columns, alpha, beta);\n      relaxLeftToRight(columns, alpha, beta);\n    }\n  }\n\n  // Reposition each node based on its incoming (target) links.\n  function relaxLeftToRight(columns, alpha, beta) {\n    for (let i = 1, n = columns.length; i < n; ++i) {\n      const column = columns[i];\n      for (const target of column) {\n        let y = 0;\n        let w = 0;\n        for (const { source, value } of target.targetLinks) {\n          const v = value * (target.layer - source.layer);\n          y += targetTop(source, target) * v;\n          w += v;\n        }\n        if (!(w > 0)) continue;\n        const dy = (y / w - target.y0) * alpha;\n        target.y0 += dy;\n        target.y1 += dy;\n        reorderNodeLinks(target);\n      }\n      if (sort === undefined) column.sort(ascendingBreadth);\n      if (column.length) resolveCollisions(column, beta);\n    }\n  }\n\n  // Reposition each node based on its outgoing (source) links.\n  function relaxRightToLeft(columns, alpha, beta) {\n    for (let n = columns.length, i = n - 2; i >= 0; --i) {\n      const column = columns[i];\n      for (const source of column) {\n        let y = 0;\n        let w = 0;\n        for (const { target, value } of source.sourceLinks) {\n          const v = value * (target.layer - source.layer);\n          y += sourceTop(source, target) * v;\n          w += v;\n        }\n        if (!(w > 0)) continue;\n        const dy = (y / w - source.y0) * alpha;\n        source.y0 += dy;\n        source.y1 += dy;\n        reorderNodeLinks(source);\n      }\n      if (sort === undefined) column.sort(ascendingBreadth);\n      if (column.length) resolveCollisions(column, beta);\n    }\n  }\n\n  function resolveCollisions(nodes, alpha) {\n    const i = nodes.length >> 1;\n    const subject = nodes[i];\n    resolveCollisionsBottomToTop(nodes, subject.y0 - py, i - 1, alpha);\n    resolveCollisionsTopToBottom(nodes, subject.y1 + py, i + 1, alpha);\n    resolveCollisionsBottomToTop(nodes, y1, nodes.length - 1, alpha);\n    resolveCollisionsTopToBottom(nodes, y0, 0, alpha);\n  }\n\n  // Push any overlapping nodes down.\n  function resolveCollisionsTopToBottom(nodes, y, i, alpha) {\n    for (; i < nodes.length; ++i) {\n      const node = nodes[i];\n      const dy = (y - node.y0) * alpha;\n      if (dy > 1e-6) (node.y0 += dy), (node.y1 += dy);\n      y = node.y1 + py;\n    }\n  }\n\n  // Push any overlapping nodes up.\n  function resolveCollisionsBottomToTop(nodes, y, i, alpha) {\n    for (; i >= 0; --i) {\n      const node = nodes[i];\n      const dy = (node.y1 - y) * alpha;\n      if (dy > 1e-6) (node.y0 -= dy), (node.y1 -= dy);\n      y = node.y0 - py;\n    }\n  }\n\n  function reorderNodeLinks({ sourceLinks, targetLinks }) {\n    if (linkSort === undefined) {\n      for (const {\n        source: { sourceLinks },\n      } of targetLinks) {\n        sourceLinks.sort(ascendingTargetBreadth);\n      }\n      for (const {\n        target: { targetLinks },\n      } of sourceLinks) {\n        targetLinks.sort(ascendingSourceBreadth);\n      }\n    }\n  }\n\n  function reorderLinks(nodes) {\n    if (linkSort === undefined) {\n      for (const { sourceLinks, targetLinks } of nodes) {\n        sourceLinks.sort(ascendingTargetBreadth);\n        targetLinks.sort(ascendingSourceBreadth);\n      }\n    }\n  }\n\n  // Returns the target.y0 that would produce an ideal link from source to target.\n  function targetTop(source, target) {\n    let y = source.y0 - ((source.sourceLinks.length - 1) * py) / 2;\n    for (const { target: node, width } of source.sourceLinks) {\n      if (node === target) break;\n      y += width + py;\n    }\n    for (const { source: node, width } of target.targetLinks) {\n      if (node === source) break;\n      y -= width;\n    }\n    return y;\n  }\n\n  // Returns the source.y0 that would produce an ideal link from source to target.\n  function sourceTop(source, target) {\n    let y = target.y0 - ((target.targetLinks.length - 1) * py) / 2;\n    for (const { source: node, width } of target.targetLinks) {\n      if (node === source) break;\n      y += width + py;\n    }\n    for (const { target: node, width } of source.sourceLinks) {\n      if (node === target) break;\n      y -= width;\n    }\n    return y;\n  }\n\n  return sankey;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
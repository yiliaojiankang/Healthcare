{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { Path } from '../shape';\nvar sin = Math.sin,\n  cos = Math.cos,\n  atan2 = Math.atan2,\n  PI = Math.PI;\nfunction _addDefaultArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var stroke = attrs.stroke,\n    lineWidth = attrs.lineWidth;\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: {\n      // 默认箭头的边长为 10，夹角为 60 度\n      path: \"M\" + 10 * cos(PI / 6) + \",\" + 10 * sin(PI / 6) + \" L0,0 L\" + 10 * cos(PI / 6) + \",-\" + 10 * sin(PI / 6),\n      // 使用 shape stroke 值\n      stroke: stroke,\n      lineWidth: lineWidth\n    }\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 箭头 path 的设置要求\n * 1. 箭头顶点坐标需要为 (0, 0)\n * 2. 箭头夹角的中心分割线需要与 X 轴正方向对齐\n */\nfunction _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, isStart) {\n  var startArrow = attrs.startArrow,\n    endArrow = attrs.endArrow,\n    stroke = attrs.stroke,\n    lineWidth = attrs.lineWidth;\n  var arrowAttrs = isStart ? startArrow : endArrow;\n  var d = arrowAttrs.d,\n    arrowFill = arrowAttrs.fill,\n    arrowStroke = arrowAttrs.stroke,\n    arrowLineWidth = arrowAttrs.lineWidth,\n    restAttrs = __rest(arrowAttrs, [\"d\", \"fill\", \"stroke\", \"lineWidth\"]);\n  var x = x1 - x2;\n  var y = y1 - y2;\n  var rad = atan2(y, x);\n  if (d) {\n    x2 = x2 - cos(rad) * d;\n    y2 = y2 - sin(rad) * d;\n  }\n  var arrowShape = new Path({\n    type: 'path',\n    canvas: shape.get('canvas'),\n    isArrowShape: true,\n    attrs: __assign(__assign({}, restAttrs), {\n      // 支持单独设置箭头的 stroke 和 lineWidth，若为空则使用 shape 的值\n      stroke: arrowStroke || stroke,\n      lineWidth: arrowLineWidth || lineWidth,\n      // 箭头是否填充需要手动设置，不会继承自 shape 的值\n      fill: arrowFill\n    })\n  });\n  arrowShape.translate(x2, y2);\n  arrowShape.rotateAtPoint(x2, y2, rad);\n  shape.set(isStart ? 'startArrowShape' : 'endArrowShape', arrowShape);\n}\n/**\n * 如果自定义箭头并且有 d 需要做偏移，如果直接画，线条会超出箭头尖端，因此需要根据箭头偏移 d, 返回线需要缩短的距离\n * |----------------\n * |<|--------------\n * |\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n * @param {number} d  箭头沿线条方向的偏移距离\n * @return {{dx: number, dy: number}} 返回线条偏移距离\n */\nexport function getShortenOffset(x1, y1, x2, y2, d) {\n  var rad = atan2(y2 - y1, x2 - x1);\n  return {\n    dx: cos(rad) * d,\n    dy: sin(rad) * d\n  };\n}\n/**\n * 绘制起始箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\nexport function addStartArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.startArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else if (attrs.startArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, true);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}\n/**\n * 绘制结束箭头\n * @param {IShape} shape 图形\n * @param {ShapeAttrs} attrs shape 的绘图属性\n * @param {number} x1 起始点 x\n * @param {number} y1 起始点 y\n * @param {number} x2 箭头作用点 x\n * @param {number} y2 箭头作用点 y\n */\nexport function addEndArrow(shape, attrs, x1, y1, x2, y2) {\n  if (typeof attrs.endArrow === 'object') {\n    _addCustomizedArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else if (attrs.endArrow) {\n    _addDefaultArrow(shape, attrs, x1, y1, x2, y2, false);\n  } else {\n    shape.set('startArrowShape', null);\n  }\n}","map":{"version":3,"names":["Path","sin","Math","cos","atan2","PI","_addDefaultArrow","shape","attrs","x1","y1","x2","y2","isStart","stroke","lineWidth","x","y","rad","arrowShape","type","canvas","get","isArrowShape","path","translate","rotateAtPoint","set","_addCustomizedArrow","startArrow","endArrow","arrowAttrs","d","arrowFill","fill","arrowStroke","arrowLineWidth","restAttrs","__rest","__assign","getShortenOffset","dx","dy","addStartArrow","addEndArrow"],"sources":["../../src/util/arrow.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
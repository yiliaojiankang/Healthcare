{"ast":null,"code":"import { toArray } from '@antv/util';\nimport { SHAPE_TO_TAGS } from '../constant';\n/**\n * 创建并返回图形的 svg 元素\n * @param type svg类型\n */\nexport function createSVGElement(type) {\n  return document.createElementNS('http://www.w3.org/2000/svg', type);\n}\n/**\n * 创建并返回图形的 dom 元素\n * @param  {IShape} shape 图形\n * @return {SVGElement}\n */\nexport function createDom(shape) {\n  var type = SHAPE_TO_TAGS[shape.type];\n  var parent = shape.getParent();\n  if (!type) {\n    throw new Error(\"the type \" + shape.type + \" is not supported by svg\");\n  }\n  var element = createSVGElement(type);\n  if (shape.get('id')) {\n    element.id = shape.get('id');\n  }\n  shape.set('el', element);\n  shape.set('attrs', {});\n  // 对于 defs 下的 dom 节点，parent 为空，通过 context 统一挂载到 defs 节点下\n  if (parent) {\n    var parentNode = parent.get('el');\n    if (parentNode) {\n      parentNode.appendChild(element);\n    } else {\n      // parentNode maybe null for group\n      parentNode = parent.createDom();\n      parent.set('el', parentNode);\n      parentNode.appendChild(element);\n    }\n  }\n  return element;\n}\n/**\n * 对 dom 元素进行排序\n * @param {IElement} element  元素\n * @param {sorter}   function 排序函数\n */\nexport function sortDom(element, sorter) {\n  var el = element.get('el');\n  var childList = toArray(el.children).sort(sorter);\n  // create empty fragment\n  var fragment = document.createDocumentFragment();\n  childList.forEach(function (child) {\n    fragment.appendChild(child);\n  });\n  el.appendChild(fragment);\n}\n/**\n * 将 dom 元素移动到父元素下的指定位置\n * @param {SVGElement} element     dom 元素\n * @param {number}     targetIndex 目标位置(从 0 开始)\n */\nexport function moveTo(element, targetIndex) {\n  var parentNode = element.parentNode;\n  var siblings = Array.from(parentNode.childNodes).filter(\n  // 要求为元素节点，且不能为 defs 节点\n  function (node) {\n    return node.nodeType === 1 && node.nodeName.toLowerCase() !== 'defs';\n  });\n  // 获取目标节点\n  var target = siblings[targetIndex];\n  var currentIndex = siblings.indexOf(element);\n  // 如果目标节点存在\n  if (target) {\n    // 当前索引 > 目标索引，直接插入到目标节点之前即可\n    if (currentIndex > targetIndex) {\n      parentNode.insertBefore(element, target);\n    } else if (currentIndex < targetIndex) {\n      // 当前索引 < 目标索引\n      // 获取目标节点的下一个节点\n      var targetNext = siblings[targetIndex + 1];\n      // 如果目标节点的下一个节点存在，插入到该节点之前\n      if (targetNext) {\n        parentNode.insertBefore(element, targetNext);\n      } else {\n        // 如果该节点不存在，则追加到末尾\n        parentNode.appendChild(element);\n      }\n    }\n  } else {\n    parentNode.appendChild(element);\n  }\n}","map":{"version":3,"names":["toArray","SHAPE_TO_TAGS","createSVGElement","type","document","createElementNS","createDom","shape","parent","getParent","Error","element","get","id","set","parentNode","appendChild","sortDom","sorter","el","childList","children","sort","fragment","createDocumentFragment","forEach","child","moveTo","targetIndex","siblings","Array","from","childNodes","filter","node","nodeType","nodeName","toLowerCase","target","currentIndex","indexOf","insertBefore","targetNext"],"sources":["../../src/util/dom.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
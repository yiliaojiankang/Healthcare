{"ast":null,"code":"import { isString, each, isArray } from './util';\nvar regexLG = /^l\\s*\\(\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexRG = /^r\\s*\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexPR = /^p\\s*\\(\\s*([axyn])\\s*\\)\\s*(.*)/i;\nvar regexColorStop = /[\\d.]+:(#[^\\s]+|[^\\)]+\\))/gi;\nfunction addStop(steps, gradient) {\n  var arr = steps.match(regexColorStop);\n  each(arr, function (item) {\n    var itemArr = item.split(':');\n    gradient.addColorStop(itemArr[0], itemArr[1]);\n  });\n}\n/**\n * 将边和填充设置的颜色转换成线性渐变对象\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   gradientStr   颜色\n * @returns {any} 渐变对象\n */\nexport function parseLineGradient(context, element, gradientStr) {\n  var arr = regexLG.exec(gradientStr);\n  var angle = parseFloat(arr[1]) % 360 * (Math.PI / 180);\n  var steps = arr[2];\n  var box = element.getBBox();\n  var start;\n  var end;\n  if (angle >= 0 && angle < 1 / 2 * Math.PI) {\n    start = {\n      x: box.minX,\n      y: box.minY\n    };\n    end = {\n      x: box.maxX,\n      y: box.maxY\n    };\n  } else if (1 / 2 * Math.PI <= angle && angle < Math.PI) {\n    start = {\n      x: box.maxX,\n      y: box.minY\n    };\n    end = {\n      x: box.minX,\n      y: box.maxY\n    };\n  } else if (Math.PI <= angle && angle < 3 / 2 * Math.PI) {\n    start = {\n      x: box.maxX,\n      y: box.maxY\n    };\n    end = {\n      x: box.minX,\n      y: box.minY\n    };\n  } else {\n    start = {\n      x: box.minX,\n      y: box.maxY\n    };\n    end = {\n      x: box.maxX,\n      y: box.minY\n    };\n  }\n  var tanTheta = Math.tan(angle);\n  var tanTheta2 = tanTheta * tanTheta;\n  var x = (end.x - start.x + tanTheta * (end.y - start.y)) / (tanTheta2 + 1) + start.x;\n  var y = tanTheta * (end.x - start.x + tanTheta * (end.y - start.y)) / (tanTheta2 + 1) + start.y;\n  var gradient = context.createLinearGradient(start.x, start.y, x, y);\n  addStop(steps, gradient);\n  return gradient;\n}\n/**\n * 将边和填充设置的颜色转换成圆形渐变对象\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   gradientStr   颜色\n * @returns {any} 渐变对象\n */\nexport function parseRadialGradient(context, element, gradientStr) {\n  var arr = regexRG.exec(gradientStr);\n  var fx = parseFloat(arr[1]);\n  var fy = parseFloat(arr[2]);\n  var fr = parseFloat(arr[3]);\n  var steps = arr[4];\n  // 环半径为0时，默认无渐变，取渐变序列的最后一个颜色\n  if (fr === 0) {\n    var colors = steps.match(regexColorStop);\n    return colors[colors.length - 1].split(':')[1];\n  }\n  var box = element.getBBox();\n  var width = box.maxX - box.minX;\n  var height = box.maxY - box.minY;\n  var r = Math.sqrt(width * width + height * height) / 2;\n  var gradient = context.createRadialGradient(box.minX + width * fx, box.minY + height * fy, 0, box.minX + width / 2, box.minY + height / 2, fr * r);\n  addStop(steps, gradient);\n  return gradient;\n}\n/**\n * 边和填充设置的颜色转换成 pattern\n * @param {CanvasRenderingContext2D} context canvas 上下文\n * @param {IElement}                 element  图形元素\n * @param {string}                   patternStr   生成 pattern 的字符串\n */\nexport function parsePattern(context, element, patternStr) {\n  // 在转换过程中进行了缓存\n  if (element.get('patternSource') && element.get('patternSource') === patternStr) {\n    return element.get('pattern');\n  }\n  var pattern;\n  var img;\n  var arr = regexPR.exec(patternStr);\n  var repeat = arr[1];\n  var source = arr[2];\n  // Function to be called when pattern loads\n  function onload() {\n    // Create pattern\n    pattern = context.createPattern(img, repeat);\n    element.set('pattern', pattern); // be a cache\n    element.set('patternSource', patternStr);\n  }\n  switch (repeat) {\n    case 'a':\n      repeat = 'repeat';\n      break;\n    case 'x':\n      repeat = 'repeat-x';\n      break;\n    case 'y':\n      repeat = 'repeat-y';\n      break;\n    case 'n':\n      repeat = 'no-repeat';\n      break;\n    default:\n      repeat = 'no-repeat';\n  }\n  img = new Image();\n  // If source URL is not a data URL\n  if (!source.match(/^data:/i)) {\n    // Set crossOrigin for this image\n    img.crossOrigin = 'Anonymous';\n  }\n  img.src = source;\n  if (img.complete) {\n    onload();\n  } else {\n    img.onload = onload;\n    // Fix onload() bug in IE9\n    img.src = img.src;\n  }\n  return pattern;\n}\nexport function parseStyle(context, element, color) {\n  var bbox = element.getBBox();\n  if (isNaN(bbox.x) || isNaN(bbox.y) || isNaN(bbox.width) || isNaN(bbox.height)) {\n    return color;\n  }\n  if (isString(color)) {\n    if (color[1] === '(' || color[2] === '(') {\n      if (color[0] === 'l') {\n        // regexLG.test(color)\n        return parseLineGradient(context, element, color);\n      }\n      if (color[0] === 'r') {\n        // regexRG.test(color)\n        return parseRadialGradient(context, element, color);\n      }\n      if (color[0] === 'p') {\n        // regexPR.test(color)\n        return parsePattern(context, element, color);\n      }\n    }\n    return color;\n  }\n  if (color instanceof CanvasPattern) {\n    return color;\n  }\n}\nexport function parseRadius(radius) {\n  var r1 = 0;\n  var r2 = 0;\n  var r3 = 0;\n  var r4 = 0;\n  if (isArray(radius)) {\n    if (radius.length === 1) {\n      r1 = r2 = r3 = r4 = radius[0];\n    } else if (radius.length === 2) {\n      r1 = r3 = radius[0];\n      r2 = r4 = radius[1];\n    } else if (radius.length === 3) {\n      r1 = radius[0];\n      r2 = r4 = radius[1];\n      r3 = radius[2];\n    } else {\n      r1 = radius[0];\n      r2 = radius[1];\n      r3 = radius[2];\n      r4 = radius[3];\n    }\n  } else {\n    r1 = r2 = r3 = r4 = radius;\n  }\n  return [r1, r2, r3, r4];\n}","map":{"version":3,"names":["isString","each","isArray","regexLG","regexRG","regexPR","regexColorStop","addStop","steps","gradient","arr","match","item","itemArr","split","addColorStop","parseLineGradient","context","element","gradientStr","exec","angle","parseFloat","Math","PI","box","getBBox","start","end","x","minX","y","minY","maxX","maxY","tanTheta","tan","tanTheta2","createLinearGradient","parseRadialGradient","fx","fy","fr","colors","length","width","height","r","sqrt","createRadialGradient","parsePattern","patternStr","get","pattern","img","repeat","source","onload","createPattern","set","Image","crossOrigin","src","complete","parseStyle","color","bbox","isNaN","CanvasPattern","parseRadius","radius","r1","r2","r3","r4"],"sources":["../../src/util/parse.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
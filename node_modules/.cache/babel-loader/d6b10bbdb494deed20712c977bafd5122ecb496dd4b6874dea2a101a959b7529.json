{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { boundsContains, calculateCentroid, lodashUtil, padBounds, rgb2arr } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport CollisionIndex from \"../../utils/collision-index\";\nimport { getGlyphQuads, shapeText } from \"../../utils/symbol-layout\";\n/* babel-plugin-inline-import '../shaders/text/text_frag.glsl' */\nvar textFrag = \"#define SDF_PX 8.0\\n#define EDGE_GAMMA 0.105\\n#define FONT_SIZE 48.0\\n\\nuniform sampler2D u_sdf_map;\\nlayout(std140) uniform commonUniforms {\\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\\n  vec2 u_sdf_map_size;\\n  float u_raisingHeight: 0.0;\\n  float u_stroke_width : 2;\\n  float u_gamma_scale : 0.5;\\n  float u_halo_blur : 0.5;\\n};\\n\\nin vec2 v_uv;\\nin float v_gamma_scale;\\nin vec4 v_color;\\nin vec4 v_stroke_color;\\nin float v_fontScale;\\n\\nout vec4 outputColor;\\n\\n#pragma include \\\"picking\\\"\\nvoid main() {\\n  // get style data mapping\\n\\n  // get sdf from atlas\\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\\n\\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\\n\\n  highp float gamma_scaled = gamma * v_gamma_scale;\\n\\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\\n\\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\\n\\n  outputColor.a *= alpha;\\n   // \\u4F5C\\u4E3A mask \\u6A21\\u677F\\u65F6\\u9700\\u8981\\u4E22\\u5F03\\u900F\\u660E\\u7684\\u50CF\\u7D20\\n  if (outputColor.a < 0.01) {\\n    discard;\\n  }\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/text/text_vert.glsl' */\nvar textVert = \"#define SDF_PX 8.0\\n#define EDGE_GAMMA 0.105\\n#define FONT_SIZE 24.0\\n\\nlayout(location = 0) in vec3 a_Position;\\nlayout(location = 1) in vec4 a_Color;\\nlayout(location = 9) in float a_Size;\\nlayout(location = 10) in vec2 a_textOffsets;\\nlayout(location = 14) in vec2 a_tex;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\\n  vec2 u_sdf_map_size;\\n  float u_raisingHeight: 0.0;\\n  float u_stroke_width : 2;\\n  float u_gamma_scale : 0.5;\\n  float u_halo_blur : 0.5;\\n};\\n\\nout vec2 v_uv;\\nout float v_gamma_scale;\\nout vec4 v_color;\\nout vec4 v_stroke_color;\\nout float v_fontScale;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"picking\\\"\\n#pragma include \\\"rotation_2d\\\"\\n\\nvoid main() {\\n  // cal style mapping - \\u6570\\u636E\\u7EB9\\u7406\\u6620\\u5C04\\u90E8\\u5206\\u7684\\u8BA1\\u7B97\\n  \\n  v_uv = a_tex / u_sdf_map_size;\\n\\n\\n\\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\\n\\n  // \\u6587\\u672C\\u7F29\\u653E\\u6BD4\\u4F8B\\n  float fontScale = a_Size / FONT_SIZE;\\n  v_fontScale = fontScale;\\n\\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\\n\\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\\n  \\n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\\n\\n  float raiseHeight = u_raisingHeight;\\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\\n  }\\n\\n  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\\n\\n  gl_Position = vec4(\\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\\n  v_gamma_scale = gl_Position.w;\\n  setPickingColor(a_PickingColor);\\n\\n}\\n\";\nimport { ShaderLocation } from \"../../core/CommonStyleAttribute\";\nvar isEqual = lodashUtil.isEqual;\nexport function TextTrianglation(feature) {\n  // @ts-ignore\n  var that = this;\n  var id = feature.id;\n  var vertices = [];\n  var indices = [];\n  if (!that.glyphInfoMap || !that.glyphInfoMap[id]) {\n    return {\n      vertices: [],\n      // [ x, y, z, tex.x,tex.y, offset.x. offset.y]\n      indices: [],\n      size: 7\n    };\n  }\n  var centroid = that.glyphInfoMap[id].centroid; // 计算中心点\n  var coord = centroid.length === 2 ? [centroid[0], centroid[1], 0] : centroid;\n  that.glyphInfoMap[id].glyphQuads.forEach(function (quad, index) {\n    vertices.push.apply(vertices, _toConsumableArray(coord).concat([quad.tex.x, quad.tex.y + quad.tex.height, quad.tl.x, quad.tl.y], _toConsumableArray(coord), [quad.tex.x + quad.tex.width, quad.tex.y + quad.tex.height, quad.tr.x, quad.tr.y], _toConsumableArray(coord), [quad.tex.x + quad.tex.width, quad.tex.y, quad.br.x, quad.br.y], _toConsumableArray(coord), [quad.tex.x, quad.tex.y, quad.bl.x, quad.bl.y]));\n    indices.push(0 + index * 4, 1 + index * 4, 2 + index * 4, 2 + index * 4, 3 + index * 4, 0 + index * 4);\n  });\n  return {\n    vertices: vertices,\n    // [ x, y, z, tex.x,tex.y, offset.x. offset.y]\n    indices: indices,\n    size: 7\n  };\n}\nvar TextModel = /*#__PURE__*/function (_BaseModel) {\n  _inherits(TextModel, _BaseModel);\n  var _super = _createSuper(TextModel);\n  function TextModel() {\n    var _this;\n    _classCallCheck(this, TextModel);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"glyphInfoMap\", {});\n    _defineProperty(_assertThisInitialized(_this), \"currentZoom\", -1);\n    _defineProperty(_assertThisInitialized(_this), \"textureHeight\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"textCount\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"preTextStyle\", {});\n    _defineProperty(_assertThisInitialized(_this), \"mapping\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _this.initGlyph(); //\n            _this.updateTexture();\n            _context.next = 4;\n            return _this.reBuildModel();\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n    return _this;\n  }\n  _createClass(TextModel, [{\n    key: \"getUninforms\",\n    value: function getUninforms() {\n      var commoninfo = this.getCommonUniformsInfo();\n      var attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n      this.updateStyleUnifoms();\n      return _objectSpread(_objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption), {\n        u_sdf_map: this.textures[0]\n      });\n    }\n  }, {\n    key: \"getCommonUniformsInfo\",\n    value: function getCommonUniformsInfo() {\n      var _ref2 = this.layer.getLayerConfig(),\n        _ref2$stroke = _ref2.stroke,\n        stroke = _ref2$stroke === void 0 ? '#fff' : _ref2$stroke,\n        _ref2$strokeWidth = _ref2.strokeWidth,\n        strokeWidth = _ref2$strokeWidth === void 0 ? 0 : _ref2$strokeWidth,\n        _ref2$halo = _ref2.halo,\n        halo = _ref2$halo === void 0 ? 0.5 : _ref2$halo,\n        _ref2$gamma = _ref2.gamma,\n        gamma = _ref2$gamma === void 0 ? 2.0 : _ref2$gamma,\n        _ref2$raisingHeight = _ref2.raisingHeight,\n        raisingHeight = _ref2$raisingHeight === void 0 ? 0 : _ref2$raisingHeight;\n      var mapping = this.getFontServiceMapping();\n      var canvas = this.getFontServiceCanvas();\n      if (mapping && Object.keys(mapping).length !== this.textCount && canvas) {\n        this.updateTexture();\n        this.textCount = Object.keys(mapping).length;\n      }\n      this.preTextStyle = this.getTextStyle();\n      var commonOptions = {\n        u_stroke_color: rgb2arr(stroke),\n        u_sdf_map_size: [(canvas === null || canvas === void 0 ? void 0 : canvas.width) || 1, (canvas === null || canvas === void 0 ? void 0 : canvas.height) || 1],\n        u_raisingHeight: Number(raisingHeight),\n        u_stroke_width: strokeWidth,\n        u_gamma_scale: gamma,\n        u_halo_blur: halo\n      };\n      var commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n      return commonBufferInfo;\n    }\n  }, {\n    key: \"initModels\",\n    value: function () {\n      var _initModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // 绑定事件\n              this.bindEvent();\n              this.extent = this.textExtent();\n              this.rawEncodeData = this.layer.getEncodedData();\n              this.preTextStyle = this.getTextStyle();\n              this.initUniformsBuffer();\n              return _context2.abrupt(\"return\", this.buildModels());\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function initModels() {\n        return _initModels.apply(this, arguments);\n      }\n      return initModels;\n    }()\n  }, {\n    key: \"buildModels\",\n    value: function () {\n      var _buildModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _ref3, _ref3$textAllowOverla, textAllowOverlap, model;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _ref3 = this.layer.getLayerConfig(), _ref3$textAllowOverla = _ref3.textAllowOverlap, textAllowOverlap = _ref3$textAllowOverla === void 0 ? false : _ref3$textAllowOverla; //  this.mapping(); 重复调用\n              this.initGlyph(); //\n              this.updateTexture();\n              if (!textAllowOverlap) {\n                this.filterGlyphs();\n              }\n              _context3.next = 6;\n              return this.layer.buildLayerModel({\n                moduleName: 'pointText',\n                vertexShader: textVert,\n                fragmentShader: textFrag,\n                inject: this.getInject(),\n                triangulation: TextTrianglation.bind(this),\n                depth: {\n                  enable: false\n                }\n              });\n            case 6:\n              model = _context3.sent;\n              return _context3.abrupt(\"return\", [model]);\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function buildModels() {\n        return _buildModels.apply(this, arguments);\n      }\n      return buildModels;\n    }() // 需要更新的场景\n    // 1. 文本偏移量发生改变\n    // 2. 文本锚点发生改变\n    // 3. 文本允许重叠发生改变\n    // 4. 文本字体发生改变\n    // 5. 文本字体粗细发生改变\n  }, {\n    key: \"needUpdate\",\n    value: function () {\n      var _needUpdate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _ref4, _ref4$textAllowOverla, textAllowOverlap, _ref4$textAnchor, textAnchor, textOffset, padding, fontFamily, fontWeight, zoom, extent, flag;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _ref4 = this.getTextStyle(), _ref4$textAllowOverla = _ref4.textAllowOverlap, textAllowOverlap = _ref4$textAllowOverla === void 0 ? false : _ref4$textAllowOverla, _ref4$textAnchor = _ref4.textAnchor, textAnchor = _ref4$textAnchor === void 0 ? 'center' : _ref4$textAnchor, textOffset = _ref4.textOffset, padding = _ref4.padding, fontFamily = _ref4.fontFamily, fontWeight = _ref4.fontWeight;\n              if (!(!isEqual(padding, this.preTextStyle.padding) || !isEqual(textOffset, this.preTextStyle.textOffset) || !isEqual(textAnchor, this.preTextStyle.textAnchor) || !isEqual(fontFamily, this.preTextStyle.fontFamily) || !isEqual(fontWeight, this.preTextStyle.fontWeight))) {\n                _context4.next = 5;\n                break;\n              }\n              _context4.next = 4;\n              return this.mapping();\n            case 4:\n              return _context4.abrupt(\"return\", true);\n            case 5:\n              if (!textAllowOverlap) {\n                _context4.next = 7;\n                break;\n              }\n              return _context4.abrupt(\"return\", false);\n            case 7:\n              // textAllowOverlap 发生改变\n              zoom = this.mapService.getZoom();\n              extent = this.mapService.getBounds();\n              flag = boundsContains(this.extent, extent); // 文本不能压盖则进行过滤\n              if (!(Math.abs(this.currentZoom - zoom) > 0.5 || !flag || textAllowOverlap !== this.preTextStyle.textAllowOverlap)) {\n                _context4.next = 14;\n                break;\n              }\n              _context4.next = 13;\n              return this.reBuildModel();\n            case 13:\n              return _context4.abrupt(\"return\", true);\n            case 14:\n              return _context4.abrupt(\"return\", false);\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function needUpdate() {\n        return _needUpdate.apply(this, arguments);\n      }\n      return needUpdate;\n    }()\n  }, {\n    key: \"clearModels\",\n    value: function clearModels() {\n      var _this$texture;\n      (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n      // TODO this.mapping\n      this.layer.off('remapping', this.mapping);\n    }\n  }, {\n    key: \"registerBuiltinAttributes\",\n    value: function registerBuiltinAttributes() {\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'textOffsets',\n        type: AttributeType.Attribute,\n        descriptor: {\n          shaderLocation: 10,\n          name: 'a_textOffsets',\n          // 文字偏移量\n          buffer: {\n            // give the WebGL driver a hint that this buffer may change\n            usage: gl.STATIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[5], vertex[6]];\n          }\n        }\n      });\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'textUv',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_tex',\n          shaderLocation: ShaderLocation.UV,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[3], vertex[4]];\n          }\n        }\n      });\n      // point layer size;\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'size',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Size',\n          shaderLocation: ShaderLocation.SIZE,\n          buffer: {\n            // give the WebGL driver a hint that this buffer may change\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 1,\n          update: function update(feature) {\n            var _feature$size = feature.size,\n              size = _feature$size === void 0 ? 12 : _feature$size;\n            return Array.isArray(size) ? [size[0]] : [size];\n          }\n        }\n      });\n    }\n  }, {\n    key: \"bindEvent\",\n    value: function bindEvent() {\n      if (!this.layer.isTileLayer) {\n        // 重新绑定\n        this.layer.on('remapping', this.mapping);\n      }\n    }\n  }, {\n    key: \"textExtent\",\n    value: function textExtent() {\n      var bounds = this.mapService.getBounds();\n      return padBounds(bounds, 0.5);\n    }\n    /**\n     * 生成文字纹理（生成文字纹理字典）\n     */\n  }, {\n    key: \"initTextFont\",\n    value: function initTextFont() {\n      var _this$getTextStyle = this.getTextStyle(),\n        fontWeight = _this$getTextStyle.fontWeight,\n        fontFamily = _this$getTextStyle.fontFamily;\n      var data = this.rawEncodeData;\n      var characterSet = [];\n      data.forEach(function (item) {\n        var _item$shape = item.shape,\n          shape = _item$shape === void 0 ? '' : _item$shape;\n        shape = shape.toString();\n        var _iterator = _createForOfIteratorHelper(shape),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var char = _step.value;\n            // 去重\n            if (characterSet.indexOf(char) === -1) {\n              characterSet.push(char);\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      });\n      this.fontService.setFontOptions({\n        characterSet: characterSet,\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        iconfont: false\n      });\n    }\n\n    /**\n     * 生成 iconfont 纹理字典\n     */\n  }, {\n    key: \"initIconFontTex\",\n    value: function initIconFontTex() {\n      var _this$getTextStyle2 = this.getTextStyle(),\n        fontWeight = _this$getTextStyle2.fontWeight,\n        fontFamily = _this$getTextStyle2.fontFamily;\n      var data = this.rawEncodeData;\n      var characterSet = [];\n      data.forEach(function (item) {\n        var _item$shape2 = item.shape,\n          shape = _item$shape2 === void 0 ? '' : _item$shape2;\n        shape = \"\".concat(shape);\n        if (characterSet.indexOf(shape) === -1) {\n          characterSet.push(shape);\n        }\n      });\n      this.fontService.setFontOptions({\n        characterSet: characterSet,\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        iconfont: true\n      });\n    }\n  }, {\n    key: \"getTextStyle\",\n    value: function getTextStyle() {\n      var _ref5 = this.layer.getLayerConfig(),\n        _ref5$fontWeight = _ref5.fontWeight,\n        fontWeight = _ref5$fontWeight === void 0 ? '400' : _ref5$fontWeight,\n        _ref5$fontFamily = _ref5.fontFamily,\n        fontFamily = _ref5$fontFamily === void 0 ? 'sans-serif' : _ref5$fontFamily,\n        _ref5$textAllowOverla = _ref5.textAllowOverlap,\n        textAllowOverlap = _ref5$textAllowOverla === void 0 ? false : _ref5$textAllowOverla,\n        _ref5$padding = _ref5.padding,\n        padding = _ref5$padding === void 0 ? [0, 0] : _ref5$padding,\n        _ref5$textAnchor = _ref5.textAnchor,\n        textAnchor = _ref5$textAnchor === void 0 ? 'center' : _ref5$textAnchor,\n        _ref5$textOffset = _ref5.textOffset,\n        textOffset = _ref5$textOffset === void 0 ? [0, 0] : _ref5$textOffset,\n        _ref5$opacity = _ref5.opacity,\n        opacity = _ref5$opacity === void 0 ? 1 : _ref5$opacity,\n        _ref5$strokeOpacity = _ref5.strokeOpacity,\n        strokeOpacity = _ref5$strokeOpacity === void 0 ? 1 : _ref5$strokeOpacity,\n        _ref5$strokeWidth = _ref5.strokeWidth,\n        strokeWidth = _ref5$strokeWidth === void 0 ? 0 : _ref5$strokeWidth,\n        _ref5$stroke = _ref5.stroke,\n        stroke = _ref5$stroke === void 0 ? '#000' : _ref5$stroke;\n      return {\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        textAllowOverlap: textAllowOverlap,\n        padding: padding,\n        textAnchor: textAnchor,\n        textOffset: textOffset,\n        opacity: opacity,\n        strokeOpacity: strokeOpacity,\n        strokeWidth: strokeWidth,\n        stroke: stroke\n      };\n    }\n\n    /**\n     * 生成文字布局（对照文字纹理字典提取对应文字的位置很好信息）\n     */\n  }, {\n    key: \"generateGlyphLayout\",\n    value: function generateGlyphLayout(iconfont) {\n      var _this2 = this;\n      var mapping = this.getFontServiceMapping();\n      var _ref6 = this.layer.getLayerConfig(),\n        _ref6$spacing = _ref6.spacing,\n        spacing = _ref6$spacing === void 0 ? 2 : _ref6$spacing,\n        _ref6$textAnchor = _ref6.textAnchor,\n        textAnchor = _ref6$textAnchor === void 0 ? 'center' : _ref6$textAnchor,\n        textOffset = _ref6.textOffset;\n      var data = this.rawEncodeData;\n      this.glyphInfo = data.map(function (feature) {\n        var _feature$shape = feature.shape,\n          shape = _feature$shape === void 0 ? '' : _feature$shape,\n          id = feature.id,\n          _feature$size2 = feature.size,\n          size = _feature$size2 === void 0 ? 1 : _feature$size2;\n        var offset = feature.textOffset ? feature.textOffset : textOffset || [0, 0];\n        var anchor = feature.textAnchor ? feature.textAnchor : textAnchor || 'center';\n        var shaping = shapeText(shape.toString(), mapping,\n        // @ts-ignore\n        size, anchor, 'left', spacing, offset,\n        //\n        iconfont);\n        var glyphQuads = getGlyphQuads(shaping, offset, false);\n        feature.shaping = shaping;\n        feature.glyphQuads = glyphQuads;\n        // feature.centroid = calculteCentroid(coordinates);\n\n        feature.centroid = calculateCentroid(feature.coordinates);\n\n        // 此时地图高德2.0 originCentroid == centroid\n        feature.originCentroid = feature.version === 'GAODE2.x' ? calculateCentroid(feature.originCoordinates) : feature.originCentroid = feature.centroid;\n        _this2.glyphInfoMap[id] = {\n          shaping: shaping,\n          glyphQuads: glyphQuads,\n          centroid: calculateCentroid(feature.coordinates)\n        };\n        return feature;\n      });\n    }\n  }, {\n    key: \"getFontServiceMapping\",\n    value: function getFontServiceMapping() {\n      var _ref7 = this.layer.getLayerConfig(),\n        _ref7$fontWeight = _ref7.fontWeight,\n        fontWeight = _ref7$fontWeight === void 0 ? '400' : _ref7$fontWeight,\n        _ref7$fontFamily = _ref7.fontFamily,\n        fontFamily = _ref7$fontFamily === void 0 ? 'sans-serif' : _ref7$fontFamily;\n      return this.fontService.getMappingByKey(\"\".concat(fontFamily, \"_\").concat(fontWeight));\n    }\n  }, {\n    key: \"getFontServiceCanvas\",\n    value: function getFontServiceCanvas() {\n      var _ref8 = this.layer.getLayerConfig(),\n        _ref8$fontWeight = _ref8.fontWeight,\n        fontWeight = _ref8$fontWeight === void 0 ? '400' : _ref8$fontWeight,\n        _ref8$fontFamily = _ref8.fontFamily,\n        fontFamily = _ref8$fontFamily === void 0 ? 'sans-serif' : _ref8$fontFamily;\n      // 更新文字布局\n      return this.fontService.getCanvasByKey(\"\".concat(fontFamily, \"_\").concat(fontWeight));\n    }\n\n    /**\n     * 文字避让 depend on originCentorid\n     */\n  }, {\n    key: \"filterGlyphs\",\n    value: function filterGlyphs() {\n      var _this3 = this;\n      var _ref9 = this.layer.getLayerConfig(),\n        _ref9$padding = _ref9.padding,\n        padding = _ref9$padding === void 0 ? [0, 0] : _ref9$padding,\n        _ref9$textAllowOverla = _ref9.textAllowOverlap,\n        textAllowOverlap = _ref9$textAllowOverla === void 0 ? false : _ref9$textAllowOverla;\n      if (textAllowOverlap) {\n        // 如果允许文本覆盖\n        return;\n      }\n      this.glyphInfoMap = {};\n      this.currentZoom = this.mapService.getZoom();\n      this.extent = this.textExtent();\n      var _this$rendererService = this.rendererService.getViewportSize(),\n        width = _this$rendererService.width,\n        height = _this$rendererService.height;\n      var collisionIndex = new CollisionIndex(width, height);\n      var filterData = this.glyphInfo.filter(function (feature) {\n        var shaping = feature.shaping,\n          _feature$id = feature.id,\n          id = _feature$id === void 0 ? 0 : _feature$id;\n        // const centroid = feature.centroid as [number, number];\n        // const centroid = feature.originCentroid as [number, number];\n        var centroid = feature.version === 'GAODE2.x' ? feature.originCentroid : feature.centroid;\n        var size = feature.size;\n        var fontScale = size / 16;\n        var pixels = _this3.mapService.lngLatToContainer(centroid);\n        var _collisionIndex$place = collisionIndex.placeCollisionBox({\n            x1: shaping.left * fontScale - padding[0],\n            x2: shaping.right * fontScale + padding[0],\n            y1: shaping.top * fontScale - padding[1],\n            y2: shaping.bottom * fontScale + padding[1],\n            anchorPointX: pixels.x,\n            anchorPointY: pixels.y\n          }),\n          box = _collisionIndex$place.box;\n        if (box && box.length) {\n          collisionIndex.insertCollisionBox(box, id);\n          return true;\n        } else {\n          return false;\n        }\n      });\n      filterData.forEach(function (item) {\n        // @ts-ignore\n        _this3.glyphInfoMap[item.id] = item;\n      });\n      // this.layer.setEncodedData(filterData);\n    }\n    /**\n     * 初始化文字布局\n     */\n  }, {\n    key: \"initGlyph\",\n    value: function initGlyph() {\n      var _this$layer$getLayerC = this.layer.getLayerConfig(),\n        _this$layer$getLayerC2 = _this$layer$getLayerC.iconfont,\n        iconfont = _this$layer$getLayerC2 === void 0 ? false : _this$layer$getLayerC2;\n      // 1.生成文字纹理（或是生成 iconfont）\n      iconfont ? this.initIconFontTex() : this.initTextFont();\n      // 2.生成文字布局\n      this.generateGlyphLayout(iconfont);\n    }\n    /**\n     * 更新文字纹理\n     */\n  }, {\n    key: \"updateTexture\",\n    value: function updateTexture() {\n      var createTexture2D = this.rendererService.createTexture2D;\n      var canvas = this.getFontServiceCanvas();\n      this.textureHeight = canvas.height;\n      if (this.texture) {\n        this.texture.destroy();\n      }\n      this.texture = createTexture2D({\n        data: canvas,\n        mag: gl.LINEAR,\n        min: gl.LINEAR,\n        width: canvas.width,\n        height: canvas.height\n      });\n      this.textures = [this.texture];\n    }\n  }, {\n    key: \"reBuildModel\",\n    value: function () {\n      var _reBuildModel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var model;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              this.filterGlyphs();\n              _context5.next = 3;\n              return this.layer.buildLayerModel({\n                moduleName: 'pointText',\n                vertexShader: textVert,\n                fragmentShader: textFrag,\n                triangulation: TextTrianglation.bind(this),\n                inject: this.getInject(),\n                depth: {\n                  enable: false\n                }\n              });\n            case 3:\n              model = _context5.sent;\n              // TODO 渲染流程待修改\n              this.layer.models = [model];\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function reBuildModel() {\n        return _reBuildModel.apply(this, arguments);\n      }\n      return reBuildModel;\n    }()\n  }]);\n  return TextModel;\n}(BaseModel);\nexport { TextModel as default };","map":{"version":3,"names":["_objectSpread","_asyncToGenerator","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_toConsumableArray","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","_regeneratorRuntime","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","Reflect","construct","arguments","apply","sham","Proxy","Boolean","valueOf","AttributeType","gl","boundsContains","calculateCentroid","lodashUtil","padBounds","rgb2arr","BaseModel","CollisionIndex","getGlyphQuads","shapeText","textFrag","textVert","ShaderLocation","isEqual","TextTrianglation","feature","that","id","vertices","indices","glyphInfoMap","size","centroid","coord","glyphQuads","forEach","quad","index","push","concat","tex","x","y","height","tl","width","tr","br","bl","TextModel","_BaseModel","_super","_this","_len","args","_key","mark","_callee","wrap","_callee$","_context","prev","initGlyph","updateTexture","reBuildModel","stop","key","getUninforms","commoninfo","getCommonUniformsInfo","attributeInfo","getUniformsBufferInfo","getStyleAttribute","updateStyleUnifoms","uniformsOption","u_sdf_map","textures","_ref2","layer","getLayerConfig","_ref2$stroke","stroke","_ref2$strokeWidth","strokeWidth","_ref2$halo","halo","_ref2$gamma","gamma","_ref2$raisingHeight","raisingHeight","mapping","getFontServiceMapping","canvas","getFontServiceCanvas","keys","textCount","preTextStyle","getTextStyle","commonOptions","u_stroke_color","u_sdf_map_size","u_raisingHeight","Number","u_stroke_width","u_gamma_scale","u_halo_blur","commonBufferInfo","_initModels","_callee2","_callee2$","_context2","bindEvent","extent","textExtent","rawEncodeData","getEncodedData","initUniformsBuffer","abrupt","buildModels","initModels","_buildModels","_callee3","_ref3","_ref3$textAllowOverla","textAllowOverlap","model","_callee3$","_context3","filterGlyphs","buildLayerModel","moduleName","vertexShader","fragmentShader","inject","getInject","triangulation","bind","depth","enable","sent","_needUpdate","_callee4","_ref4","_ref4$textAllowOverla","_ref4$textAnchor","textAnchor","textOffset","padding","fontFamily","fontWeight","zoom","flag","_callee4$","_context4","mapService","getZoom","getBounds","Math","abs","currentZoom","needUpdate","clearModels","_this$texture","texture","destroy","off","registerBuiltinAttributes","styleAttributeService","registerStyleAttribute","type","Attribute","descriptor","shaderLocation","buffer","usage","STATIC_DRAW","data","FLOAT","update","featureIdx","vertex","UV","DYNAMIC_DRAW","SIZE","_feature$size","isTileLayer","on","bounds","initTextFont","_this$getTextStyle","characterSet","item","_item$shape","shape","_iterator","_step","char","indexOf","fontService","setFontOptions","iconfont","initIconFontTex","_this$getTextStyle2","_item$shape2","_ref5","_ref5$fontWeight","_ref5$fontFamily","_ref5$textAllowOverla","_ref5$padding","_ref5$textAnchor","_ref5$textOffset","_ref5$opacity","opacity","_ref5$strokeOpacity","strokeOpacity","_ref5$strokeWidth","_ref5$stroke","generateGlyphLayout","_this2","_ref6","_ref6$spacing","spacing","_ref6$textAnchor","glyphInfo","map","_feature$shape","_feature$size2","offset","anchor","shaping","coordinates","originCentroid","version","originCoordinates","_ref7","_ref7$fontWeight","_ref7$fontFamily","getMappingByKey","_ref8","_ref8$fontWeight","_ref8$fontFamily","getCanvasByKey","_this3","_ref9","_ref9$padding","_ref9$textAllowOverla","_this$rendererService","rendererService","getViewportSize","collisionIndex","filterData","filter","_feature$id","fontScale","pixels","lngLatToContainer","_collisionIndex$place","placeCollisionBox","x1","left","x2","right","y1","top","y2","bottom","anchorPointX","anchorPointY","box","insertCollisionBox","_this$layer$getLayerC","_this$layer$getLayerC2","createTexture2D","textureHeight","mag","LINEAR","min","_reBuildModel","_callee5","_callee5$","_context5","models","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-layers/es/point/models/text.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { AttributeType, gl } from '@antv/l7-core';\nimport { boundsContains, calculateCentroid, lodashUtil, padBounds, rgb2arr } from '@antv/l7-utils';\nimport BaseModel from \"../../core/BaseModel\";\nimport CollisionIndex from \"../../utils/collision-index\";\nimport { getGlyphQuads, shapeText } from \"../../utils/symbol-layout\";\n/* babel-plugin-inline-import '../shaders/text/text_frag.glsl' */\nvar textFrag = \"#define SDF_PX 8.0\\n#define EDGE_GAMMA 0.105\\n#define FONT_SIZE 48.0\\n\\nuniform sampler2D u_sdf_map;\\nlayout(std140) uniform commonUniforms {\\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\\n  vec2 u_sdf_map_size;\\n  float u_raisingHeight: 0.0;\\n  float u_stroke_width : 2;\\n  float u_gamma_scale : 0.5;\\n  float u_halo_blur : 0.5;\\n};\\n\\nin vec2 v_uv;\\nin float v_gamma_scale;\\nin vec4 v_color;\\nin vec4 v_stroke_color;\\nin float v_fontScale;\\n\\nout vec4 outputColor;\\n\\n#pragma include \\\"picking\\\"\\nvoid main() {\\n  // get style data mapping\\n\\n  // get sdf from atlas\\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\\n\\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\\n\\n  highp float gamma_scaled = gamma * v_gamma_scale;\\n\\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\\n\\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\\n\\n  outputColor.a *= alpha;\\n   // \\u4F5C\\u4E3A mask \\u6A21\\u677F\\u65F6\\u9700\\u8981\\u4E22\\u5F03\\u900F\\u660E\\u7684\\u50CF\\u7D20\\n  if (outputColor.a < 0.01) {\\n    discard;\\n  }\\n  outputColor = filterColor(outputColor);\\n}\\n\";\n/* babel-plugin-inline-import '../shaders/text/text_vert.glsl' */\nvar textVert = \"#define SDF_PX 8.0\\n#define EDGE_GAMMA 0.105\\n#define FONT_SIZE 24.0\\n\\nlayout(location = 0) in vec3 a_Position;\\nlayout(location = 1) in vec4 a_Color;\\nlayout(location = 9) in float a_Size;\\nlayout(location = 10) in vec2 a_textOffsets;\\nlayout(location = 14) in vec2 a_tex;\\n\\nlayout(std140) uniform commonUniforms {\\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\\n  vec2 u_sdf_map_size;\\n  float u_raisingHeight: 0.0;\\n  float u_stroke_width : 2;\\n  float u_gamma_scale : 0.5;\\n  float u_halo_blur : 0.5;\\n};\\n\\nout vec2 v_uv;\\nout float v_gamma_scale;\\nout vec4 v_color;\\nout vec4 v_stroke_color;\\nout float v_fontScale;\\n\\n#pragma include \\\"projection\\\"\\n#pragma include \\\"picking\\\"\\n#pragma include \\\"rotation_2d\\\"\\n\\nvoid main() {\\n  // cal style mapping - \\u6570\\u636E\\u7EB9\\u7406\\u6620\\u5C04\\u90E8\\u5206\\u7684\\u8BA1\\u7B97\\n  \\n  v_uv = a_tex / u_sdf_map_size;\\n\\n\\n\\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\\n\\n  // \\u6587\\u672C\\u7F29\\u653E\\u6BD4\\u4F8B\\n  float fontScale = a_Size / FONT_SIZE;\\n  v_fontScale = fontScale;\\n\\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\\n\\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\\n  \\n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\\n\\n  float raiseHeight = u_raisingHeight;\\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\\n  }\\n\\n  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\\n\\n  gl_Position = vec4(\\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\\n  v_gamma_scale = gl_Position.w;\\n  setPickingColor(a_PickingColor);\\n\\n}\\n\";\nimport { ShaderLocation } from \"../../core/CommonStyleAttribute\";\nvar isEqual = lodashUtil.isEqual;\nexport function TextTrianglation(feature) {\n  // @ts-ignore\n  var that = this;\n  var id = feature.id;\n  var vertices = [];\n  var indices = [];\n  if (!that.glyphInfoMap || !that.glyphInfoMap[id]) {\n    return {\n      vertices: [],\n      // [ x, y, z, tex.x,tex.y, offset.x. offset.y]\n      indices: [],\n      size: 7\n    };\n  }\n  var centroid = that.glyphInfoMap[id].centroid; // 计算中心点\n  var coord = centroid.length === 2 ? [centroid[0], centroid[1], 0] : centroid;\n  that.glyphInfoMap[id].glyphQuads.forEach(function (quad, index) {\n    vertices.push.apply(vertices, _toConsumableArray(coord).concat([quad.tex.x, quad.tex.y + quad.tex.height, quad.tl.x, quad.tl.y], _toConsumableArray(coord), [quad.tex.x + quad.tex.width, quad.tex.y + quad.tex.height, quad.tr.x, quad.tr.y], _toConsumableArray(coord), [quad.tex.x + quad.tex.width, quad.tex.y, quad.br.x, quad.br.y], _toConsumableArray(coord), [quad.tex.x, quad.tex.y, quad.bl.x, quad.bl.y]));\n    indices.push(0 + index * 4, 1 + index * 4, 2 + index * 4, 2 + index * 4, 3 + index * 4, 0 + index * 4);\n  });\n  return {\n    vertices: vertices,\n    // [ x, y, z, tex.x,tex.y, offset.x. offset.y]\n    indices: indices,\n    size: 7\n  };\n}\nvar TextModel = /*#__PURE__*/function (_BaseModel) {\n  _inherits(TextModel, _BaseModel);\n  var _super = _createSuper(TextModel);\n  function TextModel() {\n    var _this;\n    _classCallCheck(this, TextModel);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"glyphInfoMap\", {});\n    _defineProperty(_assertThisInitialized(_this), \"currentZoom\", -1);\n    _defineProperty(_assertThisInitialized(_this), \"textureHeight\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"textCount\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"preTextStyle\", {});\n    _defineProperty(_assertThisInitialized(_this), \"mapping\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _this.initGlyph(); //\n            _this.updateTexture();\n            _context.next = 4;\n            return _this.reBuildModel();\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n    return _this;\n  }\n  _createClass(TextModel, [{\n    key: \"getUninforms\",\n    value: function getUninforms() {\n      var commoninfo = this.getCommonUniformsInfo();\n      var attributeInfo = this.getUniformsBufferInfo(this.getStyleAttribute());\n      this.updateStyleUnifoms();\n      return _objectSpread(_objectSpread(_objectSpread({}, commoninfo.uniformsOption), attributeInfo.uniformsOption), {\n        u_sdf_map: this.textures[0]\n      });\n    }\n  }, {\n    key: \"getCommonUniformsInfo\",\n    value: function getCommonUniformsInfo() {\n      var _ref2 = this.layer.getLayerConfig(),\n        _ref2$stroke = _ref2.stroke,\n        stroke = _ref2$stroke === void 0 ? '#fff' : _ref2$stroke,\n        _ref2$strokeWidth = _ref2.strokeWidth,\n        strokeWidth = _ref2$strokeWidth === void 0 ? 0 : _ref2$strokeWidth,\n        _ref2$halo = _ref2.halo,\n        halo = _ref2$halo === void 0 ? 0.5 : _ref2$halo,\n        _ref2$gamma = _ref2.gamma,\n        gamma = _ref2$gamma === void 0 ? 2.0 : _ref2$gamma,\n        _ref2$raisingHeight = _ref2.raisingHeight,\n        raisingHeight = _ref2$raisingHeight === void 0 ? 0 : _ref2$raisingHeight;\n      var mapping = this.getFontServiceMapping();\n      var canvas = this.getFontServiceCanvas();\n      if (mapping && Object.keys(mapping).length !== this.textCount && canvas) {\n        this.updateTexture();\n        this.textCount = Object.keys(mapping).length;\n      }\n      this.preTextStyle = this.getTextStyle();\n      var commonOptions = {\n        u_stroke_color: rgb2arr(stroke),\n        u_sdf_map_size: [(canvas === null || canvas === void 0 ? void 0 : canvas.width) || 1, (canvas === null || canvas === void 0 ? void 0 : canvas.height) || 1],\n        u_raisingHeight: Number(raisingHeight),\n        u_stroke_width: strokeWidth,\n        u_gamma_scale: gamma,\n        u_halo_blur: halo\n      };\n      var commonBufferInfo = this.getUniformsBufferInfo(commonOptions);\n      return commonBufferInfo;\n    }\n  }, {\n    key: \"initModels\",\n    value: function () {\n      var _initModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // 绑定事件\n              this.bindEvent();\n              this.extent = this.textExtent();\n              this.rawEncodeData = this.layer.getEncodedData();\n              this.preTextStyle = this.getTextStyle();\n              this.initUniformsBuffer();\n              return _context2.abrupt(\"return\", this.buildModels());\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function initModels() {\n        return _initModels.apply(this, arguments);\n      }\n      return initModels;\n    }()\n  }, {\n    key: \"buildModels\",\n    value: function () {\n      var _buildModels = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _ref3, _ref3$textAllowOverla, textAllowOverlap, model;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _ref3 = this.layer.getLayerConfig(), _ref3$textAllowOverla = _ref3.textAllowOverlap, textAllowOverlap = _ref3$textAllowOverla === void 0 ? false : _ref3$textAllowOverla; //  this.mapping(); 重复调用\n              this.initGlyph(); //\n              this.updateTexture();\n              if (!textAllowOverlap) {\n                this.filterGlyphs();\n              }\n              _context3.next = 6;\n              return this.layer.buildLayerModel({\n                moduleName: 'pointText',\n                vertexShader: textVert,\n                fragmentShader: textFrag,\n                inject: this.getInject(),\n                triangulation: TextTrianglation.bind(this),\n                depth: {\n                  enable: false\n                }\n              });\n            case 6:\n              model = _context3.sent;\n              return _context3.abrupt(\"return\", [model]);\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function buildModels() {\n        return _buildModels.apply(this, arguments);\n      }\n      return buildModels;\n    }() // 需要更新的场景\n    // 1. 文本偏移量发生改变\n    // 2. 文本锚点发生改变\n    // 3. 文本允许重叠发生改变\n    // 4. 文本字体发生改变\n    // 5. 文本字体粗细发生改变\n  }, {\n    key: \"needUpdate\",\n    value: function () {\n      var _needUpdate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _ref4, _ref4$textAllowOverla, textAllowOverlap, _ref4$textAnchor, textAnchor, textOffset, padding, fontFamily, fontWeight, zoom, extent, flag;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _ref4 = this.getTextStyle(), _ref4$textAllowOverla = _ref4.textAllowOverlap, textAllowOverlap = _ref4$textAllowOverla === void 0 ? false : _ref4$textAllowOverla, _ref4$textAnchor = _ref4.textAnchor, textAnchor = _ref4$textAnchor === void 0 ? 'center' : _ref4$textAnchor, textOffset = _ref4.textOffset, padding = _ref4.padding, fontFamily = _ref4.fontFamily, fontWeight = _ref4.fontWeight;\n              if (!(!isEqual(padding, this.preTextStyle.padding) || !isEqual(textOffset, this.preTextStyle.textOffset) || !isEqual(textAnchor, this.preTextStyle.textAnchor) || !isEqual(fontFamily, this.preTextStyle.fontFamily) || !isEqual(fontWeight, this.preTextStyle.fontWeight))) {\n                _context4.next = 5;\n                break;\n              }\n              _context4.next = 4;\n              return this.mapping();\n            case 4:\n              return _context4.abrupt(\"return\", true);\n            case 5:\n              if (!textAllowOverlap) {\n                _context4.next = 7;\n                break;\n              }\n              return _context4.abrupt(\"return\", false);\n            case 7:\n              // textAllowOverlap 发生改变\n              zoom = this.mapService.getZoom();\n              extent = this.mapService.getBounds();\n              flag = boundsContains(this.extent, extent); // 文本不能压盖则进行过滤\n              if (!(Math.abs(this.currentZoom - zoom) > 0.5 || !flag || textAllowOverlap !== this.preTextStyle.textAllowOverlap)) {\n                _context4.next = 14;\n                break;\n              }\n              _context4.next = 13;\n              return this.reBuildModel();\n            case 13:\n              return _context4.abrupt(\"return\", true);\n            case 14:\n              return _context4.abrupt(\"return\", false);\n            case 15:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function needUpdate() {\n        return _needUpdate.apply(this, arguments);\n      }\n      return needUpdate;\n    }()\n  }, {\n    key: \"clearModels\",\n    value: function clearModels() {\n      var _this$texture;\n      (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.destroy();\n      // TODO this.mapping\n      this.layer.off('remapping', this.mapping);\n    }\n  }, {\n    key: \"registerBuiltinAttributes\",\n    value: function registerBuiltinAttributes() {\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'textOffsets',\n        type: AttributeType.Attribute,\n        descriptor: {\n          shaderLocation: 10,\n          name: 'a_textOffsets',\n          // 文字偏移量\n          buffer: {\n            // give the WebGL driver a hint that this buffer may change\n            usage: gl.STATIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[5], vertex[6]];\n          }\n        }\n      });\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'textUv',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_tex',\n          shaderLocation: ShaderLocation.UV,\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 2,\n          update: function update(feature, featureIdx, vertex) {\n            return [vertex[3], vertex[4]];\n          }\n        }\n      });\n      // point layer size;\n      this.styleAttributeService.registerStyleAttribute({\n        name: 'size',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Size',\n          shaderLocation: ShaderLocation.SIZE,\n          buffer: {\n            // give the WebGL driver a hint that this buffer may change\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 1,\n          update: function update(feature) {\n            var _feature$size = feature.size,\n              size = _feature$size === void 0 ? 12 : _feature$size;\n            return Array.isArray(size) ? [size[0]] : [size];\n          }\n        }\n      });\n    }\n  }, {\n    key: \"bindEvent\",\n    value: function bindEvent() {\n      if (!this.layer.isTileLayer) {\n        // 重新绑定\n        this.layer.on('remapping', this.mapping);\n      }\n    }\n  }, {\n    key: \"textExtent\",\n    value: function textExtent() {\n      var bounds = this.mapService.getBounds();\n      return padBounds(bounds, 0.5);\n    }\n    /**\n     * 生成文字纹理（生成文字纹理字典）\n     */\n  }, {\n    key: \"initTextFont\",\n    value: function initTextFont() {\n      var _this$getTextStyle = this.getTextStyle(),\n        fontWeight = _this$getTextStyle.fontWeight,\n        fontFamily = _this$getTextStyle.fontFamily;\n      var data = this.rawEncodeData;\n      var characterSet = [];\n      data.forEach(function (item) {\n        var _item$shape = item.shape,\n          shape = _item$shape === void 0 ? '' : _item$shape;\n        shape = shape.toString();\n        var _iterator = _createForOfIteratorHelper(shape),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var char = _step.value;\n            // 去重\n            if (characterSet.indexOf(char) === -1) {\n              characterSet.push(char);\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      });\n      this.fontService.setFontOptions({\n        characterSet: characterSet,\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        iconfont: false\n      });\n    }\n\n    /**\n     * 生成 iconfont 纹理字典\n     */\n  }, {\n    key: \"initIconFontTex\",\n    value: function initIconFontTex() {\n      var _this$getTextStyle2 = this.getTextStyle(),\n        fontWeight = _this$getTextStyle2.fontWeight,\n        fontFamily = _this$getTextStyle2.fontFamily;\n      var data = this.rawEncodeData;\n      var characterSet = [];\n      data.forEach(function (item) {\n        var _item$shape2 = item.shape,\n          shape = _item$shape2 === void 0 ? '' : _item$shape2;\n        shape = \"\".concat(shape);\n        if (characterSet.indexOf(shape) === -1) {\n          characterSet.push(shape);\n        }\n      });\n      this.fontService.setFontOptions({\n        characterSet: characterSet,\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        iconfont: true\n      });\n    }\n  }, {\n    key: \"getTextStyle\",\n    value: function getTextStyle() {\n      var _ref5 = this.layer.getLayerConfig(),\n        _ref5$fontWeight = _ref5.fontWeight,\n        fontWeight = _ref5$fontWeight === void 0 ? '400' : _ref5$fontWeight,\n        _ref5$fontFamily = _ref5.fontFamily,\n        fontFamily = _ref5$fontFamily === void 0 ? 'sans-serif' : _ref5$fontFamily,\n        _ref5$textAllowOverla = _ref5.textAllowOverlap,\n        textAllowOverlap = _ref5$textAllowOverla === void 0 ? false : _ref5$textAllowOverla,\n        _ref5$padding = _ref5.padding,\n        padding = _ref5$padding === void 0 ? [0, 0] : _ref5$padding,\n        _ref5$textAnchor = _ref5.textAnchor,\n        textAnchor = _ref5$textAnchor === void 0 ? 'center' : _ref5$textAnchor,\n        _ref5$textOffset = _ref5.textOffset,\n        textOffset = _ref5$textOffset === void 0 ? [0, 0] : _ref5$textOffset,\n        _ref5$opacity = _ref5.opacity,\n        opacity = _ref5$opacity === void 0 ? 1 : _ref5$opacity,\n        _ref5$strokeOpacity = _ref5.strokeOpacity,\n        strokeOpacity = _ref5$strokeOpacity === void 0 ? 1 : _ref5$strokeOpacity,\n        _ref5$strokeWidth = _ref5.strokeWidth,\n        strokeWidth = _ref5$strokeWidth === void 0 ? 0 : _ref5$strokeWidth,\n        _ref5$stroke = _ref5.stroke,\n        stroke = _ref5$stroke === void 0 ? '#000' : _ref5$stroke;\n      return {\n        fontWeight: fontWeight,\n        fontFamily: fontFamily,\n        textAllowOverlap: textAllowOverlap,\n        padding: padding,\n        textAnchor: textAnchor,\n        textOffset: textOffset,\n        opacity: opacity,\n        strokeOpacity: strokeOpacity,\n        strokeWidth: strokeWidth,\n        stroke: stroke\n      };\n    }\n\n    /**\n     * 生成文字布局（对照文字纹理字典提取对应文字的位置很好信息）\n     */\n  }, {\n    key: \"generateGlyphLayout\",\n    value: function generateGlyphLayout(iconfont) {\n      var _this2 = this;\n      var mapping = this.getFontServiceMapping();\n      var _ref6 = this.layer.getLayerConfig(),\n        _ref6$spacing = _ref6.spacing,\n        spacing = _ref6$spacing === void 0 ? 2 : _ref6$spacing,\n        _ref6$textAnchor = _ref6.textAnchor,\n        textAnchor = _ref6$textAnchor === void 0 ? 'center' : _ref6$textAnchor,\n        textOffset = _ref6.textOffset;\n      var data = this.rawEncodeData;\n      this.glyphInfo = data.map(function (feature) {\n        var _feature$shape = feature.shape,\n          shape = _feature$shape === void 0 ? '' : _feature$shape,\n          id = feature.id,\n          _feature$size2 = feature.size,\n          size = _feature$size2 === void 0 ? 1 : _feature$size2;\n        var offset = feature.textOffset ? feature.textOffset : textOffset || [0, 0];\n        var anchor = feature.textAnchor ? feature.textAnchor : textAnchor || 'center';\n        var shaping = shapeText(shape.toString(), mapping,\n        // @ts-ignore\n        size, anchor, 'left', spacing, offset,\n        //\n        iconfont);\n        var glyphQuads = getGlyphQuads(shaping, offset, false);\n        feature.shaping = shaping;\n        feature.glyphQuads = glyphQuads;\n        // feature.centroid = calculteCentroid(coordinates);\n\n        feature.centroid = calculateCentroid(feature.coordinates);\n\n        // 此时地图高德2.0 originCentroid == centroid\n        feature.originCentroid = feature.version === 'GAODE2.x' ? calculateCentroid(feature.originCoordinates) : feature.originCentroid = feature.centroid;\n        _this2.glyphInfoMap[id] = {\n          shaping: shaping,\n          glyphQuads: glyphQuads,\n          centroid: calculateCentroid(feature.coordinates)\n        };\n        return feature;\n      });\n    }\n  }, {\n    key: \"getFontServiceMapping\",\n    value: function getFontServiceMapping() {\n      var _ref7 = this.layer.getLayerConfig(),\n        _ref7$fontWeight = _ref7.fontWeight,\n        fontWeight = _ref7$fontWeight === void 0 ? '400' : _ref7$fontWeight,\n        _ref7$fontFamily = _ref7.fontFamily,\n        fontFamily = _ref7$fontFamily === void 0 ? 'sans-serif' : _ref7$fontFamily;\n      return this.fontService.getMappingByKey(\"\".concat(fontFamily, \"_\").concat(fontWeight));\n    }\n  }, {\n    key: \"getFontServiceCanvas\",\n    value: function getFontServiceCanvas() {\n      var _ref8 = this.layer.getLayerConfig(),\n        _ref8$fontWeight = _ref8.fontWeight,\n        fontWeight = _ref8$fontWeight === void 0 ? '400' : _ref8$fontWeight,\n        _ref8$fontFamily = _ref8.fontFamily,\n        fontFamily = _ref8$fontFamily === void 0 ? 'sans-serif' : _ref8$fontFamily;\n      // 更新文字布局\n      return this.fontService.getCanvasByKey(\"\".concat(fontFamily, \"_\").concat(fontWeight));\n    }\n\n    /**\n     * 文字避让 depend on originCentorid\n     */\n  }, {\n    key: \"filterGlyphs\",\n    value: function filterGlyphs() {\n      var _this3 = this;\n      var _ref9 = this.layer.getLayerConfig(),\n        _ref9$padding = _ref9.padding,\n        padding = _ref9$padding === void 0 ? [0, 0] : _ref9$padding,\n        _ref9$textAllowOverla = _ref9.textAllowOverlap,\n        textAllowOverlap = _ref9$textAllowOverla === void 0 ? false : _ref9$textAllowOverla;\n      if (textAllowOverlap) {\n        // 如果允许文本覆盖\n        return;\n      }\n      this.glyphInfoMap = {};\n      this.currentZoom = this.mapService.getZoom();\n      this.extent = this.textExtent();\n      var _this$rendererService = this.rendererService.getViewportSize(),\n        width = _this$rendererService.width,\n        height = _this$rendererService.height;\n      var collisionIndex = new CollisionIndex(width, height);\n      var filterData = this.glyphInfo.filter(function (feature) {\n        var shaping = feature.shaping,\n          _feature$id = feature.id,\n          id = _feature$id === void 0 ? 0 : _feature$id;\n        // const centroid = feature.centroid as [number, number];\n        // const centroid = feature.originCentroid as [number, number];\n        var centroid = feature.version === 'GAODE2.x' ? feature.originCentroid : feature.centroid;\n        var size = feature.size;\n        var fontScale = size / 16;\n        var pixels = _this3.mapService.lngLatToContainer(centroid);\n        var _collisionIndex$place = collisionIndex.placeCollisionBox({\n            x1: shaping.left * fontScale - padding[0],\n            x2: shaping.right * fontScale + padding[0],\n            y1: shaping.top * fontScale - padding[1],\n            y2: shaping.bottom * fontScale + padding[1],\n            anchorPointX: pixels.x,\n            anchorPointY: pixels.y\n          }),\n          box = _collisionIndex$place.box;\n        if (box && box.length) {\n          collisionIndex.insertCollisionBox(box, id);\n          return true;\n        } else {\n          return false;\n        }\n      });\n      filterData.forEach(function (item) {\n        // @ts-ignore\n        _this3.glyphInfoMap[item.id] = item;\n      });\n      // this.layer.setEncodedData(filterData);\n    }\n    /**\n     * 初始化文字布局\n     */\n  }, {\n    key: \"initGlyph\",\n    value: function initGlyph() {\n      var _this$layer$getLayerC = this.layer.getLayerConfig(),\n        _this$layer$getLayerC2 = _this$layer$getLayerC.iconfont,\n        iconfont = _this$layer$getLayerC2 === void 0 ? false : _this$layer$getLayerC2;\n      // 1.生成文字纹理（或是生成 iconfont）\n      iconfont ? this.initIconFontTex() : this.initTextFont();\n      // 2.生成文字布局\n      this.generateGlyphLayout(iconfont);\n    }\n    /**\n     * 更新文字纹理\n     */\n  }, {\n    key: \"updateTexture\",\n    value: function updateTexture() {\n      var createTexture2D = this.rendererService.createTexture2D;\n      var canvas = this.getFontServiceCanvas();\n      this.textureHeight = canvas.height;\n      if (this.texture) {\n        this.texture.destroy();\n      }\n      this.texture = createTexture2D({\n        data: canvas,\n        mag: gl.LINEAR,\n        min: gl.LINEAR,\n        width: canvas.width,\n        height: canvas.height\n      });\n      this.textures = [this.texture];\n    }\n  }, {\n    key: \"reBuildModel\",\n    value: function () {\n      var _reBuildModel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var model;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              this.filterGlyphs();\n              _context5.next = 3;\n              return this.layer.buildLayerModel({\n                moduleName: 'pointText',\n                vertexShader: textVert,\n                fragmentShader: textFrag,\n                triangulation: TextTrianglation.bind(this),\n                inject: this.getInject(),\n                depth: {\n                  enable: false\n                }\n              });\n            case 3:\n              model = _context5.sent;\n              // TODO 渲染流程待修改\n              this.layer.models = [model];\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function reBuildModel() {\n        return _reBuildModel.apply(this, arguments);\n      }\n      return reBuildModel;\n    }()\n  }]);\n  return TextModel;\n}(BaseModel);\nexport { TextModel as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
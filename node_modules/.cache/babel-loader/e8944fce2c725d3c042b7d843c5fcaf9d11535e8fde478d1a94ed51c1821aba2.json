{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { each } from '@antv/util';\nimport { getElements, getIntersectElements, getMaskedElements, getSiblingMaskElements, getSilbings, isInRecords, isMask } from '../util';\nimport StateBase from './state-base';\n/**\n * @ignore\n * 区域设置状态的基础 Action\n */\nvar ElementRangeState = /** @class */function (_super) {\n  __extends(ElementRangeState, _super);\n  function ElementRangeState() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.startPoint = null;\n    _this.endPoint = null;\n    _this.isStarted = false;\n    /**\n     * 是否作用于当前 view 的 siblings，默认是 false 仅作用于自己\n     */\n    _this.effectSiblings = false;\n    /**\n     * 是否受 element 的数据影响，还是受包围盒的影响\n     */\n    _this.effectByRecord = false;\n    return _this;\n  }\n  // 获取当前的位置\n  ElementRangeState.prototype.getCurrentPoint = function () {\n    var event = this.context.event;\n    return {\n      x: event.x,\n      y: event.y\n    };\n  };\n  /**\n   * 开始，记录开始选中的位置\n   */\n  ElementRangeState.prototype.start = function () {\n    this.clear(); // 开始的时候清理之前的状态\n    this.startPoint = this.getCurrentPoint();\n    this.isStarted = true;\n  };\n  ElementRangeState.prototype.getIntersectElements = function () {\n    var elements = null;\n    if (isMask(this.context)) {\n      elements = getMaskedElements(this.context, 10);\n    } else {\n      var startPoint = this.startPoint;\n      var endPoint = this.isStarted ? this.getCurrentPoint() : this.endPoint;\n      // 如果没有开始，则不允许范围设置状态，保护性质\n      if (!startPoint || !endPoint) {\n        return;\n      }\n      // 计算框选区域\n      var box = {\n        minX: Math.min(startPoint.x, endPoint.x),\n        minY: Math.min(startPoint.y, endPoint.y),\n        maxX: Math.max(startPoint.x, endPoint.x),\n        maxY: Math.max(startPoint.y, endPoint.y)\n      };\n      // this.clear(); // 不全部清理，会导致闪烁\n      var view = this.context.view;\n      elements = getIntersectElements(view, box);\n    }\n    return elements;\n  };\n  /**\n   * 选中\n   */\n  ElementRangeState.prototype.setStateEnable = function (enable) {\n    if (this.effectSiblings && !this.effectByRecord) {\n      this.setSiblingsState(enable);\n    } else {\n      var allElements = getElements(this.context.view);\n      var elements = this.getIntersectElements();\n      if (elements && elements.length) {\n        if (this.effectByRecord) {\n          this.setSiblingsStateByRecord(elements, enable);\n        } else {\n          this.setElementsState(elements, enable, allElements);\n        }\n      } else {\n        this.clear();\n      }\n    }\n  };\n  // 根据选中的 element 的数据进行设置状态\n  ElementRangeState.prototype.setSiblingsStateByRecord = function (elements, enable) {\n    var _this = this;\n    var view = this.context.view;\n    var siblings = getSilbings(view);\n    var records = elements.map(function (el) {\n      return el.getModel().data;\n    });\n    var xFiled = view.getXScale().field;\n    var yField = view.getYScales()[0].field;\n    each(siblings, function (sibling) {\n      var allElements = getElements(sibling);\n      var effectElements = allElements.filter(function (el) {\n        var record = el.getModel().data;\n        return isInRecords(records, record, xFiled, yField);\n      });\n      _this.setElementsState(effectElements, enable, allElements);\n    });\n  };\n  // 设置兄弟 view 的状态\n  ElementRangeState.prototype.setSiblingsState = function (enable) {\n    var _this = this;\n    var view = this.context.view;\n    var siblings = getSilbings(view);\n    if (isMask(this.context)) {\n      // 受 mask 影响\n      each(siblings, function (sibling) {\n        var allElements = getElements(sibling);\n        var effectElements = getSiblingMaskElements(_this.context, sibling, 10);\n        if (effectElements && effectElements.length) {\n          _this.setElementsState(effectElements, enable, allElements);\n        } else {\n          _this.clearViewState(sibling);\n        }\n      });\n    }\n  };\n  ElementRangeState.prototype.setElementsState = function (elements, enable, allElements) {\n    var _this = this;\n    each(allElements, function (el) {\n      if (!elements.includes(el)) {\n        _this.setElementState(el, false);\n      } else {\n        _this.setElementState(el, enable);\n      }\n    });\n  };\n  /**\n   * 结束\n   */\n  ElementRangeState.prototype.end = function () {\n    this.isStarted = false;\n    this.endPoint = this.getCurrentPoint();\n  };\n  // 复写 clear\n  ElementRangeState.prototype.clear = function () {\n    var _this = this;\n    var view = this.context.view;\n    // 判断是否影响 siblings\n    if (this.effectSiblings) {\n      var siblings = getSilbings(view);\n      each(siblings, function (sibling) {\n        _this.clearViewState(sibling);\n      });\n    } else {\n      this.clearViewState(view);\n    }\n  };\n  return ElementRangeState;\n}(StateBase);\nexport default ElementRangeState;","map":{"version":3,"names":["each","getElements","getIntersectElements","getMaskedElements","getSiblingMaskElements","getSilbings","isInRecords","isMask","StateBase","ElementRangeState","_super","__extends","_this","apply","arguments","startPoint","endPoint","isStarted","effectSiblings","effectByRecord","prototype","getCurrentPoint","event","context","x","y","start","clear","elements","box","minX","Math","min","minY","maxX","max","maxY","view","setStateEnable","enable","setSiblingsState","allElements","length","setSiblingsStateByRecord","setElementsState","siblings","records","map","el","getModel","data","xFiled","getXScale","field","yField","getYScales","sibling","effectElements","filter","record","clearViewState","includes","setElementState","end"],"sources":["../../../../src/interaction/action/element/range-state.ts"],"sourcesContent":["import { each } from '@antv/util';\nimport Element from '../../../geometry/element/';\nimport {\n  getElements,\n  getIntersectElements,\n  getMaskedElements,\n  getSiblingMaskElements,\n  getSilbings,\n  isInRecords,\n  isMask,\n} from '../util';\nimport StateBase from './state-base';\n\n/**\n * @ignore\n * 区域设置状态的基础 Action\n */\nclass ElementRangeState extends StateBase {\n  private startPoint = null;\n  private endPoint = null;\n  private isStarted: boolean = false;\n  /**\n   * 是否作用于当前 view 的 siblings，默认是 false 仅作用于自己\n   */\n  protected effectSiblings = false;\n  /**\n   * 是否受 element 的数据影响，还是受包围盒的影响\n   */\n  protected effectByRecord = false;\n  // 获取当前的位置\n  private getCurrentPoint() {\n    const event = this.context.event;\n    return {\n      x: event.x,\n      y: event.y,\n    };\n  }\n\n  /**\n   * 开始，记录开始选中的位置\n   */\n  public start() {\n    this.clear(); // 开始的时候清理之前的状态\n    this.startPoint = this.getCurrentPoint();\n    this.isStarted = true;\n  }\n\n  protected getIntersectElements() {\n    let elements = null;\n    if (isMask(this.context)) {\n      elements = getMaskedElements(this.context, 10);\n    } else {\n      const startPoint = this.startPoint;\n      const endPoint = this.isStarted ? this.getCurrentPoint() : this.endPoint;\n      // 如果没有开始，则不允许范围设置状态，保护性质\n      if (!startPoint || !endPoint) {\n        return;\n      }\n      // 计算框选区域\n      const box = {\n        minX: Math.min(startPoint.x, endPoint.x),\n        minY: Math.min(startPoint.y, endPoint.y),\n        maxX: Math.max(startPoint.x, endPoint.x),\n        maxY: Math.max(startPoint.y, endPoint.y),\n      };\n      // this.clear(); // 不全部清理，会导致闪烁\n      const view = this.context.view;\n      elements = getIntersectElements(view, box);\n    }\n    return elements;\n  }\n  /**\n   * 选中\n   */\n  public setStateEnable(enable: boolean) {\n    if (this.effectSiblings && !this.effectByRecord) {\n      this.setSiblingsState(enable);\n    } else {\n      const allElements = getElements(this.context.view);\n      const elements = this.getIntersectElements();\n      if (elements && elements.length) {\n        if (this.effectByRecord) {\n          this.setSiblingsStateByRecord(elements, enable);\n        } else {\n          this.setElementsState(elements, enable, allElements);\n        }\n      } else {\n        this.clear();\n      }\n    }\n  }\n  // 根据选中的 element 的数据进行设置状态\n  private setSiblingsStateByRecord(elements, enable) {\n    const view = this.context.view;\n    const siblings = getSilbings(view);\n    const records = elements.map((el) => {\n      return el.getModel().data;\n    });\n    const xFiled = view.getXScale().field;\n    const yField = view.getYScales()[0].field;\n    each(siblings, (sibling) => {\n      const allElements = getElements(sibling);\n      const effectElements = allElements.filter((el) => {\n        const record = el.getModel().data;\n        return isInRecords(records, record, xFiled, yField);\n      });\n      this.setElementsState(effectElements, enable, allElements);\n    });\n  }\n\n  // 设置兄弟 view 的状态\n  private setSiblingsState(enable: boolean) {\n    const view = this.context.view;\n    const siblings = getSilbings(view);\n    if (isMask(this.context)) {\n      // 受 mask 影响\n      each(siblings, (sibling) => {\n        const allElements = getElements(sibling);\n        const effectElements = getSiblingMaskElements(this.context, sibling, 10);\n        if (effectElements && effectElements.length) {\n          this.setElementsState(effectElements, enable, allElements);\n        } else {\n          this.clearViewState(sibling);\n        }\n      });\n    }\n  }\n\n  protected setElementsState(elements: Element[], enable, allElements: Element[]) {\n    each(allElements, (el) => {\n      if (!elements.includes(el)) {\n        this.setElementState(el, false);\n      } else {\n        this.setElementState(el, enable);\n      }\n    });\n  }\n\n  /**\n   * 结束\n   */\n  public end() {\n    this.isStarted = false;\n    this.endPoint = this.getCurrentPoint();\n  }\n\n  // 复写 clear\n  public clear() {\n    const view = this.context.view;\n    // 判断是否影响 siblings\n    if (this.effectSiblings) {\n      const siblings = getSilbings(view);\n      each(siblings, (sibling) => {\n        this.clearViewState(sibling);\n      });\n    } else {\n      this.clearViewState(view);\n    }\n  }\n}\n\nexport default ElementRangeState;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
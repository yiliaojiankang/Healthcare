{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.slack = exports.longestPathWithLayer = exports.longestPath = void 0;\n/*\n * Initializes ranks for the input graph using the longest path algorithm. This\n * algorithm scales well and is fast in practice, it yields rather poor\n * solutions. Nodes are pushed to the lowest layer possible, leaving the bottom\n * ranks wide and leaving edges longer than necessary. However, due to its\n * speed, this algorithm is good for getting an initial ranking that can be fed\n * into other algorithms.\n *\n * This algorithm does not normalize layers because it will be used by other\n * algorithms in most cases. If using this algorithm directly, be sure to\n * run normalize at the end.\n *\n * Pre-conditions:\n *\n *    1. Input graph is a DAG.\n *    2. Input graph node labels can be assigned properties.\n *\n * Post-conditions:\n *\n *    1. Each node will be assign an (unnormalized) \"rank\" property.\n */\nvar longestPath = function (g) {\n  var _a;\n  var visited = {};\n  var dfs = function (v) {\n    var _a;\n    var label = g.node(v);\n    if (!label) return 0;\n    if (visited[v]) {\n      return label.rank;\n    }\n    visited[v] = true;\n    var rank;\n    (_a = g.outEdges(v)) === null || _a === void 0 ? void 0 : _a.forEach(function (edgeObj) {\n      var wRank = dfs(edgeObj.w);\n      var minLen = g.edge(edgeObj).minlen;\n      var r = wRank - minLen;\n      if (r) {\n        if (rank === undefined || r < rank) {\n          rank = r;\n        }\n      }\n    });\n    if (!rank) {\n      rank = 0;\n    }\n    label.rank = rank;\n    return rank;\n  };\n  (_a = g.sources()) === null || _a === void 0 ? void 0 : _a.forEach(function (source) {\n    return dfs(source);\n  });\n};\nexports.longestPath = longestPath;\nvar longestPathWithLayer = function (g) {\n  var _a;\n  // 用longest path，找出最深的点\n  var visited = {};\n  var minRank;\n  var dfs = function (v) {\n    var _a;\n    var label = g.node(v);\n    if (!label) return 0;\n    if (visited[v]) {\n      return label.rank;\n    }\n    visited[v] = true;\n    var rank;\n    (_a = g.outEdges(v)) === null || _a === void 0 ? void 0 : _a.forEach(function (edgeObj) {\n      var wRank = dfs(edgeObj.w);\n      var minLen = g.edge(edgeObj).minlen;\n      var r = wRank - minLen;\n      if (r) {\n        if (rank === undefined || r < rank) {\n          rank = r;\n        }\n      }\n    });\n    if (!rank) {\n      rank = 0;\n    }\n    if (minRank === undefined || rank < minRank) {\n      minRank = rank;\n    }\n    label.rank = rank;\n    return rank;\n  };\n  (_a = g.sources()) === null || _a === void 0 ? void 0 : _a.forEach(function (source) {\n    if (g.node(source)) dfs(source);\n  });\n  if (minRank === undefined) {\n    minRank = 0;\n  }\n  // minRank += 1; // NOTE: 最小的层级是dummy root，+1\n  // forward一遍，赋值层级\n  var forwardVisited = {};\n  var dfsForward = function (v, nextRank) {\n    var _a;\n    var label = g.node(v);\n    var currRank = !isNaN(label.layer) ? label.layer : nextRank;\n    // 没有指定，取最大值\n    if (label.rank === undefined || label.rank < currRank) {\n      label.rank = currRank;\n    }\n    if (forwardVisited[v]) return;\n    forwardVisited[v] = true;\n    // DFS遍历子节点\n    (_a = g.outEdges(v)) === null || _a === void 0 ? void 0 : _a.map(function (e) {\n      dfsForward(e.w, currRank + g.edge(e).minlen);\n    });\n  };\n  // 指定层级的，更新下游\n  g.nodes().forEach(function (n) {\n    var label = g.node(n);\n    if (!label) return;\n    if (!isNaN(label.layer)) {\n      dfsForward(n, label.layer); // 默认的dummy root所在层的rank是-1\n    } else {\n      label.rank -= minRank;\n    }\n  });\n};\nexports.longestPathWithLayer = longestPathWithLayer;\n/*\n * Returns the amount of slack for the given edge. The slack is defined as the\n * difference between the length of the edge and its minimum length.\n */\nvar slack = function (g, e) {\n  return g.node(e.w).rank - g.node(e.v).rank - g.edge(e).minlen;\n};\nexports.slack = slack;\nexports.default = {\n  longestPath: longestPath,\n  longestPathWithLayer: longestPathWithLayer,\n  slack: slack\n};","map":{"version":3,"names":["longestPath","g","visited","dfs","v","label","node","rank","_a","outEdges","forEach","edgeObj","wRank","w","minLen","edge","minlen","r","undefined","sources","source","exports","longestPathWithLayer","minRank","forwardVisited","dfsForward","nextRank","currRank","isNaN","layer","map","e","nodes","n","slack","default"],"sources":["../../../../../src/layout/dagre/src/rank/util.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
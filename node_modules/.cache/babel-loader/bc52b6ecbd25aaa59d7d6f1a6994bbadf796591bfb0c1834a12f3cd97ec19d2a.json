{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _get from \"@babel/runtime/helpers/esm/get\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport { DOM, lodashUtil } from '@antv/l7-utils';\nimport Popup from \"./popup\";\nvar get = lodashUtil.get;\nexport { LayerPopup };\nvar LayerPopup = /*#__PURE__*/function (_Popup) {\n  _inherits(LayerPopup, _Popup);\n  var _super = _createSuper(LayerPopup);\n  function LayerPopup() {\n    var _this;\n    _classCallCheck(this, LayerPopup);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    /**\n     * 用于统计当前帧当中，layer 被点击的次数\n     */\n    _defineProperty(_assertThisInitialized(_this), \"layerClickCountByFrame\", 0);\n    /**\n     * 用于保存图层对应的事件回调以及配置信息\n     * @protected\n     */\n    _defineProperty(_assertThisInitialized(_this), \"layerConfigMap\", new WeakMap());\n    _defineProperty(_assertThisInitialized(_this), \"onLayerClick\", function (layer, e) {\n      requestAnimationFrame(function () {\n        if (_this.popupOption.closeOnClick) {\n          _this.layerClickCountByFrame++;\n        }\n        if (_this.isShow && _this.isSameFeature(layer, e.featureId)) {\n          _this.hide();\n        } else {\n          var _this$getLayerInfoFra = _this.getLayerInfoFrag(layer, e),\n            title = _this$getLayerInfoFra.title,\n            content = _this$getLayerInfoFra.content;\n          _this.setDOMContent(content);\n          _this.setLnglat(e.lngLat);\n          _this.setTitle(title);\n          _this.setDisplayFeatureInfo({\n            layer: layer,\n            featureId: e.featureId\n          });\n          _this.show();\n        }\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSceneClick\", function () {\n      _this.layerClickCountByFrame = 0;\n      requestAnimationFrame(function () {\n        if (!_this.layerClickCountByFrame) {\n          _this.hide();\n        }\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onLayerHide\", function () {\n      _this.hide();\n      _this.setDisplayFeatureInfo(undefined);\n    });\n    /**\n     * 覆盖 Popup 中的默认的 closeOnClick 行为\n     */\n    // tslint:disable-next-line:no-empty\n    _defineProperty(_assertThisInitialized(_this), \"updateCloseOnClick\", function () {});\n    return _this;\n  }\n  _createClass(LayerPopup, [{\n    key: \"layerConfigItems\",\n    get:\n    /**\n     * 当期正在展示的图层以及对应元素 id 的信息\n     * @protected\n     */\n\n    function get() {\n      var _ref;\n      var _this$popupOption = this.popupOption,\n        config = _this$popupOption.config,\n        items = _this$popupOption.items;\n      return (_ref = config !== null && config !== void 0 ? config : items) !== null && _ref !== void 0 ? _ref : [];\n    }\n  }, {\n    key: \"addTo\",\n    value: function addTo(scene) {\n      _get(_getPrototypeOf(LayerPopup.prototype), \"addTo\", this).call(this, scene);\n      this.bindLayerEvent();\n      this.hide();\n      return this;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      _get(_getPrototypeOf(LayerPopup.prototype), \"remove\", this).call(this);\n      this.unbindLayerEvent();\n      return this;\n    }\n  }, {\n    key: \"setOptions\",\n    value: function setOptions(option) {\n      this.unbindLayerEvent();\n      var newOption = _objectSpread({}, option);\n      var trigger = newOption.trigger || this.popupOption.trigger;\n      var items = newOption.items || this.popupOption.items;\n      var isEmptyItems = (items === null || items === void 0 ? void 0 : items.length) === 0;\n      newOption.followCursor = trigger === 'hover' && !isEmptyItems;\n      _get(_getPrototypeOf(LayerPopup.prototype), \"setOptions\", this).call(this, newOption);\n      this.bindLayerEvent();\n      if (isEmptyItems) {\n        this.hide();\n      }\n      return this;\n    }\n  }, {\n    key: \"getDefault\",\n    value: function getDefault(option) {\n      var isHoverTrigger = option.trigger === 'hover';\n      return _objectSpread(_objectSpread({}, _get(_getPrototypeOf(LayerPopup.prototype), \"getDefault\", this).call(this, option)), {}, {\n        trigger: 'hover',\n        followCursor: isHoverTrigger,\n        lngLat: {\n          lng: 0,\n          lat: 0\n        },\n        offsets: [0, 10],\n        closeButton: false,\n        closeOnClick: true,\n        autoClose: false,\n        closeOnEsc: false\n      });\n    }\n\n    /**\n     * 绑定对应的图层事件\n     * @protected\n     */\n  }, {\n    key: \"bindLayerEvent\",\n    value: function bindLayerEvent() {\n      var _this2 = this;\n      var _this$popupOption2 = this.popupOption,\n        trigger = _this$popupOption2.trigger,\n        closeOnClick = _this$popupOption2.closeOnClick;\n      this.layerConfigItems.forEach(function (configItem) {\n        var _layer$getSource;\n        var layer = _this2.getLayerByConfig(configItem);\n        if (!layer) {\n          return;\n        }\n        var layerInfo = _objectSpread({}, configItem);\n        if (trigger === 'hover') {\n          var onMouseMove = _this2.onLayerMouseMove.bind(_this2, layer);\n          var onMouseOut = _this2.onLayerMouseOut.bind(_this2, layer);\n          layerInfo.onMouseMove = onMouseMove;\n          layerInfo.onMouseOut = onMouseOut;\n          layer === null || layer === void 0 || layer.on('mousemove', onMouseMove);\n          layer === null || layer === void 0 || layer.on('mouseout', onMouseOut);\n        } else {\n          var _this2$mapsService;\n          var onLayerClick = _this2.onLayerClick.bind(_this2, layer);\n          layerInfo.onClick = onLayerClick;\n          layer === null || layer === void 0 || layer.on('click', onLayerClick);\n          var mapContainer = (_this2$mapsService = _this2.mapsService) === null || _this2$mapsService === void 0 ? void 0 : _this2$mapsService.getMapContainer();\n          if (mapContainer && closeOnClick) {\n            mapContainer.addEventListener('click', _this2.onSceneClick);\n          }\n        }\n        var source = layer === null || layer === void 0 || (_layer$getSource = layer.getSource) === null || _layer$getSource === void 0 ? void 0 : _layer$getSource.call(layer);\n        var onSourceUpdate = _this2.onSourceUpdate.bind(_this2);\n        source === null || source === void 0 || source.on('update', onSourceUpdate);\n        layerInfo.onSourceUpdate = onSourceUpdate;\n        _this2.layerConfigMap.set(layer, layerInfo);\n      });\n    }\n\n    /**\n     * 解绑对应的图层事件\n     * @protected\n     */\n  }, {\n    key: \"unbindLayerEvent\",\n    value: function unbindLayerEvent() {\n      var _this3 = this;\n      this.layerConfigItems.forEach(function (configItem) {\n        var _this3$mapsService;\n        var layer = _this3.getLayerByConfig(configItem);\n        var layerInfo = layer && _this3.layerConfigMap.get(layer);\n        if (!layerInfo) {\n          return;\n        }\n        var onMouseMove = layerInfo.onMouseMove,\n          onMouseOut = layerInfo.onMouseOut,\n          onClick = layerInfo.onClick,\n          onSourceUpdate = layerInfo.onSourceUpdate;\n        if (onMouseMove) {\n          layer.off('mousemove', onMouseMove);\n        }\n        if (onMouseOut) {\n          layer.off('mouseout', onMouseOut);\n        }\n        if (onClick) {\n          layer.off('click', onClick);\n        }\n        if (onSourceUpdate) {\n          var _layer$getSource2;\n          layer === null || layer === void 0 || (_layer$getSource2 = layer.getSource()) === null || _layer$getSource2 === void 0 || _layer$getSource2.off('update', onSourceUpdate);\n        }\n        var mapContainer = (_this3$mapsService = _this3.mapsService) === null || _this3$mapsService === void 0 ? void 0 : _this3$mapsService.getMapContainer();\n        if (mapContainer) {\n          mapContainer.removeEventListener('click', _this3.onSceneClick);\n        }\n      });\n    }\n  }, {\n    key: \"onLayerMouseMove\",\n    value: function onLayerMouseMove(layer, e) {\n      if (!this.isSameFeature(layer, e.featureId)) {\n        var _this$getLayerInfoFra2 = this.getLayerInfoFrag(layer, e),\n          title = _this$getLayerInfoFra2.title,\n          content = _this$getLayerInfoFra2.content;\n        this.setDOMContent(content);\n        this.setTitle(title);\n        this.setDisplayFeatureInfo({\n          layer: layer,\n          featureId: e.featureId\n        });\n        this.show();\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  }, {\n    key: \"onLayerMouseOut\",\n    value: function onLayerMouseOut(layer, e) {\n      this.setDisplayFeatureInfo(undefined);\n      if (this.isShow) {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"onSourceUpdate\",\n    value: function onSourceUpdate() {\n      this.hide();\n      this.setDisplayFeatureInfo(undefined);\n    }\n\n    /**\n     * 通过当前图层和对应选中的元素获取气泡展示的 HTML 内容\n     * @param layer\n     * @param e\n     * @protected\n     */\n  }, {\n    key: \"getLayerInfoFrag\",\n    value: function getLayerInfoFrag(layer, e) {\n      var layerInfo = this.layerConfigMap.get(layer);\n      var titleFrag;\n      var contentFrag = document.createDocumentFragment();\n      if (layerInfo) {\n        var _feature = e.feature;\n        if (_feature.type === 'Feature' && 'properties' in _feature && 'geometry' in _feature) {\n          _feature = _feature.properties;\n        }\n        var title = layerInfo.title,\n          fields = layerInfo.fields,\n          customContent = layerInfo.customContent;\n        if (title) {\n          titleFrag = document.createDocumentFragment();\n          var titleElement = title instanceof Function ? title(_feature) : title;\n          DOM.appendElementType(titleFrag, titleElement);\n        }\n        if (customContent) {\n          var content = customContent instanceof Function ? customContent(_feature) : customContent;\n          DOM.appendElementType(contentFrag, content);\n        } else if (fields !== null && fields !== void 0 && fields.length) {\n          fields === null || fields === void 0 || fields.forEach(function (fieldConfig) {\n            var _ref3, _ref4;\n            var _ref2 = typeof fieldConfig === 'string' ?\n              // tslint:disable-next-line:no-object-literal-type-assertion\n              {\n                field: fieldConfig\n              } : fieldConfig,\n              field = _ref2.field,\n              formatField = _ref2.formatField,\n              formatValue = _ref2.formatValue,\n              getValue = _ref2.getValue;\n            var row = DOM.create('div', 'l7-layer-popup__row');\n            var value = getValue ? getValue(e.feature) : get(_feature, field);\n            var fieldElement = (_ref3 = formatField instanceof Function ? formatField(field, _feature) : formatField) !== null && _ref3 !== void 0 ? _ref3 : field;\n            var valueElement = (_ref4 = formatValue instanceof Function ? formatValue(value, _feature) : formatValue) !== null && _ref4 !== void 0 ? _ref4 : value;\n            var fieldSpan = DOM.create('span', 'l7-layer-popup__key', row);\n            DOM.appendElementType(fieldSpan, fieldElement);\n            DOM.appendElementType(fieldSpan, document.createTextNode('：'));\n            var valueSpan = DOM.create('span', 'l7-layer-popup__value', row);\n\n            // 当 value 中每项元素均为基础数据类型时，用逗号隔开\n            if (Array.isArray(valueElement) && valueElement.every(function (item) {\n              return !(item instanceof Object);\n            })) {\n              valueElement = valueElement.map(function (item) {\n                return String(item);\n              }).join(',');\n            }\n            DOM.appendElementType(valueSpan, valueElement);\n            contentFrag.appendChild(row);\n          });\n        }\n      }\n      return {\n        title: titleFrag,\n        content: contentFrag\n      };\n    }\n\n    /**\n     * 通过 Layer 配置访问到真实的 Layer 实例\n     * @param configItem\n     * @protected\n     */\n  }, {\n    key: \"getLayerByConfig\",\n    value: function getLayerByConfig(configItem) {\n      var layer = configItem.layer;\n      if (layer instanceof Object) {\n        return layer;\n      }\n      if (typeof layer === 'string') {\n        return this.layerService.getLayer(layer) || this.layerService.getLayerByName(layer);\n      }\n    }\n\n    /**\n     * 判断当前展示的 Feature 是否和上一次查看的一致\n     * @param layer\n     * @param featureId\n     * @protected\n     */\n  }, {\n    key: \"isSameFeature\",\n    value: function isSameFeature(layer, featureId) {\n      var displayFeatureInfo = this.displayFeatureInfo;\n      return displayFeatureInfo && layer === displayFeatureInfo.layer && featureId === displayFeatureInfo.featureId;\n    }\n  }, {\n    key: \"setDisplayFeatureInfo\",\n    value: function setDisplayFeatureInfo(displayFeatureInfo) {\n      var oldDisplayFeatureInfo = this.displayFeatureInfo;\n      if (oldDisplayFeatureInfo) {\n        oldDisplayFeatureInfo.layer.off('hide', this.onLayerHide);\n      }\n      if (displayFeatureInfo) {\n        displayFeatureInfo.layer.on('hide', this.onLayerHide);\n      }\n      this.displayFeatureInfo = displayFeatureInfo;\n    }\n  }]);\n  return LayerPopup;\n}(Popup);\nexport { LayerPopup as default };","map":{"version":3,"names":["_objectSpread","_classCallCheck","_createClass","_assertThisInitialized","_get","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","DOM","lodashUtil","Popup","get","LayerPopup","_Popup","_super","_this","_len","length","args","Array","_key","concat","WeakMap","layer","requestAnimationFrame","popupOption","closeOnClick","layerClickCountByFrame","isShow","isSameFeature","featureId","hide","_this$getLayerInfoFra","getLayerInfoFrag","title","content","setDOMContent","setLnglat","lngLat","setTitle","setDisplayFeatureInfo","show","undefined","key","_ref","_this$popupOption","config","items","value","addTo","scene","bindLayerEvent","remove","unbindLayerEvent","setOptions","option","newOption","trigger","isEmptyItems","followCursor","getDefault","isHoverTrigger","lng","lat","offsets","closeButton","autoClose","closeOnEsc","_this2","_this$popupOption2","layerConfigItems","forEach","configItem","_layer$getSource","getLayerByConfig","layerInfo","onMouseMove","onLayerMouseMove","bind","onMouseOut","onLayerMouseOut","on","_this2$mapsService","onLayerClick","onClick","mapContainer","mapsService","getMapContainer","addEventListener","onSceneClick","source","getSource","onSourceUpdate","layerConfigMap","set","_this3","_this3$mapsService","off","_layer$getSource2","removeEventListener","_this$getLayerInfoFra2","titleFrag","contentFrag","document","createDocumentFragment","_feature","feature","type","properties","fields","customContent","titleElement","Function","appendElementType","fieldConfig","_ref3","_ref4","_ref2","field","formatField","formatValue","getValue","row","create","fieldElement","valueElement","fieldSpan","createTextNode","valueSpan","isArray","every","item","Object","map","String","join","appendChild","layerService","getLayer","getLayerByName","displayFeatureInfo","oldDisplayFeatureInfo","onLayerHide","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-component/es/popup/layerPopup.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _get from \"@babel/runtime/helpers/esm/get\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { DOM, lodashUtil } from '@antv/l7-utils';\nimport Popup from \"./popup\";\nvar get = lodashUtil.get;\nexport { LayerPopup };\nvar LayerPopup = /*#__PURE__*/function (_Popup) {\n  _inherits(LayerPopup, _Popup);\n  var _super = _createSuper(LayerPopup);\n  function LayerPopup() {\n    var _this;\n    _classCallCheck(this, LayerPopup);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    /**\n     * 用于统计当前帧当中，layer 被点击的次数\n     */\n    _defineProperty(_assertThisInitialized(_this), \"layerClickCountByFrame\", 0);\n    /**\n     * 用于保存图层对应的事件回调以及配置信息\n     * @protected\n     */\n    _defineProperty(_assertThisInitialized(_this), \"layerConfigMap\", new WeakMap());\n    _defineProperty(_assertThisInitialized(_this), \"onLayerClick\", function (layer, e) {\n      requestAnimationFrame(function () {\n        if (_this.popupOption.closeOnClick) {\n          _this.layerClickCountByFrame++;\n        }\n        if (_this.isShow && _this.isSameFeature(layer, e.featureId)) {\n          _this.hide();\n        } else {\n          var _this$getLayerInfoFra = _this.getLayerInfoFrag(layer, e),\n            title = _this$getLayerInfoFra.title,\n            content = _this$getLayerInfoFra.content;\n          _this.setDOMContent(content);\n          _this.setLnglat(e.lngLat);\n          _this.setTitle(title);\n          _this.setDisplayFeatureInfo({\n            layer: layer,\n            featureId: e.featureId\n          });\n          _this.show();\n        }\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSceneClick\", function () {\n      _this.layerClickCountByFrame = 0;\n      requestAnimationFrame(function () {\n        if (!_this.layerClickCountByFrame) {\n          _this.hide();\n        }\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onLayerHide\", function () {\n      _this.hide();\n      _this.setDisplayFeatureInfo(undefined);\n    });\n    /**\n     * 覆盖 Popup 中的默认的 closeOnClick 行为\n     */\n    // tslint:disable-next-line:no-empty\n    _defineProperty(_assertThisInitialized(_this), \"updateCloseOnClick\", function () {});\n    return _this;\n  }\n  _createClass(LayerPopup, [{\n    key: \"layerConfigItems\",\n    get:\n    /**\n     * 当期正在展示的图层以及对应元素 id 的信息\n     * @protected\n     */\n\n    function get() {\n      var _ref;\n      var _this$popupOption = this.popupOption,\n        config = _this$popupOption.config,\n        items = _this$popupOption.items;\n      return (_ref = config !== null && config !== void 0 ? config : items) !== null && _ref !== void 0 ? _ref : [];\n    }\n  }, {\n    key: \"addTo\",\n    value: function addTo(scene) {\n      _get(_getPrototypeOf(LayerPopup.prototype), \"addTo\", this).call(this, scene);\n      this.bindLayerEvent();\n      this.hide();\n      return this;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      _get(_getPrototypeOf(LayerPopup.prototype), \"remove\", this).call(this);\n      this.unbindLayerEvent();\n      return this;\n    }\n  }, {\n    key: \"setOptions\",\n    value: function setOptions(option) {\n      this.unbindLayerEvent();\n      var newOption = _objectSpread({}, option);\n      var trigger = newOption.trigger || this.popupOption.trigger;\n      var items = newOption.items || this.popupOption.items;\n      var isEmptyItems = (items === null || items === void 0 ? void 0 : items.length) === 0;\n      newOption.followCursor = trigger === 'hover' && !isEmptyItems;\n      _get(_getPrototypeOf(LayerPopup.prototype), \"setOptions\", this).call(this, newOption);\n      this.bindLayerEvent();\n      if (isEmptyItems) {\n        this.hide();\n      }\n      return this;\n    }\n  }, {\n    key: \"getDefault\",\n    value: function getDefault(option) {\n      var isHoverTrigger = option.trigger === 'hover';\n      return _objectSpread(_objectSpread({}, _get(_getPrototypeOf(LayerPopup.prototype), \"getDefault\", this).call(this, option)), {}, {\n        trigger: 'hover',\n        followCursor: isHoverTrigger,\n        lngLat: {\n          lng: 0,\n          lat: 0\n        },\n        offsets: [0, 10],\n        closeButton: false,\n        closeOnClick: true,\n        autoClose: false,\n        closeOnEsc: false\n      });\n    }\n\n    /**\n     * 绑定对应的图层事件\n     * @protected\n     */\n  }, {\n    key: \"bindLayerEvent\",\n    value: function bindLayerEvent() {\n      var _this2 = this;\n      var _this$popupOption2 = this.popupOption,\n        trigger = _this$popupOption2.trigger,\n        closeOnClick = _this$popupOption2.closeOnClick;\n      this.layerConfigItems.forEach(function (configItem) {\n        var _layer$getSource;\n        var layer = _this2.getLayerByConfig(configItem);\n        if (!layer) {\n          return;\n        }\n        var layerInfo = _objectSpread({}, configItem);\n        if (trigger === 'hover') {\n          var onMouseMove = _this2.onLayerMouseMove.bind(_this2, layer);\n          var onMouseOut = _this2.onLayerMouseOut.bind(_this2, layer);\n          layerInfo.onMouseMove = onMouseMove;\n          layerInfo.onMouseOut = onMouseOut;\n          layer === null || layer === void 0 || layer.on('mousemove', onMouseMove);\n          layer === null || layer === void 0 || layer.on('mouseout', onMouseOut);\n        } else {\n          var _this2$mapsService;\n          var onLayerClick = _this2.onLayerClick.bind(_this2, layer);\n          layerInfo.onClick = onLayerClick;\n          layer === null || layer === void 0 || layer.on('click', onLayerClick);\n          var mapContainer = (_this2$mapsService = _this2.mapsService) === null || _this2$mapsService === void 0 ? void 0 : _this2$mapsService.getMapContainer();\n          if (mapContainer && closeOnClick) {\n            mapContainer.addEventListener('click', _this2.onSceneClick);\n          }\n        }\n        var source = layer === null || layer === void 0 || (_layer$getSource = layer.getSource) === null || _layer$getSource === void 0 ? void 0 : _layer$getSource.call(layer);\n        var onSourceUpdate = _this2.onSourceUpdate.bind(_this2);\n        source === null || source === void 0 || source.on('update', onSourceUpdate);\n        layerInfo.onSourceUpdate = onSourceUpdate;\n        _this2.layerConfigMap.set(layer, layerInfo);\n      });\n    }\n\n    /**\n     * 解绑对应的图层事件\n     * @protected\n     */\n  }, {\n    key: \"unbindLayerEvent\",\n    value: function unbindLayerEvent() {\n      var _this3 = this;\n      this.layerConfigItems.forEach(function (configItem) {\n        var _this3$mapsService;\n        var layer = _this3.getLayerByConfig(configItem);\n        var layerInfo = layer && _this3.layerConfigMap.get(layer);\n        if (!layerInfo) {\n          return;\n        }\n        var onMouseMove = layerInfo.onMouseMove,\n          onMouseOut = layerInfo.onMouseOut,\n          onClick = layerInfo.onClick,\n          onSourceUpdate = layerInfo.onSourceUpdate;\n        if (onMouseMove) {\n          layer.off('mousemove', onMouseMove);\n        }\n        if (onMouseOut) {\n          layer.off('mouseout', onMouseOut);\n        }\n        if (onClick) {\n          layer.off('click', onClick);\n        }\n        if (onSourceUpdate) {\n          var _layer$getSource2;\n          layer === null || layer === void 0 || (_layer$getSource2 = layer.getSource()) === null || _layer$getSource2 === void 0 || _layer$getSource2.off('update', onSourceUpdate);\n        }\n        var mapContainer = (_this3$mapsService = _this3.mapsService) === null || _this3$mapsService === void 0 ? void 0 : _this3$mapsService.getMapContainer();\n        if (mapContainer) {\n          mapContainer.removeEventListener('click', _this3.onSceneClick);\n        }\n      });\n    }\n  }, {\n    key: \"onLayerMouseMove\",\n    value: function onLayerMouseMove(layer, e) {\n      if (!this.isSameFeature(layer, e.featureId)) {\n        var _this$getLayerInfoFra2 = this.getLayerInfoFrag(layer, e),\n          title = _this$getLayerInfoFra2.title,\n          content = _this$getLayerInfoFra2.content;\n        this.setDOMContent(content);\n        this.setTitle(title);\n        this.setDisplayFeatureInfo({\n          layer: layer,\n          featureId: e.featureId\n        });\n        this.show();\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  }, {\n    key: \"onLayerMouseOut\",\n    value: function onLayerMouseOut(layer, e) {\n      this.setDisplayFeatureInfo(undefined);\n      if (this.isShow) {\n        this.hide();\n      }\n    }\n  }, {\n    key: \"onSourceUpdate\",\n    value: function onSourceUpdate() {\n      this.hide();\n      this.setDisplayFeatureInfo(undefined);\n    }\n\n    /**\n     * 通过当前图层和对应选中的元素获取气泡展示的 HTML 内容\n     * @param layer\n     * @param e\n     * @protected\n     */\n  }, {\n    key: \"getLayerInfoFrag\",\n    value: function getLayerInfoFrag(layer, e) {\n      var layerInfo = this.layerConfigMap.get(layer);\n      var titleFrag;\n      var contentFrag = document.createDocumentFragment();\n      if (layerInfo) {\n        var _feature = e.feature;\n        if (_feature.type === 'Feature' && 'properties' in _feature && 'geometry' in _feature) {\n          _feature = _feature.properties;\n        }\n        var title = layerInfo.title,\n          fields = layerInfo.fields,\n          customContent = layerInfo.customContent;\n        if (title) {\n          titleFrag = document.createDocumentFragment();\n          var titleElement = title instanceof Function ? title(_feature) : title;\n          DOM.appendElementType(titleFrag, titleElement);\n        }\n        if (customContent) {\n          var content = customContent instanceof Function ? customContent(_feature) : customContent;\n          DOM.appendElementType(contentFrag, content);\n        } else if (fields !== null && fields !== void 0 && fields.length) {\n          fields === null || fields === void 0 || fields.forEach(function (fieldConfig) {\n            var _ref3, _ref4;\n            var _ref2 = typeof fieldConfig === 'string' ?\n              // tslint:disable-next-line:no-object-literal-type-assertion\n              {\n                field: fieldConfig\n              } : fieldConfig,\n              field = _ref2.field,\n              formatField = _ref2.formatField,\n              formatValue = _ref2.formatValue,\n              getValue = _ref2.getValue;\n            var row = DOM.create('div', 'l7-layer-popup__row');\n            var value = getValue ? getValue(e.feature) : get(_feature, field);\n            var fieldElement = (_ref3 = formatField instanceof Function ? formatField(field, _feature) : formatField) !== null && _ref3 !== void 0 ? _ref3 : field;\n            var valueElement = (_ref4 = formatValue instanceof Function ? formatValue(value, _feature) : formatValue) !== null && _ref4 !== void 0 ? _ref4 : value;\n            var fieldSpan = DOM.create('span', 'l7-layer-popup__key', row);\n            DOM.appendElementType(fieldSpan, fieldElement);\n            DOM.appendElementType(fieldSpan, document.createTextNode('：'));\n            var valueSpan = DOM.create('span', 'l7-layer-popup__value', row);\n\n            // 当 value 中每项元素均为基础数据类型时，用逗号隔开\n            if (Array.isArray(valueElement) && valueElement.every(function (item) {\n              return !(item instanceof Object);\n            })) {\n              valueElement = valueElement.map(function (item) {\n                return String(item);\n              }).join(',');\n            }\n            DOM.appendElementType(valueSpan, valueElement);\n            contentFrag.appendChild(row);\n          });\n        }\n      }\n      return {\n        title: titleFrag,\n        content: contentFrag\n      };\n    }\n\n    /**\n     * 通过 Layer 配置访问到真实的 Layer 实例\n     * @param configItem\n     * @protected\n     */\n  }, {\n    key: \"getLayerByConfig\",\n    value: function getLayerByConfig(configItem) {\n      var layer = configItem.layer;\n      if (layer instanceof Object) {\n        return layer;\n      }\n      if (typeof layer === 'string') {\n        return this.layerService.getLayer(layer) || this.layerService.getLayerByName(layer);\n      }\n    }\n\n    /**\n     * 判断当前展示的 Feature 是否和上一次查看的一致\n     * @param layer\n     * @param featureId\n     * @protected\n     */\n  }, {\n    key: \"isSameFeature\",\n    value: function isSameFeature(layer, featureId) {\n      var displayFeatureInfo = this.displayFeatureInfo;\n      return displayFeatureInfo && layer === displayFeatureInfo.layer && featureId === displayFeatureInfo.featureId;\n    }\n  }, {\n    key: \"setDisplayFeatureInfo\",\n    value: function setDisplayFeatureInfo(displayFeatureInfo) {\n      var oldDisplayFeatureInfo = this.displayFeatureInfo;\n      if (oldDisplayFeatureInfo) {\n        oldDisplayFeatureInfo.layer.off('hide', this.onLayerHide);\n      }\n      if (displayFeatureInfo) {\n        displayFeatureInfo.layer.on('hide', this.onLayerHide);\n      }\n      this.displayFeatureInfo = displayFeatureInfo;\n    }\n  }]);\n  return LayerPopup;\n}(Popup);\nexport { LayerPopup as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
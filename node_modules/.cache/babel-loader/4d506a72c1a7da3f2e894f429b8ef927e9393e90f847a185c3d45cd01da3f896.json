{"ast":null,"code":"\"use strict\";\n\n/**\n * @fileOverview dagre layout\n * @author shiwu.wyy@antfin.com\n */\nrequire(\"core-js/modules/es.array.push.js\");\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DagreLayout = void 0;\nvar index_1 = __importDefault(require(\"./dagre/index\"));\nvar util_1 = require(\"../util\");\nvar base_1 = require(\"./base\");\nvar graph_1 = require(\"./dagre/graph\");\n/**\n * 层次布局\n */\nvar DagreLayout = /** @class */function (_super) {\n  __extends(DagreLayout, _super);\n  function DagreLayout(options) {\n    var _this = _super.call(this) || this;\n    /** layout 方向, 可选 TB, BT, LR, RL */\n    _this.rankdir = 'TB';\n    /** 节点水平间距(px) */\n    _this.nodesep = 50;\n    /** 每一层节点之间间距 */\n    _this.ranksep = 50;\n    /** 是否保留布局连线的控制点 */\n    _this.controlPoints = false;\n    /** 每层节点是否根据节点数据中的 comboId 进行排序，以防止同层 combo 重叠 */\n    _this.sortByCombo = false;\n    /** 是否保留每条边上的dummy node */\n    _this.edgeLabelSpace = true;\n    /** 是否基于 dagre 进行辐射布局，若是，第一层节点将被放置在最内环上，其余层依次向外辐射 */\n    _this.radial = false;\n    _this.nodes = [];\n    _this.edges = [];\n    /** 迭代结束的回调函数 */\n    _this.onLayoutEnd = function () {};\n    _this.layoutNode = function (nodeId) {\n      var self = _this;\n      var nodes = self.nodes;\n      var node = nodes.find(function (node) {\n        return node.id === nodeId;\n      });\n      if (node) {\n        var layout = node.layout !== false;\n        return layout;\n      }\n      return true;\n    };\n    _this.updateCfg(options);\n    return _this;\n  }\n  DagreLayout.prototype.getDefaultCfg = function () {\n    return {\n      rankdir: 'TB',\n      align: undefined,\n      nodeSize: undefined,\n      nodesepFunc: undefined,\n      ranksepFunc: undefined,\n      nodesep: 50,\n      ranksep: 50,\n      controlPoints: false,\n      radial: false,\n      focusNode: null // radial 为 true 时生效，关注的节点\n    };\n  };\n  /**\n   * 执行布局\n   */\n  DagreLayout.prototype.execute = function () {\n    var _this = this;\n    var _a, _b, _c, _d;\n    var self = this;\n    var nodes = self.nodes,\n      nodeSize = self.nodeSize,\n      rankdir = self.rankdir,\n      combos = self.combos,\n      begin = self.begin,\n      radial = self.radial,\n      _e = self.comboEdges,\n      comboEdges = _e === void 0 ? [] : _e,\n      _f = self.vedges,\n      vedges = _f === void 0 ? [] : _f;\n    if (!nodes) return;\n    var edges = self.edges || [];\n    var g = new graph_1.Graph({\n      multigraph: true,\n      compound: true\n    });\n    // collect the nodes in their combo, to create virtual edges for comboEdges\n    self.nodeMap = {};\n    var nodeComboMap = {};\n    nodes.forEach(function (node) {\n      self.nodeMap[node.id] = node;\n      if (!node.comboId) return;\n      nodeComboMap[node.comboId] = nodeComboMap[node.comboId] || [];\n      nodeComboMap[node.comboId].push(node.id);\n    });\n    var sortedNodes = [];\n    var visitedMap = {};\n    if ((_a = self.nodeOrder) === null || _a === void 0 ? void 0 : _a.length) {\n      self.nodeOrder.forEach(function (id) {\n        visitedMap[id] = true;\n        sortedNodes.push(self.nodeMap[id]);\n      });\n      nodes.forEach(function (node) {\n        if (!visitedMap[node.id]) sortedNodes.push(node);\n      });\n    } else {\n      sortedNodes = nodes;\n    }\n    var nodeSizeFunc;\n    if (!nodeSize) {\n      nodeSizeFunc = function (d) {\n        if (d.size) {\n          if ((0, util_1.isArray)(d.size)) {\n            return d.size;\n          }\n          if ((0, util_1.isObject)(d.size)) {\n            return [d.size.width || 40, d.size.height || 40];\n          }\n          return [d.size, d.size];\n        }\n        return [40, 40];\n      };\n    } else if ((0, util_1.isArray)(nodeSize)) {\n      nodeSizeFunc = function () {\n        return nodeSize;\n      };\n    } else {\n      nodeSizeFunc = function () {\n        return [nodeSize, nodeSize];\n      };\n    }\n    var ranksepfunc = (0, util_1.getFunc)(self.ranksep, 50, self.ranksepFunc);\n    var nodesepfunc = (0, util_1.getFunc)(self.nodesep, 50, self.nodesepFunc);\n    var horisep = nodesepfunc;\n    var vertisep = ranksepfunc;\n    if (rankdir === 'LR' || rankdir === 'RL') {\n      horisep = ranksepfunc;\n      vertisep = nodesepfunc;\n    }\n    g.setDefaultEdgeLabel(function () {\n      return {};\n    });\n    g.setGraph(self);\n    var comboMap = {};\n    if (this.sortByCombo && combos) {\n      combos.forEach(function (combo) {\n        comboMap[combo.id] = combo;\n        // regard the collapsed combo as a node\n        if (combo.collapsed) {\n          var size = nodeSizeFunc(combo);\n          var verti = vertisep(combo);\n          var hori = horisep(combo);\n          var width = size[0] + 2 * hori;\n          var height = size[1] + 2 * verti;\n          g.setNode(combo.id, {\n            width: width,\n            height: height\n          });\n        }\n        if (!combo.parentId) return;\n        if (!comboMap[combo.parentId]) {\n          g.setNode(combo.parentId, {});\n        }\n        g.setParent(combo.id, combo.parentId);\n      });\n    }\n    sortedNodes.filter(function (node) {\n      return node.layout !== false;\n    }).forEach(function (node) {\n      var size = nodeSizeFunc(node);\n      var verti = vertisep(node);\n      var hori = horisep(node);\n      var width = size[0] + 2 * hori;\n      var height = size[1] + 2 * verti;\n      var layer = node.layer;\n      if ((0, util_1.isNumber)(layer)) {\n        // 如果有layer属性，加入到node的label中\n        g.setNode(node.id, {\n          width: width,\n          height: height,\n          layer: layer\n        });\n      } else {\n        g.setNode(node.id, {\n          width: width,\n          height: height\n        });\n      }\n      if (_this.sortByCombo && node.comboId) {\n        if (!comboMap[node.comboId]) {\n          comboMap[node.comboId] = {\n            id: node.comboId\n          };\n          g.setNode(node.comboId, {});\n        }\n        g.setParent(node.id, node.comboId);\n      }\n    });\n    edges.forEach(function (edge) {\n      // dagrejs Wiki https://github.com/dagrejs/dagre/wiki#configuring-the-layout\n      var source = (0, util_1.getEdgeTerminal)(edge, 'source');\n      var target = (0, util_1.getEdgeTerminal)(edge, 'target');\n      if (_this.layoutNode(source) && _this.layoutNode(target)) {\n        g.setEdge(source, target, {\n          weight: edge.weight || 1\n        });\n      }\n    });\n    // create virtual edges from node to node for comboEdges\n    (_b = comboEdges === null || comboEdges === void 0 ? void 0 : comboEdges.concat(vedges || [])) === null || _b === void 0 ? void 0 : _b.forEach(function (comboEdge) {\n      var _a, _b;\n      var source = comboEdge.source,\n        target = comboEdge.target;\n      var sources = ((_a = comboMap[source]) === null || _a === void 0 ? void 0 : _a.collapsed) ? [source] : nodeComboMap[source] || [source];\n      var targets = ((_b = comboMap[target]) === null || _b === void 0 ? void 0 : _b.collapsed) ? [target] : nodeComboMap[target] || [target];\n      sources.forEach(function (s) {\n        targets.forEach(function (t) {\n          g.setEdge(s, t, {\n            weight: comboEdge.weight || 1\n          });\n        });\n      });\n    });\n    // 考虑增量图中的原始图\n    var prevGraph = undefined;\n    if ((_c = self.preset) === null || _c === void 0 ? void 0 : _c.nodes) {\n      prevGraph = new graph_1.Graph({\n        multigraph: true,\n        compound: true\n      });\n      self.preset.nodes.forEach(function (node) {\n        prevGraph === null || prevGraph === void 0 ? void 0 : prevGraph.setNode(node.id, node);\n      });\n    }\n    index_1.default.layout(g, {\n      prevGraph: prevGraph,\n      edgeLabelSpace: self.edgeLabelSpace,\n      keepNodeOrder: Boolean(!!self.nodeOrder),\n      nodeOrder: self.nodeOrder\n    });\n    var dBegin = [0, 0];\n    if (begin) {\n      var minX_1 = Infinity;\n      var minY_1 = Infinity;\n      g.nodes().forEach(function (node) {\n        var coord = g.node(node);\n        if (minX_1 > coord.x) minX_1 = coord.x;\n        if (minY_1 > coord.y) minY_1 = coord.y;\n      });\n      g.edges().forEach(function (edge) {\n        var _a;\n        var coord = g.edge(edge);\n        (_a = coord.points) === null || _a === void 0 ? void 0 : _a.forEach(function (point) {\n          if (minX_1 > point.x) minX_1 = point.x;\n          if (minY_1 > point.y) minY_1 = point.y;\n        });\n      });\n      dBegin[0] = begin[0] - minX_1;\n      dBegin[1] = begin[1] - minY_1;\n    }\n    var isHorizontal = rankdir === 'LR' || rankdir === 'RL';\n    // 变形为辐射\n    if (radial) {\n      var _g = this,\n        focusNode = _g.focusNode,\n        ranksep = _g.ranksep,\n        getRadialPos_1 = _g.getRadialPos;\n      var focusId = (0, util_1.isString)(focusNode) ? focusNode : focusNode === null || focusNode === void 0 ? void 0 : focusNode.id;\n      var focusLayer_1 = focusId ? (_d = g.node(focusId)) === null || _d === void 0 ? void 0 : _d._rank : 0;\n      var layers_1 = [];\n      var dim_1 = isHorizontal ? 'y' : 'x';\n      var sizeDim_1 = isHorizontal ? 'height' : 'width';\n      // 找到整个图作为环的坐标维度（dim）的最大、最小值，考虑节点宽度\n      var min_1 = Infinity;\n      var max_1 = -Infinity;\n      g.nodes().forEach(function (node) {\n        var coord = g.node(node);\n        if (!self.nodeMap[node]) return;\n        var currentNodesep = nodesepfunc(self.nodeMap[node]);\n        if (focusLayer_1 === 0) {\n          if (!layers_1[coord._rank]) {\n            layers_1[coord._rank] = {\n              nodes: [],\n              totalWidth: 0,\n              maxSize: -Infinity\n            };\n          }\n          layers_1[coord._rank].nodes.push(node);\n          layers_1[coord._rank].totalWidth += currentNodesep * 2 + coord[sizeDim_1];\n          if (layers_1[coord._rank].maxSize < Math.max(coord.width, coord.height)) {\n            layers_1[coord._rank].maxSize = Math.max(coord.width, coord.height);\n          }\n        } else {\n          var diffLayer = coord._rank - focusLayer_1;\n          if (diffLayer === 0) {\n            if (!layers_1[diffLayer]) {\n              layers_1[diffLayer] = {\n                nodes: [],\n                totalWidth: 0,\n                maxSize: -Infinity\n              };\n            }\n            layers_1[diffLayer].nodes.push(node);\n            layers_1[diffLayer].totalWidth += currentNodesep * 2 + coord[sizeDim_1];\n            if (layers_1[diffLayer].maxSize < Math.max(coord.width, coord.height)) {\n              layers_1[diffLayer].maxSize = Math.max(coord.width, coord.height);\n            }\n          } else {\n            var diffLayerAbs = Math.abs(diffLayer);\n            if (!layers_1[diffLayerAbs]) {\n              layers_1[diffLayerAbs] = {\n                left: [],\n                right: [],\n                totalWidth: 0,\n                maxSize: -Infinity\n              };\n            }\n            layers_1[diffLayerAbs].totalWidth += currentNodesep * 2 + coord[sizeDim_1];\n            if (layers_1[diffLayerAbs].maxSize < Math.max(coord.width, coord.height)) {\n              layers_1[diffLayerAbs].maxSize = Math.max(coord.width, coord.height);\n            }\n            if (diffLayer < 0) {\n              layers_1[diffLayerAbs].left.push(node);\n            } else {\n              layers_1[diffLayerAbs].right.push(node);\n            }\n          }\n        }\n        var leftPos = coord[dim_1] - coord[sizeDim_1] / 2 - currentNodesep;\n        var rightPos = coord[dim_1] + coord[sizeDim_1] / 2 + currentNodesep;\n        if (leftPos < min_1) min_1 = leftPos;\n        if (rightPos > max_1) max_1 = rightPos;\n      });\n      // const padding = (max - min) * 0.1; // TODO\n      // \b初始化为第一圈的半径，后面根据每层 ranksep 叠加\n      var radius_1 = ranksep || 50; // TODO;\n      var radiusMap_1 = {};\n      // 扩大最大最小值范围，以便为环上留出接缝处的空隙\n      var rangeLength_1 = (max_1 - min_1) / 0.9;\n      var range_1 = [(min_1 + max_1 - rangeLength_1) * 0.5, (min_1 + max_1 + rangeLength_1) * 0.5];\n      // 根据半径、分布比例，计算节点在环上的位置，并返回该组节点中最大的 ranksep 值\n      var processNodes_1 = function (layerNodes, radius, propsMaxRanksep, arcRange) {\n        if (propsMaxRanksep === void 0) {\n          propsMaxRanksep = -Infinity;\n        }\n        if (arcRange === void 0) {\n          arcRange = [0, 1];\n        }\n        var maxRanksep = propsMaxRanksep;\n        layerNodes.forEach(function (node) {\n          var coord = g.node(node);\n          radiusMap_1[node] = radius;\n          // 获取变形为 radial 后的直角坐标系坐标\n          var _a = getRadialPos_1(coord[dim_1], range_1, rangeLength_1, radius, arcRange),\n            newX = _a.x,\n            newY = _a.y;\n          // 将新坐标写入源数据\n          if (!self.nodeMap[node]) return;\n          self.nodeMap[node].x = newX + dBegin[0];\n          self.nodeMap[node].y = newY + dBegin[1];\n          // @ts-ignore: pass layer order to data for increment layout use\n          self.nodeMap[node]._order = coord._order;\n          // 找到本层最大的一个 ranksep，作为下一层与本层的间隙，叠加到下一层的半径上\n          var currentNodeRanksep = ranksepfunc(self.nodeMap[node]);\n          if (maxRanksep < currentNodeRanksep) maxRanksep = currentNodeRanksep;\n        });\n        return maxRanksep;\n      };\n      var isFirstLevel_1 = true;\n      var lastLayerMaxNodeSize_1 = 0;\n      layers_1.forEach(function (layerNodes) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        if (!((_a = layerNodes === null || layerNodes === void 0 ? void 0 : layerNodes.nodes) === null || _a === void 0 ? void 0 : _a.length) && !((_b = layerNodes === null || layerNodes === void 0 ? void 0 : layerNodes.left) === null || _b === void 0 ? void 0 : _b.length) && !((_c = layerNodes === null || layerNodes === void 0 ? void 0 : layerNodes.right) === null || _c === void 0 ? void 0 : _c.length)) {\n          return;\n        }\n        // 第一层只有一个节点，直接放在圆心，初始半径设定为 0\n        if (isFirstLevel_1 && layerNodes.nodes.length === 1) {\n          // 将新坐标写入源数据\n          var nodeId = layerNodes.nodes[0];\n          if (!self.nodeMap[nodeId]) return;\n          self.nodeMap[nodeId].x = dBegin[0];\n          self.nodeMap[nodeId].y = dBegin[1];\n          radiusMap_1[layerNodes.nodes[0]] = 0;\n          radius_1 = ranksepfunc(self.nodeMap[nodeId]);\n          isFirstLevel_1 = false;\n          return;\n        }\n        // 为接缝留出空隙，半径也需要扩大\n        radius_1 = Math.max(radius_1, layerNodes.totalWidth / (2 * Math.PI)); // / 0.9;\n        var maxRanksep = -Infinity;\n        if (focusLayer_1 === 0 || ((_d = layerNodes.nodes) === null || _d === void 0 ? void 0 : _d.length)) {\n          maxRanksep = processNodes_1(layerNodes.nodes, radius_1, maxRanksep, [0, 1]); // 0.8\n        } else {\n          var leftRatio = ((_e = layerNodes.left) === null || _e === void 0 ? void 0 : _e.length) / (((_f = layerNodes.left) === null || _f === void 0 ? void 0 : _f.length) + ((_g = layerNodes.right) === null || _g === void 0 ? void 0 : _g.length));\n          maxRanksep = processNodes_1(layerNodes.left, radius_1, maxRanksep, [0, leftRatio]); // 接缝留出 0.05 的缝隙\n          maxRanksep = processNodes_1(layerNodes.right, radius_1, maxRanksep, [leftRatio + 0.05, 1]); // 接缝留出 0.05 的缝隙\n        }\n\n        radius_1 += maxRanksep;\n        isFirstLevel_1 = false;\n        lastLayerMaxNodeSize_1 - layerNodes.maxSize;\n      });\n      g.edges().forEach(function (edge) {\n        var _a, _b, _c;\n        var coord = g.edge(edge);\n        var i = edges.findIndex(function (it) {\n          var source = (0, util_1.getEdgeTerminal)(it, 'source');\n          var target = (0, util_1.getEdgeTerminal)(it, 'target');\n          return source === edge.v && target === edge.w;\n        });\n        if (i <= -1) return;\n        if (self.edgeLabelSpace && self.controlPoints && edges[i].type !== 'loop') {\n          var otherDim_1 = dim_1 === 'x' ? 'y' : 'x';\n          var controlPoints = (_a = coord === null || coord === void 0 ? void 0 : coord.points) === null || _a === void 0 ? void 0 : _a.slice(1, coord.points.length - 1);\n          var newControlPoints_1 = [];\n          var sourceOtherDimValue_1 = (_b = g.node(edge.v)) === null || _b === void 0 ? void 0 : _b[otherDim_1];\n          var otherDimDist_1 = sourceOtherDimValue_1 - ((_c = g.node(edge.w)) === null || _c === void 0 ? void 0 : _c[otherDim_1]);\n          var sourceRadius_1 = radiusMap_1[edge.v];\n          var radiusDist_1 = sourceRadius_1 - radiusMap_1[edge.w];\n          controlPoints === null || controlPoints === void 0 ? void 0 : controlPoints.forEach(function (point) {\n            // 根据该边的起点、终点半径，及起点、终点、控制点位置关系，确定该控制点的半径\n            var cRadius = (point[otherDim_1] - sourceOtherDimValue_1) / otherDimDist_1 * radiusDist_1 + sourceRadius_1;\n            // 获取变形为 radial 后的直角坐标系坐标\n            var newPos = getRadialPos_1(point[dim_1], range_1, rangeLength_1, cRadius);\n            newControlPoints_1.push({\n              x: newPos.x + dBegin[0],\n              y: newPos.y + dBegin[1]\n            });\n          });\n          edges[i].controlPoints = newControlPoints_1;\n        }\n      });\n    } else {\n      var layerCoords_1 = new Set();\n      var isInvert = rankdir === 'BT' || rankdir === 'RL';\n      var layerCoordSort = isInvert ? function (a, b) {\n        return b - a;\n      } : function (a, b) {\n        return a - b;\n      };\n      g.nodes().forEach(function (node) {\n        var coord = g.node(node);\n        if (!coord) return;\n        var ndata = _this.nodeMap[node];\n        if (!ndata) {\n          ndata = combos === null || combos === void 0 ? void 0 : combos.find(function (it) {\n            return it.id === node;\n          });\n        }\n        if (!ndata) return;\n        ndata.x = coord.x + dBegin[0];\n        ndata.y = coord.y + dBegin[1];\n        // @ts-ignore: pass layer order to data for increment layout use\n        ndata._order = coord._order;\n        layerCoords_1.add(isHorizontal ? ndata.x : ndata.y);\n      });\n      var layerCoordsArr_1 = Array.from(layerCoords_1).sort(layerCoordSort);\n      // pre-define the isHorizontal related functions to avoid redundant calc in interations\n      var isDifferentLayer_1 = isHorizontal ? function (point1, point2) {\n        return point1.x !== point2.x;\n      } : function (point1, point2) {\n        return point1.y !== point2.y;\n      };\n      var filterControlPointsOutOfBoundary_1 = isHorizontal ? function (ps, point1, point2) {\n        var max = Math.max(point1.y, point2.y);\n        var min = Math.min(point1.y, point2.y);\n        return ps.filter(function (point) {\n          return point.y <= max && point.y >= min;\n        });\n      } : function (ps, point1, point2) {\n        var max = Math.max(point1.x, point2.x);\n        var min = Math.min(point1.x, point2.x);\n        return ps.filter(function (point) {\n          return point.x <= max && point.x >= min;\n        });\n      };\n      g.edges().forEach(function (edge) {\n        var _a;\n        var coord = g.edge(edge);\n        var i = edges.findIndex(function (it) {\n          var source = (0, util_1.getEdgeTerminal)(it, 'source');\n          var target = (0, util_1.getEdgeTerminal)(it, 'target');\n          return source === edge.v && target === edge.w;\n        });\n        if (i <= -1) return;\n        if (self.edgeLabelSpace && self.controlPoints && edges[i].type !== 'loop') {\n          (_a = coord === null || coord === void 0 ? void 0 : coord.points) === null || _a === void 0 ? void 0 : _a.forEach(function (point) {\n            point.x += dBegin[0];\n            point.y += dBegin[1];\n          });\n          var sourceNode = self.nodeMap[edge.v];\n          var targetNode = self.nodeMap[edge.w];\n          edges[i].controlPoints = getControlPoints(coord === null || coord === void 0 ? void 0 : coord.points, sourceNode, targetNode, layerCoordsArr_1, isHorizontal, isDifferentLayer_1, filterControlPointsOutOfBoundary_1);\n        }\n      });\n    }\n    if (self.onLayoutEnd) self.onLayoutEnd();\n    return {\n      nodes: nodes,\n      edges: edges\n    };\n  };\n  DagreLayout.prototype.getRadialPos = function (dimValue, range, rangeLength, radius, arcRange) {\n    if (arcRange === void 0) {\n      arcRange = [0, 1];\n    }\n    // dimRatio 占圆弧的比例\n    var dimRatio = (dimValue - range[0]) / rangeLength;\n    // 再进一步归一化到指定的范围上\n    dimRatio = dimRatio * (arcRange[1] - arcRange[0]) + arcRange[0];\n    // 使用最终归一化后的范围计算角度\n    var angle = dimRatio * 2 * Math.PI; // 弧度\n    // 将极坐标系转换为直角坐标系\n    return {\n      x: Math.cos(angle) * radius,\n      y: Math.sin(angle) * radius\n    };\n  };\n  DagreLayout.prototype.getType = function () {\n    return 'dagre';\n  };\n  return DagreLayout;\n}(base_1.Base);\nexports.DagreLayout = DagreLayout;\n/**\n * Format controlPoints to avoid polylines crossing nodes\n * @param points\n * @param sourceNode\n * @param targetNode\n * @param layerCoordsArr\n * @param isHorizontal\n * @returns\n */\nvar getControlPoints = function (points, sourceNode, targetNode, layerCoordsArr, isHorizontal, isDifferentLayer, filterControlPointsOutOfBoundary) {\n  var controlPoints = (points === null || points === void 0 ? void 0 : points.slice(1, points.length - 1)) || []; // 去掉头尾\n  // 酌情增加控制点，使折线不穿过跨层的节点\n  if (sourceNode && targetNode) {\n    var sourceX = sourceNode.x,\n      sourceY = sourceNode.y;\n    var targetX = targetNode.x,\n      targetY = targetNode.y;\n    if (isHorizontal) {\n      sourceX = sourceNode.y;\n      sourceY = sourceNode.x;\n      targetX = targetNode.y;\n      targetY = targetNode.x;\n    }\n    // 为跨层级的边增加第一个控制点。忽略垂直的/横向的边。\n    // 新控制点 = {\n    //   x: 终点x,\n    //   y: (起点y + 下一层y) / 2,   #下一层y可能不等于终点y\n    // }\n    if (targetY !== sourceY && sourceX !== targetX) {\n      var sourceLayer = layerCoordsArr.indexOf(sourceY);\n      var sourceNextLayerCoord = layerCoordsArr[sourceLayer + 1];\n      if (sourceNextLayerCoord) {\n        var firstControlPoint = controlPoints[0];\n        var insertStartControlPoint = isHorizontal ? {\n          x: (sourceY + sourceNextLayerCoord) / 2,\n          y: (firstControlPoint === null || firstControlPoint === void 0 ? void 0 : firstControlPoint.y) || targetX\n        } : {\n          x: (firstControlPoint === null || firstControlPoint === void 0 ? void 0 : firstControlPoint.x) || targetX,\n          y: (sourceY + sourceNextLayerCoord) / 2\n        };\n        // 当新增的控制点不存在（!=当前第一个控制点）时添加\n        if (!firstControlPoint || isDifferentLayer(firstControlPoint, insertStartControlPoint)) {\n          controlPoints.unshift(insertStartControlPoint);\n        }\n      }\n      var targetLayer = layerCoordsArr.indexOf(targetY);\n      var layerDiff = Math.abs(targetLayer - sourceLayer);\n      if (layerDiff === 1) {\n        controlPoints = filterControlPointsOutOfBoundary(controlPoints, sourceNode, targetNode);\n        // one controlPoint at least\n        if (!controlPoints.length) {\n          controlPoints.push(isHorizontal ? {\n            x: (sourceY + targetY) / 2,\n            y: sourceX\n          } : {\n            x: sourceX,\n            y: (sourceY + targetY) / 2\n          });\n        }\n      } else if (layerDiff > 1) {\n        var targetLastLayerCoord = layerCoordsArr[targetLayer - 1];\n        if (targetLastLayerCoord) {\n          var lastControlPoints = controlPoints[controlPoints.length - 1];\n          var insertEndControlPoint = isHorizontal ? {\n            x: (targetY + targetLastLayerCoord) / 2,\n            y: (lastControlPoints === null || lastControlPoints === void 0 ? void 0 : lastControlPoints.y) || targetX\n          } : {\n            x: (lastControlPoints === null || lastControlPoints === void 0 ? void 0 : lastControlPoints.x) || sourceX,\n            y: (targetY + targetLastLayerCoord) / 2\n          };\n          // 当新增的控制点不存在（!=当前最后一个控制点）时添加\n          if (!lastControlPoints || isDifferentLayer(lastControlPoints, insertEndControlPoint)) {\n            controlPoints.push(insertEndControlPoint);\n          }\n        }\n      }\n    }\n  }\n  return controlPoints;\n};","map":{"version":3,"names":["require","index_1","__importDefault","util_1","base_1","graph_1","DagreLayout","_super","__extends","options","_this","call","rankdir","nodesep","ranksep","controlPoints","sortByCombo","edgeLabelSpace","radial","nodes","edges","onLayoutEnd","layoutNode","nodeId","self","node","find","id","layout","updateCfg","prototype","getDefaultCfg","align","undefined","nodeSize","nodesepFunc","ranksepFunc","focusNode","execute","combos","begin","_e","comboEdges","_f","vedges","g","Graph","multigraph","compound","nodeMap","nodeComboMap","forEach","comboId","push","sortedNodes","visitedMap","_a","nodeOrder","length","nodeSizeFunc","d","size","isArray","isObject","width","height","ranksepfunc","getFunc","nodesepfunc","horisep","vertisep","setDefaultEdgeLabel","setGraph","comboMap","combo","collapsed","verti","hori","setNode","parentId","setParent","filter","layer","isNumber","edge","source","getEdgeTerminal","target","setEdge","weight","_b","concat","comboEdge","sources","targets","s","t","prevGraph","_c","preset","default","keepNodeOrder","Boolean","dBegin","minX_1","Infinity","minY_1","coord","x","y","points","point","isHorizontal","_g","getRadialPos_1","getRadialPos","focusId","isString","focusLayer_1","_d","_rank","layers_1","dim_1","sizeDim_1","min_1","max_1","currentNodesep","totalWidth","maxSize","Math","max","diffLayer","diffLayerAbs","abs","left","right","leftPos","rightPos","radius_1","radiusMap_1","rangeLength_1","range_1","processNodes_1","layerNodes","radius","propsMaxRanksep","arcRange","maxRanksep","newX","newY","_order","currentNodeRanksep","isFirstLevel_1","lastLayerMaxNodeSize_1","PI","leftRatio","i","findIndex","it","v","w","type","otherDim_1","slice","newControlPoints_1","sourceOtherDimValue_1","otherDimDist_1","sourceRadius_1","radiusDist_1","cRadius","newPos","layerCoords_1","Set","isInvert","layerCoordSort","a","b","ndata","add","layerCoordsArr_1","Array","from","sort","isDifferentLayer_1","point1","point2","filterControlPointsOutOfBoundary_1","ps","min","sourceNode","targetNode","getControlPoints","dimValue","range","rangeLength","dimRatio","angle","cos","sin","getType","Base","exports","layerCoordsArr","isDifferentLayer","filterControlPointsOutOfBoundary","sourceX","sourceY","targetX","targetY","sourceLayer","indexOf","sourceNextLayerCoord","firstControlPoint","insertStartControlPoint","unshift","targetLayer","layerDiff","targetLastLayerCoord","lastControlPoints","insertEndControlPoint"],"sources":["../../src/layout/dagre.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
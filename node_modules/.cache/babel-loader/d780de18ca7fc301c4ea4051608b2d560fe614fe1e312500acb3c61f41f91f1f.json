{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport line from './line';\nimport { distance, isNumberEqual, getBBoxByArray, piMod } from './util';\nimport { nearestPoint } from './bezier';\n// 差值公式\nfunction quadraticAt(p0, p1, p2, t) {\n  var onet = 1 - t;\n  return onet * onet * p0 + 2 * t * onet * p1 + t * t * p2;\n}\n// 求极值\nfunction extrema(p0, p1, p2) {\n  var a = p0 + p2 - 2 * p1;\n  if (isNumberEqual(a, 0)) {\n    return [0.5];\n  }\n  var rst = (p0 - p1) / a;\n  if (rst <= 1 && rst >= 0) {\n    return [rst];\n  }\n  return [];\n}\nfunction derivativeAt(p0, p1, p2, t) {\n  return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\n}\n// 分割贝塞尔曲线\nfunction divideQuadratic(x1, y1, x2, y2, x3, y3, t) {\n  // 划分点\n  var xt = quadraticAt(x1, x2, x3, t);\n  var yt = quadraticAt(y1, y2, y3, t);\n  // 分割的第一条曲线的控制点\n  var controlPoint1 = line.pointAt(x1, y1, x2, y2, t);\n  // 分割的第二条曲线的控制点\n  var controlPoint2 = line.pointAt(x2, y2, x3, y3, t);\n  return [[x1, y1, controlPoint1.x, controlPoint1.y, xt, yt], [xt, yt, controlPoint2.x, controlPoint2.y, x3, y3]];\n}\n// 使用迭代法取贝塞尔曲线的长度\nfunction quadraticLength(x1, y1, x2, y2, x3, y3, iterationCount) {\n  if (iterationCount === 0) {\n    return (distance(x1, y1, x2, y2) + distance(x2, y2, x3, y3) + distance(x1, y1, x3, y3)) / 2;\n  }\n  var quadratics = divideQuadratic(x1, y1, x2, y2, x3, y3, 0.5);\n  var left = quadratics[0];\n  var right = quadratics[1];\n  left.push(iterationCount - 1);\n  right.push(iterationCount - 1);\n  return quadraticLength.apply(null, left) + quadraticLength.apply(null, right);\n}\nexport default {\n  box: function (x1, y1, x2, y2, x3, y3) {\n    var xExtrema = extrema(x1, x2, x3)[0];\n    var yExtrema = extrema(y1, y2, y3)[0];\n    // 控制点不加入 box 的计算\n    var xArr = [x1, x3];\n    var yArr = [y1, y3];\n    if (xExtrema !== undefined) {\n      xArr.push(quadraticAt(x1, x2, x3, xExtrema));\n    }\n    if (yExtrema !== undefined) {\n      yArr.push(quadraticAt(y1, y2, y3, yExtrema));\n    }\n    return getBBoxByArray(xArr, yArr);\n  },\n  length: function (x1, y1, x2, y2, x3, y3) {\n    return quadraticLength(x1, y1, x2, y2, x3, y3, 3);\n  },\n  nearestPoint: function (x1, y1, x2, y2, x3, y3, x0, y0) {\n    return nearestPoint([x1, x2, x3], [y1, y2, y3], x0, y0, quadraticAt);\n  },\n  pointDistance: function (x1, y1, x2, y2, x3, y3, x0, y0) {\n    var point = this.nearestPoint(x1, y1, x2, y2, x3, y3, x0, y0);\n    return distance(point.x, point.y, x0, y0);\n  },\n  interpolationAt: quadraticAt,\n  pointAt: function (x1, y1, x2, y2, x3, y3, t) {\n    return {\n      x: quadraticAt(x1, x2, x3, t),\n      y: quadraticAt(y1, y2, y3, t)\n    };\n  },\n  divide: function (x1, y1, x2, y2, x3, y3, t) {\n    return divideQuadratic(x1, y1, x2, y2, x3, y3, t);\n  },\n  tangentAngle: function (x1, y1, x2, y2, x3, y3, t) {\n    var dx = derivativeAt(x1, x2, x3, t);\n    var dy = derivativeAt(y1, y2, y3, t);\n    var angle = Math.atan2(dy, dx);\n    return piMod(angle);\n  }\n};","map":{"version":3,"names":["line","distance","isNumberEqual","getBBoxByArray","piMod","nearestPoint","quadraticAt","p0","p1","p2","t","onet","extrema","a","rst","derivativeAt","divideQuadratic","x1","y1","x2","y2","x3","y3","xt","yt","controlPoint1","pointAt","controlPoint2","x","y","quadraticLength","iterationCount","quadratics","left","right","push","apply","box","xExtrema","yExtrema","xArr","yArr","undefined","length","x0","y0","pointDistance","point","interpolationAt","divide","tangentAngle","dx","dy","angle","Math","atan2"],"sources":["../src/quadratic.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
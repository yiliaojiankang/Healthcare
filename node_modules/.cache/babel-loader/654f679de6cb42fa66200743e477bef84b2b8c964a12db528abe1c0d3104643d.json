{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { each, isArray } from '@antv/util';\nimport { animation, annotation, interaction, limitInPlot, scale, scrollbar, slider, theme, tooltip } from '../../adaptor/common';\nimport { area, line, point } from '../../adaptor/geometries';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { adjustYMetaByZero } from '../../utils/data';\n/**\n * geometry 配置处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var data = options.data,\n    color = options.color,\n    lineStyle = options.lineStyle,\n    lineShape = options.lineShape,\n    pointMapping = options.point,\n    areaMapping = options.area,\n    seriesField = options.seriesField;\n  var pointState = pointMapping === null || pointMapping === void 0 ? void 0 : pointMapping.state;\n  var areaState = areaMapping === null || areaMapping === void 0 ? void 0 : areaMapping.state;\n  chart.data(data);\n  // line geometry 处理\n  var primary = deepAssign({}, params, {\n    options: {\n      shapeField: seriesField,\n      line: {\n        color: color,\n        style: lineStyle,\n        shape: lineShape\n      },\n      // 颜色保持一致，因为如果颜色不一致，会导致 tooltip 中元素重复。\n      // 如果存在，才设置，否则为空\n      point: pointMapping && __assign({\n        color: color,\n        shape: 'circle'\n      }, pointMapping),\n      // 面积配置\n      area: areaMapping && __assign({\n        color: color\n      }, areaMapping),\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined\n    }\n  });\n  var second = deepAssign({}, primary, {\n    options: {\n      tooltip: false,\n      state: pointState\n    }\n  });\n  var areaParams = deepAssign({}, primary, {\n    options: {\n      tooltip: false,\n      state: areaState\n    }\n  });\n  line(primary);\n  point(second);\n  area(areaParams);\n  return params;\n}\n/**\n * meta 配置\n * @param params\n */\nexport function meta(params) {\n  var _a, _b;\n  var options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField,\n    data = options.data;\n  return flow(scale((_a = {}, _a[xField] = xAxis, _a[yField] = yAxis, _a), (_b = {}, _b[xField] = {\n    type: 'cat'\n  }, _b[yField] = adjustYMetaByZero(data, yField), _b)))(params);\n}\n/**\n * 坐标系配置. 支持 reflect 镜像处理\n * @param params\n */\nfunction coordinate(params) {\n  var chart = params.chart,\n    options = params.options;\n  var reflect = options.reflect;\n  if (reflect) {\n    var p = reflect;\n    if (!isArray(p)) {\n      p = [p];\n    }\n    var actions = p.map(function (d) {\n      return ['reflect', d];\n    });\n    chart.coordinate({\n      type: 'rect',\n      actions: actions\n    });\n  }\n  return params;\n}\n/**\n * axis 配置\n * @param params\n */\nexport function axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField;\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n  if (yAxis === false) {\n    chart.axis(yField, false);\n  } else {\n    chart.axis(yField, yAxis);\n  }\n  return params;\n}\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    seriesField = options.seriesField;\n  if (legend && seriesField) {\n    chart.legend(seriesField, legend);\n  } else if (legend === false) {\n    chart.legend(false);\n  }\n  return params;\n}\n/**\n * 数据标签\n * @param params\n */\nfunction label(params) {\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label,\n    yField = options.yField;\n  var lineGeometry = findGeometry(chart, 'line');\n  // label 为 false, 空 则不显示 label\n  if (!label) {\n    lineGeometry.label(false);\n  } else {\n    var callback = label.callback,\n      cfg = __rest(label, [\"callback\"]);\n    lineGeometry.label({\n      fields: [yField],\n      callback: callback,\n      cfg: __assign({\n        layout: [{\n          type: 'limit-in-plot'\n        }, {\n          type: 'path-adjust-position'\n        }, {\n          type: 'point-adjust-position'\n        }, {\n          type: 'limit-in-plot',\n          cfg: {\n            action: 'hide'\n          }\n        }]\n      }, transformLabel(cfg))\n    });\n  }\n  return params;\n}\n/**\n * 统一处理 adjust\n * @param params\n */\nexport function adjust(params) {\n  var chart = params.chart,\n    options = params.options;\n  var isStack = options.isStack;\n  if (isStack) {\n    each(chart.geometries, function (g) {\n      g.adjust('stack');\n    });\n  }\n  return params;\n}\n/**\n * 折线图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(geometry, meta, adjust, theme, coordinate, axis, legend, tooltip, label, slider, scrollbar, interaction, animation, annotation(), limitInPlot)(params);\n}","map":{"version":3,"names":["each","isArray","animation","annotation","interaction","limitInPlot","scale","scrollbar","slider","theme","tooltip","area","line","point","deepAssign","findGeometry","flow","transformLabel","adjustYMetaByZero","geometry","params","chart","options","data","color","lineStyle","lineShape","pointMapping","areaMapping","seriesField","pointState","state","areaState","primary","shapeField","style","shape","__assign","label","undefined","second","areaParams","meta","xAxis","yAxis","xField","yField","_a","_b","type","coordinate","reflect","p","actions","map","d","axis","legend","lineGeometry","callback","cfg","__rest","fields","layout","action","adjust","isStack","geometries","g","adaptor"],"sources":["../../../src/plots/line/adaptor.ts"],"sourcesContent":["import { Geometry } from '@antv/g2';\nimport { each, isArray } from '@antv/util';\nimport {\n  animation,\n  annotation,\n  interaction,\n  limitInPlot,\n  scale,\n  scrollbar,\n  slider,\n  theme,\n  tooltip,\n} from '../../adaptor/common';\nimport { area, line, point } from '../../adaptor/geometries';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, findGeometry, flow, transformLabel } from '../../utils';\nimport { adjustYMetaByZero } from '../../utils/data';\nimport { LineOptions } from './types';\n\n/**\n * geometry 配置处理\n * @param params\n */\nfunction geometry(params: Params<LineOptions>): Params<LineOptions> {\n  const { chart, options } = params;\n  const { data, color, lineStyle, lineShape, point: pointMapping, area: areaMapping, seriesField } = options;\n  const pointState = pointMapping?.state;\n  const areaState = areaMapping?.state;\n\n  chart.data(data);\n\n  // line geometry 处理\n  const primary = deepAssign({}, params, {\n    options: {\n      shapeField: seriesField,\n      line: {\n        color,\n        style: lineStyle,\n        shape: lineShape,\n      },\n      // 颜色保持一致，因为如果颜色不一致，会导致 tooltip 中元素重复。\n      // 如果存在，才设置，否则为空\n      point: pointMapping && {\n        color,\n        shape: 'circle',\n        ...pointMapping,\n      },\n      // 面积配置\n      area: areaMapping && {\n        color,\n        ...areaMapping,\n      },\n      // label 不传递给各个 geometry adaptor，由 label adaptor 处理\n      label: undefined,\n    },\n  });\n  const second = deepAssign({}, primary, { options: { tooltip: false, state: pointState } });\n  const areaParams = deepAssign({}, primary, { options: { tooltip: false, state: areaState } });\n\n  line(primary);\n  point(second);\n  area(areaParams);\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nexport function meta(params: Params<LineOptions>): Params<LineOptions> {\n  const { options } = params;\n  const { xAxis, yAxis, xField, yField, data } = options;\n\n  return flow(\n    scale(\n      {\n        [xField]: xAxis,\n        [yField]: yAxis,\n      },\n      {\n        [xField]: {\n          type: 'cat',\n        },\n        [yField]: adjustYMetaByZero(data, yField),\n      }\n    )\n  )(params);\n}\n\n/**\n * 坐标系配置. 支持 reflect 镜像处理\n * @param params\n */\nfunction coordinate(params: Params<LineOptions>): Params<LineOptions> {\n  const { chart, options } = params;\n  const { reflect } = options;\n  if (reflect) {\n    let p = reflect as any;\n    if (!isArray(p)) {\n      p = [p];\n    }\n    const actions = p.map((d) => ['reflect', d]);\n\n    chart.coordinate({ type: 'rect', actions });\n  }\n\n  return params;\n}\n\n/**\n * axis 配置\n * @param params\n */\nexport function axis(params: Params<LineOptions>): Params<LineOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(xField, false);\n  } else {\n    chart.axis(xField, xAxis);\n  }\n\n  if (yAxis === false) {\n    chart.axis(yField, false);\n  } else {\n    chart.axis(yField, yAxis);\n  }\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params: Params<LineOptions>): Params<LineOptions> {\n  const { chart, options } = params;\n  const { legend, seriesField } = options;\n\n  if (legend && seriesField) {\n    chart.legend(seriesField, legend);\n  } else if (legend === false) {\n    chart.legend(false);\n  }\n\n  return params;\n}\n\n/**\n * 数据标签\n * @param params\n */\nfunction label(params: Params<LineOptions>): Params<LineOptions> {\n  const { chart, options } = params;\n  const { label, yField } = options;\n\n  const lineGeometry = findGeometry(chart, 'line');\n\n  // label 为 false, 空 则不显示 label\n  if (!label) {\n    lineGeometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    lineGeometry.label({\n      fields: [yField],\n      callback,\n      cfg: {\n        layout: [\n          { type: 'limit-in-plot' },\n          { type: 'path-adjust-position' },\n          { type: 'point-adjust-position' },\n          { type: 'limit-in-plot', cfg: { action: 'hide' } },\n        ],\n        ...transformLabel(cfg),\n      },\n    });\n  }\n\n  return params;\n}\n\n/**\n * 统一处理 adjust\n * @param params\n */\nexport function adjust(params: Params<Pick<LineOptions, 'isStack'>>): Params<any> {\n  const { chart, options } = params;\n  const { isStack } = options;\n\n  if (isStack) {\n    each(chart.geometries, (g: Geometry) => {\n      g.adjust('stack');\n    });\n  }\n\n  return params;\n}\n\n/**\n * 折线图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<LineOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    geometry,\n    meta,\n    adjust,\n    theme,\n    coordinate,\n    axis,\n    legend,\n    tooltip,\n    label,\n    slider,\n    scrollbar,\n    interaction,\n    animation,\n    annotation(),\n    limitInPlot\n  )(params);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
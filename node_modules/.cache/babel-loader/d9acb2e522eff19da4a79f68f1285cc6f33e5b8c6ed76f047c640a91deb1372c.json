{"ast":null,"code":"/**\n * @fileoverview text\n * @author dengfuping_develop@163.com\n */\nimport { __assign, __extends } from \"tslib\";\nimport { each } from '@antv/util';\nimport { detect } from 'detect-browser';\nimport { setTransform } from '../util/svg';\nimport { SVG_ATTR_MAP } from '../constant';\nimport ShapeBase from './base';\nvar LETTER_SPACING = 0.3;\nvar BASELINE_MAP = {\n  top: 'before-edge',\n  middle: 'central',\n  bottom: 'after-edge',\n  alphabetic: 'baseline',\n  hanging: 'hanging'\n};\n// for FireFox\nvar BASELINE_MAP_FOR_FIREFOX = {\n  top: 'text-before-edge',\n  middle: 'central',\n  bottom: 'text-after-edge',\n  alphabetic: 'alphabetic',\n  hanging: 'hanging'\n};\nvar ANCHOR_MAP = {\n  left: 'left',\n  start: 'left',\n  center: 'middle',\n  right: 'end',\n  end: 'end'\n};\nvar Text = /** @class */function (_super) {\n  __extends(Text, _super);\n  function Text() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.type = 'text';\n    _this.canFill = true;\n    _this.canStroke = true;\n    return _this;\n  }\n  Text.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n    return __assign(__assign({}, attrs), {\n      x: 0,\n      y: 0,\n      text: null,\n      fontSize: 12,\n      fontFamily: 'sans-serif',\n      fontStyle: 'normal',\n      fontWeight: 'normal',\n      fontVariant: 'normal',\n      textAlign: 'start',\n      textBaseline: 'bottom'\n    });\n  };\n  Text.prototype.createPath = function (context, targetAttrs) {\n    var _this = this;\n    var attrs = this.attr();\n    var el = this.get('el');\n    this._setFont();\n    each(targetAttrs || attrs, function (value, attr) {\n      if (attr === 'text') {\n        _this._setText(\"\" + value);\n      } else if (attr === 'matrix' && value) {\n        setTransform(_this);\n      } else if (SVG_ATTR_MAP[attr]) {\n        el.setAttribute(SVG_ATTR_MAP[attr], value);\n      }\n    });\n    el.setAttribute('paint-order', 'stroke');\n    el.setAttribute('style', 'stroke-linecap:butt; stroke-linejoin:miter;');\n  };\n  Text.prototype._setFont = function () {\n    var el = this.get('el');\n    var _a = this.attr(),\n      textBaseline = _a.textBaseline,\n      textAlign = _a.textAlign;\n    var browser = detect();\n    if (browser && browser.name === 'firefox') {\n      // compatible with FireFox browser, ref: https://github.com/antvis/g/issues/119\n      el.setAttribute('dominant-baseline', BASELINE_MAP_FOR_FIREFOX[textBaseline] || 'alphabetic');\n    } else {\n      el.setAttribute('alignment-baseline', BASELINE_MAP[textBaseline] || 'baseline');\n    }\n    el.setAttribute('text-anchor', ANCHOR_MAP[textAlign] || 'left');\n  };\n  Text.prototype._setText = function (text) {\n    var el = this.get('el');\n    var _a = this.attr(),\n      x = _a.x,\n      _b = _a.textBaseline,\n      baseline = _b === void 0 ? 'bottom' : _b;\n    if (!text) {\n      el.innerHTML = '';\n    } else if (~text.indexOf('\\n')) {\n      var textArr = text.split('\\n');\n      var textLen_1 = textArr.length - 1;\n      var arr_1 = '';\n      each(textArr, function (segment, i) {\n        if (i === 0) {\n          if (baseline === 'alphabetic') {\n            arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"\" + -textLen_1 + \"em\\\">\" + segment + \"</tspan>\";\n          } else if (baseline === 'top') {\n            arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"0.9em\\\">\" + segment + \"</tspan>\";\n          } else if (baseline === 'middle') {\n            arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"\" + -(textLen_1 - 1) / 2 + \"em\\\">\" + segment + \"</tspan>\";\n          } else if (baseline === 'bottom') {\n            arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"-\" + (textLen_1 + LETTER_SPACING) + \"em\\\">\" + segment + \"</tspan>\";\n          } else if (baseline === 'hanging') {\n            arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"\" + (-(textLen_1 - 1) - LETTER_SPACING) + \"em\\\">\" + segment + \"</tspan>\";\n          }\n        } else {\n          arr_1 += \"<tspan x=\\\"\" + x + \"\\\" dy=\\\"1em\\\">\" + segment + \"</tspan>\";\n        }\n      });\n      el.innerHTML = arr_1;\n    } else {\n      el.innerHTML = text;\n    }\n  };\n  return Text;\n}(ShapeBase);\nexport default Text;","map":{"version":3,"names":["each","detect","setTransform","SVG_ATTR_MAP","ShapeBase","LETTER_SPACING","BASELINE_MAP","top","middle","bottom","alphabetic","hanging","BASELINE_MAP_FOR_FIREFOX","ANCHOR_MAP","left","start","center","right","end","Text","_super","__extends","_this","apply","arguments","type","canFill","canStroke","prototype","getDefaultAttrs","attrs","call","__assign","x","y","text","fontSize","fontFamily","fontStyle","fontWeight","fontVariant","textAlign","textBaseline","createPath","context","targetAttrs","attr","el","get","_setFont","value","_setText","setAttribute","_a","browser","name","_b","baseline","innerHTML","indexOf","textArr","split","textLen_1","length","arr_1","segment","i"],"sources":["../../src/shape/text.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
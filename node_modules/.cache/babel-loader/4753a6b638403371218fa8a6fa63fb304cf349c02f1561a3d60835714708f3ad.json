{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __extends } from \"tslib\";\nimport { Action, registerAction, registerInteraction } from '@antv/g2';\nimport { each, get, isArray, map } from '@antv/util';\nimport { getAllElements, getSiblingViews, getViews } from '../../../utils';\nimport { clearHighlight, getElementValue } from './utils';\n/**\n * 存在多个 view 时，view 之间的联动交互\n *\n * 提供四个反馈 action，均接受参数：linkField 关联字段，dim 维度\n * 1. showTooltip\n * 2. active\n * 3. highlight\n * 4. selected\n *\n * 附加，两个结束反馈 action：\n * 1. hidetooltip\n * 2. reset 清除激活和高亮状态\n */\nvar Association = /** @class */function (_super) {\n  __extends(Association, _super);\n  function Association() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\n   * 获取关联的 elements\n   *\n   * - 如果 dim 参数存在，根据 dim 获取相应的 field。与 linkField 不匹配则 return\n   * - 否则 dim 参数不存在，且 linkField 存在，则作为关联字段\n   * - 否则若 linkField 不存在，则获取第一个分类字段\n   * @returns EventItem[]\n   */\n  Association.prototype.getAssociationItems = function (views, params) {\n    var _a;\n    var event = this.context.event;\n    var _b = params || {},\n      linkField = _b.linkField,\n      dim = _b.dim;\n    var items = [];\n    if ((_a = event.data) === null || _a === void 0 ? void 0 : _a.data) {\n      var data_1 = event.data.data;\n      each(views, function (v) {\n        var _a, _b;\n        var field = linkField;\n        if (dim === 'x') {\n          field = v.getXScale().field;\n        } else if (dim === 'y') {\n          field = (_a = v.getYScales().find(function (s) {\n            return s.field === field;\n          })) === null || _a === void 0 ? void 0 : _a.field;\n        } else if (!field) {\n          field = (_b = v.getGroupScales()[0]) === null || _b === void 0 ? void 0 : _b.field;\n        }\n        if (!field) {\n          return;\n        }\n        var elements = map(getAllElements(v), function (ele) {\n          var active = false;\n          var inactive = false;\n          var dataValue = isArray(data_1) ? get(data_1[0], field) : get(data_1, field);\n          if (getElementValue(ele, field) === dataValue) {\n            active = true;\n          } else {\n            inactive = true;\n          }\n          return {\n            element: ele,\n            view: v,\n            active: active,\n            inactive: inactive\n          };\n        });\n        items.push.apply(items, elements);\n      });\n    }\n    return items;\n  };\n  /**\n   * 所有同一层级的 tooltip 显示\n   */\n  Association.prototype.showTooltip = function (params) {\n    var siblings = getSiblingViews(this.context.view);\n    var elements = this.getAssociationItems(siblings, params);\n    each(elements, function (ele) {\n      if (ele.active) {\n        var box = ele.element.shape.getCanvasBBox();\n        ele.view.showTooltip({\n          x: box.minX + box.width / 2,\n          y: box.minY + box.height / 2\n        });\n      }\n    });\n  };\n  /**\n   * 隐藏同一层级的 tooltip\n   */\n  Association.prototype.hideTooltip = function () {\n    var siblings = getSiblingViews(this.context.view);\n    each(siblings, function (sibling) {\n      sibling.hideTooltip();\n    });\n  };\n  /**\n   * 设置 active 状态\n   */\n  Association.prototype.active = function (params) {\n    var views = getViews(this.context.view);\n    var items = this.getAssociationItems(views, params);\n    each(items, function (item) {\n      var active = item.active,\n        element = item.element;\n      if (active) {\n        element.setState('active', true);\n      }\n    });\n  };\n  /**\n   * 设置 selected 状态\n   */\n  Association.prototype.selected = function (params) {\n    var views = getViews(this.context.view);\n    var items = this.getAssociationItems(views, params);\n    each(items, function (item) {\n      var active = item.active,\n        element = item.element;\n      if (active) {\n        element.setState('selected', true);\n      }\n    });\n  };\n  /**\n   * 进行高亮 => 设置 inactive 状态\n   */\n  Association.prototype.highlight = function (params) {\n    var views = getViews(this.context.view);\n    var items = this.getAssociationItems(views, params);\n    each(items, function (item) {\n      var inactive = item.inactive,\n        element = item.element;\n      if (inactive) {\n        element.setState('inactive', true);\n      }\n    });\n  };\n  Association.prototype.reset = function () {\n    var views = getViews(this.context.view);\n    each(views, function (v) {\n      clearHighlight(v);\n    });\n  };\n  return Association;\n}(Action);\nregisterAction('association', Association);\n/**\n * 相邻 view 的 active 联动（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-active', {\n  start: [{\n    trigger: 'element:mouseenter',\n    action: 'association:active'\n  }],\n  end: [{\n    trigger: 'element:mouseleave',\n    action: 'association:reset'\n  }]\n});\n/**\n * 相邻 view 的 active 联动（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-selected', {\n  start: [{\n    trigger: 'element:mouseenter',\n    action: 'association:selected'\n  }],\n  end: [{\n    trigger: 'element:mouseleave',\n    action: 'association:reset'\n  }]\n});\n/**\n * 相邻 view 的 highlight 联动, 突出当前 element\n */\nregisterInteraction('association-highlight', {\n  start: [{\n    trigger: 'element:mouseenter',\n    action: 'association:highlight'\n  }],\n  end: [{\n    trigger: 'element:mouseleave',\n    action: 'association:reset'\n  }]\n});\n/**\n * 相邻 view 的 tooltip 联动，根据 groupField 进行关联（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-tooltip', {\n  start: [{\n    trigger: 'element:mousemove',\n    action: 'association:showTooltip'\n  }],\n  end: [{\n    trigger: 'element:mouseleave',\n    action: 'association:hideTooltip'\n  }]\n});","map":{"version":3,"names":["Action","registerAction","registerInteraction","each","get","isArray","map","getAllElements","getSiblingViews","getViews","clearHighlight","getElementValue","Association","_super","__extends","prototype","getAssociationItems","views","params","event","context","_b","linkField","dim","items","_a","data","data_1","v","field","getXScale","getYScales","find","s","getGroupScales","elements","ele","active","inactive","dataValue","element","view","push","apply","showTooltip","siblings","box","shape","getCanvasBBox","x","minX","width","y","minY","height","hideTooltip","sibling","item","setState","selected","highlight","reset","start","trigger","action","end"],"sources":["../../../../src/plots/mix/interactions/association.ts"],"sourcesContent":["import { Action, Element, registerAction, registerInteraction, View } from '@antv/g2';\nimport { each, get, isArray, map } from '@antv/util';\nimport { getAllElements, getSiblingViews, getViews } from '../../../utils';\nimport { clearHighlight, getElementValue } from './utils';\n\ntype EventItem = { element: Element; view: View; active: boolean; inactive: boolean };\ntype ActionParams = { linkField?: string; dim?: 'x' | 'y' };\n/**\n * 存在多个 view 时，view 之间的联动交互\n *\n * 提供四个反馈 action，均接受参数：linkField 关联字段，dim 维度\n * 1. showTooltip\n * 2. active\n * 3. highlight\n * 4. selected\n *\n * 附加，两个结束反馈 action：\n * 1. hidetooltip\n * 2. reset 清除激活和高亮状态\n */\nclass Association extends Action {\n  /**\n   * 获取关联的 elements\n   *\n   * - 如果 dim 参数存在，根据 dim 获取相应的 field。与 linkField 不匹配则 return\n   * - 否则 dim 参数不存在，且 linkField 存在，则作为关联字段\n   * - 否则若 linkField 不存在，则获取第一个分类字段\n   * @returns EventItem[]\n   */\n  private getAssociationItems(views: View[], params?: ActionParams): EventItem[] {\n    const { event } = this.context;\n    const { linkField, dim } = params || {};\n\n    const items = [];\n\n    if (event.data?.data) {\n      const { data } = event.data;\n      each(views, (v: View) => {\n        let field = linkField;\n        if (dim === 'x') {\n          field = v.getXScale().field;\n        } else if (dim === 'y') {\n          field = v.getYScales().find((s) => s.field === field)?.field;\n        } else if (!field) {\n          field = v.getGroupScales()[0]?.field;\n        }\n        if (!field) {\n          return;\n        }\n        const elements = map(getAllElements(v), (ele) => {\n          let active = false;\n          let inactive = false;\n          const dataValue = isArray(data) ? get(data[0], field) : get(data, field);\n          if (getElementValue(ele, field) === dataValue) {\n            active = true;\n          } else {\n            inactive = true;\n          }\n          return { element: ele, view: v, active, inactive };\n        });\n        items.push(...elements);\n      });\n    }\n\n    return items;\n  }\n\n  /**\n   * 所有同一层级的 tooltip 显示\n   */\n  public showTooltip(params?: ActionParams) {\n    const siblings = getSiblingViews(this.context.view);\n    const elements = this.getAssociationItems(siblings, params);\n\n    each(elements, (ele) => {\n      if (ele.active) {\n        const box = ele.element.shape.getCanvasBBox();\n        ele.view.showTooltip({ x: box.minX + box.width / 2, y: box.minY + box.height / 2 });\n      }\n    });\n  }\n\n  /**\n   * 隐藏同一层级的 tooltip\n   */\n  public hideTooltip() {\n    const siblings = getSiblingViews(this.context.view);\n    each(siblings, (sibling) => {\n      sibling.hideTooltip();\n    });\n  }\n\n  /**\n   * 设置 active 状态\n   */\n  public active(params?: ActionParams) {\n    const views = getViews(this.context.view);\n    const items = this.getAssociationItems(views, params);\n\n    each(items, (item: EventItem) => {\n      const { active, element } = item;\n      if (active) {\n        element.setState('active', true);\n      }\n    });\n  }\n\n  /**\n   * 设置 selected 状态\n   */\n  public selected(params?: ActionParams) {\n    const views = getViews(this.context.view);\n    const items = this.getAssociationItems(views, params);\n\n    each(items, (item: EventItem) => {\n      const { active, element } = item;\n      if (active) {\n        element.setState('selected', true);\n      }\n    });\n  }\n\n  /**\n   * 进行高亮 => 设置 inactive 状态\n   */\n  public highlight(params?: ActionParams) {\n    const views = getViews(this.context.view);\n    const items = this.getAssociationItems(views, params);\n\n    each(items, (item: EventItem) => {\n      const { inactive, element } = item;\n      if (inactive) {\n        element.setState('inactive', true);\n      }\n    });\n  }\n\n  public reset() {\n    const views = getViews(this.context.view);\n    each(views, (v) => {\n      clearHighlight(v);\n    });\n  }\n}\n\nregisterAction('association', Association);\n\n/**\n * 相邻 view 的 active 联动（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-active', {\n  start: [{ trigger: 'element:mouseenter', action: 'association:active' }],\n  end: [{ trigger: 'element:mouseleave', action: 'association:reset' }],\n});\n\n/**\n * 相邻 view 的 active 联动（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-selected', {\n  start: [{ trigger: 'element:mouseenter', action: 'association:selected' }],\n  end: [{ trigger: 'element:mouseleave', action: 'association:reset' }],\n});\n\n/**\n * 相邻 view 的 highlight 联动, 突出当前 element\n */\nregisterInteraction('association-highlight', {\n  start: [{ trigger: 'element:mouseenter', action: 'association:highlight' }],\n  end: [{ trigger: 'element:mouseleave', action: 'association:reset' }],\n});\n\n/**\n * 相邻 view 的 tooltip 联动，根据 groupField 进行关联（相同维值的 tooltip 联动）\n */\nregisterInteraction('association-tooltip', {\n  start: [{ trigger: 'element:mousemove', action: 'association:showTooltip' }],\n  end: [{ trigger: 'element:mouseleave', action: 'association:hideTooltip' }],\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"/**\n * @fileoverview image\n * @author dengfuping_develop@163.com\n */\nimport { __assign, __extends } from \"tslib\";\nimport { each, isString } from '@antv/util';\nimport { SVG_ATTR_MAP } from '../constant';\nimport ShapeBase from './base';\nvar Image = /** @class */function (_super) {\n  __extends(Image, _super);\n  function Image() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.type = 'image';\n    _this.canFill = false;\n    _this.canStroke = false;\n    return _this;\n  }\n  Image.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n    return __assign(__assign({}, attrs), {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n  };\n  Image.prototype.createPath = function (context, targetAttrs) {\n    var _this = this;\n    var attrs = this.attr();\n    var el = this.get('el');\n    each(targetAttrs || attrs, function (value, attr) {\n      if (attr === 'img') {\n        _this._setImage(attrs.img);\n      } else if (SVG_ATTR_MAP[attr]) {\n        el.setAttribute(SVG_ATTR_MAP[attr], value);\n      }\n    });\n  };\n  Image.prototype.setAttr = function (name, value) {\n    this.attrs[name] = value;\n    if (name === 'img') {\n      this._setImage(value);\n    }\n  };\n  Image.prototype._setImage = function (img) {\n    var attrs = this.attr();\n    var el = this.get('el');\n    if (isString(img)) {\n      el.setAttribute('href', img);\n    } else if (img instanceof window.Image) {\n      if (!attrs.width) {\n        el.setAttribute('width', img.width);\n        this.attr('width', img.width);\n      }\n      if (!attrs.height) {\n        el.setAttribute('height', img.height);\n        this.attr('height', img.height);\n      }\n      el.setAttribute('href', img.src);\n    } else if (img instanceof HTMLElement && isString(img.nodeName) && img.nodeName.toUpperCase() === 'CANVAS') {\n      // @ts-ignore\n      el.setAttribute('href', img.toDataURL());\n    } else if (img instanceof ImageData) {\n      var canvas = document.createElement('canvas');\n      canvas.setAttribute('width', \"\" + img.width);\n      canvas.setAttribute('height', \"\" + img.height);\n      canvas.getContext('2d').putImageData(img, 0, 0);\n      if (!attrs.width) {\n        el.setAttribute('width', \"\" + img.width);\n        this.attr('width', img.width);\n      }\n      if (!attrs.height) {\n        el.setAttribute('height', \"\" + img.height);\n        this.attr('height', img.height);\n      }\n      el.setAttribute('href', canvas.toDataURL());\n    }\n  };\n  return Image;\n}(ShapeBase);\nexport default Image;","map":{"version":3,"names":["each","isString","SVG_ATTR_MAP","ShapeBase","Image","_super","__extends","_this","apply","arguments","type","canFill","canStroke","prototype","getDefaultAttrs","attrs","call","__assign","x","y","width","height","createPath","context","targetAttrs","attr","el","get","value","_setImage","img","setAttribute","setAttr","name","window","src","HTMLElement","nodeName","toUpperCase","toDataURL","ImageData","canvas","document","createElement","getContext","putImageData"],"sources":["../../src/shape/image.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
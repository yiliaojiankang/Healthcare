{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar util_1 = require(\"../util\");\nvar sort = function (entries, biasRight, usePrev, keepNodeOrder) {\n  var parts = (0, util_1.partition)(entries, function (entry) {\n    var hasFixOrder = entry.hasOwnProperty(\"fixorder\") && !isNaN(entry.fixorder);\n    if (keepNodeOrder) return !hasFixOrder && entry.hasOwnProperty(\"barycenter\");\n    // NOTE: 有fixorder的也可以排\n    return hasFixOrder || entry.hasOwnProperty(\"barycenter\");\n  });\n  var sortable = parts.lhs;\n  var unsortable = parts.rhs.sort(function (a, b) {\n    return -a.i - -b.i;\n  });\n  var vs = [];\n  var sum = 0;\n  var weight = 0;\n  var vsIndex = 0;\n  sortable === null || sortable === void 0 ? void 0 : sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  sortable === null || sortable === void 0 ? void 0 : sortable.forEach(function (entry) {\n    var _a;\n    vsIndex += (_a = entry.vs) === null || _a === void 0 ? void 0 : _a.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n  var result = {\n    vs: vs.flat()\n  };\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n  return result;\n};\nvar consumeUnsortable = function (vs, unsortable, index) {\n  var iindex = index;\n  var last;\n  while (unsortable.length && (last = unsortable[unsortable.length - 1]).i <= iindex) {\n    unsortable.pop();\n    vs === null || vs === void 0 ? void 0 : vs.push(last.vs);\n    iindex++;\n  }\n  return iindex;\n};\n/**\n * 配置是否考虑使用之前的布局结果\n */\nvar compareWithBias = function (bias, usePrev) {\n  return function (entryV, entryW) {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    }\n    if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n    // 重心相同，考虑之前排好的顺序\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      }\n      if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n};\nexports.default = sort;","map":{"version":3,"names":["util_1","require","sort","entries","biasRight","usePrev","keepNodeOrder","parts","partition","entry","hasFixOrder","hasOwnProperty","isNaN","fixorder","sortable","lhs","unsortable","rhs","a","b","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","_a","length","push","barycenter","result","flat","index","iindex","last","pop","bias","entryV","entryW","undefined","order","exports","default"],"sources":["../../../../../src/layout/dagre/src/order/sort.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
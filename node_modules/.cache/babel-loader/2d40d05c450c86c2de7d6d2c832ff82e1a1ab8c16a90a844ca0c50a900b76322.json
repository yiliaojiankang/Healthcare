{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { isEqual } from '@antv/util';\nfunction getMinDiff(del, add, modify) {\n  var type = null;\n  var min = modify;\n  if (add < min) {\n    min = add;\n    type = 'add';\n  }\n  if (del < min) {\n    min = del;\n    type = 'del';\n  }\n  return {\n    type: type,\n    min: min\n  };\n}\n/*\n * https://en.wikipedia.org/wiki/Levenshtein_distance\n * 计算两条path的编辑距离\n */\nvar levenshteinDistance = function (source, target) {\n  var sourceLen = source.length;\n  var targetLen = target.length;\n  var sourceSegment, targetSegment;\n  var temp = 0;\n  if (sourceLen === 0 || targetLen === 0) {\n    return null;\n  }\n  var dist = [];\n  for (var i = 0; i <= sourceLen; i++) {\n    dist[i] = [];\n    dist[i][0] = {\n      min: i\n    };\n  }\n  for (var j = 0; j <= targetLen; j++) {\n    dist[0][j] = {\n      min: j\n    };\n  }\n  for (var i = 1; i <= sourceLen; i++) {\n    sourceSegment = source[i - 1];\n    for (var j = 1; j <= targetLen; j++) {\n      targetSegment = target[j - 1];\n      if (isEqual(sourceSegment, targetSegment)) {\n        temp = 0;\n      } else {\n        temp = 1;\n      }\n      var del = dist[i - 1][j].min + 1;\n      var add = dist[i][j - 1].min + 1;\n      var modify = dist[i - 1][j - 1].min + temp;\n      dist[i][j] = getMinDiff(del, add, modify);\n    }\n  }\n  return dist;\n};\nexport default function fillPathByDiff(source, target) {\n  var diffMatrix = levenshteinDistance(source, target);\n  var sourceLen = source.length;\n  var targetLen = target.length;\n  var changes = [];\n  var index = 1;\n  var minPos = 1;\n  // 如果source和target不是完全不相等\n  // @ts-ignore\n  if (diffMatrix[sourceLen][targetLen] !== sourceLen) {\n    // 获取从source到target所需改动\n    for (var i = 1; i <= sourceLen; i++) {\n      var min = diffMatrix[i][i].min;\n      minPos = i;\n      for (var j = index; j <= targetLen; j++) {\n        if (diffMatrix[i][j].min < min) {\n          min = diffMatrix[i][j].min;\n          minPos = j;\n        }\n      }\n      index = minPos;\n      if (diffMatrix[i][index].type) {\n        changes.push({\n          index: i - 1,\n          type: diffMatrix[i][index].type\n        });\n      }\n    }\n    // 对source进行增删path\n    for (var i = changes.length - 1; i >= 0; i--) {\n      index = changes[i].index;\n      if (changes[i].type === 'add') {\n        // @ts-ignore\n        source.splice(index, 0, [].concat(source[index]));\n      } else {\n        // @ts-ignore\n        source.splice(index, 1);\n      }\n    }\n  }\n  // source尾部补齐\n  sourceLen = source.length;\n  if (sourceLen < targetLen) {\n    for (var i = 0; i < targetLen - sourceLen; i++) {\n      if (source[sourceLen - 1][0] === 'z' || source[sourceLen - 1][0] === 'Z') {\n        // @ts-ignore\n        source.splice(sourceLen - 2, 0, source[sourceLen - 2]);\n      } else {\n        // @ts-ignore\n        source.push(source[sourceLen - 1]);\n      }\n    }\n  }\n  return source;\n}","map":{"version":3,"names":["isEqual","getMinDiff","del","add","modify","type","min","levenshteinDistance","source","target","sourceLen","length","targetLen","sourceSegment","targetSegment","temp","dist","i","j","fillPathByDiff","diffMatrix","changes","index","minPos","push","splice","concat"],"sources":["../src/fill-path-by-diff.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
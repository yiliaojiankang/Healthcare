{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Action, Util } from '@antv/g2';\nimport { isEqual } from '@antv/util';\nimport { transform } from '../../../../utils/matrix';\n/**\n * 饼图 图例激活 action\n */\nvar PieLegendAction = /** @class */function (_super) {\n  __extends(PieLegendAction, _super);\n  function PieLegendAction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  /**\n   * 获取激活的图形元素\n   */\n  PieLegendAction.prototype.getActiveElements = function () {\n    var delegateObject = Util.getDelegationObject(this.context);\n    if (delegateObject) {\n      var view = this.context.view;\n      var component = delegateObject.component,\n        item_1 = delegateObject.item;\n      var field_1 = component.get('field');\n      if (field_1) {\n        var elements = view.geometries[0].elements;\n        return elements.filter(function (ele) {\n          return ele.getModel().data[field_1] === item_1.value;\n        });\n      }\n    }\n    return [];\n  };\n  /**\n   * 获取激活的标签\n   */\n  PieLegendAction.prototype.getActiveElementLabels = function () {\n    var view = this.context.view;\n    var elements = this.getActiveElements();\n    var labels = view.geometries[0].labelsContainer.getChildren();\n    return labels.filter(function (label) {\n      return elements.find(function (ele) {\n        return isEqual(ele.getData(), label.get('data'));\n      });\n    });\n  };\n  PieLegendAction.prototype.transfrom = function (offset) {\n    if (offset === void 0) {\n      offset = 7.5;\n    }\n    var elements = this.getActiveElements();\n    var elementLabels = this.getActiveElementLabels();\n    elements.forEach(function (element, idx) {\n      var labelShape = elementLabels[idx];\n      var coordinate = element.geometry.coordinate;\n      if (coordinate.isPolar && coordinate.isTransposed) {\n        var _a = Util.getAngle(element.getModel(), coordinate),\n          startAngle = _a.startAngle,\n          endAngle = _a.endAngle;\n        var middleAngle = (startAngle + endAngle) / 2;\n        var r = offset;\n        var x = r * Math.cos(middleAngle);\n        var y = r * Math.sin(middleAngle);\n        element.shape.setMatrix(transform([['t', x, y]]));\n        labelShape.setMatrix(transform([['t', x, y]]));\n      }\n    });\n  };\n  PieLegendAction.prototype.active = function () {\n    this.transfrom();\n  };\n  /**\n   * 激活态还原\n   */\n  PieLegendAction.prototype.reset = function () {\n    this.transfrom(0);\n  };\n  return PieLegendAction;\n}(Action);\nexport { PieLegendAction };","map":{"version":3,"names":["Action","Util","isEqual","transform","PieLegendAction","_super","__extends","prototype","getActiveElements","delegateObject","getDelegationObject","context","view","component","item_1","item","field_1","get","elements","geometries","filter","ele","getModel","data","value","getActiveElementLabels","labels","labelsContainer","getChildren","label","find","getData","transfrom","offset","elementLabels","forEach","element","idx","labelShape","coordinate","geometry","isPolar","isTransposed","_a","getAngle","startAngle","endAngle","middleAngle","r","x","Math","cos","y","sin","shape","setMatrix","active","reset"],"sources":["../../../../../src/plots/pie/interactions/actions/legend-active.ts"],"sourcesContent":["import { IElement, IGroup } from '@antv/g-base';\nimport { Action, Element, Util } from '@antv/g2';\nimport { isEqual } from '@antv/util';\nimport { transform } from '../../../../utils/matrix';\n\n/**\n * 饼图 图例激活 action\n */\nexport class PieLegendAction extends Action {\n  /**\n   * 获取激活的图形元素\n   */\n  private getActiveElements(): Element[] {\n    const delegateObject = Util.getDelegationObject(this.context);\n    if (delegateObject) {\n      const view = this.context.view;\n      const { component, item } = delegateObject;\n      const field = component.get('field');\n      if (field) {\n        const elements = view.geometries[0].elements;\n        return elements.filter((ele) => ele.getModel().data[field] === item.value);\n      }\n    }\n    return [];\n  }\n\n  /**\n   * 获取激活的标签\n   */\n  private getActiveElementLabels(): (IElement | IGroup)[] {\n    const view = this.context.view;\n    const elements = this.getActiveElements();\n    const labels = view.geometries[0].labelsContainer.getChildren();\n    return labels.filter((label) => elements.find((ele) => isEqual(ele.getData(), label.get('data'))));\n  }\n\n  protected transfrom(offset: number = 7.5) {\n    const elements = this.getActiveElements();\n    const elementLabels = this.getActiveElementLabels();\n    elements.forEach((element, idx) => {\n      const labelShape = elementLabels[idx];\n      const coordinate = element.geometry.coordinate;\n      if (coordinate.isPolar && coordinate.isTransposed) {\n        const { startAngle, endAngle } = Util.getAngle(element.getModel(), coordinate);\n        const middleAngle = (startAngle + endAngle) / 2;\n        const r = offset;\n        const x = r * Math.cos(middleAngle);\n        const y = r * Math.sin(middleAngle);\n        element.shape.setMatrix(transform([['t', x, y]]));\n        labelShape.setMatrix(transform([['t', x, y]]));\n      }\n    });\n  }\n\n  public active() {\n    this.transfrom();\n  }\n\n  /**\n   * 激活态还原\n   */\n  public reset() {\n    this.transfrom(0);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
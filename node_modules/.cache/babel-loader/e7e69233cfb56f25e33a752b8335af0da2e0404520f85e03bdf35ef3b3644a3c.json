{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\n/**\n * @fileoverview 线\n * @author dxq613@gmail.com\n */\nimport { Line as LineUtil } from '@antv/g-math';\nimport ShapeBase from './base';\nimport inLine from '../util/in-stroke/line';\nimport * as ArrowUtil from '../util/arrow';\nvar Line = /** @class */function (_super) {\n  __extends(Line, _super);\n  function Line() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  Line.prototype.getDefaultAttrs = function () {\n    var attrs = _super.prototype.getDefaultAttrs.call(this);\n    return __assign(__assign({}, attrs), {\n      x1: 0,\n      y1: 0,\n      x2: 0,\n      y2: 0,\n      startArrow: false,\n      endArrow: false\n    });\n  };\n  Line.prototype.initAttrs = function (attrs) {\n    this.setArrow();\n  };\n  // 更新属性时，检测是否更改了箭头\n  Line.prototype.onAttrChange = function (name, value, originValue) {\n    _super.prototype.onAttrChange.call(this, name, value, originValue);\n    // 由于箭头的绘制依赖于 line 的诸多 attrs，因此这里不再对每个 attr 进行判断，attr 每次变化都会影响箭头的更新\n    this.setArrow();\n  };\n  Line.prototype.setArrow = function () {\n    var attrs = this.attr();\n    var x1 = attrs.x1,\n      y1 = attrs.y1,\n      x2 = attrs.x2,\n      y2 = attrs.y2,\n      startArrow = attrs.startArrow,\n      endArrow = attrs.endArrow;\n    if (startArrow) {\n      ArrowUtil.addStartArrow(this, attrs, x2, y2, x1, y1);\n    }\n    if (endArrow) {\n      ArrowUtil.addEndArrow(this, attrs, x1, y1, x2, y2);\n    }\n  };\n  Line.prototype.isInStrokeOrPath = function (x, y, isStroke, isFill, lineWidth) {\n    if (!isStroke || !lineWidth) {\n      return false;\n    }\n    var _a = this.attr(),\n      x1 = _a.x1,\n      y1 = _a.y1,\n      x2 = _a.x2,\n      y2 = _a.y2;\n    return inLine(x1, y1, x2, y2, lineWidth, x, y);\n  };\n  Line.prototype.createPath = function (context) {\n    var attrs = this.attr();\n    var x1 = attrs.x1,\n      y1 = attrs.y1,\n      x2 = attrs.x2,\n      y2 = attrs.y2,\n      startArrow = attrs.startArrow,\n      endArrow = attrs.endArrow;\n    var startArrowDistance = {\n      dx: 0,\n      dy: 0\n    };\n    var endArrowDistance = {\n      dx: 0,\n      dy: 0\n    };\n    if (startArrow && startArrow.d) {\n      startArrowDistance = ArrowUtil.getShortenOffset(x1, y1, x2, y2, attrs.startArrow.d);\n    }\n    if (endArrow && endArrow.d) {\n      endArrowDistance = ArrowUtil.getShortenOffset(x1, y1, x2, y2, attrs.endArrow.d);\n    }\n    context.beginPath();\n    // 如果自定义箭头，线条相应缩进\n    context.moveTo(x1 + startArrowDistance.dx, y1 + startArrowDistance.dy);\n    context.lineTo(x2 - endArrowDistance.dx, y2 - endArrowDistance.dy);\n  };\n  Line.prototype.afterDrawPath = function (context) {\n    var startArrowShape = this.get('startArrowShape');\n    var endArrowShape = this.get('endArrowShape');\n    if (startArrowShape) {\n      startArrowShape.draw(context);\n    }\n    if (endArrowShape) {\n      endArrowShape.draw(context);\n    }\n  };\n  /**\n   * Get length of line\n   * @return {number} length\n   */\n  Line.prototype.getTotalLength = function () {\n    var _a = this.attr(),\n      x1 = _a.x1,\n      y1 = _a.y1,\n      x2 = _a.x2,\n      y2 = _a.y2;\n    return LineUtil.length(x1, y1, x2, y2);\n  };\n  /**\n   * Get point according to ratio\n   * @param {number} ratio\n   * @return {Point} point\n   */\n  Line.prototype.getPoint = function (ratio) {\n    var _a = this.attr(),\n      x1 = _a.x1,\n      y1 = _a.y1,\n      x2 = _a.x2,\n      y2 = _a.y2;\n    return LineUtil.pointAt(x1, y1, x2, y2, ratio);\n  };\n  return Line;\n}(ShapeBase);\nexport default Line;","map":{"version":3,"names":["Line","LineUtil","ShapeBase","inLine","ArrowUtil","_super","__extends","prototype","getDefaultAttrs","attrs","call","__assign","x1","y1","x2","y2","startArrow","endArrow","initAttrs","setArrow","onAttrChange","name","value","originValue","attr","addStartArrow","addEndArrow","isInStrokeOrPath","x","y","isStroke","isFill","lineWidth","_a","createPath","context","startArrowDistance","dx","dy","endArrowDistance","d","getShortenOffset","beginPath","moveTo","lineTo","afterDrawPath","startArrowShape","get","endArrowShape","draw","getTotalLength","length","getPoint","ratio","pointAt"],"sources":["../../src/shape/line.ts"],"sourcesContent":[null],"mappings":";AAAA;;;;AAIA,SAASA,IAAI,IAAIC,QAAQ,QAAQ,cAAc;AAC/C,OAAOC,SAAS,MAAM,QAAQ;AAC9B,OAAOC,MAAM,MAAM,wBAAwB;AAC3C,OAAO,KAAKC,SAAS,MAAM,eAAe;AAE1C,IAAAJ,IAAA,0BAAAK,MAAA;EAAmBC,SAAA,CAAAN,IAAA,EAAAK,MAAA;EAAnB,SAAAL,KAAA;;EAkGA;EAjGEA,IAAA,CAAAO,SAAA,CAAAC,eAAe,GAAf;IACE,IAAMC,KAAK,GAAGJ,MAAA,CAAAE,SAAA,CAAMC,eAAe,CAAAE,IAAA,MAAE;IACrC,OAAAC,QAAA,CAAAA,QAAA,KACKF,KAAK;MACRG,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE,CAAC;MACLC,UAAU,EAAE,KAAK;MACjBC,QAAQ,EAAE;IAAK;EAEnB,CAAC;EAEDjB,IAAA,CAAAO,SAAA,CAAAW,SAAS,GAAT,UAAUT,KAAK;IACb,IAAI,CAACU,QAAQ,EAAE;EACjB,CAAC;EAED;EACAnB,IAAA,CAAAO,SAAA,CAAAa,YAAY,GAAZ,UAAaC,IAAY,EAAEC,KAAU,EAAEC,WAAgB;IACrDlB,MAAA,CAAAE,SAAA,CAAMa,YAAY,CAAAV,IAAA,OAACW,IAAI,EAAEC,KAAK,EAAEC,WAAW,CAAC;IAC5C;IACA,IAAI,CAACJ,QAAQ,EAAE;EACjB,CAAC;EAEDnB,IAAA,CAAAO,SAAA,CAAAY,QAAQ,GAAR;IACE,IAAMV,KAAK,GAAG,IAAI,CAACe,IAAI,EAAE;IACjB,IAAAZ,EAAE,GAAuCH,KAAK,CAAAG,EAA5C;MAAEC,EAAE,GAAmCJ,KAAK,CAAAI,EAAxC;MAAEC,EAAE,GAA+BL,KAAK,CAAAK,EAApC;MAAEC,EAAE,GAA2BN,KAAK,CAAAM,EAAhC;MAAEC,UAAU,GAAeP,KAAK,CAAAO,UAApB;MAAEC,QAAQ,GAAKR,KAAK,CAAAQ,QAAV;IAC5C,IAAID,UAAU,EAAE;MACdZ,SAAS,CAACqB,aAAa,CAAC,IAAI,EAAEhB,KAAK,EAAEK,EAAE,EAAEC,EAAE,EAAEH,EAAE,EAAEC,EAAE,CAAC;;IAEtD,IAAII,QAAQ,EAAE;MACZb,SAAS,CAACsB,WAAW,CAAC,IAAI,EAAEjB,KAAK,EAAEG,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;;EAEtD,CAAC;EAEDf,IAAA,CAAAO,SAAA,CAAAoB,gBAAgB,GAAhB,UAAiBC,CAAC,EAAEC,CAAC,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,SAAS;IAChD,IAAI,CAACF,QAAQ,IAAI,CAACE,SAAS,EAAE;MAC3B,OAAO,KAAK;;IAER,IAAAC,EAAA,GAAqB,IAAI,CAACT,IAAI,EAAE;MAA9BZ,EAAE,GAAAqB,EAAA,CAAArB,EAAA;MAAEC,EAAE,GAAAoB,EAAA,CAAApB,EAAA;MAAEC,EAAE,GAAAmB,EAAA,CAAAnB,EAAA;MAAEC,EAAE,GAAAkB,EAAA,CAAAlB,EAAgB;IACtC,OAAOZ,MAAM,CAACS,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEiB,SAAS,EAAEJ,CAAC,EAAEC,CAAC,CAAC;EAChD,CAAC;EAED7B,IAAA,CAAAO,SAAA,CAAA2B,UAAU,GAAV,UAAWC,OAAO;IAChB,IAAM1B,KAAK,GAAG,IAAI,CAACe,IAAI,EAAE;IACjB,IAAAZ,EAAE,GAAuCH,KAAK,CAAAG,EAA5C;MAAEC,EAAE,GAAmCJ,KAAK,CAAAI,EAAxC;MAAEC,EAAE,GAA+BL,KAAK,CAAAK,EAApC;MAAEC,EAAE,GAA2BN,KAAK,CAAAM,EAAhC;MAAEC,UAAU,GAAeP,KAAK,CAAAO,UAApB;MAAEC,QAAQ,GAAKR,KAAK,CAAAQ,QAAV;IAC5C,IAAImB,kBAAkB,GAAG;MACvBC,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE;KACL;IACD,IAAIC,gBAAgB,GAAG;MACrBF,EAAE,EAAE,CAAC;MACLC,EAAE,EAAE;KACL;IAED,IAAItB,UAAU,IAAIA,UAAU,CAACwB,CAAC,EAAE;MAC9BJ,kBAAkB,GAAGhC,SAAS,CAACqC,gBAAgB,CAAC7B,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEN,KAAK,CAACO,UAAU,CAACwB,CAAC,CAAC;;IAErF,IAAIvB,QAAQ,IAAIA,QAAQ,CAACuB,CAAC,EAAE;MAC1BD,gBAAgB,GAAGnC,SAAS,CAACqC,gBAAgB,CAAC7B,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEN,KAAK,CAACQ,QAAQ,CAACuB,CAAC,CAAC;;IAGjFL,OAAO,CAACO,SAAS,EAAE;IACnB;IACAP,OAAO,CAACQ,MAAM,CAAC/B,EAAE,GAAGwB,kBAAkB,CAACC,EAAE,EAAExB,EAAE,GAAGuB,kBAAkB,CAACE,EAAE,CAAC;IACtEH,OAAO,CAACS,MAAM,CAAC9B,EAAE,GAAGyB,gBAAgB,CAACF,EAAE,EAAEtB,EAAE,GAAGwB,gBAAgB,CAACD,EAAE,CAAC;EACpE,CAAC;EAEDtC,IAAA,CAAAO,SAAA,CAAAsC,aAAa,GAAb,UAAcV,OAAO;IACnB,IAAMW,eAAe,GAAG,IAAI,CAACC,GAAG,CAAC,iBAAiB,CAAC;IACnD,IAAMC,aAAa,GAAG,IAAI,CAACD,GAAG,CAAC,eAAe,CAAC;IAC/C,IAAID,eAAe,EAAE;MACnBA,eAAe,CAACG,IAAI,CAACd,OAAO,CAAC;;IAE/B,IAAIa,aAAa,EAAE;MACjBA,aAAa,CAACC,IAAI,CAACd,OAAO,CAAC;;EAE/B,CAAC;EAED;;;;EAIAnC,IAAA,CAAAO,SAAA,CAAA2C,cAAc,GAAd;IACQ,IAAAjB,EAAA,GAAqB,IAAI,CAACT,IAAI,EAAE;MAA9BZ,EAAE,GAAAqB,EAAA,CAAArB,EAAA;MAAEC,EAAE,GAAAoB,EAAA,CAAApB,EAAA;MAAEC,EAAE,GAAAmB,EAAA,CAAAnB,EAAA;MAAEC,EAAE,GAAAkB,EAAA,CAAAlB,EAAgB;IACtC,OAAOd,QAAQ,CAACkD,MAAM,CAACvC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;EACxC,CAAC;EAED;;;;;EAKAf,IAAA,CAAAO,SAAA,CAAA6C,QAAQ,GAAR,UAASC,KAAa;IACd,IAAApB,EAAA,GAAqB,IAAI,CAACT,IAAI,EAAE;MAA9BZ,EAAE,GAAAqB,EAAA,CAAArB,EAAA;MAAEC,EAAE,GAAAoB,EAAA,CAAApB,EAAA;MAAEC,EAAE,GAAAmB,EAAA,CAAAnB,EAAA;MAAEC,EAAE,GAAAkB,EAAA,CAAAlB,EAAgB;IACtC,OAAOd,QAAQ,CAACqD,OAAO,CAAC1C,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEsC,KAAK,CAAC;EAChD,CAAC;EACH,OAAArD,IAAC;AAAD,CAAC,CAlGkBE,SAAS;AAoG5B,eAAeF,IAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}
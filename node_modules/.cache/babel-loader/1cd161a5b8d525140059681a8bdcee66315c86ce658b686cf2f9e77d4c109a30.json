{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _dec12, _dec13, _dec14, _dec15, _dec16, _dec17, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _descriptor16;\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n// @ts-ignore\nimport { AsyncSeriesHook } from '@antv/async-hook';\nimport { DOM } from '@antv/l7-utils';\nimport elementResizeDetectorMaker from \"element-resize-detector\";\nimport { EventEmitter } from 'eventemitter3';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport { createRendererContainer } from \"../../utils/dom\";\nimport { InteractionEvent } from \"../interaction/IInteractionService\";\n/**\n * will emit `loaded` `resize` `destroy` event panstart panmove panend\n */\nvar Scene = (_dec = injectable(), _dec2 = inject(TYPES.SceneID), _dec3 = inject(TYPES.IIconService), _dec4 = inject(TYPES.IFontService), _dec5 = inject(TYPES.IControlService), _dec6 = inject(TYPES.IGlobalConfigService), _dec7 = inject(TYPES.IMapService), _dec8 = inject(TYPES.ICoordinateSystemService), _dec9 = inject(TYPES.IRendererService), _dec10 = inject(TYPES.ILayerService), _dec11 = inject(TYPES.IDebugService), _dec12 = inject(TYPES.ICameraService), _dec13 = inject(TYPES.IInteractionService), _dec14 = inject(TYPES.IPickingService), _dec15 = inject(TYPES.IShaderModuleService), _dec16 = inject(TYPES.IMarkerService), _dec17 = inject(TYPES.IPopupService), _dec(_class = (_class2 = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(Scene, _EventEmitter);\n  var _super = _createSuper(Scene);\n  function Scene() {\n    var _this;\n    _classCallCheck(this, Scene);\n    _this = _super.call(this);\n    // @see https://github.com/webpack/tapable#usage\n    _defineProperty(_assertThisInitialized(_this), \"destroyed\", false);\n    _defineProperty(_assertThisInitialized(_this), \"loaded\", false);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"id\", _descriptor, _assertThisInitialized(_this));\n    /**\n     * 使用各种 Service\n     */\n    _initializerDefineProperty(_assertThisInitialized(_this), \"iconService\", _descriptor2, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"fontService\", _descriptor3, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"controlService\", _descriptor4, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"configService\", _descriptor5, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"map\", _descriptor6, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"coordinateSystemService\", _descriptor7, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"rendererService\", _descriptor8, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"layerService\", _descriptor9, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"debugService\", _descriptor10, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"cameraService\", _descriptor11, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"interactionService\", _descriptor12, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"pickingService\", _descriptor13, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"shaderModuleService\", _descriptor14, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"markerService\", _descriptor15, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"popupService\", _descriptor16, _assertThisInitialized(_this));\n    /**\n     * 是否首次渲染\n     */\n    _defineProperty(_assertThisInitialized(_this), \"inited\", false);\n    // TODO: 改成状态机\n    _defineProperty(_assertThisInitialized(_this), \"rendering\", false);\n    /**\n     * canvas 容器\n     */\n    _defineProperty(_assertThisInitialized(_this), \"$container\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"canvas\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"markerContainer\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"resizeDetector\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"hooks\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowResized\", function () {\n      _this.emit('resize');\n      // @ts-check\n      if (_this.$container) {\n        _this.initContainer();\n        // 触发 Map， canvas\n        // DOM.triggerResize();\n        _this.coordinateSystemService.needRefresh = true;\n        //  repaint layers\n        _this.render();\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleMapCameraChanged\", function (viewport) {\n      _this.cameraService.update(viewport);\n      _this.render();\n    });\n    _this.hooks = {\n      /**\n       * 初始化异步任务，可并行：\n       * 1. initMap：初始化地图底图、相机\n       * 2. initRenderer：初始化渲染引擎\n       * 3. initWorker：初始化 Worker\n       */\n      init: new AsyncSeriesHook()\n    };\n    return _this;\n  }\n  _createClass(Scene, [{\n    key: \"init\",\n    value: function init(sceneConfig) {\n      var _this2 = this;\n      // 设置场景配置项\n      this.configService.setSceneConfig(this.id, sceneConfig);\n      // 初始化 ShaderModule\n      this.shaderModuleService.registerBuiltinModules();\n\n      // 初始化资源管理 图片\n      this.iconService.init();\n      this.iconService.on('imageUpdate', function () {\n        return _this2.render();\n      });\n      // 字体资源\n      this.fontService.init();\n      /**\n       * 初始化底图\n       */\n      this.hooks.init.tapPromise('initMap', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this2.debugService.log('map.mapInitStart', {\n                type: _this2.map.version\n              });\n              // 等待首次相机同步\n              _context.next = 3;\n              return new Promise(function (resolve) {\n                _this2.map.onCameraChanged(function (viewport) {\n                  _this2.cameraService.init();\n                  _this2.cameraService.update(viewport);\n                  resolve();\n                });\n                _this2.map.init();\n              });\n            case 3:\n              // 重新绑定非首次相机更新事件\n              _this2.map.onCameraChanged(_this2.handleMapCameraChanged);\n              _this2.map.addMarkerContainer();\n              // 初始化未加载的marker;\n              _this2.markerService.addMarkers();\n              _this2.markerService.addMarkerLayers();\n              _this2.popupService.initPopup();\n              // 地图初始化之后 才能初始化 container 上的交互\n              _this2.interactionService.init();\n              _this2.interactionService.on(InteractionEvent.Drag, _this2.addSceneEvent.bind(_this2));\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      })));\n\n      /**\n       * 初始化渲染引擎\n       */\n      this.hooks.init.tapPromise('initRenderer', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this2$map;\n        var renderContainer, _window$matchMedia;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // https://github.com/antvis/L7/issues/1459#issuecomment-1709481920 不确定我什么会报错先兼容一下\n              renderContainer = ((_this2$map = _this2.map) === null || _this2$map === void 0 ? void 0 : _this2$map.getOverlayContainer()) || undefined;\n              if (renderContainer) {\n                _this2.$container = renderContainer;\n              } else {\n                _this2.$container = createRendererContainer(_this2.configService.getSceneConfig(_this2.id).id || '');\n              }\n\n              // 创建底图之上的 container\n              if (!_this2.$container) {\n                _context2.next = 14;\n                break;\n              }\n              _this2.canvas = DOM.create('canvas', '', _this2.$container);\n              _this2.setCanvas();\n              _context2.next = 7;\n              return _this2.rendererService.init(\n              // @ts-ignore\n              _this2.canvas, _this2.configService.getSceneConfig(_this2.id), sceneConfig.gl);\n            case 7:\n              _this2.registerContextLost();\n              _this2.initContainer();\n              _this2.resizeDetector = elementResizeDetectorMaker({\n                strategy: \"scroll\" //<- For ultra performance.\n              });\n\n              _this2.resizeDetector.listenTo(_this2.$container, _this2.handleWindowResized);\n              if (window.matchMedia) {\n                (_window$matchMedia = window.matchMedia('screen and (-webkit-min-device-pixel-ratio: 1.5)')) === null || _window$matchMedia === void 0 || _window$matchMedia.addListener(_this2.handleWindowResized.bind('screen'));\n              }\n              _context2.next = 15;\n              break;\n            case 14:\n              console.error('容器 id 不存在');\n            case 15:\n              _this2.pickingService.init(_this2.id);\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      })));\n      this.render();\n    }\n  }, {\n    key: \"registerContextLost\",\n    value: function registerContextLost() {\n      var _this3 = this;\n      var canvas = this.rendererService.getCanvas();\n      if (canvas) {\n        canvas.addEventListener('webglcontextlost', function () {\n          return _this3.emit('webglcontextlost');\n        });\n      }\n    }\n  }, {\n    key: \"addLayer\",\n    value: function addLayer(layer) {\n      this.layerService.sceneService = this;\n      this.layerService.add(layer);\n    }\n  }, {\n    key: \"addMask\",\n    value: function addMask(mask) {\n      this.layerService.sceneService = this;\n      this.layerService.addMask(mask);\n    }\n  }, {\n    key: \"render\",\n    value: function () {\n      var _render = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(this.rendering || this.destroyed)) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 2:\n              this.rendering = true;\n              // 首次初始化，或者地图的容器被强制销毁的需要重新初始化\n              if (this.inited) {\n                _context3.next = 16;\n                break;\n              }\n              _context3.next = 6;\n              return this.hooks.init.promise();\n            case 6:\n              // 初始化地图和渲染\n              if (this.destroyed) {\n                this.destroy();\n              }\n              // FIXME: 初始化 marker 容器，可以放到 map 初始化方法中？\n              _context3.next = 9;\n              return this.layerService.initLayers();\n            case 9:\n              this.layerService.renderLayers();\n              this.controlService.addControls();\n              this.loaded = true;\n              this.emit('loaded');\n              this.inited = true;\n              _context3.next = 20;\n              break;\n            case 16:\n              _context3.next = 18;\n              return this.layerService.initLayers();\n            case 18:\n              _context3.next = 20;\n              return this.layerService.renderLayers();\n            case 20:\n              // 组件需要等待layer 初始化完成之后添加\n              this.rendering = false;\n            case 21:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function render() {\n        return _render.apply(this, arguments);\n      }\n      return render;\n    }()\n    /**\n     * 用户自定义添加第三方字体 （用户使用 layer/point/text/iconfont 的前提需要加载第三方字体文件）\n     * @param fontFamily\n     * @param fontPath\n     */\n  }, {\n    key: \"addFontFace\",\n    value: function addFontFace(fontFamily, fontPath) {\n      this.fontService.addFontFace(fontFamily, fontPath);\n    }\n  }, {\n    key: \"getSceneContainer\",\n    value: function getSceneContainer() {\n      return this.$container;\n    }\n  }, {\n    key: \"exportPng\",\n    value: function () {\n      var _exportPng = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(type) {\n        var _this$$container;\n        var renderCanvas, layersPng;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              renderCanvas = (_this$$container = this.$container) === null || _this$$container === void 0 ? void 0 : _this$$container.getElementsByTagName('canvas')[0];\n              _context4.next = 3;\n              return this.render();\n            case 3:\n              layersPng = type === 'jpg' ? renderCanvas === null || renderCanvas === void 0 ? void 0 : renderCanvas.toDataURL('image/jpeg') : renderCanvas === null || renderCanvas === void 0 ? void 0 : renderCanvas.toDataURL('image/png');\n              return _context4.abrupt(\"return\", layersPng);\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function exportPng(_x) {\n        return _exportPng.apply(this, arguments);\n      }\n      return exportPng;\n    }()\n  }, {\n    key: \"getSceneConfig\",\n    value: function getSceneConfig() {\n      return this.configService.getSceneConfig(this.id);\n    }\n\n    // get point size info\n  }, {\n    key: \"getPointSizeRange\",\n    value: function getPointSizeRange() {\n      return this.rendererService.getPointSizeRange();\n    }\n  }, {\n    key: \"addMarkerContainer\",\n    value: function addMarkerContainer() {\n      // @ts-ignore\n      var mapContainer = this.$container.parentElement;\n      if (mapContainer !== null) {\n        this.markerContainer = DOM.create('div', 'l7-marker-container', mapContainer);\n      }\n    }\n  }, {\n    key: \"getMarkerContainer\",\n    value: function getMarkerContainer() {\n      return this.markerContainer;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _this4 = this,\n        _this$$container2;\n      if (!this.inited) {\n        this.destroyed = true;\n        return;\n      }\n      this.resizeDetector.removeListener(this.$container, this.handleWindowResized);\n      this.pickingService.destroy();\n      this.layerService.destroy();\n\n      // this.rendererService.destroy();\n\n      this.interactionService.destroy();\n      this.controlService.destroy();\n      this.markerService.destroy();\n      this.fontService.destroy();\n      this.iconService.destroy();\n      this.removeAllListeners();\n      this.inited = false;\n      this.map.destroy();\n      setTimeout(function () {\n        var _this4$$container;\n        (_this4$$container = _this4.$container) === null || _this4$$container === void 0 || _this4$$container.removeChild(_this4.canvas);\n        // this.canvas = null 清除对 webgl 实例的引用\n        // @ts-ignore\n        _this4.canvas = null;\n        // Tip: 把这一部分销毁放到写下一个事件循环中执行，兼容 L7React 中 scene 和 layer 同时销毁的情况\n        _this4.rendererService.destroy();\n      });\n      // 销毁 container 容器\n      (_this$$container2 = this.$container) === null || _this$$container2 === void 0 || (_this$$container2 = _this$$container2.parentNode) === null || _this$$container2 === void 0 || _this$$container2.removeChild(this.$container);\n      this.emit('destroy');\n    }\n  }, {\n    key: \"initContainer\",\n    value: function initContainer() {\n      var _this$$container3, _this$$container4;\n      var pixelRatio = DOM.DPR;\n      var w = ((_this$$container3 = this.$container) === null || _this$$container3 === void 0 ? void 0 : _this$$container3.clientWidth) || 400;\n      var h = ((_this$$container4 = this.$container) === null || _this$$container4 === void 0 ? void 0 : _this$$container4.clientHeight) || 300;\n      var canvas = this.canvas;\n      if (canvas) {\n        canvas.width = w * pixelRatio;\n        canvas.height = h * pixelRatio;\n      }\n      this.rendererService.viewport({\n        x: 0,\n        y: 0,\n        width: pixelRatio * w,\n        height: pixelRatio * h\n      });\n    }\n  }, {\n    key: \"setCanvas\",\n    value: function setCanvas() {\n      var _this$$container5, _this$$container6;\n      var pixelRatio = DOM.DPR;\n      var w = ((_this$$container5 = this.$container) === null || _this$$container5 === void 0 ? void 0 : _this$$container5.clientWidth) || 400;\n      var h = ((_this$$container6 = this.$container) === null || _this$$container6 === void 0 ? void 0 : _this$$container6.clientHeight) || 300;\n      var canvas = this.canvas;\n      canvas.width = w * pixelRatio;\n      canvas.height = h * pixelRatio;\n      canvas.style.width = '100%';\n      canvas.style.height = '100%';\n    }\n  }, {\n    key: \"addSceneEvent\",\n    value: function addSceneEvent(target) {\n      this.emit(target.type, target);\n    }\n  }]);\n  return Scene;\n}(EventEmitter), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"id\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"iconService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"fontService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, \"controlService\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor6 = _applyDecoratedDescriptor(_class2.prototype, \"map\", [_dec7], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor7 = _applyDecoratedDescriptor(_class2.prototype, \"coordinateSystemService\", [_dec8], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor8 = _applyDecoratedDescriptor(_class2.prototype, \"rendererService\", [_dec9], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor9 = _applyDecoratedDescriptor(_class2.prototype, \"layerService\", [_dec10], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor10 = _applyDecoratedDescriptor(_class2.prototype, \"debugService\", [_dec11], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor11 = _applyDecoratedDescriptor(_class2.prototype, \"cameraService\", [_dec12], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor12 = _applyDecoratedDescriptor(_class2.prototype, \"interactionService\", [_dec13], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor13 = _applyDecoratedDescriptor(_class2.prototype, \"pickingService\", [_dec14], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor14 = _applyDecoratedDescriptor(_class2.prototype, \"shaderModuleService\", [_dec15], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor15 = _applyDecoratedDescriptor(_class2.prototype, \"markerService\", [_dec16], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor16 = _applyDecoratedDescriptor(_class2.prototype, \"popupService\", [_dec17], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { Scene as default };","map":{"version":3,"names":["_asyncToGenerator","_initializerDefineProperty","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_applyDecoratedDescriptor","_initializerWarningHelper","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_dec7","_dec8","_dec9","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_dec16","_dec17","_class","_class2","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","_descriptor7","_descriptor8","_descriptor9","_descriptor10","_descriptor11","_descriptor12","_descriptor13","_descriptor14","_descriptor15","_descriptor16","_regeneratorRuntime","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","AsyncSeriesHook","DOM","elementResizeDetectorMaker","EventEmitter","inject","injectable","TYPES","createRendererContainer","InteractionEvent","Scene","SceneID","IIconService","IFontService","IControlService","IGlobalConfigService","IMapService","ICoordinateSystemService","IRendererService","ILayerService","IDebugService","ICameraService","IInteractionService","IPickingService","IShaderModuleService","IMarkerService","IPopupService","_EventEmitter","_super","_this","emit","$container","initContainer","coordinateSystemService","needRefresh","render","viewport","cameraService","update","hooks","init","key","value","sceneConfig","_this2","configService","setSceneConfig","id","shaderModuleService","registerBuiltinModules","iconService","on","fontService","tapPromise","mark","_callee","wrap","_callee$","_context","prev","next","debugService","log","type","map","version","Promise","resolve","onCameraChanged","handleMapCameraChanged","addMarkerContainer","markerService","addMarkers","addMarkerLayers","popupService","initPopup","interactionService","Drag","addSceneEvent","bind","stop","_callee2","_this2$map","renderContainer","_window$matchMedia","_callee2$","_context2","getOverlayContainer","undefined","getSceneConfig","canvas","create","setCanvas","rendererService","gl","registerContextLost","resizeDetector","strategy","listenTo","handleWindowResized","window","matchMedia","addListener","console","error","pickingService","_this3","getCanvas","addEventListener","addLayer","layer","layerService","sceneService","add","addMask","mask","_render","_callee3","_callee3$","_context3","rendering","destroyed","abrupt","inited","promise","destroy","initLayers","renderLayers","controlService","addControls","loaded","addFontFace","fontFamily","fontPath","getSceneContainer","_exportPng","_callee4","_this$$container","renderCanvas","layersPng","_callee4$","_context4","getElementsByTagName","toDataURL","exportPng","_x","getPointSizeRange","mapContainer","parentElement","markerContainer","getMarkerContainer","_this4","_this$$container2","removeListener","removeAllListeners","setTimeout","_this4$$container","removeChild","parentNode","_this$$container3","_this$$container4","pixelRatio","DPR","w","clientWidth","h","clientHeight","width","height","x","y","_this$$container5","_this$$container6","style","target","configurable","enumerable","writable","initializer","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-core/es/services/scene/SceneService.js"],"sourcesContent":["import _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _dec12, _dec13, _dec14, _dec15, _dec16, _dec17, _class, _class2, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _descriptor16;\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n// @ts-ignore\nimport { AsyncSeriesHook } from '@antv/async-hook';\nimport { DOM } from '@antv/l7-utils';\nimport elementResizeDetectorMaker from \"element-resize-detector\";\nimport { EventEmitter } from 'eventemitter3';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { TYPES } from \"../../types\";\nimport { createRendererContainer } from \"../../utils/dom\";\nimport { InteractionEvent } from \"../interaction/IInteractionService\";\n/**\n * will emit `loaded` `resize` `destroy` event panstart panmove panend\n */\nvar Scene = (_dec = injectable(), _dec2 = inject(TYPES.SceneID), _dec3 = inject(TYPES.IIconService), _dec4 = inject(TYPES.IFontService), _dec5 = inject(TYPES.IControlService), _dec6 = inject(TYPES.IGlobalConfigService), _dec7 = inject(TYPES.IMapService), _dec8 = inject(TYPES.ICoordinateSystemService), _dec9 = inject(TYPES.IRendererService), _dec10 = inject(TYPES.ILayerService), _dec11 = inject(TYPES.IDebugService), _dec12 = inject(TYPES.ICameraService), _dec13 = inject(TYPES.IInteractionService), _dec14 = inject(TYPES.IPickingService), _dec15 = inject(TYPES.IShaderModuleService), _dec16 = inject(TYPES.IMarkerService), _dec17 = inject(TYPES.IPopupService), _dec(_class = (_class2 = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(Scene, _EventEmitter);\n  var _super = _createSuper(Scene);\n  function Scene() {\n    var _this;\n    _classCallCheck(this, Scene);\n    _this = _super.call(this);\n    // @see https://github.com/webpack/tapable#usage\n    _defineProperty(_assertThisInitialized(_this), \"destroyed\", false);\n    _defineProperty(_assertThisInitialized(_this), \"loaded\", false);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"id\", _descriptor, _assertThisInitialized(_this));\n    /**\n     * 使用各种 Service\n     */\n    _initializerDefineProperty(_assertThisInitialized(_this), \"iconService\", _descriptor2, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"fontService\", _descriptor3, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"controlService\", _descriptor4, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"configService\", _descriptor5, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"map\", _descriptor6, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"coordinateSystemService\", _descriptor7, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"rendererService\", _descriptor8, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"layerService\", _descriptor9, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"debugService\", _descriptor10, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"cameraService\", _descriptor11, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"interactionService\", _descriptor12, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"pickingService\", _descriptor13, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"shaderModuleService\", _descriptor14, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"markerService\", _descriptor15, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"popupService\", _descriptor16, _assertThisInitialized(_this));\n    /**\n     * 是否首次渲染\n     */\n    _defineProperty(_assertThisInitialized(_this), \"inited\", false);\n    // TODO: 改成状态机\n    _defineProperty(_assertThisInitialized(_this), \"rendering\", false);\n    /**\n     * canvas 容器\n     */\n    _defineProperty(_assertThisInitialized(_this), \"$container\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"canvas\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"markerContainer\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"resizeDetector\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"hooks\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowResized\", function () {\n      _this.emit('resize');\n      // @ts-check\n      if (_this.$container) {\n        _this.initContainer();\n        // 触发 Map， canvas\n        // DOM.triggerResize();\n        _this.coordinateSystemService.needRefresh = true;\n        //  repaint layers\n        _this.render();\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"handleMapCameraChanged\", function (viewport) {\n      _this.cameraService.update(viewport);\n      _this.render();\n    });\n    _this.hooks = {\n      /**\n       * 初始化异步任务，可并行：\n       * 1. initMap：初始化地图底图、相机\n       * 2. initRenderer：初始化渲染引擎\n       * 3. initWorker：初始化 Worker\n       */\n      init: new AsyncSeriesHook()\n    };\n    return _this;\n  }\n  _createClass(Scene, [{\n    key: \"init\",\n    value: function init(sceneConfig) {\n      var _this2 = this;\n      // 设置场景配置项\n      this.configService.setSceneConfig(this.id, sceneConfig);\n      // 初始化 ShaderModule\n      this.shaderModuleService.registerBuiltinModules();\n\n      // 初始化资源管理 图片\n      this.iconService.init();\n      this.iconService.on('imageUpdate', function () {\n        return _this2.render();\n      });\n      // 字体资源\n      this.fontService.init();\n      /**\n       * 初始化底图\n       */\n      this.hooks.init.tapPromise('initMap', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this2.debugService.log('map.mapInitStart', {\n                type: _this2.map.version\n              });\n              // 等待首次相机同步\n              _context.next = 3;\n              return new Promise(function (resolve) {\n                _this2.map.onCameraChanged(function (viewport) {\n                  _this2.cameraService.init();\n                  _this2.cameraService.update(viewport);\n                  resolve();\n                });\n                _this2.map.init();\n              });\n            case 3:\n              // 重新绑定非首次相机更新事件\n              _this2.map.onCameraChanged(_this2.handleMapCameraChanged);\n              _this2.map.addMarkerContainer();\n              // 初始化未加载的marker;\n              _this2.markerService.addMarkers();\n              _this2.markerService.addMarkerLayers();\n              _this2.popupService.initPopup();\n              // 地图初始化之后 才能初始化 container 上的交互\n              _this2.interactionService.init();\n              _this2.interactionService.on(InteractionEvent.Drag, _this2.addSceneEvent.bind(_this2));\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      })));\n\n      /**\n       * 初始化渲染引擎\n       */\n      this.hooks.init.tapPromise('initRenderer', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this2$map;\n        var renderContainer, _window$matchMedia;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // https://github.com/antvis/L7/issues/1459#issuecomment-1709481920 不确定我什么会报错先兼容一下\n              renderContainer = ((_this2$map = _this2.map) === null || _this2$map === void 0 ? void 0 : _this2$map.getOverlayContainer()) || undefined;\n              if (renderContainer) {\n                _this2.$container = renderContainer;\n              } else {\n                _this2.$container = createRendererContainer(_this2.configService.getSceneConfig(_this2.id).id || '');\n              }\n\n              // 创建底图之上的 container\n              if (!_this2.$container) {\n                _context2.next = 14;\n                break;\n              }\n              _this2.canvas = DOM.create('canvas', '', _this2.$container);\n              _this2.setCanvas();\n              _context2.next = 7;\n              return _this2.rendererService.init(\n              // @ts-ignore\n              _this2.canvas, _this2.configService.getSceneConfig(_this2.id), sceneConfig.gl);\n            case 7:\n              _this2.registerContextLost();\n              _this2.initContainer();\n              _this2.resizeDetector = elementResizeDetectorMaker({\n                strategy: \"scroll\" //<- For ultra performance.\n              });\n\n              _this2.resizeDetector.listenTo(_this2.$container, _this2.handleWindowResized);\n              if (window.matchMedia) {\n                (_window$matchMedia = window.matchMedia('screen and (-webkit-min-device-pixel-ratio: 1.5)')) === null || _window$matchMedia === void 0 || _window$matchMedia.addListener(_this2.handleWindowResized.bind('screen'));\n              }\n              _context2.next = 15;\n              break;\n            case 14:\n              console.error('容器 id 不存在');\n            case 15:\n              _this2.pickingService.init(_this2.id);\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      })));\n      this.render();\n    }\n  }, {\n    key: \"registerContextLost\",\n    value: function registerContextLost() {\n      var _this3 = this;\n      var canvas = this.rendererService.getCanvas();\n      if (canvas) {\n        canvas.addEventListener('webglcontextlost', function () {\n          return _this3.emit('webglcontextlost');\n        });\n      }\n    }\n  }, {\n    key: \"addLayer\",\n    value: function addLayer(layer) {\n      this.layerService.sceneService = this;\n      this.layerService.add(layer);\n    }\n  }, {\n    key: \"addMask\",\n    value: function addMask(mask) {\n      this.layerService.sceneService = this;\n      this.layerService.addMask(mask);\n    }\n  }, {\n    key: \"render\",\n    value: function () {\n      var _render = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(this.rendering || this.destroyed)) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 2:\n              this.rendering = true;\n              // 首次初始化，或者地图的容器被强制销毁的需要重新初始化\n              if (this.inited) {\n                _context3.next = 16;\n                break;\n              }\n              _context3.next = 6;\n              return this.hooks.init.promise();\n            case 6:\n              // 初始化地图和渲染\n              if (this.destroyed) {\n                this.destroy();\n              }\n              // FIXME: 初始化 marker 容器，可以放到 map 初始化方法中？\n              _context3.next = 9;\n              return this.layerService.initLayers();\n            case 9:\n              this.layerService.renderLayers();\n              this.controlService.addControls();\n              this.loaded = true;\n              this.emit('loaded');\n              this.inited = true;\n              _context3.next = 20;\n              break;\n            case 16:\n              _context3.next = 18;\n              return this.layerService.initLayers();\n            case 18:\n              _context3.next = 20;\n              return this.layerService.renderLayers();\n            case 20:\n              // 组件需要等待layer 初始化完成之后添加\n              this.rendering = false;\n            case 21:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function render() {\n        return _render.apply(this, arguments);\n      }\n      return render;\n    }()\n    /**\n     * 用户自定义添加第三方字体 （用户使用 layer/point/text/iconfont 的前提需要加载第三方字体文件）\n     * @param fontFamily\n     * @param fontPath\n     */\n  }, {\n    key: \"addFontFace\",\n    value: function addFontFace(fontFamily, fontPath) {\n      this.fontService.addFontFace(fontFamily, fontPath);\n    }\n  }, {\n    key: \"getSceneContainer\",\n    value: function getSceneContainer() {\n      return this.$container;\n    }\n  }, {\n    key: \"exportPng\",\n    value: function () {\n      var _exportPng = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(type) {\n        var _this$$container;\n        var renderCanvas, layersPng;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              renderCanvas = (_this$$container = this.$container) === null || _this$$container === void 0 ? void 0 : _this$$container.getElementsByTagName('canvas')[0];\n              _context4.next = 3;\n              return this.render();\n            case 3:\n              layersPng = type === 'jpg' ? renderCanvas === null || renderCanvas === void 0 ? void 0 : renderCanvas.toDataURL('image/jpeg') : renderCanvas === null || renderCanvas === void 0 ? void 0 : renderCanvas.toDataURL('image/png');\n              return _context4.abrupt(\"return\", layersPng);\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function exportPng(_x) {\n        return _exportPng.apply(this, arguments);\n      }\n      return exportPng;\n    }()\n  }, {\n    key: \"getSceneConfig\",\n    value: function getSceneConfig() {\n      return this.configService.getSceneConfig(this.id);\n    }\n\n    // get point size info\n  }, {\n    key: \"getPointSizeRange\",\n    value: function getPointSizeRange() {\n      return this.rendererService.getPointSizeRange();\n    }\n  }, {\n    key: \"addMarkerContainer\",\n    value: function addMarkerContainer() {\n      // @ts-ignore\n      var mapContainer = this.$container.parentElement;\n      if (mapContainer !== null) {\n        this.markerContainer = DOM.create('div', 'l7-marker-container', mapContainer);\n      }\n    }\n  }, {\n    key: \"getMarkerContainer\",\n    value: function getMarkerContainer() {\n      return this.markerContainer;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var _this4 = this,\n        _this$$container2;\n      if (!this.inited) {\n        this.destroyed = true;\n        return;\n      }\n      this.resizeDetector.removeListener(this.$container, this.handleWindowResized);\n      this.pickingService.destroy();\n      this.layerService.destroy();\n\n      // this.rendererService.destroy();\n\n      this.interactionService.destroy();\n      this.controlService.destroy();\n      this.markerService.destroy();\n      this.fontService.destroy();\n      this.iconService.destroy();\n      this.removeAllListeners();\n      this.inited = false;\n      this.map.destroy();\n      setTimeout(function () {\n        var _this4$$container;\n        (_this4$$container = _this4.$container) === null || _this4$$container === void 0 || _this4$$container.removeChild(_this4.canvas);\n        // this.canvas = null 清除对 webgl 实例的引用\n        // @ts-ignore\n        _this4.canvas = null;\n        // Tip: 把这一部分销毁放到写下一个事件循环中执行，兼容 L7React 中 scene 和 layer 同时销毁的情况\n        _this4.rendererService.destroy();\n      });\n      // 销毁 container 容器\n      (_this$$container2 = this.$container) === null || _this$$container2 === void 0 || (_this$$container2 = _this$$container2.parentNode) === null || _this$$container2 === void 0 || _this$$container2.removeChild(this.$container);\n      this.emit('destroy');\n    }\n  }, {\n    key: \"initContainer\",\n    value: function initContainer() {\n      var _this$$container3, _this$$container4;\n      var pixelRatio = DOM.DPR;\n      var w = ((_this$$container3 = this.$container) === null || _this$$container3 === void 0 ? void 0 : _this$$container3.clientWidth) || 400;\n      var h = ((_this$$container4 = this.$container) === null || _this$$container4 === void 0 ? void 0 : _this$$container4.clientHeight) || 300;\n      var canvas = this.canvas;\n      if (canvas) {\n        canvas.width = w * pixelRatio;\n        canvas.height = h * pixelRatio;\n      }\n      this.rendererService.viewport({\n        x: 0,\n        y: 0,\n        width: pixelRatio * w,\n        height: pixelRatio * h\n      });\n    }\n  }, {\n    key: \"setCanvas\",\n    value: function setCanvas() {\n      var _this$$container5, _this$$container6;\n      var pixelRatio = DOM.DPR;\n      var w = ((_this$$container5 = this.$container) === null || _this$$container5 === void 0 ? void 0 : _this$$container5.clientWidth) || 400;\n      var h = ((_this$$container6 = this.$container) === null || _this$$container6 === void 0 ? void 0 : _this$$container6.clientHeight) || 300;\n      var canvas = this.canvas;\n      canvas.width = w * pixelRatio;\n      canvas.height = h * pixelRatio;\n      canvas.style.width = '100%';\n      canvas.style.height = '100%';\n    }\n  }, {\n    key: \"addSceneEvent\",\n    value: function addSceneEvent(target) {\n      this.emit(target.type, target);\n    }\n  }]);\n  return Scene;\n}(EventEmitter), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"id\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"iconService\", [_dec3], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class2.prototype, \"fontService\", [_dec4], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class2.prototype, \"controlService\", [_dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor5 = _applyDecoratedDescriptor(_class2.prototype, \"configService\", [_dec6], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor6 = _applyDecoratedDescriptor(_class2.prototype, \"map\", [_dec7], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor7 = _applyDecoratedDescriptor(_class2.prototype, \"coordinateSystemService\", [_dec8], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor8 = _applyDecoratedDescriptor(_class2.prototype, \"rendererService\", [_dec9], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor9 = _applyDecoratedDescriptor(_class2.prototype, \"layerService\", [_dec10], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor10 = _applyDecoratedDescriptor(_class2.prototype, \"debugService\", [_dec11], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor11 = _applyDecoratedDescriptor(_class2.prototype, \"cameraService\", [_dec12], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor12 = _applyDecoratedDescriptor(_class2.prototype, \"interactionService\", [_dec13], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor13 = _applyDecoratedDescriptor(_class2.prototype, \"pickingService\", [_dec14], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor14 = _applyDecoratedDescriptor(_class2.prototype, \"shaderModuleService\", [_dec15], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor15 = _applyDecoratedDescriptor(_class2.prototype, \"markerService\", [_dec16], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor16 = _applyDecoratedDescriptor(_class2.prototype, \"popupService\", [_dec17], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nexport { Scene as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n/**\n * WebGL 中的顶点数据压缩\n * 使用 float-pack 技术，在 shader 中解压\n * @see https://zhuanlan.zhihu.com/p/67484498\n */\n\nimport { lodashUtil } from '@antv/l7-utils';\nimport { getShapeIndex } from \"./sdf-2d\";\nvar clamp = lodashUtil.clamp;\nexport var LEFT_SHIFT1 = 2;\nexport var LEFT_SHIFT2 = 4;\nexport var LEFT_SHIFT6 = 64;\nexport var LEFT_SHIFT7 = 128;\nexport var LEFT_SHIFT8 = 256;\nexport var LEFT_SHIFT9 = 512;\nexport var LEFT_SHIFT13 = 8192;\nexport var LEFT_SHIFT14 = 16384;\nexport var LEFT_SHIFT15 = 32768;\nexport var LEFT_SHIFT16 = 32768 * 2;\nexport var LEFT_SHIFT17 = 131072.0;\nexport var LEFT_SHIFT18 = 262144.0;\nexport var LEFT_SHIFT19 = 524288.0;\nexport var LEFT_SHIFT20 = 1048576.0;\nexport var LEFT_SHIFT21 = 2097152.0;\nexport var LEFT_SHIFT22 = 4194304.0;\nexport var LEFT_SHIFT23 = 8388608.0;\nexport var LEFT_SHIFT24 = 16777216.0;\nexport var LEFT_SHIFT25 = 16777216.0 * 2;\n\n/**\n * encode 2 8-bit unsigned int into a 16-bit float\n * @param {number} a 8-bit int\n * @param {number} b 8-bit int\n * @return {number} float\n */\nexport function packUint8ToFloat(a, b) {\n  a = clamp(Math.floor(a), 0, 255);\n  b = clamp(Math.floor(b), 0, 255);\n  return 256 * a + b;\n}\n\n/**\n * 为 SDF circle 压缩顶点数据\n */\nexport function packCircleVertex(props) {\n  var color = props.color,\n    radius = props.radius,\n    tileX = props.tileX,\n    tileY = props.tileY,\n    shape = props.shape,\n    opacity = props.opacity,\n    stroke = props.stroke,\n    strokeWidth = props.strokeWidth,\n    strokeOpacity = props.strokeOpacity;\n  var packedBuffer = [];\n  var packedBuffer2 = [];\n  var packedBuffer3 = [];\n  var packedColor = [packUint8ToFloat(color[0], color[1]), packUint8ToFloat(color[2], color[3])];\n  var packedStrokeColor = [packUint8ToFloat(stroke[0], stroke[1]), packUint8ToFloat(stroke[2], stroke[3])];\n  [[-1, -1], [1, -1], [1, 1], [-1, 1]].forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      extrudeX = _ref2[0],\n      extrudeY = _ref2[1];\n    // vec4(\n    //   color,\n    //   color,\n    //   (4-bit extrude, 4-bit shape, 16-bit radius),\n    //   tileCoords\n    // )\n    packedBuffer.push([].concat(packedColor, [(extrudeX + 1) * LEFT_SHIFT23 + (extrudeY + 1) * LEFT_SHIFT21 + getShapeIndex(shape) * LEFT_SHIFT17 + radius, (tileX + 512) * LEFT_SHIFT19 + (tileY + 512) * LEFT_SHIFT6]));\n\n    // vec4(\n    //   strokeColor,\n    //   strokeColor,\n    //   strokeWidth,\n    //   strokeOpacity\n    // )\n    packedBuffer2.push([].concat(packedStrokeColor, [strokeWidth, strokeOpacity]));\n    packedBuffer3.push([opacity, 0, 0, 0]);\n  });\n  return {\n    packedBuffer: packedBuffer,\n    packedBuffer2: packedBuffer2,\n    packedBuffer3: packedBuffer3\n  };\n}\nexport function packOpacity(opacity, placed) {\n  if (opacity === 0 && !placed) {\n    return 0;\n  } else if (opacity === 1 && placed) {\n    return 4294967295;\n  }\n  var targetBit = placed ? 1 : 0;\n  var opacityBits = Math.floor(opacity * 127);\n  return opacityBits * LEFT_SHIFT25 + targetBit * LEFT_SHIFT24 + opacityBits * LEFT_SHIFT17 + targetBit * LEFT_SHIFT16 + opacityBits * LEFT_SHIFT9 + targetBit * LEFT_SHIFT8 + opacityBits * LEFT_SHIFT1 + targetBit;\n}","map":{"version":3,"names":["_slicedToArray","lodashUtil","getShapeIndex","clamp","LEFT_SHIFT1","LEFT_SHIFT2","LEFT_SHIFT6","LEFT_SHIFT7","LEFT_SHIFT8","LEFT_SHIFT9","LEFT_SHIFT13","LEFT_SHIFT14","LEFT_SHIFT15","LEFT_SHIFT16","LEFT_SHIFT17","LEFT_SHIFT18","LEFT_SHIFT19","LEFT_SHIFT20","LEFT_SHIFT21","LEFT_SHIFT22","LEFT_SHIFT23","LEFT_SHIFT24","LEFT_SHIFT25","packUint8ToFloat","a","b","Math","floor","packCircleVertex","props","color","radius","tileX","tileY","shape","opacity","stroke","strokeWidth","strokeOpacity","packedBuffer","packedBuffer2","packedBuffer3","packedColor","packedStrokeColor","forEach","_ref","_ref2","extrudeX","extrudeY","push","concat","packOpacity","placed","targetBit","opacityBits"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-core/es/utils/vertex-compression.js"],"sourcesContent":["import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n/**\n * WebGL 中的顶点数据压缩\n * 使用 float-pack 技术，在 shader 中解压\n * @see https://zhuanlan.zhihu.com/p/67484498\n */\n\nimport { lodashUtil } from '@antv/l7-utils';\nimport { getShapeIndex } from \"./sdf-2d\";\nvar clamp = lodashUtil.clamp;\nexport var LEFT_SHIFT1 = 2;\nexport var LEFT_SHIFT2 = 4;\nexport var LEFT_SHIFT6 = 64;\nexport var LEFT_SHIFT7 = 128;\nexport var LEFT_SHIFT8 = 256;\nexport var LEFT_SHIFT9 = 512;\nexport var LEFT_SHIFT13 = 8192;\nexport var LEFT_SHIFT14 = 16384;\nexport var LEFT_SHIFT15 = 32768;\nexport var LEFT_SHIFT16 = 32768 * 2;\nexport var LEFT_SHIFT17 = 131072.0;\nexport var LEFT_SHIFT18 = 262144.0;\nexport var LEFT_SHIFT19 = 524288.0;\nexport var LEFT_SHIFT20 = 1048576.0;\nexport var LEFT_SHIFT21 = 2097152.0;\nexport var LEFT_SHIFT22 = 4194304.0;\nexport var LEFT_SHIFT23 = 8388608.0;\nexport var LEFT_SHIFT24 = 16777216.0;\nexport var LEFT_SHIFT25 = 16777216.0 * 2;\n\n/**\n * encode 2 8-bit unsigned int into a 16-bit float\n * @param {number} a 8-bit int\n * @param {number} b 8-bit int\n * @return {number} float\n */\nexport function packUint8ToFloat(a, b) {\n  a = clamp(Math.floor(a), 0, 255);\n  b = clamp(Math.floor(b), 0, 255);\n  return 256 * a + b;\n}\n\n/**\n * 为 SDF circle 压缩顶点数据\n */\nexport function packCircleVertex(props) {\n  var color = props.color,\n    radius = props.radius,\n    tileX = props.tileX,\n    tileY = props.tileY,\n    shape = props.shape,\n    opacity = props.opacity,\n    stroke = props.stroke,\n    strokeWidth = props.strokeWidth,\n    strokeOpacity = props.strokeOpacity;\n  var packedBuffer = [];\n  var packedBuffer2 = [];\n  var packedBuffer3 = [];\n  var packedColor = [packUint8ToFloat(color[0], color[1]), packUint8ToFloat(color[2], color[3])];\n  var packedStrokeColor = [packUint8ToFloat(stroke[0], stroke[1]), packUint8ToFloat(stroke[2], stroke[3])];\n  [[-1, -1], [1, -1], [1, 1], [-1, 1]].forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      extrudeX = _ref2[0],\n      extrudeY = _ref2[1];\n    // vec4(\n    //   color,\n    //   color,\n    //   (4-bit extrude, 4-bit shape, 16-bit radius),\n    //   tileCoords\n    // )\n    packedBuffer.push([].concat(packedColor, [(extrudeX + 1) * LEFT_SHIFT23 + (extrudeY + 1) * LEFT_SHIFT21 + getShapeIndex(shape) * LEFT_SHIFT17 + radius, (tileX + 512) * LEFT_SHIFT19 + (tileY + 512) * LEFT_SHIFT6]));\n\n    // vec4(\n    //   strokeColor,\n    //   strokeColor,\n    //   strokeWidth,\n    //   strokeOpacity\n    // )\n    packedBuffer2.push([].concat(packedStrokeColor, [strokeWidth, strokeOpacity]));\n    packedBuffer3.push([opacity, 0, 0, 0]);\n  });\n  return {\n    packedBuffer: packedBuffer,\n    packedBuffer2: packedBuffer2,\n    packedBuffer3: packedBuffer3\n  };\n}\nexport function packOpacity(opacity, placed) {\n  if (opacity === 0 && !placed) {\n    return 0;\n  } else if (opacity === 1 && placed) {\n    return 4294967295;\n  }\n  var targetBit = placed ? 1 : 0;\n  var opacityBits = Math.floor(opacity * 127);\n  return opacityBits * LEFT_SHIFT25 + targetBit * LEFT_SHIFT24 + opacityBits * LEFT_SHIFT17 + targetBit * LEFT_SHIFT16 + opacityBits * LEFT_SHIFT9 + targetBit * LEFT_SHIFT8 + opacityBits * LEFT_SHIFT1 + targetBit;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
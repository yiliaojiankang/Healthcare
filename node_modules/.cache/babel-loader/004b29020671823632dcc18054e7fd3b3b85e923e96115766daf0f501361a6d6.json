{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { isFunction } from '@antv/util';\nvar MyWorker = /** @class */function () {\n  function MyWorker(url) {\n    var _this = this;\n    this.queue = [];\n    this.worker = new Worker(url);\n    this.worker.onmessage = function (e) {\n      var _a;\n      (_a = _this.queue.shift()) === null || _a === void 0 ? void 0 : _a.resolve(e);\n    };\n    this.worker.onmessageerror = function (e) {\n      var _a;\n      console.warn('[AntV G2] Web worker is not available');\n      (_a = _this.queue.shift()) === null || _a === void 0 ? void 0 : _a.reject(e);\n    };\n  }\n  MyWorker.prototype.post = function (params, onError) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      _this.queue.push({\n        resolve: resolve,\n        reject: reject\n      });\n      try {\n        _this.worker.postMessage(params);\n      } catch (e) {\n        console.warn('[AntV G2] Web worker is not available');\n        isFunction(onError) && onError();\n      }\n    });\n  };\n  MyWorker.prototype.destroy = function () {\n    this.worker.terminate();\n  };\n  return MyWorker;\n}();\nexport function createWorker(f) {\n  if (typeof window === 'undefined') return;\n  var blob;\n  try {\n    blob = new Blob([f.toString()], {\n      type: 'application/javascript'\n    });\n  } catch (e) {\n    // @ts-ignore\n    blob = new window.BlobBuilder();\n    blob.append(f.toString());\n    blob = blob.getBlob();\n  }\n  return new MyWorker(URL.createObjectURL(blob));\n}","map":{"version":3,"names":["isFunction","MyWorker","url","_this","queue","worker","Worker","onmessage","e","_a","shift","resolve","onmessageerror","console","warn","reject","prototype","post","params","onError","Promise","push","postMessage","destroy","terminate","createWorker","f","window","blob","Blob","toString","type","BlobBuilder","append","getBlob","URL","createObjectURL"],"sources":["../../../../src/geometry/label/util/createWorker.ts"],"sourcesContent":["import { isFunction } from '@antv/util';\n\nclass MyWorker {\n  queue: any[] = [];\n  worker: Worker;\n\n  constructor(url) {\n    this.worker = new Worker(url);\n    this.worker.onmessage = (e: MessageEvent) => {\n      this.queue.shift()?.resolve(e);\n    };\n    this.worker.onmessageerror = (e: MessageEvent) => {\n      console.warn('[AntV G2] Web worker is not available');\n      this.queue.shift()?.reject(e);\n    };\n  }\n\n  post(params, onError?: () => any): Promise<MessageEvent> {\n    return new Promise((resolve, reject) => {\n      this.queue.push({ resolve, reject });\n      try {\n        this.worker.postMessage(params);\n      } catch (e) {\n        console.warn('[AntV G2] Web worker is not available');\n        isFunction(onError) && onError();\n      }\n    });\n  }\n\n  destroy() {\n    this.worker.terminate();\n  }\n}\n\nexport function createWorker(f: any) {\n  if (typeof window === 'undefined') return;\n\n  let blob;\n  try {\n    blob = new Blob([f.toString()], { type: 'application/javascript' });\n  } catch (e) {\n    // @ts-ignore\n    blob = new window.BlobBuilder();\n    blob.append(f.toString());\n    blob = blob.getBlob();\n  }\n\n  return new MyWorker(URL.createObjectURL(blob));\n}\n"],"mappings":";;;;AAAA,SAASA,UAAU,QAAQ,YAAY;AAEvC,IAAAC,QAAA;EAIE,SAAAA,SAAYC,GAAG;IAAf,IAAAC,KAAA;IAHA,KAAAC,KAAK,GAAU,EAAE;IAIf,IAAI,CAACC,MAAM,GAAG,IAAIC,MAAM,CAACJ,GAAG,CAAC;IAC7B,IAAI,CAACG,MAAM,CAACE,SAAS,GAAG,UAACC,CAAe;;MACtC,CAAAC,EAAA,GAAAN,KAAI,CAACC,KAAK,CAACM,KAAK,EAAE,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,OAAO,CAACH,CAAC,CAAC;IAChC,CAAC;IACD,IAAI,CAACH,MAAM,CAACO,cAAc,GAAG,UAACJ,CAAe;;MAC3CK,OAAO,CAACC,IAAI,CAAC,uCAAuC,CAAC;MACrD,CAAAL,EAAA,GAAAN,KAAI,CAACC,KAAK,CAACM,KAAK,EAAE,cAAAD,EAAA,uBAAAA,EAAA,CAAEM,MAAM,CAACP,CAAC,CAAC;IAC/B,CAAC;EACH;EAEAP,QAAA,CAAAe,SAAA,CAAAC,IAAI,GAAJ,UAAKC,MAAM,EAAEC,OAAmB;IAAhC,IAAAhB,KAAA;IACE,OAAO,IAAIiB,OAAO,CAAC,UAACT,OAAO,EAAEI,MAAM;MACjCZ,KAAI,CAACC,KAAK,CAACiB,IAAI,CAAC;QAAEV,OAAO,EAAAA,OAAA;QAAEI,MAAM,EAAAA;MAAA,CAAE,CAAC;MACpC,IAAI;QACFZ,KAAI,CAACE,MAAM,CAACiB,WAAW,CAACJ,MAAM,CAAC;OAChC,CAAC,OAAOV,CAAC,EAAE;QACVK,OAAO,CAACC,IAAI,CAAC,uCAAuC,CAAC;QACrDd,UAAU,CAACmB,OAAO,CAAC,IAAIA,OAAO,EAAE;;IAEpC,CAAC,CAAC;EACJ,CAAC;EAEDlB,QAAA,CAAAe,SAAA,CAAAO,OAAO,GAAP;IACE,IAAI,CAAClB,MAAM,CAACmB,SAAS,EAAE;EACzB,CAAC;EACH,OAAAvB,QAAC;AAAD,CAAC,CA9BD;AAgCA,OAAM,SAAUwB,YAAYA,CAACC,CAAM;EACjC,IAAI,OAAOC,MAAM,KAAK,WAAW,EAAE;EAEnC,IAAIC,IAAI;EACR,IAAI;IACFA,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACH,CAAC,CAACI,QAAQ,EAAE,CAAC,EAAE;MAAEC,IAAI,EAAE;IAAwB,CAAE,CAAC;GACpE,CAAC,OAAOvB,CAAC,EAAE;IACV;IACAoB,IAAI,GAAG,IAAID,MAAM,CAACK,WAAW,EAAE;IAC/BJ,IAAI,CAACK,MAAM,CAACP,CAAC,CAACI,QAAQ,EAAE,CAAC;IACzBF,IAAI,GAAGA,IAAI,CAACM,OAAO,EAAE;;EAGvB,OAAO,IAAIjC,QAAQ,CAACkC,GAAG,CAACC,eAAe,CAACR,IAAI,CAAC,CAAC;AAChD"},"metadata":{},"sourceType":"module","externalDependencies":[]}
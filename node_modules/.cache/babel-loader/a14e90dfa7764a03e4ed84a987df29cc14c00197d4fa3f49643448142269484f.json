{"ast":null,"code":"import { __extends, __read } from \"tslib\";\nimport { each } from '@antv/util';\nimport Action from '../base';\nimport { getDelegationObject, getScaleByField, isList, isSlider } from '../util';\n/**\n * 数据过滤。\n * @ignore\n */\nvar DataFilter = /** @class */function (_super) {\n  __extends(DataFilter, _super);\n  function DataFilter() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DataFilter.prototype.filterView = function (view, field, filter) {\n    var _this = this;\n    // 只有存在这个 scale 时才生效\n    if (view.getScaleByField(field)) {\n      view.filter(field, filter);\n    }\n    if (view.views && view.views.length) {\n      each(view.views, function (subView) {\n        _this.filterView(subView, field, filter);\n      });\n    }\n  };\n  /**\n   * 过滤数据\n   */\n  DataFilter.prototype.filter = function () {\n    var delegateObject = getDelegationObject(this.context);\n    if (delegateObject) {\n      var view = this.context.view;\n      var component = delegateObject.component;\n      var field = component.get('field');\n      // 列表类的组件能够触发\n      if (isList(delegateObject)) {\n        if (field) {\n          var unCheckedItems = component.getItemsByState('unchecked');\n          var scale_1 = getScaleByField(view, field);\n          var names_1 = unCheckedItems.map(function (item) {\n            return item.name;\n          });\n          if (names_1.length) {\n            this.filterView(view, field, function (value) {\n              var text = scale_1.getText(value);\n              return !names_1.includes(text);\n            });\n          } else {\n            this.filterView(view, field, null);\n          }\n          view.render(true);\n        }\n      } else if (isSlider(delegateObject)) {\n        var range = component.getValue();\n        var _a = __read(range, 2),\n          min_1 = _a[0],\n          max_1 = _a[1];\n        this.filterView(view, field, function (value) {\n          return value >= min_1 && value <= max_1;\n        });\n        view.render(true);\n      }\n    }\n  };\n  return DataFilter;\n}(Action);\nexport default DataFilter;","map":{"version":3,"names":["each","Action","getDelegationObject","getScaleByField","isList","isSlider","DataFilter","_super","__extends","prototype","filterView","view","field","filter","_this","views","length","subView","delegateObject","context","component","get","unCheckedItems","getItemsByState","scale_1","names_1","map","item","name","value","text","getText","includes","render","range","getValue","_a","__read","min_1","max_1"],"sources":["../../../../src/interaction/action/data/filter.ts"],"sourcesContent":["import { each } from '@antv/util';\nimport { View } from 'src/chart';\nimport Action from '../base';\nimport { getDelegationObject, getScaleByField, isList, isSlider } from '../util';\n\n/**\n * 数据过滤。\n * @ignore\n */\nclass DataFilter extends Action {\n  private filterView(view: View, field, filter) {\n    // 只有存在这个 scale 时才生效\n    if (view.getScaleByField(field)) {\n      view.filter(field, filter);\n    }\n    if (view.views && view.views.length) {\n      each(view.views, (subView) => {\n        this.filterView(subView, field, filter);\n      });\n    }\n  }\n  /**\n   * 过滤数据\n   */\n  public filter() {\n    const delegateObject = getDelegationObject(this.context);\n    if (delegateObject) {\n      const view = this.context.view;\n      const { component } = delegateObject;\n      const field = component.get('field');\n      // 列表类的组件能够触发\n      if (isList(delegateObject)) {\n        if (field) {\n          const unCheckedItems = component.getItemsByState('unchecked');\n          const scale = getScaleByField(view, field);\n          const names: string[] = unCheckedItems.map((item) => item.name);\n          if (names.length) {\n            this.filterView(view, field, (value) => {\n              const text = scale.getText(value);\n              return !names.includes(text);\n            });\n          } else {\n            this.filterView(view, field, null);\n          }\n          view.render(true);\n        }\n      } else if (isSlider(delegateObject)) {\n        const range = component.getValue();\n        const [min, max] = range;\n        this.filterView(view, field, (value) => {\n          return value >= min && value <= max;\n        });\n        view.render(true);\n      }\n    }\n  }\n}\n\nexport default DataFilter;\n"],"mappings":";AAAA,SAASA,IAAI,QAAQ,YAAY;AAEjC,OAAOC,MAAM,MAAM,SAAS;AAC5B,SAASC,mBAAmB,EAAEC,eAAe,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,SAAS;AAEhF;;;;AAIA,IAAAC,UAAA,0BAAAC,MAAA;EAAyBC,SAAA,CAAAF,UAAA,EAAAC,MAAA;EAAzB,SAAAD,WAAA;;EA+CA;EA9CUA,UAAA,CAAAG,SAAA,CAAAC,UAAU,GAAlB,UAAmBC,IAAU,EAAEC,KAAK,EAAEC,MAAM;IAA5C,IAAAC,KAAA;IACE;IACA,IAAIH,IAAI,CAACR,eAAe,CAACS,KAAK,CAAC,EAAE;MAC/BD,IAAI,CAACE,MAAM,CAACD,KAAK,EAAEC,MAAM,CAAC;;IAE5B,IAAIF,IAAI,CAACI,KAAK,IAAIJ,IAAI,CAACI,KAAK,CAACC,MAAM,EAAE;MACnChB,IAAI,CAACW,IAAI,CAACI,KAAK,EAAE,UAACE,OAAO;QACvBH,KAAI,CAACJ,UAAU,CAACO,OAAO,EAAEL,KAAK,EAAEC,MAAM,CAAC;MACzC,CAAC,CAAC;;EAEN,CAAC;EACD;;;EAGOP,UAAA,CAAAG,SAAA,CAAAI,MAAM,GAAb;IACE,IAAMK,cAAc,GAAGhB,mBAAmB,CAAC,IAAI,CAACiB,OAAO,CAAC;IACxD,IAAID,cAAc,EAAE;MAClB,IAAMP,IAAI,GAAG,IAAI,CAACQ,OAAO,CAACR,IAAI;MACtB,IAAAS,SAAS,GAAKF,cAAc,CAAAE,SAAnB;MACjB,IAAMR,KAAK,GAAGQ,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;MACpC;MACA,IAAIjB,MAAM,CAACc,cAAc,CAAC,EAAE;QAC1B,IAAIN,KAAK,EAAE;UACT,IAAMU,cAAc,GAAGF,SAAS,CAACG,eAAe,CAAC,WAAW,CAAC;UAC7D,IAAMC,OAAK,GAAGrB,eAAe,CAACQ,IAAI,EAAEC,KAAK,CAAC;UAC1C,IAAMa,OAAK,GAAaH,cAAc,CAACI,GAAG,CAAC,UAACC,IAAI;YAAK,OAAAA,IAAI,CAACC,IAAI;UAAT,CAAS,CAAC;UAC/D,IAAIH,OAAK,CAACT,MAAM,EAAE;YAChB,IAAI,CAACN,UAAU,CAACC,IAAI,EAAEC,KAAK,EAAE,UAACiB,KAAK;cACjC,IAAMC,IAAI,GAAGN,OAAK,CAACO,OAAO,CAACF,KAAK,CAAC;cACjC,OAAO,CAACJ,OAAK,CAACO,QAAQ,CAACF,IAAI,CAAC;YAC9B,CAAC,CAAC;WACH,MAAM;YACL,IAAI,CAACpB,UAAU,CAACC,IAAI,EAAEC,KAAK,EAAE,IAAI,CAAC;;UAEpCD,IAAI,CAACsB,MAAM,CAAC,IAAI,CAAC;;OAEpB,MAAM,IAAI5B,QAAQ,CAACa,cAAc,CAAC,EAAE;QACnC,IAAMgB,KAAK,GAAGd,SAAS,CAACe,QAAQ,EAAE;QAC5B,IAAAC,EAAA,GAAAC,MAAA,CAAaH,KAAK;UAAjBI,KAAG,GAAAF,EAAA;UAAEG,KAAG,GAAAH,EAAA,GAAS;QACxB,IAAI,CAAC1B,UAAU,CAACC,IAAI,EAAEC,KAAK,EAAE,UAACiB,KAAK;UACjC,OAAOA,KAAK,IAAIS,KAAG,IAAIT,KAAK,IAAIU,KAAG;QACrC,CAAC,CAAC;QACF5B,IAAI,CAACsB,MAAM,CAAC,IAAI,CAAC;;;EAGvB,CAAC;EACH,OAAA3B,UAAC;AAAD,CAAC,CA/CwBL,MAAM;AAiD/B,eAAeK,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}
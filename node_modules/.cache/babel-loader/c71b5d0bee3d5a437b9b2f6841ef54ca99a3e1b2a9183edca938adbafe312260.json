{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { getTheme } from '@antv/g2';\nimport { each, find, isObject, map } from '@antv/util';\nimport { deepAssign } from '../utils';\nimport { conversionTagFormatter } from '../utils/conversion';\nfunction getConversionTagOptionsWithDefaults(options, horizontal) {\n  return deepAssign({\n    size: horizontal ? 32 : 80,\n    spacing: horizontal ? 8 : 12,\n    offset: horizontal ? 32 : 0,\n    arrow: options.arrow !== false && {\n      headSize: 12,\n      style: {\n        fill: 'rgba(0, 0, 0, 0.05)'\n      }\n    },\n    text: options.text !== false && {\n      style: {\n        fontSize: 12,\n        fill: 'rgba(0, 0, 0, 0.85)',\n        textAlign: 'center',\n        textBaseline: 'middle'\n      },\n      formatter: conversionTagFormatter\n    }\n  }, options);\n}\nfunction parsePoints(coordinate, element) {\n  // @ts-ignore\n  return map(element.getModel().points, function (point) {\n    return coordinate.convertPoint(point);\n  });\n}\nfunction renderArrowTag(config, elemPrev, elemNext) {\n  var view = config.view,\n    geometry = config.geometry,\n    group = config.group,\n    options = config.options,\n    horizontal = config.horizontal;\n  var offset = options.offset,\n    size = options.size,\n    arrow = options.arrow;\n  var coordinate = view.getCoordinate();\n  var pointPrev = parsePoints(coordinate, elemPrev)[3];\n  var pointNext = parsePoints(coordinate, elemNext)[0];\n  var totalHeight = pointNext.y - pointPrev.y;\n  var totalWidth = pointNext.x - pointPrev.x;\n  if (typeof arrow === 'boolean') {\n    return;\n  }\n  var headSize = arrow.headSize;\n  var spacing = options.spacing;\n  var points;\n  if (horizontal) {\n    if ((totalWidth - headSize) / 2 < spacing) {\n      // 当柱间距不足容纳箭头尖与间隔时，画三角并挤占间隔\n      spacing = Math.max(1, (totalWidth - headSize) / 2);\n      points = [[pointPrev.x + spacing, pointPrev.y - offset], [pointPrev.x + spacing, pointPrev.y - offset - size], [pointNext.x - spacing, pointNext.y - offset - size / 2]];\n    } else {\n      // 当柱间距足够时，画完整图形并留出间隔。\n      points = [[pointPrev.x + spacing, pointPrev.y - offset], [pointPrev.x + spacing, pointPrev.y - offset - size], [pointNext.x - spacing - headSize, pointNext.y - offset - size], [pointNext.x - spacing, pointNext.y - offset - size / 2], [pointNext.x - spacing - headSize, pointNext.y - offset]];\n    }\n  } else {\n    if ((totalHeight - headSize) / 2 < spacing) {\n      // 当柱间距不足容纳箭头尖与间隔时，画三角并挤占间隔\n      spacing = Math.max(1, (totalHeight - headSize) / 2);\n      points = [[pointPrev.x + offset, pointPrev.y + spacing], [pointPrev.x + offset + size, pointPrev.y + spacing], [pointNext.x + offset + size / 2, pointNext.y - spacing]];\n    } else {\n      // 当柱间距足够时，画完整图形并留出间隔。\n      points = [[pointPrev.x + offset, pointPrev.y + spacing], [pointPrev.x + offset + size, pointPrev.y + spacing], [pointNext.x + offset + size, pointNext.y - spacing - headSize], [pointNext.x + offset + size / 2, pointNext.y - spacing], [pointNext.x + offset, pointNext.y - spacing - headSize]];\n    }\n  }\n  group.addShape('polygon', {\n    id: \"\".concat(view.id, \"-conversion-tag-arrow-\").concat(geometry.getElementId(elemPrev.getModel().mappingData)),\n    name: 'conversion-tag-arrow',\n    origin: {\n      element: elemPrev,\n      nextElement: elemNext\n    },\n    attrs: __assign(__assign({}, arrow.style || {}), {\n      points: points\n    })\n  });\n}\nfunction renderTextTag(config, elemPrev, elemNext) {\n  var _a, _b, _c;\n  var view = config.view,\n    geometry = config.geometry,\n    group = config.group,\n    options = config.options,\n    field = config.field,\n    horizontal = config.horizontal;\n  var offset = options.offset,\n    size = options.size;\n  if (typeof options.text === 'boolean') {\n    return;\n  }\n  var coordinate = view.getCoordinate();\n  var text = ((_a = options.text) === null || _a === void 0 ? void 0 : _a.formatter) && ((_b = options.text) === null || _b === void 0 ? void 0 : _b.formatter(elemPrev.getData()[field], elemNext.getData()[field]));\n  var pointPrev = parsePoints(coordinate, elemPrev)[horizontal ? 3 : 0];\n  var pointNext = parsePoints(coordinate, elemNext)[horizontal ? 0 : 3];\n  var textShape = group.addShape('text', {\n    id: \"\".concat(view.id, \"-conversion-tag-text-\").concat(geometry.getElementId(elemPrev.getModel().mappingData)),\n    name: 'conversion-tag-text',\n    origin: {\n      element: elemPrev,\n      nextElement: elemNext\n    },\n    attrs: __assign(__assign({}, ((_c = options.text) === null || _c === void 0 ? void 0 : _c.style) || {}), {\n      text: text,\n      x: horizontal ? (pointPrev.x + pointNext.x) / 2 : pointPrev.x + offset + size / 2,\n      y: horizontal ? pointPrev.y - offset - size / 2 : (pointPrev.y + pointNext.y) / 2\n    })\n  });\n  if (horizontal) {\n    var totalWidth = pointNext.x - pointPrev.x;\n    var textWidth = textShape.getBBox().width;\n    if (textWidth > totalWidth) {\n      var cWidth = textWidth / text.length;\n      var cEnd = Math.max(1, Math.ceil(totalWidth / cWidth) - 1);\n      var textAdjusted = \"\".concat(text.slice(0, cEnd), \"...\");\n      textShape.attr('text', textAdjusted);\n    }\n  }\n}\nfunction renderTag(options, elemPrev, elemNext) {\n  renderArrowTag(options, elemPrev, elemNext);\n  renderTextTag(options, elemPrev, elemNext);\n}\n/**\n * 返回支持转化率组件的 adaptor，适用于柱形图/条形图\n * @param field 用户转化率计算的字段\n * @param horizontal 是否水平方向的转化率\n * @param disabled 是否禁用\n */\nexport function conversionTag(field, horizontal, disabled) {\n  if (horizontal === void 0) {\n    horizontal = true;\n  }\n  if (disabled === void 0) {\n    disabled = false;\n  }\n  return function (params) {\n    var options = params.options,\n      chart = params.chart;\n    var conversionTag = options.conversionTag,\n      theme = options.theme;\n    if (conversionTag && !disabled) {\n      // 有转化率组件时，柱子宽度占比自动为 1/3\n      chart.theme(deepAssign({}, isObject(theme) ? theme : getTheme(theme), {\n        columnWidthRatio: 1 / 3\n      }));\n      // 使用  shape annotation 绘制转化率组件\n      chart.annotation().shape({\n        render: function (container, view) {\n          var group = container.addGroup({\n            id: \"\".concat(chart.id, \"-conversion-tag-group\"),\n            name: 'conversion-tag-group'\n          });\n          var interval = find(chart.geometries, function (geom) {\n            return geom.type === 'interval';\n          });\n          var config = {\n            view: view,\n            geometry: interval,\n            group: group,\n            field: field,\n            horizontal: horizontal,\n            options: getConversionTagOptionsWithDefaults(conversionTag, horizontal)\n          };\n          var elements = interval.elements;\n          each(elements, function (elem, idx) {\n            if (idx > 0) {\n              renderTag(config, elements[idx - 1], elem);\n            }\n          });\n        }\n      });\n    }\n    return params;\n  };\n}","map":{"version":3,"names":["getTheme","each","find","isObject","map","deepAssign","conversionTagFormatter","getConversionTagOptionsWithDefaults","options","horizontal","size","spacing","offset","arrow","headSize","style","fill","text","fontSize","textAlign","textBaseline","formatter","parsePoints","coordinate","element","getModel","points","point","convertPoint","renderArrowTag","config","elemPrev","elemNext","view","geometry","group","getCoordinate","pointPrev","pointNext","totalHeight","y","totalWidth","x","Math","max","addShape","id","concat","getElementId","mappingData","name","origin","nextElement","attrs","__assign","renderTextTag","field","_a","_b","getData","textShape","_c","textWidth","getBBox","width","cWidth","length","cEnd","ceil","textAdjusted","slice","attr","renderTag","conversionTag","disabled","params","chart","theme","columnWidthRatio","annotation","shape","render","container","addGroup","interval","geometries","geom","type","elements","elem","idx"],"sources":["../../src/adaptor/conversion-tag.ts"],"sourcesContent":["import { Coordinate, Element, Geometry, getTheme, IGroup, ShapeAttrs, View } from '@antv/g2';\nimport { each, find, isObject, map } from '@antv/util';\nimport { Params } from '../core/adaptor';\nimport { Options } from '../types';\nimport { deepAssign } from '../utils';\nimport { conversionTagFormatter } from '../utils/conversion';\n\n/** 转化率组件配置选项 */\nexport interface ConversionTagOptions {\n  /** tag 高度 */\n  size?: number;\n  /** tag 对柱子间距 */\n  spacing?: number;\n  /** tag 距离轴线距离 */\n  offset?: number;\n  /** 箭头形状配置 */\n  arrow?:\n    | {\n        /** 箭头宽度 */\n        headSize?: number;\n        /** 箭头样式 */\n        style?: ShapeAttrs;\n      }\n    | false;\n  /** 文本配置 */\n  text?:\n    | {\n        /** 文字大小 */\n        size?: number;\n        /** 文字样式 */\n        style?: ShapeAttrs;\n        /** 文本格式化 */\n        formatter?: (prev: number, next: number) => string;\n      }\n    | false;\n}\n\nexport interface OptionWithConversionTag {\n  conversionTag?: ConversionTagOptions | false;\n}\n\n/** 控制转化率组件绘制的选项 */\ntype TagRenderConfig = {\n  /** 所在的 View */\n  view: View;\n  /** 所属的 geometry */\n  geometry: Geometry;\n  /** 转化率组件的 group */\n  group: IGroup;\n  /** 转化率配置 */\n  options: ConversionTagOptions;\n  /** 用于转化率计算的字段 */\n  field: string;\n  /** 水平/垂直 */\n  horizontal: boolean;\n};\n\nfunction getConversionTagOptionsWithDefaults(options: ConversionTagOptions, horizontal: boolean): ConversionTagOptions {\n  return deepAssign(\n    {\n      size: horizontal ? 32 : 80,\n      spacing: horizontal ? 8 : 12,\n      offset: horizontal ? 32 : 0,\n      arrow: options.arrow !== false && {\n        headSize: 12,\n        style: {\n          fill: 'rgba(0, 0, 0, 0.05)',\n        },\n      },\n      text: options.text !== false && {\n        style: {\n          fontSize: 12,\n          fill: 'rgba(0, 0, 0, 0.85)',\n          textAlign: 'center',\n          textBaseline: 'middle',\n        },\n        formatter: conversionTagFormatter,\n      },\n    },\n    options\n  );\n}\n\nfunction parsePoints(coordinate: Coordinate, element: Element): { x: number; y: number }[] {\n  // @ts-ignore\n  return map(element.getModel().points, (point) => coordinate.convertPoint(point));\n}\n\nfunction renderArrowTag(config: TagRenderConfig, elemPrev: Element, elemNext: Element): void {\n  const { view, geometry, group, options, horizontal } = config;\n  const { offset, size, arrow } = options;\n  const coordinate = view.getCoordinate();\n  const pointPrev = parsePoints(coordinate, elemPrev)[3];\n  const pointNext = parsePoints(coordinate, elemNext)[0];\n  const totalHeight = pointNext.y - pointPrev.y;\n  const totalWidth = pointNext.x - pointPrev.x;\n\n  if (typeof arrow === 'boolean') {\n    return;\n  }\n  const { headSize } = arrow;\n  let spacing = options.spacing;\n  let points;\n\n  if (horizontal) {\n    if ((totalWidth - headSize) / 2 < spacing) {\n      // 当柱间距不足容纳箭头尖与间隔时，画三角并挤占间隔\n      spacing = Math.max(1, (totalWidth - headSize) / 2);\n      points = [\n        [pointPrev.x + spacing, pointPrev.y - offset],\n        [pointPrev.x + spacing, pointPrev.y - offset - size],\n        [pointNext.x - spacing, pointNext.y - offset - size / 2],\n      ];\n    } else {\n      // 当柱间距足够时，画完整图形并留出间隔。\n      points = [\n        [pointPrev.x + spacing, pointPrev.y - offset],\n        [pointPrev.x + spacing, pointPrev.y - offset - size],\n        [pointNext.x - spacing - headSize, pointNext.y - offset - size],\n        [pointNext.x - spacing, pointNext.y - offset - size / 2],\n        [pointNext.x - spacing - headSize, pointNext.y - offset],\n      ];\n    }\n  } else {\n    if ((totalHeight - headSize) / 2 < spacing) {\n      // 当柱间距不足容纳箭头尖与间隔时，画三角并挤占间隔\n      spacing = Math.max(1, (totalHeight - headSize) / 2);\n      points = [\n        [pointPrev.x + offset, pointPrev.y + spacing],\n        [pointPrev.x + offset + size, pointPrev.y + spacing],\n        [pointNext.x + offset + size / 2, pointNext.y - spacing],\n      ];\n    } else {\n      // 当柱间距足够时，画完整图形并留出间隔。\n      points = [\n        [pointPrev.x + offset, pointPrev.y + spacing],\n        [pointPrev.x + offset + size, pointPrev.y + spacing],\n        [pointNext.x + offset + size, pointNext.y - spacing - headSize],\n        [pointNext.x + offset + size / 2, pointNext.y - spacing],\n        [pointNext.x + offset, pointNext.y - spacing - headSize],\n      ];\n    }\n  }\n\n  group.addShape('polygon', {\n    id: `${view.id}-conversion-tag-arrow-${geometry.getElementId(elemPrev.getModel().mappingData)}`,\n    name: 'conversion-tag-arrow',\n    origin: {\n      element: elemPrev,\n      nextElement: elemNext,\n    },\n    attrs: {\n      ...(arrow.style || {}),\n      points,\n    },\n  });\n}\n\nfunction renderTextTag(config: TagRenderConfig, elemPrev: Element, elemNext: Element): void {\n  const { view, geometry, group, options, field, horizontal } = config;\n  const { offset, size } = options;\n  if (typeof options.text === 'boolean') {\n    return;\n  }\n  const coordinate = view.getCoordinate();\n  const text = options.text?.formatter && options.text?.formatter(elemPrev.getData()[field], elemNext.getData()[field]);\n\n  const pointPrev = parsePoints(coordinate, elemPrev)[horizontal ? 3 : 0];\n  const pointNext = parsePoints(coordinate, elemNext)[horizontal ? 0 : 3];\n\n  const textShape = group.addShape('text', {\n    id: `${view.id}-conversion-tag-text-${geometry.getElementId(elemPrev.getModel().mappingData)}`,\n    name: 'conversion-tag-text',\n    origin: {\n      element: elemPrev,\n      nextElement: elemNext,\n    },\n    attrs: {\n      ...(options.text?.style || {}),\n      text,\n      x: horizontal ? (pointPrev.x + pointNext.x) / 2 : pointPrev.x + offset + size / 2,\n      y: horizontal ? pointPrev.y - offset - size / 2 : (pointPrev.y + pointNext.y) / 2,\n    },\n  });\n\n  if (horizontal) {\n    const totalWidth = pointNext.x - pointPrev.x;\n    const { width: textWidth } = textShape.getBBox();\n    if (textWidth > totalWidth) {\n      const cWidth = textWidth / text.length;\n      const cEnd = Math.max(1, Math.ceil(totalWidth / cWidth) - 1);\n      const textAdjusted = `${text.slice(0, cEnd)}...`;\n      textShape.attr('text', textAdjusted);\n    }\n  }\n}\n\nfunction renderTag(options: TagRenderConfig, elemPrev: Element, elemNext: Element): void {\n  renderArrowTag(options, elemPrev, elemNext);\n  renderTextTag(options, elemPrev, elemNext);\n}\n\n/**\n * 返回支持转化率组件的 adaptor，适用于柱形图/条形图\n * @param field 用户转化率计算的字段\n * @param horizontal 是否水平方向的转化率\n * @param disabled 是否禁用\n */\nexport function conversionTag<O extends OptionWithConversionTag & Options>(\n  field: string,\n  horizontal = true,\n  disabled = false\n) {\n  return function (params: Params<O>): Params<O> {\n    const { options, chart } = params;\n    const { conversionTag, theme } = options;\n\n    if (conversionTag && !disabled) {\n      // 有转化率组件时，柱子宽度占比自动为 1/3\n      chart.theme(\n        deepAssign({}, isObject(theme) ? theme : getTheme(theme), {\n          columnWidthRatio: 1 / 3,\n        })\n      );\n      // 使用  shape annotation 绘制转化率组件\n      chart.annotation().shape({\n        render: (container, view) => {\n          const group = container.addGroup({\n            id: `${chart.id}-conversion-tag-group`,\n            name: 'conversion-tag-group',\n          });\n          const interval = find(chart.geometries, (geom: Geometry) => geom.type === 'interval');\n          const config: TagRenderConfig = {\n            view,\n            geometry: interval,\n            group,\n            field,\n            horizontal,\n            options: getConversionTagOptionsWithDefaults(conversionTag, horizontal),\n          };\n          const elements = interval.elements;\n          each(elements, (elem: Element, idx: number) => {\n            if (idx > 0) {\n              renderTag(config, elements[idx - 1], elem);\n            }\n          });\n        },\n      });\n    }\n\n    return params;\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
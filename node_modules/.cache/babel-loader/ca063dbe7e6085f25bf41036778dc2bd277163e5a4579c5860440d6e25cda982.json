{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _dec, _class;\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nimport { LRUCache } from '@antv/l7-utils';\n// @ts-ignore\nimport TinySDF from '@mapbox/tiny-sdf';\nimport { EventEmitter } from 'eventemitter3';\nimport { injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { buildMapping } from \"../../utils/font_util\";\nexport var DEFAULT_CHAR_SET = getDefaultCharacterSet();\nexport var DEFAULT_FONT_FAMILY = 'sans-serif';\nexport var DEFAULT_FONT_WEIGHT = 'normal';\nexport var DEFAULT_FONT_SIZE = 24;\nexport var DEFAULT_BUFFER = 3;\nexport var DEFAULT_CUTOFF = 0.25;\nexport var DEFAULT_RADIUS = 8;\nvar MAX_CANVAS_WIDTH = 1024;\nvar BASELINE_SCALE = 1.0;\nvar HEIGHT_SCALE = 1.0;\nvar CACHE_LIMIT = 3;\nexport var VALID_PROPS = ['fontFamily', 'fontWeight', 'characterSet', 'fontSize', 'sdf', 'buffer', 'cutoff', 'radius'];\nfunction getDefaultCharacterSet() {\n  var charSet = [];\n  for (var i = 32; i < 128; i++) {\n    charSet.push(String.fromCharCode(i));\n  }\n  return charSet;\n}\nfunction setTextStyle(ctx, fontFamily, fontSize, fontWeight) {\n  ctx.font = \"\".concat(fontWeight, \" \").concat(fontSize, \"px \").concat(fontFamily);\n  ctx.fillStyle = 'black';\n  ctx.textBaseline = 'middle';\n  // ctx.textAlign = 'left';\n}\n\nfunction populateAlphaChannel(alphaChannel, imageData) {\n  // populate distance value from tinySDF to image alpha channel\n  for (var i = 0; i < alphaChannel.length; i++) {\n    imageData.data[4 * i + 3] = alphaChannel[i];\n  }\n}\nvar FontService = (_dec = injectable(), _dec(_class = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(FontService, _EventEmitter);\n  var _super = _createSuper(FontService);\n  function FontService() {\n    var _this;\n    _classCallCheck(this, FontService);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"fontAtlas\", void 0);\n    // iconFontMap 记录用户设置的 iconfont unicode 和名称的键值关系\n    _defineProperty(_assertThisInitialized(_this), \"iconFontMap\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"iconFontGlyphs\", {});\n    _defineProperty(_assertThisInitialized(_this), \"fontOptions\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"key\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"cache\", new LRUCache(CACHE_LIMIT));\n    return _this;\n  }\n  _createClass(FontService, [{\n    key: \"scale\",\n    get: function get() {\n      return HEIGHT_SCALE;\n    }\n  }, {\n    key: \"canvas\",\n    get: function get() {\n      var data = this.cache.get(this.key);\n      return data && data.data;\n    }\n  }, {\n    key: \"mapping\",\n    get: function get() {\n      var data = this.cache.get(this.key);\n      return data && data.mapping || {};\n    }\n  }, {\n    key: \"getCanvasByKey\",\n    value: function getCanvasByKey(key) {\n      var data = this.cache.get(key);\n      return data && data.data;\n    }\n  }, {\n    key: \"getMappingByKey\",\n    value: function getMappingByKey(key) {\n      var data = this.cache.get(key);\n      return data && data.mapping || {};\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      this.cache.clear();\n      this.fontOptions = {\n        fontFamily: DEFAULT_FONT_FAMILY,\n        fontWeight: DEFAULT_FONT_WEIGHT,\n        characterSet: DEFAULT_CHAR_SET,\n        fontSize: DEFAULT_FONT_SIZE,\n        buffer: DEFAULT_BUFFER,\n        sdf: true,\n        cutoff: DEFAULT_CUTOFF,\n        radius: DEFAULT_RADIUS,\n        iconfont: false\n      };\n      this.key = '';\n      this.iconFontMap = new Map();\n    }\n  }, {\n    key: \"addIconGlyphs\",\n    value: function addIconGlyphs(glyphs) {\n      var _this2 = this;\n      glyphs.forEach(function (glyph) {\n        _this2.iconFontGlyphs[glyph.name] = glyph.unicode;\n      });\n    }\n\n    /**\n     * 添加对 iconfont unicode 的映射\n     * @param fontUnicode\n     * @param name\n     */\n  }, {\n    key: \"addIconFont\",\n    value: function addIconFont(name, fontUnicode) {\n      this.iconFontMap.set(name, fontUnicode);\n    }\n\n    /**\n     * 获取自定义 iconfont 别称对应的 unicode 编码，若是当前的 map 中没有对应的键值对，那么就返回原值\n     * @param name\n     * @returns\n     */\n  }, {\n    key: \"getIconFontKey\",\n    value: function getIconFontKey(name) {\n      return this.iconFontMap.get(name) || name;\n    }\n  }, {\n    key: \"getGlyph\",\n    value: function getGlyph(name) {\n      if (this.iconFontGlyphs[name]) {\n        return String.fromCharCode(parseInt(this.iconFontGlyphs[name], 16));\n      }\n      return '';\n    }\n  }, {\n    key: \"setFontOptions\",\n    value: function setFontOptions(option) {\n      this.fontOptions = _objectSpread(_objectSpread({}, this.fontOptions), option);\n      this.key = this.getKey();\n      var charSet = this.getNewChars(this.key, this.fontOptions.characterSet);\n      var cachedFontAtlas = this.cache.get(this.key);\n      if (cachedFontAtlas && charSet.length === 0) {\n        // update texture with cached fontAtlas\n        return;\n      }\n      // update fontAtlas with new settings\n      var fontAtlas = this.generateFontAtlas(this.key, charSet, cachedFontAtlas);\n      this.fontAtlas = fontAtlas;\n\n      // update cache\n      this.cache.set(this.key, fontAtlas);\n    }\n    /**\n     * 用户自定义添加第三方字体 （用户使用 layer/point/text/iconfont 的前提需要加载第三方字体文件）\n     * @param fontFamily\n     * @param fontPath\n     */\n  }, {\n    key: \"addFontFace\",\n    value: function addFontFace(fontFamily, fontPath) {\n      var _this3 = this;\n      var style = document.createElement('style');\n      style.type = 'text/css';\n      style.innerText = \"\\n        @font-face{\\n            font-family: '\".concat(fontFamily, \"';\\n            src: url('\").concat(fontPath, \"') format('woff2'),\\n            url('\").concat(fontPath, \"') format('woff'),\\n            url('\").concat(fontPath, \"') format('truetype');\\n        }\");\n      style.onload = function () {\n        if (document.fonts) {\n          try {\n            // @ts-ignore\n            document.fonts.load(\"24px \".concat(fontFamily), 'L7text');\n            document.fonts.ready.then(function () {\n              _this3.emit('fontloaded', {\n                fontFamily: fontFamily\n              });\n            });\n          } catch (e) {\n            console.warn('当前环境不支持 document.fonts !');\n            console.warn('当前环境不支持 iconfont !');\n            console.warn(e);\n          }\n        }\n      };\n      document.getElementsByTagName('head')[0].appendChild(style);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.cache.clear();\n      this.iconFontMap.clear();\n    }\n  }, {\n    key: \"generateFontAtlas\",\n    value: function generateFontAtlas(key, characterSet, cachedFontAtlas) {\n      var _this$fontOptions = this.fontOptions,\n        fontFamily = _this$fontOptions.fontFamily,\n        fontWeight = _this$fontOptions.fontWeight,\n        fontSize = _this$fontOptions.fontSize,\n        buffer = _this$fontOptions.buffer,\n        sdf = _this$fontOptions.sdf,\n        radius = _this$fontOptions.radius,\n        cutoff = _this$fontOptions.cutoff,\n        iconfont = _this$fontOptions.iconfont;\n      var canvas = cachedFontAtlas && cachedFontAtlas.data;\n      if (!canvas) {\n        canvas = window.document.createElement('canvas');\n        canvas.width = MAX_CANVAS_WIDTH;\n      }\n      var ctx = canvas.getContext('2d', {\n        willReadFrequently: true\n      });\n      setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n      // 1. build mapping\n      var _buildMapping = buildMapping(_objectSpread({\n          getFontWidth: function getFontWidth(char) {\n            return ctx.measureText(char).width;\n          },\n          fontHeight: fontSize * HEIGHT_SCALE,\n          buffer: buffer,\n          characterSet: characterSet,\n          maxCanvasWidth: MAX_CANVAS_WIDTH\n        }, cachedFontAtlas && {\n          mapping: cachedFontAtlas.mapping,\n          xOffset: cachedFontAtlas.xOffset,\n          yOffset: cachedFontAtlas.yOffset\n        })),\n        mapping = _buildMapping.mapping,\n        canvasHeight = _buildMapping.canvasHeight,\n        xOffset = _buildMapping.xOffset,\n        yOffset = _buildMapping.yOffset;\n\n      // 2. update canvas\n      // copy old canvas data to new canvas only when height changed\n      // TODO safari 不能正常更新\n      var copyImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      canvas.height = canvasHeight;\n      ctx.putImageData(copyImageData, 0, 0);\n      setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n      // 3. layout characters\n      if (sdf) {\n        var tinySDF = new TinySDF(fontSize, buffer, radius, cutoff, fontFamily, fontWeight);\n        // used to store distance values from tinySDF\n        // tinySDF.size equals `fontSize + buffer * 2`\n        var imageData = ctx.getImageData(0, 0, tinySDF.size, tinySDF.size);\n        var _iterator = _createForOfIteratorHelper(characterSet),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var char = _step.value;\n            if (iconfont) {\n              // @ts-ignore\n              // const icon = eval(\n              //   '(\"' + char.replace('&#x', '\\\\u').replace(';', '') + '\")',\n              // );\n\n              var icon = String.fromCharCode(parseInt(char.replace('&#x', '').replace(';', ''), 16));\n              var iconData = tinySDF.draw(icon);\n              populateAlphaChannel(iconData, imageData);\n            } else {\n              populateAlphaChannel(tinySDF.draw(char), imageData);\n            }\n            // populateAlphaChannel(tinySDF.draw(char), imageData);\n\n            // 考虑到描边，需要保留 sdf 的 buffer，不能像 deck.gl 一样直接减去\n            ctx.putImageData(imageData, mapping[char].x, mapping[char].y);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        var _iterator2 = _createForOfIteratorHelper(characterSet),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _char = _step2.value;\n            ctx.fillText(_char, mapping[_char].x, mapping[_char].y + fontSize * BASELINE_SCALE);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n      return {\n        xOffset: xOffset,\n        yOffset: yOffset,\n        mapping: mapping,\n        data: canvas,\n        width: canvas.width,\n        height: canvas.height\n      };\n    }\n  }, {\n    key: \"getKey\",\n    value: function getKey() {\n      var _this$fontOptions2 = this.fontOptions,\n        fontFamily = _this$fontOptions2.fontFamily,\n        fontWeight = _this$fontOptions2.fontWeight;\n      return \"\".concat(fontFamily, \"_\").concat(fontWeight);\n    }\n\n    /**\n     *\n     * @param key\n     * @param characterSet\n     * @returns\n     * 若是相同的 key，那么将字符存储到同同一个字符列表中\n     */\n  }, {\n    key: \"getNewChars\",\n    value: function getNewChars(key, characterSet) {\n      var cachedFontAtlas = this.cache.get(key);\n      if (!cachedFontAtlas) {\n        return characterSet;\n      }\n      var newChars = [];\n      var cachedMapping = cachedFontAtlas.mapping;\n      var cachedCharSet = new Set(Object.keys(cachedMapping));\n      var charSet = new Set(characterSet);\n      charSet.forEach(function (char) {\n        if (!cachedCharSet.has(char)) {\n          newChars.push(char);\n        }\n      });\n      return newChars;\n    }\n  }]);\n  return FontService;\n}(EventEmitter)) || _class);\nexport { FontService as default };","map":{"version":3,"names":["_objectSpread","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","_dec","_class","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","Reflect","construct","arguments","apply","sham","Proxy","Boolean","valueOf","LRUCache","TinySDF","EventEmitter","injectable","buildMapping","DEFAULT_CHAR_SET","getDefaultCharacterSet","DEFAULT_FONT_FAMILY","DEFAULT_FONT_WEIGHT","DEFAULT_FONT_SIZE","DEFAULT_BUFFER","DEFAULT_CUTOFF","DEFAULT_RADIUS","MAX_CANVAS_WIDTH","BASELINE_SCALE","HEIGHT_SCALE","CACHE_LIMIT","VALID_PROPS","charSet","push","String","fromCharCode","setTextStyle","ctx","fontFamily","fontSize","fontWeight","font","concat","fillStyle","textBaseline","populateAlphaChannel","alphaChannel","imageData","data","FontService","_EventEmitter","_super","_this","_len","args","_key","key","get","cache","mapping","getCanvasByKey","getMappingByKey","init","clear","fontOptions","characterSet","buffer","sdf","cutoff","radius","iconfont","iconFontMap","Map","addIconGlyphs","glyphs","_this2","forEach","glyph","iconFontGlyphs","unicode","addIconFont","fontUnicode","set","getIconFontKey","getGlyph","parseInt","setFontOptions","option","getKey","getNewChars","cachedFontAtlas","fontAtlas","generateFontAtlas","addFontFace","fontPath","_this3","style","document","createElement","type","innerText","onload","fonts","load","ready","then","emit","console","warn","getElementsByTagName","appendChild","destroy","_this$fontOptions","canvas","window","width","getContext","willReadFrequently","_buildMapping","getFontWidth","char","measureText","fontHeight","maxCanvasWidth","xOffset","yOffset","canvasHeight","copyImageData","getImageData","height","putImageData","tinySDF","size","_iterator","_step","icon","replace","iconData","draw","x","y","_iterator2","_step2","_char","fillText","_this$fontOptions2","newChars","cachedMapping","cachedCharSet","Set","keys","has","default"],"sources":["D:/桌面文件/C4大赛/作品源代码/vue/node_modules/@antv/l7-core/es/services/asset/FontService.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _dec, _class;\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { LRUCache } from '@antv/l7-utils';\n// @ts-ignore\nimport TinySDF from '@mapbox/tiny-sdf';\nimport { EventEmitter } from 'eventemitter3';\nimport { injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { buildMapping } from \"../../utils/font_util\";\nexport var DEFAULT_CHAR_SET = getDefaultCharacterSet();\nexport var DEFAULT_FONT_FAMILY = 'sans-serif';\nexport var DEFAULT_FONT_WEIGHT = 'normal';\nexport var DEFAULT_FONT_SIZE = 24;\nexport var DEFAULT_BUFFER = 3;\nexport var DEFAULT_CUTOFF = 0.25;\nexport var DEFAULT_RADIUS = 8;\nvar MAX_CANVAS_WIDTH = 1024;\nvar BASELINE_SCALE = 1.0;\nvar HEIGHT_SCALE = 1.0;\nvar CACHE_LIMIT = 3;\nexport var VALID_PROPS = ['fontFamily', 'fontWeight', 'characterSet', 'fontSize', 'sdf', 'buffer', 'cutoff', 'radius'];\nfunction getDefaultCharacterSet() {\n  var charSet = [];\n  for (var i = 32; i < 128; i++) {\n    charSet.push(String.fromCharCode(i));\n  }\n  return charSet;\n}\nfunction setTextStyle(ctx, fontFamily, fontSize, fontWeight) {\n  ctx.font = \"\".concat(fontWeight, \" \").concat(fontSize, \"px \").concat(fontFamily);\n  ctx.fillStyle = 'black';\n  ctx.textBaseline = 'middle';\n  // ctx.textAlign = 'left';\n}\n\nfunction populateAlphaChannel(alphaChannel, imageData) {\n  // populate distance value from tinySDF to image alpha channel\n  for (var i = 0; i < alphaChannel.length; i++) {\n    imageData.data[4 * i + 3] = alphaChannel[i];\n  }\n}\nvar FontService = (_dec = injectable(), _dec(_class = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(FontService, _EventEmitter);\n  var _super = _createSuper(FontService);\n  function FontService() {\n    var _this;\n    _classCallCheck(this, FontService);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"fontAtlas\", void 0);\n    // iconFontMap 记录用户设置的 iconfont unicode 和名称的键值关系\n    _defineProperty(_assertThisInitialized(_this), \"iconFontMap\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"iconFontGlyphs\", {});\n    _defineProperty(_assertThisInitialized(_this), \"fontOptions\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"key\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"cache\", new LRUCache(CACHE_LIMIT));\n    return _this;\n  }\n  _createClass(FontService, [{\n    key: \"scale\",\n    get: function get() {\n      return HEIGHT_SCALE;\n    }\n  }, {\n    key: \"canvas\",\n    get: function get() {\n      var data = this.cache.get(this.key);\n      return data && data.data;\n    }\n  }, {\n    key: \"mapping\",\n    get: function get() {\n      var data = this.cache.get(this.key);\n      return data && data.mapping || {};\n    }\n  }, {\n    key: \"getCanvasByKey\",\n    value: function getCanvasByKey(key) {\n      var data = this.cache.get(key);\n      return data && data.data;\n    }\n  }, {\n    key: \"getMappingByKey\",\n    value: function getMappingByKey(key) {\n      var data = this.cache.get(key);\n      return data && data.mapping || {};\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      this.cache.clear();\n      this.fontOptions = {\n        fontFamily: DEFAULT_FONT_FAMILY,\n        fontWeight: DEFAULT_FONT_WEIGHT,\n        characterSet: DEFAULT_CHAR_SET,\n        fontSize: DEFAULT_FONT_SIZE,\n        buffer: DEFAULT_BUFFER,\n        sdf: true,\n        cutoff: DEFAULT_CUTOFF,\n        radius: DEFAULT_RADIUS,\n        iconfont: false\n      };\n      this.key = '';\n      this.iconFontMap = new Map();\n    }\n  }, {\n    key: \"addIconGlyphs\",\n    value: function addIconGlyphs(glyphs) {\n      var _this2 = this;\n      glyphs.forEach(function (glyph) {\n        _this2.iconFontGlyphs[glyph.name] = glyph.unicode;\n      });\n    }\n\n    /**\n     * 添加对 iconfont unicode 的映射\n     * @param fontUnicode\n     * @param name\n     */\n  }, {\n    key: \"addIconFont\",\n    value: function addIconFont(name, fontUnicode) {\n      this.iconFontMap.set(name, fontUnicode);\n    }\n\n    /**\n     * 获取自定义 iconfont 别称对应的 unicode 编码，若是当前的 map 中没有对应的键值对，那么就返回原值\n     * @param name\n     * @returns\n     */\n  }, {\n    key: \"getIconFontKey\",\n    value: function getIconFontKey(name) {\n      return this.iconFontMap.get(name) || name;\n    }\n  }, {\n    key: \"getGlyph\",\n    value: function getGlyph(name) {\n      if (this.iconFontGlyphs[name]) {\n        return String.fromCharCode(parseInt(this.iconFontGlyphs[name], 16));\n      }\n      return '';\n    }\n  }, {\n    key: \"setFontOptions\",\n    value: function setFontOptions(option) {\n      this.fontOptions = _objectSpread(_objectSpread({}, this.fontOptions), option);\n      this.key = this.getKey();\n      var charSet = this.getNewChars(this.key, this.fontOptions.characterSet);\n      var cachedFontAtlas = this.cache.get(this.key);\n      if (cachedFontAtlas && charSet.length === 0) {\n        // update texture with cached fontAtlas\n        return;\n      }\n      // update fontAtlas with new settings\n      var fontAtlas = this.generateFontAtlas(this.key, charSet, cachedFontAtlas);\n      this.fontAtlas = fontAtlas;\n\n      // update cache\n      this.cache.set(this.key, fontAtlas);\n    }\n    /**\n     * 用户自定义添加第三方字体 （用户使用 layer/point/text/iconfont 的前提需要加载第三方字体文件）\n     * @param fontFamily\n     * @param fontPath\n     */\n  }, {\n    key: \"addFontFace\",\n    value: function addFontFace(fontFamily, fontPath) {\n      var _this3 = this;\n      var style = document.createElement('style');\n      style.type = 'text/css';\n      style.innerText = \"\\n        @font-face{\\n            font-family: '\".concat(fontFamily, \"';\\n            src: url('\").concat(fontPath, \"') format('woff2'),\\n            url('\").concat(fontPath, \"') format('woff'),\\n            url('\").concat(fontPath, \"') format('truetype');\\n        }\");\n      style.onload = function () {\n        if (document.fonts) {\n          try {\n            // @ts-ignore\n            document.fonts.load(\"24px \".concat(fontFamily), 'L7text');\n            document.fonts.ready.then(function () {\n              _this3.emit('fontloaded', {\n                fontFamily: fontFamily\n              });\n            });\n          } catch (e) {\n            console.warn('当前环境不支持 document.fonts !');\n            console.warn('当前环境不支持 iconfont !');\n            console.warn(e);\n          }\n        }\n      };\n      document.getElementsByTagName('head')[0].appendChild(style);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.cache.clear();\n      this.iconFontMap.clear();\n    }\n  }, {\n    key: \"generateFontAtlas\",\n    value: function generateFontAtlas(key, characterSet, cachedFontAtlas) {\n      var _this$fontOptions = this.fontOptions,\n        fontFamily = _this$fontOptions.fontFamily,\n        fontWeight = _this$fontOptions.fontWeight,\n        fontSize = _this$fontOptions.fontSize,\n        buffer = _this$fontOptions.buffer,\n        sdf = _this$fontOptions.sdf,\n        radius = _this$fontOptions.radius,\n        cutoff = _this$fontOptions.cutoff,\n        iconfont = _this$fontOptions.iconfont;\n      var canvas = cachedFontAtlas && cachedFontAtlas.data;\n      if (!canvas) {\n        canvas = window.document.createElement('canvas');\n        canvas.width = MAX_CANVAS_WIDTH;\n      }\n      var ctx = canvas.getContext('2d', {\n        willReadFrequently: true\n      });\n      setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n      // 1. build mapping\n      var _buildMapping = buildMapping(_objectSpread({\n          getFontWidth: function getFontWidth(char) {\n            return ctx.measureText(char).width;\n          },\n          fontHeight: fontSize * HEIGHT_SCALE,\n          buffer: buffer,\n          characterSet: characterSet,\n          maxCanvasWidth: MAX_CANVAS_WIDTH\n        }, cachedFontAtlas && {\n          mapping: cachedFontAtlas.mapping,\n          xOffset: cachedFontAtlas.xOffset,\n          yOffset: cachedFontAtlas.yOffset\n        })),\n        mapping = _buildMapping.mapping,\n        canvasHeight = _buildMapping.canvasHeight,\n        xOffset = _buildMapping.xOffset,\n        yOffset = _buildMapping.yOffset;\n\n      // 2. update canvas\n      // copy old canvas data to new canvas only when height changed\n      // TODO safari 不能正常更新\n      var copyImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      canvas.height = canvasHeight;\n      ctx.putImageData(copyImageData, 0, 0);\n      setTextStyle(ctx, fontFamily, fontSize, fontWeight);\n\n      // 3. layout characters\n      if (sdf) {\n        var tinySDF = new TinySDF(fontSize, buffer, radius, cutoff, fontFamily, fontWeight);\n        // used to store distance values from tinySDF\n        // tinySDF.size equals `fontSize + buffer * 2`\n        var imageData = ctx.getImageData(0, 0, tinySDF.size, tinySDF.size);\n        var _iterator = _createForOfIteratorHelper(characterSet),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var char = _step.value;\n            if (iconfont) {\n              // @ts-ignore\n              // const icon = eval(\n              //   '(\"' + char.replace('&#x', '\\\\u').replace(';', '') + '\")',\n              // );\n\n              var icon = String.fromCharCode(parseInt(char.replace('&#x', '').replace(';', ''), 16));\n              var iconData = tinySDF.draw(icon);\n              populateAlphaChannel(iconData, imageData);\n            } else {\n              populateAlphaChannel(tinySDF.draw(char), imageData);\n            }\n            // populateAlphaChannel(tinySDF.draw(char), imageData);\n\n            // 考虑到描边，需要保留 sdf 的 buffer，不能像 deck.gl 一样直接减去\n            ctx.putImageData(imageData, mapping[char].x, mapping[char].y);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        var _iterator2 = _createForOfIteratorHelper(characterSet),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _char = _step2.value;\n            ctx.fillText(_char, mapping[_char].x, mapping[_char].y + fontSize * BASELINE_SCALE);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n      return {\n        xOffset: xOffset,\n        yOffset: yOffset,\n        mapping: mapping,\n        data: canvas,\n        width: canvas.width,\n        height: canvas.height\n      };\n    }\n  }, {\n    key: \"getKey\",\n    value: function getKey() {\n      var _this$fontOptions2 = this.fontOptions,\n        fontFamily = _this$fontOptions2.fontFamily,\n        fontWeight = _this$fontOptions2.fontWeight;\n      return \"\".concat(fontFamily, \"_\").concat(fontWeight);\n    }\n\n    /**\n     *\n     * @param key\n     * @param characterSet\n     * @returns\n     * 若是相同的 key，那么将字符存储到同同一个字符列表中\n     */\n  }, {\n    key: \"getNewChars\",\n    value: function getNewChars(key, characterSet) {\n      var cachedFontAtlas = this.cache.get(key);\n      if (!cachedFontAtlas) {\n        return characterSet;\n      }\n      var newChars = [];\n      var cachedMapping = cachedFontAtlas.mapping;\n      var cachedCharSet = new Set(Object.keys(cachedMapping));\n      var charSet = new Set(characterSet);\n      charSet.forEach(function (char) {\n        if (!cachedCharSet.has(char)) {\n          newChars.push(char);\n        }\n      });\n      return newChars;\n    }\n  }]);\n  return FontService;\n}(EventEmitter)) || _class);\nexport { FontService as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
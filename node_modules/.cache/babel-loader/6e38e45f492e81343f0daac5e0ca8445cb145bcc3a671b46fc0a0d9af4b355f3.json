{"ast":null,"code":"import _isTypedArray from \"lodash/isTypedArray\";\nimport _isPlainObject from \"lodash/isPlainObject\";\n/**\n * 考虑结构体命名, eg:\n * a: { b: 1 }  ->  'a.b'\n * a: [ { b: 1 } ] -> 'a[0].b'\n */\nexport function extractUniforms(uniforms) {\n  var extractedUniforms = {};\n  Object.keys(uniforms).forEach(function (uniformName) {\n    extractUniformsRecursively(uniformName, uniforms[uniformName], extractedUniforms, '');\n  });\n  return extractedUniforms;\n}\nfunction extractUniformsRecursively(uniformName, uniformValue, uniforms, prefix) {\n  if (uniformValue === null || typeof uniformValue === 'number' ||\n  // u_A: 1\n  typeof uniformValue === 'boolean' ||\n  // u_A: false\n  Array.isArray(uniformValue) && typeof uniformValue[0] === 'number' ||\n  // u_A: [1, 2, 3]\n  _isTypedArray(uniformValue) ||\n  // u_A: Float32Array\n  // @ts-ignore\n  uniformValue === '' ||\n  // @ts-ignore\n  uniformValue.resize !== undefined) {\n    uniforms[\"\".concat(prefix && prefix + '.').concat(uniformName)] = uniformValue;\n    return;\n  }\n\n  // u_Struct.a.b.c\n  if (_isPlainObject(uniformValue)) {\n    Object.keys(uniformValue).forEach(function (childName) {\n      extractUniformsRecursively(childName,\n      // @ts-ignore\n      uniformValue[childName], uniforms, \"\".concat(prefix && prefix + '.').concat(uniformName));\n    });\n  }\n\n  // u_Struct[0].a\n  if (Array.isArray(uniformValue)) {\n    // @ts-ignore\n    uniformValue.forEach(function (child, idx) {\n      Object.keys(child).forEach(function (childName) {\n        extractUniformsRecursively(childName,\n        // @ts-ignore\n        child[childName], uniforms, \"\".concat(prefix && prefix + '.').concat(uniformName, \"[\").concat(idx, \"]\"));\n      });\n    });\n  }\n}","map":{"version":3,"names":["extractUniforms","uniforms","extractedUniforms","Object","keys","forEach","uniformName","extractUniformsRecursively","uniformValue","prefix","Array","isArray","_isTypedArray","resize","undefined","concat","_isPlainObject","childName","child","idx"],"sources":["../../src/utils/uniform.ts"],"sourcesContent":["import type { IUniform } from '@antv/g-webgpu-core';\nimport { isPlainObject, isTypedArray } from 'lodash';\n\n/**\n * 考虑结构体命名, eg:\n * a: { b: 1 }  ->  'a.b'\n * a: [ { b: 1 } ] -> 'a[0].b'\n */\nexport function extractUniforms(uniforms: {\n  [key: string]: IUniform;\n}): {\n  [key: string]: IUniform;\n} {\n  const extractedUniforms = {};\n  Object.keys(uniforms).forEach((uniformName) => {\n    extractUniformsRecursively(\n      uniformName,\n      uniforms[uniformName],\n      extractedUniforms,\n      '',\n    );\n  });\n\n  return extractedUniforms;\n}\n\nfunction extractUniformsRecursively(\n  uniformName: string,\n  uniformValue: IUniform,\n  uniforms: {\n    [key: string]: IUniform;\n  },\n  prefix: string,\n) {\n  if (\n    uniformValue === null ||\n    typeof uniformValue === 'number' || // u_A: 1\n    typeof uniformValue === 'boolean' || // u_A: false\n    (Array.isArray(uniformValue) && typeof uniformValue[0] === 'number') || // u_A: [1, 2, 3]\n    isTypedArray(uniformValue) || // u_A: Float32Array\n    // @ts-ignore\n    uniformValue === '' ||\n    // @ts-ignore\n    uniformValue.resize !== undefined\n  ) {\n    uniforms[`${prefix && prefix + '.'}${uniformName}`] = uniformValue;\n    return;\n  }\n\n  // u_Struct.a.b.c\n  if (isPlainObject(uniformValue)) {\n    Object.keys(uniformValue).forEach((childName) => {\n      extractUniformsRecursively(\n        childName,\n        // @ts-ignore\n        uniformValue[childName],\n        uniforms,\n        `${prefix && prefix + '.'}${uniformName}`,\n      );\n    });\n  }\n\n  // u_Struct[0].a\n  if (Array.isArray(uniformValue)) {\n    // @ts-ignore\n    uniformValue.forEach((child, idx) => {\n      Object.keys(child).forEach((childName) => {\n        extractUniformsRecursively(\n          childName,\n          // @ts-ignore\n          child[childName],\n          uniforms,\n          `${prefix && prefix + '.'}${uniformName}[${idx}]`,\n        );\n      });\n    });\n  }\n}\n"],"mappings":";;AAGA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASA,eAAeA,CAACC,QAE/B,EAEC;EACA,IAAMC,iBAAiB,GAAG,CAAC,CAAC;EAC5BC,MAAM,CAACC,IAAI,CAACH,QAAQ,CAAC,CAACI,OAAO,CAAC,UAACC,WAAW,EAAK;IAC7CC,0BAA0B,CACxBD,WAAW,EACXL,QAAQ,CAACK,WAAW,CAAC,EACrBJ,iBAAiB,EACjB,EAAE,CACH;EACH,CAAC,CAAC;EAEF,OAAOA,iBAAiB;AAC1B;AAEA,SAASK,0BAA0BA,CACjCD,WAAmB,EACnBE,YAAsB,EACtBP,QAEC,EACDQ,MAAc,EACd;EACA,IACED,YAAY,KAAK,IAAI,IACrB,OAAOA,YAAY,KAAK,QAAQ;EAAI;EACpC,OAAOA,YAAY,KAAK,SAAS;EAAI;EACpCE,KAAK,CAACC,OAAO,CAACH,YAAY,CAAC,IAAI,OAAOA,YAAY,CAAC,CAAC,CAAC,KAAK,QAAS;EAAI;EACxEI,aAAA,CAAaJ,YAAY,CAAC;EAAI;EAC9B;EACAA,YAAY,KAAK,EAAE;EACnB;EACAA,YAAY,CAACK,MAAM,KAAKC,SAAS,EACjC;IACAb,QAAQ,IAAAc,MAAA,CAAIN,MAAM,IAAIA,MAAM,GAAG,GAAG,EAAAM,MAAA,CAAGT,WAAW,EAAG,GAAGE,YAAY;IAClE;EACF;;EAEA;EACA,IAAIQ,cAAA,CAAcR,YAAY,CAAC,EAAE;IAC/BL,MAAM,CAACC,IAAI,CAACI,YAAY,CAAC,CAACH,OAAO,CAAC,UAACY,SAAS,EAAK;MAC/CV,0BAA0B,CACxBU,SAAS;MACT;MACAT,YAAY,CAACS,SAAS,CAAC,EACvBhB,QAAQ,KAAAc,MAAA,CACLN,MAAM,IAAIA,MAAM,GAAG,GAAG,EAAAM,MAAA,CAAGT,WAAW,EACxC;IACH,CAAC,CAAC;EACJ;;EAEA;EACA,IAAII,KAAK,CAACC,OAAO,CAACH,YAAY,CAAC,EAAE;IAC/B;IACAA,YAAY,CAACH,OAAO,CAAC,UAACa,KAAK,EAAEC,GAAG,EAAK;MACnChB,MAAM,CAACC,IAAI,CAACc,KAAK,CAAC,CAACb,OAAO,CAAC,UAACY,SAAS,EAAK;QACxCV,0BAA0B,CACxBU,SAAS;QACT;QACAC,KAAK,CAACD,SAAS,CAAC,EAChBhB,QAAQ,KAAAc,MAAA,CACLN,MAAM,IAAIA,MAAM,GAAG,GAAG,EAAAM,MAAA,CAAGT,WAAW,OAAAS,MAAA,CAAII,GAAG,OAC/C;MACH,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}
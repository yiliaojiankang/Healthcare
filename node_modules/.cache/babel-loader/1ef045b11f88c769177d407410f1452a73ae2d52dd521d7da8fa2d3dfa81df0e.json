{"ast":null,"code":"import { distance } from './util';\nvar EPSILON = 0.0001;\n/**\n * 使用牛顿切割法求最近的点\n * @param {number[]} xArr      点的 x 数组\n * @param {number[]} yArr      点的 y 数组\n * @param {number}   x         指定的点 x\n * @param {number}   y         指定的点 y\n * @param {Function} tCallback 差值函数\n */\nexport function nearestPoint(xArr, yArr, x, y, tCallback, length) {\n  var t;\n  var d = Infinity;\n  var v0 = [x, y];\n  var segNum = 20;\n  if (length && length > 200) {\n    segNum = length / 10;\n  }\n  var increaseRate = 1 / segNum;\n  var interval = increaseRate / 10;\n  for (var i = 0; i <= segNum; i++) {\n    var _t = i * increaseRate;\n    var v1 = [tCallback.apply(null, xArr.concat([_t])), tCallback.apply(null, yArr.concat([_t]))];\n    var d1 = distance(v0[0], v0[1], v1[0], v1[1]);\n    if (d1 < d) {\n      t = _t;\n      d = d1;\n    }\n  }\n  // 提前终止\n  if (t === 0) {\n    return {\n      x: xArr[0],\n      y: yArr[0]\n    };\n  }\n  if (t === 1) {\n    var count = xArr.length;\n    return {\n      x: xArr[count - 1],\n      y: yArr[count - 1]\n    };\n  }\n  d = Infinity;\n  for (var i = 0; i < 32; i++) {\n    if (interval < EPSILON) {\n      break;\n    }\n    var prev = t - interval;\n    var next = t + interval;\n    var v1 = [tCallback.apply(null, xArr.concat([prev])), tCallback.apply(null, yArr.concat([prev]))];\n    var d1 = distance(v0[0], v0[1], v1[0], v1[1]);\n    if (prev >= 0 && d1 < d) {\n      t = prev;\n      d = d1;\n    } else {\n      var v2 = [tCallback.apply(null, xArr.concat([next])), tCallback.apply(null, yArr.concat([next]))];\n      var d2 = distance(v0[0], v0[1], v2[0], v2[1]);\n      if (next <= 1 && d2 < d) {\n        t = next;\n        d = d2;\n      } else {\n        interval *= 0.5;\n      }\n    }\n  }\n  return {\n    x: tCallback.apply(null, xArr.concat([t])),\n    y: tCallback.apply(null, yArr.concat([t]))\n  };\n}\n// 近似求解 https://community.khronos.org/t/3d-cubic-bezier-segment-length/62363/2\nexport function snapLength(xArr, yArr) {\n  var totalLength = 0;\n  var count = xArr.length;\n  for (var i = 0; i < count; i++) {\n    var x = xArr[i];\n    var y = yArr[i];\n    var nextX = xArr[(i + 1) % count];\n    var nextY = yArr[(i + 1) % count];\n    totalLength += distance(x, y, nextX, nextY);\n  }\n  return totalLength / 2;\n}","map":{"version":3,"names":["distance","EPSILON","nearestPoint","xArr","yArr","x","y","tCallback","length","t","d","Infinity","v0","segNum","increaseRate","interval","i","_t","v1","apply","concat","d1","count","prev","next","v2","d2","snapLength","totalLength","nextX","nextY"],"sources":["../src/bezier.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
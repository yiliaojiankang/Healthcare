{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { __extends } from \"tslib\";\nimport { ext, vec2, vec3 } from '@antv/matrix-util';\nimport { isNumberEqual } from '@antv/util';\nimport Coordinate from './base';\nvar Polar = /** @class */function (_super) {\n  __extends(Polar, _super);\n  function Polar(cfg) {\n    var _this = _super.call(this, cfg) || this;\n    _this.isPolar = true;\n    _this.type = 'polar';\n    var _a = cfg.startAngle,\n      startAngle = _a === void 0 ? -Math.PI / 2 : _a,\n      _b = cfg.endAngle,\n      endAngle = _b === void 0 ? Math.PI * 3 / 2 : _b,\n      _c = cfg.innerRadius,\n      innerRadius = _c === void 0 ? 0 : _c,\n      radius = cfg.radius;\n    _this.startAngle = startAngle;\n    _this.endAngle = endAngle;\n    _this.innerRadius = innerRadius;\n    _this.radius = radius;\n    _this.initial();\n    return _this;\n  }\n  Polar.prototype.initial = function () {\n    _super.prototype.initial.call(this);\n    while (this.endAngle < this.startAngle) {\n      this.endAngle += Math.PI * 2;\n    }\n    var oneBox = this.getOneBox();\n    var oneWidth = oneBox.maxX - oneBox.minX;\n    var oneHeight = oneBox.maxY - oneBox.minY;\n    var left = Math.abs(oneBox.minX) / oneWidth;\n    var top = Math.abs(oneBox.minY) / oneHeight;\n    var maxRadius;\n    if (this.height / oneHeight > this.width / oneWidth) {\n      // width 为主\n      maxRadius = this.width / oneWidth;\n      this.circleCenter = {\n        x: this.center.x - (0.5 - left) * this.width,\n        y: this.center.y - (0.5 - top) * maxRadius * oneHeight\n      };\n    } else {\n      // height 为主\n      maxRadius = this.height / oneHeight;\n      this.circleCenter = {\n        x: this.center.x - (0.5 - left) * maxRadius * oneWidth,\n        y: this.center.y - (0.5 - top) * this.height\n      };\n    }\n    this.polarRadius = this.radius;\n    if (!this.radius) {\n      this.polarRadius = maxRadius;\n    } else if (this.radius > 0 && this.radius <= 1) {\n      this.polarRadius = maxRadius * this.radius;\n    } else if (this.radius <= 0 || this.radius > maxRadius) {\n      this.polarRadius = maxRadius;\n    }\n    this.x = {\n      start: this.startAngle,\n      end: this.endAngle\n    };\n    this.y = {\n      start: this.innerRadius * this.polarRadius,\n      end: this.polarRadius\n    };\n  };\n  Polar.prototype.getRadius = function () {\n    return this.polarRadius;\n  };\n  Polar.prototype.convertPoint = function (point) {\n    var _a;\n    var center = this.getCenter();\n    var x = point.x,\n      y = point.y;\n    if (this.isTransposed) {\n      _a = [y, x], x = _a[0], y = _a[1];\n    }\n    x = this.convertDim(x, 'x');\n    y = this.convertDim(y, 'y');\n    return {\n      x: center.x + Math.cos(x) * y,\n      y: center.y + Math.sin(x) * y\n    };\n  };\n  Polar.prototype.invertPoint = function (point) {\n    var _a;\n    var center = this.getCenter();\n    var vPoint = [point.x - center.x, point.y - center.y];\n    var _b = this,\n      startAngle = _b.startAngle,\n      endAngle = _b.endAngle;\n    if (this.isReflect('x')) {\n      _a = [endAngle, startAngle], startAngle = _a[0], endAngle = _a[1];\n    }\n    var m = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    ext.leftRotate(m, m, startAngle);\n    var vStart3 = [1, 0, 0];\n    vec3.transformMat3(vStart3, vStart3, m);\n    var vStart2 = [vStart3[0], vStart3[1]];\n    var angle = ext.angleTo(vStart2, vPoint, endAngle < startAngle);\n    if (isNumberEqual(angle, Math.PI * 2)) {\n      angle = 0;\n    }\n    var radius = vec2.length(vPoint);\n    var xPercent = angle / (endAngle - startAngle);\n    xPercent = endAngle - startAngle > 0 ? xPercent : -xPercent;\n    var yPercent = this.invertDim(radius, 'y');\n    var rst = {\n      x: 0,\n      y: 0\n    };\n    rst.x = this.isTransposed ? yPercent : xPercent;\n    rst.y = this.isTransposed ? xPercent : yPercent;\n    return rst;\n  };\n  Polar.prototype.getCenter = function () {\n    return this.circleCenter;\n  };\n  Polar.prototype.getOneBox = function () {\n    var startAngle = this.startAngle;\n    var endAngle = this.endAngle;\n    if (Math.abs(endAngle - startAngle) >= Math.PI * 2) {\n      return {\n        minX: -1,\n        maxX: 1,\n        minY: -1,\n        maxY: 1\n      };\n    }\n    var xs = [0, Math.cos(startAngle), Math.cos(endAngle)];\n    var ys = [0, Math.sin(startAngle), Math.sin(endAngle)];\n    for (var i = Math.min(startAngle, endAngle); i < Math.max(startAngle, endAngle); i += Math.PI / 18) {\n      xs.push(Math.cos(i));\n      ys.push(Math.sin(i));\n    }\n    return {\n      minX: Math.min.apply(Math, xs),\n      maxX: Math.max.apply(Math, xs),\n      minY: Math.min.apply(Math, ys),\n      maxY: Math.max.apply(Math, ys)\n    };\n  };\n  return Polar;\n}(Coordinate);\nexport default Polar;","map":{"version":3,"names":["ext","vec2","vec3","isNumberEqual","Coordinate","Polar","_super","__extends","cfg","_this","call","isPolar","type","_a","startAngle","Math","PI","_b","endAngle","_c","innerRadius","radius","initial","prototype","oneBox","getOneBox","oneWidth","maxX","minX","oneHeight","maxY","minY","left","abs","top","maxRadius","height","width","circleCenter","x","center","y","polarRadius","start","end","getRadius","convertPoint","point","getCenter","isTransposed","convertDim","cos","sin","invertPoint","vPoint","isReflect","m","leftRotate","vStart3","transformMat3","vStart2","angle","angleTo","length","xPercent","yPercent","invertDim","rst","xs","ys","i","min","max","push","apply"],"sources":["../../src/coord/polar.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}